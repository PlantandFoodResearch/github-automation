{
  "projects": [
    {
      "name": "Kea Samples Database",
      "key": "KEA",
      "issues": [
        {
          "summary": "Dynamic Admin-tables interface",
          "key": "KEA-1",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "(Trying out the GitHub issue tracker)\nThe admin interfaces for the Dynamic tables stuff seems to be missing.\n\nWhen we merged Stephan's code for provenance we seemed to have missed the admin stuff for the tables whose names start with 'dynamic_model'.\n\nI also don't understand how these fit in to the scheme of things but it seems that we have an omission.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/1",
          "labels": [],
          "comments": [
            {
              "body": "No, there was never any admin stuff for the dynamic_models app. There is a bit of magic (monkey patching) going on here which we could (should) probably get rid of, and would cause less confusion later if we did.\n\nHe kept the dynamic_models application as a separate application that contains the dynamic_models code. Then the provenance app was added as a wrapper on the top to link the dynamic_models app into kea. The models in the dynamic_models app are monkey patched to appear like they are part of the provenance app. The DynamicModel model is actually appears in the django admin called \"Provenance definitions\" under the provenance app. Ping me on gtalk if you want me to explain it in more detail.\n",
              "author": "will.buick",
              "created": "2014-05-05T01:27:16Z"
            },
            {
              "body": "I removed the magic William talked about to make it simpler and all is now in the provenance application.\n\nHope that William explained how the \"dynamic models\" fit into the scheme of things and all is becoming slowly less confusing.\n",
              "created": "2014-05-08T03:15:47Z"
            }
          ]
        },
        {
          "summary": "Change provenance definition fields are bad",
          "key": "KEA-2",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When editing an already entered provenance definition the list of fields at the bottom does not properly display the fields.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/2",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I think that Stefan has fixed this now\n",
              "author": "zane.gilmore",
              "created": "2014-05-22T23:21:06Z"
            }
          ]
        },
        {
          "summary": "No way of producing spreadsheets from datagrid",
          "key": "KEA-3",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There doesn't appear to be a way of producing a spreadsheet from a datagrid.\nThis is a vital part of the required functionality. \nSo we will need it before we can roll out to live.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/3",
          "labels": [],
          "comments": [
            {
              "body": "Export to excel functionality now available.\n",
              "author": "will.buick",
              "created": "2014-05-09T09:47:14Z"
            }
          ]
        },
        {
          "summary": "mechanism for attaching samples to provenances",
          "key": "KEA-4",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Although the provenance system seems to be coming into shape nicely, we have forgotten a vital step.\n\nWe need to figure out how we attach a given provenance to a sample.\nThe present pedigree provenance for a sample is via a column on the sample table that is a foreign key to a plant.\n\nThis will not work for our new system. \nHow do we attach a provenance to a sample?\nPerhaps some sort of many to many where one half of the many to many defines which provenance is to be attached?\n\nI am fairly certain that we will need to change the sample table so that the Plant column is no longer \"not null\" but maybe we need to add one or two columns to get that connection or just do it via the aforementioned many to many.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/4",
          "labels": [
            "Provenance",
            "Requirement"
          ],
          "comments": [
            {
              "body": "That's what the ProvenanceType table is for. There should be a ForeignKey on the Sample table which links to the ProvenanceType table. If you read my original spec this was all covered. The idea was a nullable ForeignKey to the Plant table and a ForeignKey to the ProvenanceType table. Then when/if the new Provenance code consumes the pedigree data we can remove the Plant ForeignKey from the Sample table.\n",
              "author": "will.buick",
              "created": "2014-05-08T01:35:30Z"
            },
            {
              "body": "Just thinking about this I think that the relationship is many to one.\nMultiple samples could conceivably have one provenance, but I don't think that a sample should have more than one provenance.\n",
              "author": "zane.gilmore",
              "created": "2014-05-08T01:48:20Z"
            },
            {
              "body": "My solution already does exactly this. Each Sample can only ever have one ProvenanceType and a ProvenanceType can have many samples.\n",
              "author": "will.buick",
              "created": "2014-05-08T01:52:42Z"
            },
            {
              "body": "To use the provenance type table for this we will still need some way of identifying which field of what provenance to use.\n\nSo I'm not sure that what Stephan has created will fit with that model as he has made the provenance type a way of grouping provenances.\n",
              "author": "zane.gilmore",
              "created": "2014-05-08T01:54:21Z"
            },
            {
              "body": "Not sure exactly what you mean by the first paragraph. Would be easier to discuss this on hangout rather than here I think.\n",
              "author": "will.buick",
              "created": "2014-05-08T01:58:04Z"
            },
            {
              "body": "Current thinking on this is as follows:\n\nSamples will be linked to provenances using a many-to-many defined on the dynamic model.\n\nThis many-to-many will have to be a many-to-many using a \"through\" table\n\nManyToManyField(Sample, through='SomeProvenanceJoiningTable')\n\nWe require the through table because the foreign key to the sample table must be unique. The \"through\" table looks like this\n\nclass SomeProvenanceJoiningTable(models.Model)\nsome_provenance_joining_table = models.ManyToManyField('ProvenanceTable')\nsample = models.ManyToManyField('Sample', unique=True)\n\nThis allows us to have the database managing relational data integrity rather than using the GenericForeignKey implementation that django provides.\n\nThere is one problem with this solution linking samples to provenances\nthere will be multiple m2m joining tables from sample to provenance\neach one of those joining tables has a unique sample_id column\nbut it's only unique over one table, not across multiple joining tables\nthis means that is is actually still possible to have a sample attached to more than one provenance\n",
              "author": "will.buick",
              "created": "2014-05-08T03:18:00Z"
            },
            {
              "body": "What you describe in code is not a through table. Not sure the samples are all in the same table but if they are could it be possible to use a shared through table for this?\n\nWith the dynamic model you can create this ...\n\n``` python\nclass SharedProvenanceMapping(models.Model):\n    sample = models.ForeignKey('app.Sample', unique=True, null=False, blank=False, index=True)\n    provenance1 = models.ForeignKey('provenance.First', null=True, blank=True, index=True)\n    provenance2 = models.ForeignKey('provenance.Second, null=True, blank=True, index=True)\n    ...\n\nclass First(models.Model):\n    samples = models.ManyToManyField('app.Sample', through='shared.SharedProvenanceMapping')\n    ...\n\nclass Second(models.Model):\n    samples = models.ManyToManyField('app.Sample', through='shared.SharedProvenanceMapping')\n    ...\n```\n\nThe model still allows samples to be attached to >1 provenance, though the way the Django ORM works this should never be a problem. The problem I see is that through tables change the behaviour of the [ORM](https://docs.djangoproject.com/en/1.6/topics/db/models/#intermediary-manytomany) and I can see many problems with them and a dynamic model/admin/import & export approach.\n\nA possible solution, that needs more thought, might be a custom M2M field that always uses the same through table in the way I described, but does not change the default ORM M2M behaviour. The field could filter out sample ids that already have associations, avoiding unique constraint exceptions that would defo pop up otherwise.\n\nAny thoughts?\n",
              "created": "2014-05-08T16:53:13Z"
            },
            {
              "body": "I have been investigating another approach using two more columns on the sample table and a trigger for referential integrity.\nThis means that a sample can only have one provenance, which is as it should be.\n\nThe two columns are:\nProvenanceTable\nProvenanceID\n\nThe provenance table contains the name of the provenance joining table to be used and the provenance id contains the id within that joining table.\nI have written the trigger function and it all looks do-able.\n\n```\nCREATE OR REPLACE FUNCTION checkprovintegrity()\n  RETURNS trigger AS\n$BODY$\nDECLARE\n    TableName varchar;\n    ProvIdentifier int;\n    Plantid int;\n\n    TableNameCount int;\n    IdentifierCount int;\n\nBEGIN\n    TableName := NEW.\"ProvenanceTable\";\n    ProvIdentifier := NEW.\"ProvenanceID\";\n    Plantid := NEW.\"Plant_id\";\n\n    -- if the plant is set then we don't need to check the provenance\n    if Plantid IS NOT Null THEN\n        RETURN NEW;\n    END IF;\n\n    select count(*) into TableNameCount\n        from dynamic_models_dynamicmodel \n        where db_table = TableName;\n\n    if TableNameCount = 0 THEN\n        RAISE EXCEPTION 'Nonexistent Table --> %', TableName USING HINT = 'Please check provenance table name';\n    END IF;\n\n\n    EXECUTE 'SELECT count(*) FROM '||TableName ||' WHERE id = '|| ProvIdentifier\n       INTO IdentifierCount\n       USING TableName,ProvIdentifier;\n\n    if IdentifierCount = 0 THEN\n        RAISE EXCEPTION 'Nonexistent Provenance --> % in Table --> %', ProvIdentifier, TableName \n            USING HINT = 'Please check provenance table name and/or provenance identifier';\n    END IF;\n\n    return NEW;\nEND;\n$BODY$\n  LANGUAGE plpgsql VOLATILE\n  COST 100;\nALTER FUNCTION checkprovintegrity()\n  OWNER TO keaadmin;\n\n```\n",
              "author": "zane.gilmore",
              "created": "2014-05-09T03:09:23Z"
            },
            {
              "body": "Just thinking about, it we can modify this so that the provenance table is a foreign key to the dynamic_models_dynamicmodel table and just use the trigger for checking the provenance id column.\nBut I think that the idea is sound.\nCan anybody see anything wrong with it?\n",
              "author": "zane.gilmore",
              "created": "2014-05-09T03:12:19Z"
            },
            {
              "body": "Good to know that the idea worked. Now that we have a working example at the database level we could possibly look at a custom implementation of django's GenericForeignKey to work with this at the ORM level.\n",
              "author": "will.buick",
              "created": "2014-05-09T03:13:35Z"
            },
            {
              "body": "I think that we have nailed this now\n",
              "author": "zane.gilmore",
              "created": "2014-11-05T00:16:18Z"
            }
          ]
        },
        {
          "summary": "Provenance type admin not working",
          "key": "KEA-5",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I try to create a new provenance type I get:\n\n---\n\nAttributeError at /admin/provenance/provenancetype/add/\n\n'NoneType' object has no attribute '_meta'\n\nRequest Method:     GET\nRequest URL:    http://localhost:8000/admin/provenance/provenancetype/add/\nDjango Version:     1.5.5\nException Type:     AttributeError\nException Value:    \n\n'NoneType' object has no attribute '_meta'\n\nException Location:     /home/zane/programming/virtenv/kea/src/kea/kea/provenance/forms.py in provenance_definitions_choices, line 25\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/5",
          "labels": [],
          "comments": [
            {
              "body": "Do you have stale ContentTypes? Meaning content types for models that once where installed and are now orphaned?\nI will work around those but you should make sure that all content types have an existing model class they can load.\n",
              "created": "2014-05-08T02:52:51Z"
            },
            {
              "body": "I have not yet created any provenance types.\nIf that is what you mean?\n",
              "author": "zane.gilmore",
              "created": "2014-05-08T02:59:21Z"
            },
            {
              "body": "No, he means the content types in django https://docs.djangoproject.com/en/dev/ref/contrib/contenttypes/\n\nIt's a database table that contains information about all django models.\n\nI'm not sure if it's possible to not have a m2m to the contenttypes table to avoid these sort of problems?\n",
              "author": "will.buick",
              "created": "2014-05-08T03:01:53Z"
            },
            {
              "body": "No. It is something special about the Django content types framework \nthat makes it painful to work with.\nOnce I get the tests pass I will push a workaround and you should not \nbe bothered with this anymore.\n\nThough the next time someone runs \"bin/django syncdb\" he should get a \nmessage about those stale content type records I mentioned and should \nconfirm their deletion.\n\nOn Mi 07 Mai 2014 19:59:22 PDT, Zane Gilmore wrote:\n\n> I have not yet created any provenance types.\n> If that is what you mean?\n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/5#issuecomment-42508864.\n",
              "created": "2014-05-08T03:05:26Z"
            },
            {
              "body": "fixed in b29cca668fcacae597e78a0a42d654007cbddbd7\n",
              "created": "2014-05-08T03:11:47Z"
            }
          ]
        },
        {
          "summary": "Add float style fields for provenances",
          "key": "KEA-6",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Could I please have the promised float-style number fields for provenances ASAP?\n\nI am trying to build a first draft of a usable provenance right now and I will be needing it very soon.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/6",
          "labels": [],
          "comments": [
            {
              "body": "Pushed in 9cb766ca3281b36e7ddd5f104e4d8942fb7809d5\n",
              "created": "2014-05-14T02:56:22Z"
            }
          ]
        },
        {
          "summary": "field list for editing provenances is superimposing text on names",
          "key": "KEA-7",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "While editing provenances that already exist. \nThe field name of the fields lists has superimposed text that makes the field names quite unreadable.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/7",
          "labels": [],
          "comments": [
            {
              "body": "Can you tell me what browser and version you use?\nMost likely CSS conflict/issue.\n",
              "created": "2014-05-14T02:57:55Z"
            },
            {
              "body": "Firefox 29.0\nLinux version\n\nBut... the same thing happens on Chromium\nVersion 34.0.1847.116 Ubuntu 14.04 aura (260972)\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T03:08:11Z"
            },
            {
              "body": "fixed in 57b90dae261f1f5b5767a7712550f6171ac919ed\n",
              "created": "2014-05-14T05:05:07Z"
            },
            {
              "body": "This fix appears to have broken things.\nThe provenances have now disappeared and I can't get at the provenance type editor.\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T05:33:51Z"
            },
            {
              "body": "Adding the first few lines of the exception returned when I click on the \"Provenance definitions\" admin link:\n\nDatabaseError at /admin/provenance/provenancedefinition/\n\nrelation \"provenance_provenancedefinition\" does not exist\nLINE 1: SELECT COUNT(*) FROM \"provenance_provenancedefinition\"\n                             ^\n\nRequest Method:     GET\nRequest URL:    http://localhost:8000/admin/provenance/provenancedefinition/\nDjango Version:     1.5.5\nException Type:     DatabaseError\nException Value:    \n\nrelation \"provenance_provenancedefinition\" does not exist\nLINE 1: SELECT COUNT(*) FROM \"provenance_provenancedefinition\"\n                             ^\n\nException Location:     /home/zane/programming/virtenv/kea/eggs/Django-1.5.5-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py in execute, line 54\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T05:37:29Z"
            },
            {
              "body": "Ummm just got your email to my PFR email account, will look at that\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T05:46:19Z"
            }
          ]
        },
        {
          "summary": "Need some time fields in provenances.",
          "key": "KEA-8",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Will need some time fields.\nDateTime and just date.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/8",
          "labels": [],
          "comments": [
            {
              "body": "fixed in a5ffd3644973e4431db2efdc477849f9a3a847bc\n",
              "created": "2014-05-14T03:13:10Z"
            }
          ]
        },
        {
          "summary": "Exception raised on successful provenance changes",
          "key": "KEA-9",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Every time I make a change to an existing provenance or create a new one, I get:\nNoReverseMatch at /admin/provenance/provenancedefinition/\nu'djdt' is not a registered namespace\n\nRestarting django then shows where I have been successful in creating or editing the prov'.\n\nI'm not sure whether this is the same issue as we were talking about where a django restart is required for any changes.\nEither way, we need a more graceful way of dealing with this.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/9",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "djdt is the django debug toolbar.\nNot sure why you it would raise NoReverseMatch. Can you deactivateit \nand see what that will do?\n\nOn Di 13 Mai 2014 21:07:29 PDT, Zane Gilmore wrote:\n\n> Every time I make a change to an existing provenance or create a new\n> one, I get:\n> NoReverseMatch at /admin/provenance/provenancedefinition/\n> u'djdt' is not a registered namespace\n> \n> Restarting django then shows where I have been successful in creating\n> or editing the prov'.\n> \n> I'm not sure whether this is the same issue as we were talking about\n> where a django restart is required for any changes.\n> Either way, we need a more graceful way of dealing with this.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/9.\n",
              "created": "2014-05-14T04:11:16Z"
            },
            {
              "body": "Not sure whether we can run the debug thingy right now.\n",
              "author": "zane.gilmore",
              "created": "2014-05-22T23:19:06Z"
            },
            {
              "body": "I think this can close now\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T04:24:50Z"
            }
          ]
        },
        {
          "summary": "Crop style filtering of data for provenances",
          "key": "KEA-10",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to create a system for ensuring that a user can only see data for a given provenance a la crops.\n\nWe will need a way of selecting which provenance the user wants to see data for and a mechanism for controlling who has access to what provenance.\n\nThis should really be done before we go live properly but for the initial roll-out for Marc Greven (Suavignon Blanc) we can probably live without it.\n\nWe can just use his access to funny-fruit and he can muddle through.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/10",
          "labels": [
            "Datagrid",
            "Provenance",
            "Requirement"
          ],
          "comments": [
            {
              "body": "The access should probably just be given via the app\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T04:15:52Z"
            },
            {
              "body": "Haven't looked much into the way Kea does user permissions and how they \nare handled with the integration of the admin. In a perfect world \nsituation I can create the default model permissions (change, delete, \nadd) in auth.permissions for dynamic models and if you remove all those \npermissions for a user he wont have access to them at all.\n\nCan anyone comment on the way the admin stuff is integrated into Kea?\n\nOn Di 13 Mai 2014 21:15:52 PDT, Zane Gilmore wrote:\n\n> The access should probably just be given via the app\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/10#issuecomment-43040553.\n",
              "created": "2014-05-14T04:27:21Z"
            },
            {
              "body": "Currently there is a CropUser model that maps users to crops. It handles which crops a user has access to. Have a look at the crop app in kea. It contains the form for choosing crops and a middleware that sets the request.crop property. This is a rewrite of Zane's original crop handling code.\n",
              "author": "will.buick",
              "created": "2014-05-14T04:31:40Z"
            },
            {
              "body": "Stefan,\nyes I don't expect you to do this without a great deal of discussion. \nThe mechanism I used was applied after much agony.\nYou will notice that I did not assign this issue to you. This was because we all need to discuss it and argue etc.\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T05:21:04Z"
            },
            {
              "body": "I have started this off by adding three new tables:\n- Provenance : which is the main entity to group the dynamic tables into areas by what they are used for e.g. Sauvignon Blanc or Quarantine\n- ProvenanceUser: the many to many for assigning user access to Provenances\n- ProvenanceList: many to many to group the dynamic tables to the Provenance that attach samples to their provenance\n\nThen adding a form that is basically a copy of the crop-user management form.\nI now need to make an admin form to edit the Provenance table which includes the many to many.\n\nFiltering of the correct data for given provenance also needs to be done along with the pertinent code changes throughout the code base to handle all of this.\n",
              "author": "zane.gilmore",
              "created": "2014-05-27T23:49:27Z"
            },
            {
              "body": "You can filter results in the datagrid by changing the get_search_queryset method in this file\n\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/datagrid/views/provenance_filter.py\n\nThe indexes will need to be changed first to include the provenance data you want to filter on.\n",
              "author": "will.buick",
              "created": "2014-05-28T00:23:06Z"
            },
            {
              "body": "Done now\n",
              "author": "zane.gilmore",
              "created": "2014-11-05T00:17:37Z"
            }
          ]
        },
        {
          "summary": "table name for provenance definitions",
          "key": "KEA-11",
          "status": "Done",
          "description": "Zane can you please verify that the db table is really only created with the name field and not the combination of app_label and name? I am not able to reproduce this.\n\nIf you can please post the values you put into the provenance definition form.\n\nThanks\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/11",
          "labels": [
            "invalid"
          ],
          "comments": [
            {
              "body": "Stefan,\nMany apologies.\nThis is partly a case of PEBKAC and partly a case of me expecting something different to what is reality.\nWill close this.\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T05:24:59Z"
            }
          ]
        },
        {
          "summary": "Ordering of fields in the spreadsheet",
          "key": "KEA-12",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Is there any mechanism we can use to impose an order of the columns in the import and export spreadsheets?\nI am looking at the order of the fields for a provenance table I have just created and there are some very important fields and some not so important fields and the important fields are at the end of a quite large list.\n(this particular provenance table I am expecting to get into the dozens of columns)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/12",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Text based foreign key not working",
          "key": "KEA-13",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have created Prov tables with json e.g.:\n\n---\n\n{\n  \"to\":\"sauv_blanc.Company\",\n  \"to_field\":\"name\"\n}\n\n---\n\nBut when I try to add a row into that table using the name field I get:\n\n---\n\nLine number: 1 - invalid literal for int() with base 10: 'Acme Wines'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/eggs/django_import_export-0.2.2-py2.7.egg/import_export/resources.py\", line 335, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/eggs/django_import_export-0.2.2-py2.7.egg/import_export/resources.py\", line 201, in import_obj\nself.import_field(field, obj, data)\nValueError: invalid literal for int() with base 10: 'Acme Wines'\n\n---\n\nSo it looks like a foreign key type automatically assumes type int.\nCan we put some smarts into things that can do the conversion?\nOr we need another mechanism to achieve the foreign key.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/13",
          "labels": [],
          "comments": [
            {
              "body": "Interesting ... looks like the django-import-export app interferes with \nthe import and most likely does not handle this situation graceful.\nDo you have a full traceback? The position of the exception does not \nmake much sense to me. I will try to replicate this once asap.\n\nOn Mi 14 Mai 2014 16:19:23 PDT, Zane Gilmore wrote:\n\n> I have created Prov tables with json e.g.:\n> \n> ---\n> \n> {\n> \"to\":\"sauv_blanc.Company\",\n> \"to_field\":\"name\"\n> }\n> \n> ---\n> \n> But when I try to add a row into that table using the name field I get:\n> \n> ---\n> \n> Line number: 1 - invalid literal for int() with base 10: 'Acme Wines'\n> \n> Traceback (most recent call last):\n> File\n> \"/home/zane/programming/virtenv/kea/eggs/django_import_export-0.2.2-py2.7.egg/import_export/resources.py\",\n> line 335, in import_data\n> self.import_obj(instance, row, real_dry_run)\n> File\n> \"/home/zane/programming/virtenv/kea/eggs/django_import_export-0.2.2-py2.7.egg/import_export/resources.py\",\n> line 201, in import_obj\n> self.import_field(field, obj, data)\n> ValueError: invalid literal for int() with base 10: 'Acme Wines'\n> \n> ---\n> \n> So it looks like a foreign key type automatically assumes type int.\n> Can we put some smarts into things that can do the conversion?\n> Or we need another mechanism to achieve the foreign key.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/13.\n",
              "created": "2014-05-14T23:27:06Z"
            },
            {
              "body": "Thanks Stefan.\nBut the urgency is not enough to interfere with doctor's visits etc.\nThe scientist will understand in the short term\nThe fix would be nice today but not essential.\n\nThanks,\nZane\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T23:35:49Z"
            },
            {
              "body": "Just tried replacing the Company name with an ID number and then the DB complained:\n\n```\nIntegrityError at /admin/sauv_blanc/vineyard/process_import/\n\ninsert or update on table \"sauv_blanc_vineyard\" violates foreign key constraint \"company_id_refs_name_018520af\"\nDETAIL:  Key (company_id)=(Acme Wines) is not present in table \"sauv_blanc_vineyard\".\n```\n",
              "author": "zane.gilmore",
              "created": "2014-05-14T23:57:16Z"
            },
            {
              "body": "Stefan,\nAs you said in your email the wriong vrsion of import-export is not properly set up in buildout.\nCould you and William please collaborate to get that going correctly?\n\nThanks\n",
              "author": "zane.gilmore",
              "created": "2014-05-21T23:50:27Z"
            }
          ]
        },
        {
          "summary": "Editing column in provenance doesn't drop constraints when required",
          "key": "KEA-14",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I removed  a \"to_field\" entry in the field definition the constraint was not removed in postgres.\n\nNot sure how easy this will be to achieve. If it looks too difficult then perhaps a warning may be the easiest to achieve. Then, because only a developer should be changing provenances then the constraint dropping can be done with PGAdmin3 or similar.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/14",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Moved to 03 milestone as related to others in that milestone.\n",
              "created": "2015-04-16T03:16:36Z"
            },
            {
              "body": "This has become moot with #242\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:34:58Z"
            }
          ]
        },
        {
          "summary": "Process handling Branch Display for 2 splits off parent not correct",
          "key": "KEA-15",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When there are 2 sample splits off parent then the display of the the branching in process execute is not displaying correctly.\nThe second split appears to be coming off the first split.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/15",
          "labels": [
            "Process Handling",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This has been done now.\nHowever we will need to do this in a more organised way.\n",
              "author": "zane.gilmore",
              "created": "2014-11-05T00:19:37Z"
            }
          ]
        },
        {
          "summary": "Previously created provenance disappeared",
          "key": "KEA-18",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "With the last pull the prov that I was working on has now disappeared from the admin page.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/18",
          "labels": [],
          "comments": []
        },
        {
          "summary": "exception on first page after restart",
          "key": "KEA-19",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I fist run runserver and point my browser at the instance I am always getting:\n\n```\nDatabaseError at /\n\ncurrent transaction is aborted, commands ignored until end of transaction block\n\nRequest Method:     GET\nRequest URL:    http://10.38.8.61:8000/\nDjango Version:     1.5.8\nException Type:     DatabaseError\nException Value:    \n\ncurrent transaction is aborted, commands ignored until end of transaction block\n\nException Location:     /home/zane/programming/virtenv/kea/eggs/Django-1.5.8-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py in execute, line 54\n```\n\nAny subsequent pages are OK.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/19",
          "labels": [
            "duplicate"
          ],
          "comments": [
            {
              "body": "I think that this one is gone and was rally just a part of #13 \n",
              "author": "zane.gilmore",
              "created": "2014-05-22T23:14:23Z"
            }
          ]
        },
        {
          "summary": "Setting the page size on datagrid is not working",
          "key": "KEA-20",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I enter a new page size for the data grid the number of displayed rows does not change.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/20",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Just set page size on Samples and it worked.\nThe bug appears to be on populations only.\n",
              "author": "zane.gilmore",
              "created": "2014-05-22T23:38:41Z"
            },
            {
              "body": "Unable to replicate. Set page size works on both populations and samples. Perhaps more specific steps required to trigger the bug?\n",
              "author": "will.buick",
              "created": "2014-05-25T21:23:54Z"
            }
          ]
        },
        {
          "summary": "Date filtering not going as expected",
          "key": "KEA-21",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I enter 2011 --> 2012\nI get records from 2004\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/21",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Just looking at the resultant screen I see an error message:\n\n```\nInvalid filter, try > YYYY\n```\n\nBut when I try this it only seems to show 2011 records.\n",
              "author": "zane.gilmore",
              "created": "2014-05-22T23:32:35Z"
            },
            {
              "body": "I've committed a bugfix for this.\n",
              "author": "will.buick",
              "created": "2014-05-26T00:23:36Z"
            }
          ]
        },
        {
          "summary": "Plate data not correct",
          "key": "KEA-22",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The plate datagrid does not seem to be correct.\n\nThe only crop that appears to have any plates is kiwifruit.\nThis is not correct.\nNot sure what could be wrong here.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/22",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Bugfix for this is committed. You'll need to rebuild the index using the following command.\n\nbin/django populate_index \"extract-plate-data-for-search\" \"plate-data-for-search\" -k 2\n",
              "author": "will.buick",
              "created": "2014-05-25T23:45:11Z"
            }
          ]
        },
        {
          "summary": "Add auto increment option to localID field type",
          "key": "KEA-23",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It would be nice to be able to make it so that localids are incremented automatically a la primary key ids\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/23",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Can you give more information how this is supposed to work with excel imports?\nWould a user defined value be ignored? If not, how would it influence the sequence?\n",
              "created": "2014-05-28T18:13:44Z"
            },
            {
              "body": "Stefan,\nGood point.\nYes if it was made auto-incrementing then the value should not be user defined at all.\nEven to the point where if there was no data already in the table then the data export would either black out the column cells or not include it at all.\n\nPerhaps make it so that any data that was there already is displayed but black out the cells on that column for when the user enters in data. It would make it obvious that they are not to put any values in.\n",
              "author": "zane.gilmore",
              "created": "2014-05-28T22:09:56Z"
            },
            {
              "body": "Stephan,\nHow is this work going?\n",
              "author": "zane.gilmore",
              "created": "2014-06-25T02:47:12Z"
            },
            {
              "body": "This is working now for provenance.\n",
              "created": "2015-04-16T03:15:42Z"
            },
            {
              "body": "Done\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:35:20Z"
            }
          ]
        },
        {
          "summary": "Add minimum digits option to LocalID field type",
          "key": "KEA-24",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When localids are displayed in a list or on a label, it makes it easier to correctly sort them or read them if the correct number of prepended zeroes are added.\n\nSo an option to define what is the minimum number of digits to display would be useful.\n\nThis means that any method that converts the stored integer to it's base 32 equivalent will need to respect this to make it useful.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/24",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "fixed in 764998347b299f41d01b48de65221efb17ae2b22\nAdded a min_length option that will take an integer to define the number of digits, excluding the prefix, to be displayed.\n",
              "created": "2014-05-28T19:04:09Z"
            }
          ]
        },
        {
          "summary": "Find all of the uses of choose widget and replace with datagrid",
          "key": "KEA-25",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to search the code base and replace every use of the home baked choose widget and replace them with datagrids\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/25",
          "labels": [
            "Datagrid",
            "Requirement",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I don't think that there are any more instances of the choose widget left in use now.\n",
              "author": "zane.gilmore",
              "created": "2014-11-05T00:20:47Z"
            }
          ]
        },
        {
          "summary": "Enable the ability to create URLs to datagrid searches",
          "key": "KEA-26",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It would be nice to be able to create a URL that will get the present search on a datagrid.\n\nAt present this URL is written to the second line of a spreadsheet export in the Choose Widget.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/26",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I've committed a fix in for this. It requires using a patched \"forked\" version of the dynatable library that I'm using so you'll need to run buildout before you can test this. The javascript code is altering the page url as you use the interface. Then when you refresh the page it will apply the same filters, page size and pagination choices you had before. I haven't added this into the spreadsheet yet like you mention. I'll let you test it first and if you're happy that it works we can add it into the spreadsheet then.\n",
              "author": "will.buick",
              "created": "2014-05-26T06:17:12Z"
            },
            {
              "body": "Can't see any evidence of what you have done on populations or genotypes.\nWhen I refresh it just basically does a reset search\n",
              "author": "zane.gilmore",
              "created": "2014-05-26T23:33:21Z"
            },
            {
              "body": "And yes I did do a git pull and a buildout\n",
              "author": "zane.gilmore",
              "created": "2014-05-26T23:34:06Z"
            },
            {
              "body": "This is working for me. When you are adding filters, changing pages etc it should be updating the GET params in the page url. Then when you reload the page it should show the same state.\n",
              "author": "will.buick",
              "created": "2014-05-26T23:35:33Z"
            },
            {
              "body": "This issue was traced to searches that contain the % character that causes malformed urls. This functionality has been disabled for the next release and we will revisit this issue later. Apart from the % character issue this functionality works as expected.\n",
              "author": "will.buick",
              "created": "2014-05-28T00:04:24Z"
            },
            {
              "body": "Darryl has now created a mechanism for creating URLs to specific searches now.\n",
              "author": "zane.gilmore",
              "created": "2014-11-05T00:21:57Z"
            }
          ]
        },
        {
          "summary": "Datagrid sorting is not working",
          "key": "KEA-27",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I do an order by LocalID and set them to 50 records at a time then look thru the pages, the pages do not not match with the choose widget which I do the same on.\n\nIt appears to be a sorting issue:\n\n```\nOld Choose  New Datagrid\nPOP0Y1D POP0Y1D\nPOP0Y26     POP0Y2K\nPOP0Y2K     POP0Y26\nPOP0Y46     POP0Y46\nPOP0Y47     POP0Y47\nPOP0Y48     POP0Y49\nPOP0Y49     POP0Y48\nPOP0Y6W POP0Y6Y\nPOP0Y6Y     POP0Y6Z\nPOP0Y6Z     POP0Y6W\n```\n\nAs you can see my old choose widget seems to be getting it right.\nBut the datagrid seems to shuffling things up.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/27",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "I suspect what is happening is your choose widget is ordering by localid in the database when the localid is being stored as an integer. I'm storing the localid as a base32 encoded string and it's trying to order on that. That would explain the problem? It's the only thing I can think of. The solution would be to store the local id as an integer in elasticsearch then post process it before displaying it in the datagrid. This does add extra overhead in processing time because some of those local id's require database queries to render. That's overhead that we're trying to avoid.\n",
              "author": "will.buick",
              "created": "2014-05-26T05:21:38Z"
            },
            {
              "body": "But if you store it as an integer how are you supposed to filter on it? So that won't work. I have no idea how to solve this at the moment. Any ideas are welcome.\n",
              "author": "will.buick",
              "created": "2014-05-26T05:27:18Z"
            },
            {
              "body": "William,\nAs far as I can tell the base32 and the integer should sort in the same order.\nI can't see why it shouldn't\nIf you look at the entries I listed above they are not in the correct order for either integer or base32\nTo me it looks like something else is going wrong.\n",
              "author": "zane.gilmore",
              "created": "2014-05-26T23:08:55Z"
            },
            {
              "body": "FYI\nhttp://localhost:8000/populations/search/?sorts[population_local_id]=-1\nworks\nhttp://localhost:8000/populations/search/?sorts[population_local_id]=1\ndoes not work\n\nSo the reversal of the sort produces a correctly sorted reverse sort but the sort without the minus sign does not.\n",
              "author": "zane.gilmore",
              "created": "2014-05-27T00:34:12Z"
            },
            {
              "body": "Maybe this might be what we need?\n\nhttp://stackoverflow.com/questions/14044074/sorting-results-in-elastic\n",
              "author": "zane.gilmore",
              "created": "2014-05-27T01:19:25Z"
            },
            {
              "body": "You might be onto something there. That adds a lot more complexity though and would take a while to implement.\n",
              "author": "will.buick",
              "created": "2014-05-27T01:21:36Z"
            },
            {
              "body": "Let's leave it for now.\nWe will need to get it fixed soon though.\n",
              "author": "zane.gilmore",
              "created": "2014-05-27T02:36:43Z"
            }
          ]
        },
        {
          "summary": "The sorting arrow is in wrong direction",
          "key": "KEA-28",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Although this may be debatable...\n\nThe arrow denoting that the column is being sorted is in the wrong direction.\nThe usual convention is that the arrow indicates the direction of increase.\n\nI think that that may be be what will give the least confusion.\n\nThe converse may be that the triangle denotes the apex is smaller going to the base which is larger but this is not conventional. Maybe to remove confusion might be to use the carat (^) and it's reverse like I do in the Choose widget.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/28",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "I think that what you have done now is change no arrow to down and down arrow to not sorted.\n",
              "author": "zane.gilmore",
              "created": "2014-05-28T04:59:37Z"
            },
            {
              "body": "That seems strange because I just reversed the sorting in the python code. This could perhaps indicate a bug in the javascript code somewhere.\n",
              "author": "will.buick",
              "created": "2014-05-28T05:01:18Z"
            },
            {
              "body": "When you click on the name of the column successively the column seems to be sorted when the arrow disappears and when the arrow points down the sorting appears to disappear.\n\nThis may be a part of #27 \n",
              "author": "zane.gilmore",
              "created": "2014-05-28T05:13:31Z"
            },
            {
              "body": "This appears to be OK now.\nSo am closing it.\n",
              "author": "zane.gilmore",
              "created": "2014-06-22T23:56:53Z"
            }
          ]
        },
        {
          "summary": "Population admin form throwing exception",
          "key": "KEA-29",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The population admin form is going straight to error:\n\n```\nAttributeError at /admin/pndata/population/844/\n\n'ChooseParentPlantView' object has no attribute 'search_index'\n\nRequest Method:     GET\nRequest URL:    http://localhost:8000/admin/pndata/population/844/\nDjango Version:     1.5.8\nException Type:     AttributeError\nException Value:    \n\n'ChooseParentPlantView' object has no attribute 'search_index'\n\nException Location:     /home/zane/programming/virtenv/kea/src/kea/kea/choose/views.py in get_context_data, line 32\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/29",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Not just for populations but also for genotypes and plants\n",
              "author": "zane.gilmore",
              "created": "2014-05-27T02:47:03Z"
            },
            {
              "body": "Both sample initialisation forms are also showing the same error.\n",
              "author": "zane.gilmore",
              "created": "2014-05-27T02:50:36Z"
            },
            {
              "body": "Fixed.\n",
              "author": "will.buick",
              "created": "2014-05-28T00:00:48Z"
            }
          ]
        },
        {
          "summary": "Errors in import prov' type not informative enough",
          "key": "KEA-30",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The list of errors given for faulty data in an import spreadsheet gives the line number, which should be \"row\" number and not many clues as to what field was the offending one.\n\nAlso the errors should be user informative not a call stack from an exception.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/30",
          "labels": [
            "Provenance",
            "bug",
            "question"
          ],
          "comments": [
            {
              "body": "Fixed in 783300b4f3e446ec543fca3a4e898996179d09be\n",
              "created": "2014-05-29T04:43:44Z"
            },
            {
              "body": "Only the first error on the first failing column is shown, if that is not enough please reopen.\n",
              "created": "2014-05-29T04:45:11Z"
            },
            {
              "body": "Sorry Stephan.\nNo it is not good enough.\nWe need to know which column is creating the error, otherwise there is no way of telling which one it was.\n",
              "author": "zane.gilmore",
              "created": "2014-06-25T02:53:06Z"
            },
            {
              "body": "Errors are now displaying in the following format (example):\n\nLine number: 1 harvester_speed Invalid literal for Decimal: u'Wrong!'\nLine number: 2 harvester_brand Value u'Not a brand!' is not a valid choice.\n\nI hope that helps.\nDarryl\n",
              "created": "2015-02-25T23:50:47Z"
            },
            {
              "body": "Could you please add quotes around the column names.\n",
              "author": "zane.gilmore",
              "created": "2015-03-02T22:52:36Z"
            },
            {
              "body": "The \"required\" reporting on the Import confirmation screen is probably not going to be sufficient.\nI think that that needs to be reported as an error.\n\nPlease correct me if I am wrong but there seems to be a \"required\" string put into a field when the entity has to be found elsewhere. Then a strike-through   is put onto that string when it is found.\n\nWe need to say something like \"Found\" instead and also report an error if it is not found.\n\nPerhaps by highlighting it in the confirmation in red?\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T23:58:14Z"
            },
            {
              "body": "Also, I like the error reporting otherwise. You are bolding the column name which is good. So don't worry about the quotes around the column name.\n",
              "author": "zane.gilmore",
              "created": "2015-03-04T00:00:04Z"
            },
            {
              "body": "Righto. 窶亀he only thing remaining to be corrected here is for the ForeignKeyWidget, which tries to be informative if the object as not been created yet during the confirm step of the sample initialisation wizard. But again this is only a problem only if we retain multi-sheet excel imports during provenance sample initialisation which I'm pushing for discarding (see #124). \n",
              "created": "2015-03-09T21:33:38Z"
            },
            {
              "body": "issues #234 and #235 are now covering this\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:36:26Z"
            }
          ]
        },
        {
          "summary": "Uploading Prov types choking on textual  foreign keys",
          "key": "KEA-31",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After uploading this file:\nhttps://drive.google.com/file/d/0B4TupZPfpeyxcXpjS2N1MHR6RWc/edit?usp=sharing\n\nI got a list of these errors:\n\n```\nLine number: 1 - [u\"'' value must be an integer.\"]\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 335, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 201, in import_obj\nself.import_field(field, obj, data)\nValidationError: [u\"'' value must be an integer.\"]\n```\n\nFor each line.\nThis looks like the same issue that was occurring with the single table imports when I was using the wrong version of import export.\nIncidentally it works OK for the single table import.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/31",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I am still having problems here.\nStephan,\nWith that last DB dump, could you try to upload some data via prov' type?\nEspecially using the type I created for the Sauvignon Blanc stuff.\n",
              "author": "zane.gilmore",
              "created": "2014-06-19T03:09:30Z"
            },
            {
              "body": "Hi Zane,\n\nI will check that tomorrow. If you have a traceback or any other \ndetails about the problems you have please share.\n\n-stj\n\nOn Mi 18 Jun 2014 20:09:30 PDT, Zane Gilmore wrote:\n\n> I am still having problems here.\n> Stephan,\n> With that last DB dump, could you try to upload some data via prov' type?\n> Especially using the type I created for the Sauvignon Blanc stuff.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/31#issuecomment-46519315.\n",
              "created": "2014-06-19T05:11:51Z"
            },
            {
              "body": "The reported error for each row looks like:\nRow number: 1 - Column:\nModel company with pk u'SauvBlank R Us' does not exist.\n\nSorry no traceback.\nThere is also another bug which I will put in another issue to do with the file submission.\n",
              "author": "zane.gilmore",
              "created": "2014-06-19T22:10:02Z"
            },
            {
              "body": "Just thinking about it...\nDid you say that the foreign key to use must be set as the primary key?\nBecause those columns are only set as unique not null etc\n",
              "author": "zane.gilmore",
              "created": "2014-06-19T22:11:40Z"
            },
            {
              "body": "No, the primary key is set by django. You need to make it unique, though.\nﾂ\nI have to look at the issue and how postgres does FK checks. Might need to come up with an ordered import where spreadsheets are loaded according to their relations. Am hoping with postgres I don't need go down that path because postgres does FK checks on commit IMO not like MySQL on insert/update.\nﾂ\n\non Jun 19, 2014, Zane Gilmore notifications@github.com wrote:\n\nJust thinking about it... Did you say that the foreign key to use must be set as the primary key? Because those columns are only set as unique not null etc\n窶燃eply to this email directly or view it on GitHub.\n",
              "created": "2014-06-19T22:21:14Z"
            },
            {
              "body": "I have had no problems in the past.\nAFAIK any checks like that should be OK within the same transaction.\n\nAny previous insert should be seen for integrity checks.\n\nOn 20 June 2014 10:21, stj notifications@github.com wrote:\n\n> No, the primary key is set by django. You need to make it unique, though.\n> \n> I have to look at the issue and how postgres does FK checks. Might need to\n> come up with an ordered import where spreadsheets are loaded according to\n> their relations. Am hoping with postgres I don't need go down that path\n> because postgres does FK checks on commit IMO not like MySQL on\n> insert/update.\n> \n> on Jun 19, 2014, Zane Gilmore notifications@github.com wrote:\n> \n> Just thinking about it... Did you say that the foreign key to use must be\n> set as the primary key? Because those columns are only set as unique not\n> null etc\n> 窶燃eply to this email directly or view it on GitHub.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/31#issuecomment-46624653\n> .\n",
              "author": "zane.gilmore",
              "created": "2014-06-19T22:34:26Z"
            },
            {
              "body": "I believe that this is now fixed\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:35:34Z"
            }
          ]
        },
        {
          "summary": "Population AltNames not updating for sample, plates or extract plates datagrid",
          "key": "KEA-32",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I added some altnames for a population then checked the other datagrids.\nThe genotype and plant  datagrids updated OK.\n\nThe samples, plates and extract plates one did not\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/32",
          "labels": [],
          "comments": [
            {
              "body": "Should have this one sorted now. Everything seems to be updating correctly through celery. It's currently taking just over a minute to update the search index when you save a PopulationAltName. The PopulationAltName I saved updated about 1600 records in the elasticsearch index in multiple mapping types.\n\nNot going to close this just yet, but it's ready for testing.\n",
              "author": "will.buick",
              "created": "2014-06-04T07:34:19Z"
            },
            {
              "body": "This should be good now\n",
              "author": "zane.gilmore",
              "created": "2014-06-22T23:49:24Z"
            }
          ]
        },
        {
          "summary": "Entries not added after sample initialisation",
          "key": "KEA-33",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I initialised a (single pop) batch none of:\ngenotype\nplant\nor sample \nhad the new entries added to the datagrid.\nThe new rows **were** added to the DB.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/33",
          "labels": [],
          "comments": [
            {
              "body": "The code is trying to update them in the index. The problem is that Creating a new sample batch happens in a single transaction. The post_save model signals are sent when the model is saved but the record is unable to be retrieved from the database until the transaction is submitted. That means that most of the records won't be updated in elasticsearch because the code tries to populate elasticsearch before the transaction is committed and fails because the data in the database isn't available yet.\n\nNo ideas yet how to solve this problem. It's a tricky one.\n",
              "author": "will.buick",
              "created": "2014-05-29T04:53:51Z"
            },
            {
              "body": "The following issue seems to be relevant https://code.djangoproject.com/ticket/14051\n\nDjango 1.6 has new improved transaction management. This should be investigated as a possible solution.\n",
              "author": "will.buick",
              "created": "2014-05-29T05:02:13Z"
            },
            {
              "body": "Also https://code.djangoproject.com/ticket/21803 and https://github.com/carljm/django-transaction-hooks\n",
              "author": "will.buick",
              "created": "2014-05-29T05:05:13Z"
            },
            {
              "body": "Fixed this by using https://github.com/davehughes/django-transaction-signals\n\nWe will need to refactor kea/elasticsearch/signals.py when we upgrade to django 1.6.\n\nUse this library https://django-transaction-hooks.readthedocs.org/en/latest/\n\nWe can quite easily upgrade between the two by doing something like\n\n```\nconnection.on_commit(lambda: some_celery_task.delay('arg1'))\n```\n",
              "author": "will.buick",
              "created": "2014-06-02T23:44:56Z"
            }
          ]
        },
        {
          "summary": "Leftmost column needs that whole row data display a la choosewidget",
          "key": "KEA-34",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The link that Marek did for the choosewidget where clicking on the leftmost cell of a choosewidget displayed the contents of the entire row has been lost with the new datagrid.\n\nWe need to add this at some point.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/34",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This still needs looking at.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:36:38Z"
            },
            {
              "body": "William,\nThis is another feature that we lost with the new datagrid.\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:37:35Z"
            }
          ]
        },
        {
          "summary": "Process run creation uses denorm sample chooser",
          "key": "KEA-35",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The process run creation interface makes use of the old choose widget with the sample denormalised table.\n\nWe will be needing to convert this over to the new datagrid.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/35",
          "labels": [
            "Datagrid",
            "Process Handling",
            "Requirement"
          ],
          "comments": []
        },
        {
          "summary": "All created processruns have crop 15 set (funnyfruit)",
          "key": "KEA-36",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The crop for processruns are not being set to the current crop\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/36",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Show all records button on Datagrid",
          "key": "KEA-37",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "An easy way of displaying all of the records on the datagrid.\ni.e. A tick box or similar that when clicked the datagrid expands to list the entire set of records.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/37",
          "labels": [
            "Datagrid",
            "enhancement",
            "wontfix"
          ],
          "comments": [
            {
              "body": "I can understand the reasoning for this, but it's not going to work. There are just too many records. We would have to put an upper limit on it. It's just not possible to load in 100000 records.\n",
              "author": "will.buick",
              "created": "2014-06-06T01:22:21Z"
            },
            {
              "body": "I agree but some sort of warning first may be in order for larger datasets.\nAnd then if they still want the full list then we allow them to download it via some other non-datagrid mechanism.\n\nFor smaller sets though it would be very useful.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:40:25Z"
            },
            {
              "body": "Not convinced this is needed now",
              "author": "zane.gilmore",
              "created": "2017-10-18T00:41:03Z"
            }
          ]
        },
        {
          "summary": "the order of fields in the datagrid for choosing samples for processrun creation",
          "key": "KEA-38",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to make the order of the fields in the datagrid used in the process run creation more convenient for the users.\n\nThe order should start:\nSample LocalID\nSample Altnames\nSample Batch LocalID\nIn plate\nPopulation LocalID\nPopulation Altnames\nSample Container\nSample Date\n\nThe rest of the fields probably won't matter.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/38",
          "labels": [
            "Datagrid",
            "Process Handling",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "there should be a save button at top of page on datagrid",
          "key": "KEA-39",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a data grid is used to choose a large list of entries having the save button only at the bottom is inconvenient.\n\nPutting a save button at the top as well as at the bottom is more convenient.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/39",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I took a slightly different approach to this after investigating the usability of the datagrid in different browsers. Have a look and let me know what you think.\n",
              "author": "will.buick",
              "created": "2014-06-09T10:21:06Z"
            }
          ]
        },
        {
          "summary": "Multi pop population list spreadsheet has black on black headers",
          "key": "KEA-40",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The headers are appearing as black on black in the population list spreadsheet used in the multi-population batch initialisation.\n\nThis appears to only be happening in Excel. This needs to be fixed as Excel is almost exclusively used in Kea.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/40",
          "labels": [],
          "comments": [
            {
              "body": "I have just been looking at your other spreadsheets. \nThey all have this problem.\n\nMy advice is to use my Excel header thingies.\n\nWe are going to need this pretty soon too.\nThere will be big complaints soon.\n",
              "author": "zane.gilmore",
              "created": "2014-06-12T21:41:54Z"
            },
            {
              "body": "I've already fixed it. You'll need to test this though because I don't have ms excel, only libre office.\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/e411dccdae8075ed1cbf2459d96197c67e8813d9\n",
              "author": "will.buick",
              "created": "2014-06-12T21:44:25Z"
            },
            {
              "body": "Exception at /new-batch/initialise/choose-populations/\n\nColumn order does not contain all columns set(['father_plant',\n'mother_plant', 'mother_species', 'experiment', 'breeder', 'funding'])\n\nException Location:\n/home/zane/programming/virtenv/kea/src/kea/kea/datagrid/views/base.py in\nget_column_ordering, line 89\n\nOn 13 June 2014 09:44, wilbuick notifications@github.com wrote:\n\n> I've already fixed it. You'll need to test this though because I don't\n> have ms excel, only libre office.\n> \n> e411dcc\n> https://github.com/PlantandFoodResearch/Kea/commit/e411dccdae8075ed1cbf2459d96197c67e8813d9\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/40#issuecomment-45952089\n> .\n",
              "author": "zane.gilmore",
              "created": "2014-06-12T21:53:20Z"
            },
            {
              "body": "I get that exception when I try to create a new multi-pop batch\n\nOn 13 June 2014 09:53, Zane Gilmore zane.gilmore@gmail.com wrote:\n\n> Exception at /new-batch/initialise/choose-populations/\n> \n> Column order does not contain all columns set(['father_plant',\n> 'mother_plant', 'mother_species', 'experiment', 'breeder', 'funding'])\n> \n> Exception Location:\n> /home/zane/programming/virtenv/kea/src/kea/kea/datagrid/views/base.py in\n> get_column_ordering, line 89\n> \n> On 13 June 2014 09:44, wilbuick notifications@github.com wrote:\n> \n> > I've already fixed it. You'll need to test this though because I don't\n> > have ms excel, only libre office.\n> > \n> > e411dcc\n> > https://github.com/PlantandFoodResearch/Kea/commit/e411dccdae8075ed1cbf2459d96197c67e8813d9\n> > \n> > 窶能n> > Reply to this email directly or view it on GitHub\n> > https://github.com/PlantandFoodResearch/Kea/issues/40#issuecomment-45952089\n> > .\n",
              "author": "zane.gilmore",
              "created": "2014-06-12T21:55:29Z"
            },
            {
              "body": "Fixed that one too. If you only want to fix the black headings in excel then patch this file on production\n\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/excel/helpers.py\n",
              "author": "will.buick",
              "created": "2014-06-12T22:06:25Z"
            },
            {
              "body": "Sorry William but there is another one now,\n\n```\nTypeError at /new-batch/initialise/None/\n\nobject of type 'int' has no len()\n\nRequest Method:     POST\nRequest URL:    http://10.38.8.61:8000/new-batch/initialise/None/\nDjango Version:     1.5.8\nException Type:     TypeError\nException Value:    \n\nobject of type 'int' has no len()\n\nException Location:     /home/zane/programming/virtenv/kea/src/kea/kea/excel/helpers.py in write, line 115\n```\n",
              "author": "zane.gilmore",
              "created": "2014-06-12T23:26:00Z"
            },
            {
              "body": "It's OK William I have fixed it by wrapping the value sent to the len function with str()\n",
              "author": "zane.gilmore",
              "created": "2014-06-12T23:37:17Z"
            },
            {
              "body": "And the Headers are now working well with Excel.\n",
              "author": "zane.gilmore",
              "created": "2014-06-12T23:38:08Z"
            },
            {
              "body": "I've added in one more fix for that. Just enforcing a maximum column width for xlwt which was a problem I had. Are there any more problems with the release?\n",
              "author": "will.buick",
              "created": "2014-06-13T00:28:00Z"
            },
            {
              "body": "Closing this now\n",
              "author": "zane.gilmore",
              "created": "2014-06-22T23:47:52Z"
            }
          ]
        },
        {
          "summary": "After initial import of prov-type file there is no confirmation button",
          "key": "KEA-41",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After the initial import of a provenance type file, the data from the file is nicely displayed in the tabbed area at bottom of screen.\nHowever there doesn't seem to be a button to confirm the import.\n\nI am assuming that the confirmation button will only work if there are no issues with any of the tabs. However if there is no issue with the top tab then there is no indication of there being any problems with any of the presently hidden tabs.\n\nCould you please put some warning or error message independent of the tabs saying something like \"there were problems with this file\" or similar please? And/or perhaps write the title of the problematic tabs in red letters or background.\n\nI am describing this as a bug because although it is functional it is a user interface bug.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/41",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "I think that this is fixed\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:41:24Z"
            }
          ]
        },
        {
          "summary": "Provenence import does not handle dates",
          "key": "KEA-42",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have tried everything.\nI have tried to upload the data formatted as date values, and as strings.\n\nThere does not seem to be any way of structuring the data in any way that is acceptable.\nIf I upload it as date it complains that it wants a string not a float.\n\nIf I structure it as a string then it complains it is not in the right format.\nThis will not work.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/42",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Did some research about this to figure out what is going on. With the \ninformation Zane gave me that dates are stored in excel as integers I \nfound this post http://www.cpearson.com/excel/datetime.htm . This isn't \nideal but since we are the creating source for the excel workbook I \nfeel it is save to assume that dates start from 1900 NOT 1904.\n\nOn Di 24 Jun 2014 21:14:12 PDT, Zane Gilmore wrote:\n\n> I have tried everything.\n> I have tried to upload the data formatted as date values, and as strings.\n> \n> There does not seem to be any way of structuring the data in any way\n> that is acceptable.\n> If I upload it as date it complains that it wants a string not a float.\n> \n> If I structure it as a string then it complains it is not in the right\n> format.\n> This will not work.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/42.\n",
              "created": "2014-06-26T03:12:05Z"
            },
            {
              "body": "Stefan,\nxlrd and xlwt should do the date handling for you. (import/export should\ntoo)\nThe main thing is that you know what the the type of the cell _should_ be\nand are duly dealt with.\n\nI have had a great deal of trouble dealing with Excel dates too.\nIf you have a look at pndata/processExcel.py line 1731 -> line 1794 you can\nget a insight into the painful world of importing date data from\nspreadsheets.\n\nFeel free to create a decent method for extracting dates from a known date\ncell using this code as a starting point.\n\nNote the use of \"xldate_as_tuple()\" on line 1780 which IIRC is in xlrd\n\nAlso the regex for pulling apart strings (line 1749) is pretty primitive\ntoo but it works most of the time :-/\n\nOn 26 June 2014 15:12, stj notifications@github.com wrote:\n\n> Did some research about this to figure out what is going on. With the\n> information Zane gave me that dates are stored in excel as integers I\n> found this post http://www.cpearson.com/excel/datetime.htm . This isn't\n> ideal but since we are the creating source for the excel workbook I\n> feel it is save to assume that dates start from 1900 NOT 1904.\n> \n> On Di 24 Jun 2014 21:14:12 PDT, Zane Gilmore wrote:\n> \n> > I have tried everything.\n> > I have tried to upload the data formatted as date values, and as strings.\n> > \n> > There does not seem to be any way of structuring the data in any way\n> > that is acceptable.\n> > If I upload it as date it complains that it wants a string not a float.\n> > \n> > If I structure it as a string then it complains it is not in the right\n> > format.\n> > This will not work.\n> > \n> > 窶能n> > Reply to this email directly or view it on GitHub\n> > https://github.com/PlantandFoodResearch/Kea/issues/42.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/42#issuecomment-47183605\n> .\n",
              "author": "zane.gilmore",
              "created": "2014-06-26T22:36:21Z"
            },
            {
              "body": "BTW,\nThis issue is one I see as a very high priority.\nWe need to ensure that we can cover the main data types for import and time\ndata is a big one.\n\nOn 27 June 2014 10:36, Zane Gilmore zane.gilmore@gmail.com wrote:\n\n> Stefan,\n> xlrd and xlwt should do the date handling for you. (import/export should\n> too)\n> The main thing is that you know what the the type of the cell _should_ be\n> and are duly dealt with.\n> \n> I have had a great deal of trouble dealing with Excel dates too.\n> If you have a look at pndata/processExcel.py line 1731 -> line 1794 you\n> can get a insight into the painful world of importing date data from\n> spreadsheets.\n> \n> Feel free to create a decent method for extracting dates from a known date\n> cell using this code as a starting point.\n> \n> Note the use of \"xldate_as_tuple()\" on line 1780 which IIRC is in xlrd\n> \n> Also the regex for pulling apart strings (line 1749) is pretty primitive\n> too but it works most of the time :-/\n> \n> On 26 June 2014 15:12, stj notifications@github.com wrote:\n> \n> > Did some research about this to figure out what is going on. With the\n> > information Zane gave me that dates are stored in excel as integers I\n> > found this post http://www.cpearson.com/excel/datetime.htm . This isn't\n> > ideal but since we are the creating source for the excel workbook I\n> > feel it is save to assume that dates start from 1900 NOT 1904.\n> > \n> > On Di 24 Jun 2014 21:14:12 PDT, Zane Gilmore wrote:\n> > \n> > > I have tried everything.\n> > > I have tried to upload the data formatted as date values, and as\n> > > strings.\n> > > \n> > > There does not seem to be any way of structuring the data in any way\n> > > that is acceptable.\n> > > If I upload it as date it complains that it wants a string not a float.\n> > > \n> > > If I structure it as a string then it complains it is not in the right\n> > > format.\n> > > This will not work.\n> > > \n> > > 窶能n> > > Reply to this email directly or view it on GitHub\n> > > https://github.com/PlantandFoodResearch/Kea/issues/42.\n> > \n> > 窶能n> > Reply to this email directly or view it on GitHub\n> > https://github.com/PlantandFoodResearch/Kea/issues/42#issuecomment-47183605\n> > .\n",
              "author": "zane.gilmore",
              "created": "2014-06-26T22:38:07Z"
            },
            {
              "body": "I am working on this right now and try to figure out what data I get \nback from xlrd & xlwt. My libre office created xls files have returned \nfloats for most columns, even though I put in just an integer. I'd like \nto use a spreadsheet that is created with excel for testing too. Could \nyou send me one for the harvest table with dates, decimals and strings \nin it, please?\n\nOn Do 26 Jun 2014 15:38:07 PDT, Zane Gilmore wrote:\n\n> BTW,\n> This issue is one I see as a very high priority.\n> We need to ensure that we can cover the main data types for import and\n> time\n> data is a big one.\n> \n> On 27 June 2014 10:36, Zane Gilmore zane.gilmore@gmail.com wrote:\n> \n> > Stefan,\n> > xlrd and xlwt should do the date handling for you. (import/export\n> > should\n> > too)\n> > The main thing is that you know what the the type of the cell\n> > _should_ be\n> > and are duly dealt with.\n> > \n> > I have had a great deal of trouble dealing with Excel dates too.\n> > If you have a look at pndata/processExcel.py line 1731 -> line 1794 you\n> > can get a insight into the painful world of importing date data from\n> > spreadsheets.\n> > \n> > Feel free to create a decent method for extracting dates from a\n> > known date\n> > cell using this code as a starting point.\n> > \n> > Note the use of \"xldate_as_tuple()\" on line 1780 which IIRC is in xlrd\n> > \n> > Also the regex for pulling apart strings (line 1749) is pretty\n> > primitive\n> > too but it works most of the time :-/\n> > \n> > On 26 June 2014 15:12, stj notifications@github.com wrote:\n> > \n> > > Did some research about this to figure out what is going on. With the\n> > > information Zane gave me that dates are stored in excel as integers I\n> > > found this post http://www.cpearson.com/excel/datetime.htm . This\n> > > isn't\n> > > ideal but since we are the creating source for the excel workbook I\n> > > feel it is save to assume that dates start from 1900 NOT 1904.\n> > > \n> > > On Di 24 Jun 2014 21:14:12 PDT, Zane Gilmore wrote:\n> > > \n> > > > I have tried everything.\n> > > > I have tried to upload the data formatted as date values, and as\n> > > > strings.\n> > > > \n> > > > There does not seem to be any way of structuring the data in any way\n> > > > that is acceptable.\n> > > > If I upload it as date it complains that it wants a string not a\n> > > > float.\n> > > > \n> > > > If I structure it as a string then it complains it is not in the\n> > > > right\n> > > > format.\n> > > > This will not work.\n> > > > \n> > > > 窶能n> > > > Reply to this email directly or view it on GitHub\n> > > > https://github.com/PlantandFoodResearch/Kea/issues/42.\n> > > \n> > > 窶能n> > > Reply to this email directly or view it on GitHub\n> > > \n> > > https://github.com/PlantandFoodResearch/Kea/issues/42#issuecomment-47183605\n> > > \n> > > .\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/42#issuecomment-47289152.\n",
              "created": "2014-06-27T01:54:14Z"
            },
            {
              "body": "Pushed some changes to the django-import-export repository.\nPlease pull from that branch and try to reproduce the issue.\n",
              "created": "2014-06-27T02:58:37Z"
            },
            {
              "body": "Fixed now\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:41:53Z"
            }
          ]
        },
        {
          "summary": "renaming column appears to just add new column in DB",
          "key": "KEA-43",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I changed the name of a column in a prov table the column was was not changed and there was a new column added to the DB with the same attributes as the old except for the name.\n\nThe export spreadsheet does not include the old column so when an import is attempted you get a postgres error saying that the entry contains an illegal null.\n(I assume that this does not occur for a nullable column)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/43",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Yeah I am not surprised. A rename will look for the migration \nintrospection like a delete and add. In a normal application lifecycle, \non would alter the migration to do a rename not a delete/add to not \nlose data but with the dynamic-on-the-fly-approach I consider this an \nedge case that should be avoided.\n\n From our earlier talks I took that alter tables are something you \nhardly ever do and the system should not put much emphasis on alter \ntable functionality (except add column).\n\nWill have to think about a way to fix this.\n\nOn Mi 25 Jun 2014 18:46:09 PDT, Zane Gilmore wrote:\n\n> When I changed the name of a column in a prov table the column was was\n> not changed and there was a new column added to the DB with the same\n> attributes as the old except for the name.\n> \n> The export spreadsheet does not include the old column so when an\n> import is attempted you get a postgres error saying that the entry\n> contains an illegal null.\n> (I assume that this does not occur for a nullable column)\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/43.\n",
              "created": "2014-06-26T02:57:24Z"
            },
            {
              "body": "done and moot from #242\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:39:41Z"
            }
          ]
        },
        {
          "summary": "New sample batch initialisation doesn't have create new population link.",
          "key": "KEA-44",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the new sample batch initialisation forms were done, the link to create a new population was not added.\nWilliam,\nPlease add this back to the initialisation forms.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/44",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This is in the provenance branch.\n",
              "author": "will.buick",
              "created": "2014-06-27T01:05:26Z"
            }
          ]
        },
        {
          "summary": "We need a way of getting empty import skeleton file",
          "key": "KEA-45",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The import export system does not have a way of getting an empty file to import data into table.\n\nRight now the only way of getting the file is to export the entire contents of the tables delete the contents of the file then adding what you want to import.\nIf you want the e.g. sample table to part of provenance type this will not work.\nOr even when the provenances start to get a reasonable number of rows already added.\n\nSo can you please add a link like  \"get skeleton\" or similar to the import page so the user can download a spreadsheet to enter data into.\n\nThanks,\nZane\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/45",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "I added a checkbox _skeleton_ to the export form. If you check that it will not download any data.\nAgain this is done in the django-import-export repository.\n",
              "created": "2014-06-27T03:14:27Z"
            },
            {
              "body": "That looks good but...\n\nIf I _do_ want to download the data and don't tick the box then the I now get a \"This field is required error\"\n",
              "author": "zane.gilmore",
              "created": "2014-07-14T05:13:37Z"
            },
            {
              "body": "FIxed, _skeleton_ from field no longer **required**.\n",
              "created": "2014-09-10T23:57:36Z"
            }
          ]
        },
        {
          "summary": "Please add: add genotype and add location to add plant form",
          "key": "KEA-46",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "The modifications to the add plant form have left out the add plant and add location links.\n\nThese were Plus symbols next to the input and search widget links for those fields.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/46",
          "labels": [
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Oops,\nThat's the add genotype link in the add plant form.\n",
              "author": "zane.gilmore",
              "created": "2014-06-29T23:28:49Z"
            },
            {
              "body": "Added add link for all choose widgets except locations. Location admin add url throws 404\n\nhttp://localhost:8000/admin/pndata/location/add/\n",
              "author": "will.buick",
              "created": "2014-06-30T03:01:46Z"
            },
            {
              "body": "Yes, the location add stuff is not via the admin interface.\nNot sure whether Marek did that.\n",
              "author": "zane.gilmore",
              "created": "2014-06-30T04:32:44Z"
            },
            {
              "body": "No, it wasn't added before afaik. I can add a button in, I just need to know what url to point it at.\n",
              "author": "will.buick",
              "created": "2014-06-30T04:33:51Z"
            },
            {
              "body": "Don't worry for now.\nI will reopen this issue but the higher priority is now the provenance stuff.\n",
              "author": "zane.gilmore",
              "created": "2014-06-30T04:35:30Z"
            },
            {
              "body": "This should still be done\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:42:22Z"
            }
          ]
        },
        {
          "summary": "Provenance drop down not properly rendering in Firefox",
          "key": "KEA-47",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The drop down box for choosing provenances is not being properly placed and sized when Firefox is used.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/47",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "This appears to be fixed now.\n",
              "author": "zane.gilmore",
              "created": "2014-10-20T20:30:52Z"
            }
          ]
        },
        {
          "summary": "trigger needs setting up for provenancelist table",
          "key": "KEA-48",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The trigger for providing DB level referential integrity in the provenancelist table needs to be set up.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/48",
          "labels": [
            "Provenance",
            "Requirement"
          ],
          "comments": [
            {
              "body": "I think that this is done now\n",
              "author": "zane.gilmore",
              "created": "2014-10-20T20:30:15Z"
            }
          ]
        },
        {
          "summary": "provenance column needs to be added to the samplecontainer and processrun tables",
          "key": "KEA-49",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The provenance column that will connect the samplecontainer and processrun tables to the provenance dynamic tables need to be set up.\n\nWe will only need the reference to the provenance table as they won't require row level connections like the sample table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/49",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "The final decision was to add Provenance to ProcessRun and SampleContainer tables and to add ProvenanceTable (read ProvenanceDefinition) and ProvenanceID (read pk of the row in dynamic table referenced by the ProvenanceDefinition).\n\nClosing.\n",
              "created": "2014-09-11T00:03:21Z"
            }
          ]
        },
        {
          "summary": "Code changes to handle provenances in processrun",
          "key": "KEA-50",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to modify the code that filters processruns to be able to handle the provenance that is to be added in #49 \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/50",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "ProcessRuns filtered by session provenance or crop.\n",
              "created": "2014-09-11T00:04:06Z"
            }
          ]
        },
        {
          "summary": "Code changes to handle provenances in processrun",
          "key": "KEA-51",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to modify the code that filters processruns to be able to handle the provenance that is to be added in #49 \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/51",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Done.\n",
              "created": "2014-09-11T00:04:44Z"
            }
          ]
        },
        {
          "summary": "code changes to handle provenances in samplecontainers",
          "key": "KEA-52",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to look for any code that does any filtering using the crop in sample container and make the necessary changes to accommodate the provenance column added in #49 \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/52",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "I think that this is now been implicitly done now.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:44:36Z"
            }
          ]
        },
        {
          "summary": "location chooser for new plant form only showing addresses",
          "key": "KEA-53",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the magnifying glass is clicked on the new plant form for choosing the location of the plant, only Street Addresses are listed.\nAnd when any of them are chosen and a save attempted an error is returned:\n\n```\nModel location with pk xxxx does not exist.\n```\n\nWhere the xs are the pk of the chosen address.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/53",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "We can't go live with this. So it's pretty high priority\n",
              "author": "zane.gilmore",
              "created": "2014-07-03T03:17:43Z"
            },
            {
              "body": "The location list is now empty\n",
              "author": "zane.gilmore",
              "created": "2014-07-04T01:21:01Z"
            },
            {
              "body": "Not for me. On this page choosing a location works just fine. I'm testing this against the master branch if that makes any difference.\n\nhttp://localhost:8000/admin/pndata/plant/add/\n",
              "author": "will.buick",
              "created": "2014-07-04T01:25:10Z"
            },
            {
              "body": "Sorry hadn't built indexes\n",
              "author": "zane.gilmore",
              "created": "2014-07-04T01:44:50Z"
            }
          ]
        },
        {
          "summary": "Process run list (Browse ProcessRuns) is showing child processruns",
          "key": "KEA-54",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The list of process runs after clicking the Processes menu link should not be showing any child processes.\n\nThe filter should be looking at the \"IsFirstDegree\" column of the Process table.\nThis is causing major problems for a number of users right now.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/54",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "This is still not fixed.\nIn fact it may be that the list of processruns is the inverse of what we want.\nWe need to talk about this.\n\nProcessruns are created for every parent processrun.\nWe only want the parents being listed here.\n",
              "author": "zane.gilmore",
              "created": "2014-07-10T00:02:20Z"
            },
            {
              "body": "The code that builds the queryset that filters the search results is here\n\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/process/views/processrun.py#L153.\n\nIf it's not correct then you'll have to advise how it should be.\n",
              "author": "will.buick",
              "created": "2014-07-10T00:05:27Z"
            },
            {
              "body": "This appears to be fixed now\n",
              "author": "zane.gilmore",
              "created": "2014-11-10T00:58:34Z"
            }
          ]
        },
        {
          "summary": "After saving a new genotype popup is blank",
          "key": "KEA-55",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a new genotype is created in the datagrid create new and the save is clicked the window does not close or give any feed back about a successful save.\n\nYou only get a blank window that must then be closed.\nCan we either give a success message saying that the window can be closed or perhaps just close the window automatically.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/55",
          "labels": [
            "Datagrid",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "This is currently in the provenance branch. I've only added it to the samples initialisation page at the moment. You can test it here.\n\nhttp://localhost:8000/samples/initialisation/\n\nGive me a list of places in the code where this needs to be implemented and I'll get it done.\n",
              "author": "will.buick",
              "created": "2014-07-08T06:48:14Z"
            }
          ]
        },
        {
          "summary": "Plant datagrid needs isaparent column",
          "key": "KEA-56",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to add the isaparent column to the Plant datagrid.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/56",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "Sorry to be a PITA.\nBut could you please put that column in at about number 5?\nWhen I saw it, it become obvious that it is a column that is likely to be used more than many of the others so it needs to be more accessible.\nJust after \"Date Planted\", I think.\n\nSorry again.\n",
              "author": "zane.gilmore",
              "created": "2014-07-04T01:30:30Z"
            }
          ]
        },
        {
          "summary": "index rebuild command needs switch to list all indexes",
          "key": "KEA-57",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It would be useful to have a switch or separate command that just lists all of the buildable indices for elastic search.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/57",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This is done but I haven't pushed yet until after you release to live. Going to close.\n",
              "author": "will.buick",
              "created": "2014-07-04T04:21:03Z"
            }
          ]
        },
        {
          "summary": "Can't create new populations from sample init",
          "key": "KEA-58",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I try to create a new population from the sample initialisation form all I get are 500 errors.\nHere is an exception from an email\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/contrib/admin/options.py\", line 372, in wrapper\n    return self.admin_site.admin_view(view)(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/views/decorators/cache.py\", line 89, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/contrib/admin/sites.py\", line 202, in inner\n    return view(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/db/transaction.py\", line 223, in inner\n    return func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/contrib/admin/options.py\", line 1010, in add_view\n    return self.response_add(request, new_object)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/contrib/admin/options.py\", line 833, in response_add\n    (escape(pk_value), escapejs(obj)))\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/utils/functional.py\", line 196, in wrapper\n    return func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.8-py2.7.egg/django/utils/html.py\", line 64, in escapejs\n    return mark_safe(force_text(value).translate(_js_escapes))\n\nTypeError: expected a character buffer object\n\n\n<WSGIRequest\npath:/admin/pndata/population/add/,\nGET:<QueryDict: {u'_popup': [u'1']}>,\nPOST:<QueryDict: {u'altnames-0-AltName': [u''], u'altnames-1-Population': [u''], u'population_local_id': [u'', u'', u'', u''], u'date_planted': [u'', u'', u'', u''], u'altnames-1-AltNameType': [u''], u'altnames-2-id': [u''], u'population_altnames': [u'', u'', u'', u''], u'MotherParentPlant': [u''], u'Experiment': [u'28'], u'PollenParentPlant': [u''], u'altnames-2-AltNameType': [u''], u'genotype_altnames': [u'', u'', u'', u''], u'altnames-2-AltName': [u''], u'altnames-1-id': [u''], u'_save': [u'Save'], u'location_name': [u'', u'', u'', u''], u'Description': [u'yowzah yowzah'], u'altnames-__prefix__-AltName': [u''], u'import_date': [u'', u'', u'', u''], u'date_dead': [u'', u'', u'', u''], u'altnames-2-Population': [u''], u'csrfmiddlewaretoken': [u'djd9fS8JiKr0i8FHoHZPsIQeSIBku1uX'], u'altnames-MAX_NUM_FORMS': [u'1000'], u'altnames-__prefix__-id': [u''], u'plant_local_id': [u'', u'', u'', u''], u'altnames-1-AltName': [u''], u'plant_description': [u'', u'', u'', u''], u'Breeder':\n  [u'24'], u'father_plant': [u'', u'', u'', u''], u'altnames-0-id': [u''], u'altnames-__prefix__-AltNameType': [u''], u'altnames-0-Population': [u''], u'DateOfCross': [u'2014-07-08'], u'plant_altnames': [u'', u'', u'', u''], u'Crop': [u'15'], u'mother_plant': [u'', u'', u'', u''], u'_popup': [u'1'], u'altnames-__prefix__-Population': [u''], u'altnames-TOTAL_FORMS': [u'3'], u'altnames-0-AltNameType': [u''], u'altnames-INITIAL_FORMS': [u'0']}>,\nCOOKIES:{'csrftoken': 'djd9fS8JiKr0i8FHoHZPsIQeSIBku1uX',\n 'sessionid': '764qq0n4ji3ozxb2uf3rrieojl4sk99s',\n 'username': 'cflzjg'},\nMETA:{'CONTENT_LENGTH': '9320',\n 'CONTENT_TYPE': 'multipart/form-data; boundary=---------------------------1312425732022432204649593513',\n u'CSRF_COOKIE': u'djd9fS8JiKr0i8FHoHZPsIQeSIBku1uX',\n 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'csrftoken=djd9fS8JiKr0i8FHoHZPsIQeSIBku1uX; sessionid=764qq0n4ji3ozxb2uf3rrieojl4sk99s; username=cflzjg',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_REFERER': 'http://keatest.pfr.co.nz/admin/pndata/population/add/?_popup=1',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:30.0) Gecko/20100101 Firefox/30.0',\n 'HTTP_X_FORWARDED_FOR': '10.38.8.61',\n 'HTTP_X_FORWARDED_HOST': 'keatest.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'keatest.pfr.co.nz',\n 'PATH_INFO': u'/admin/pndata/population/add/',\n 'QUERY_STRING': '_popup=1',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'POST',\n 'REQUEST_URI': '/admin/pndata/population/add/?_popup=1',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb21.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb21.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x12bf0c0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x33752d0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/58",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "I don't think this has anything to do with the sample init at all. There is nothing to indicate that in the stack trace. Could you try to replicate this error by adding it using the normal admin interface?\n\nhttp://kea.pfr.co.nz/admin/pndata/population/add/\n\nTo me it looks like submitting some invalid data. This might be caused by a bug in the javascript code somewhere or invalid configuration of the Population model admin class in pndata/admin.py\n",
              "author": "will.buick",
              "created": "2014-07-08T00:23:14Z"
            },
            {
              "body": "This is very strange.\nI went to the admin add population and it worked.\nThen I went to the sample init and the add population worked.\n\nI can no longer replicate the bug!\nBut I am not happy to close it until I have some sense of what went wrong initially\n",
              "author": "zane.gilmore",
              "created": "2014-07-08T01:10:37Z"
            },
            {
              "body": "Heisenbug\n",
              "author": "will.buick",
              "created": "2014-07-08T01:13:40Z"
            },
            {
              "body": "Bloody Heisenberg!\n",
              "author": "zane.gilmore",
              "created": "2014-07-08T01:18:24Z"
            },
            {
              "body": "We can re-open this if needs be\n",
              "author": "zane.gilmore",
              "created": "2014-11-04T23:12:37Z"
            }
          ]
        },
        {
          "summary": "column headers and data not aligning in processrun data display",
          "key": "KEA-59",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The column headers in the data display for the execute processrun pages are not aligning properly.\nWhen one the column headers are resized then they magically realign.\nNot sure what's going on here, they worked before.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/59",
          "labels": [
            "Process Handling",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "We have found out that this only occurs in Chrome/Chromium\n",
              "author": "zane.gilmore",
              "created": "2014-07-10T01:32:57Z"
            },
            {
              "body": "This appears to be fixed now\n",
              "author": "zane.gilmore",
              "created": "2014-11-10T01:27:01Z"
            }
          ]
        },
        {
          "summary": "Please set colour scheme back to how it was before Bootstrap",
          "key": "KEA-60",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After you set the menuing to use Bootstrap the look and feel of the app has changed.\n\nPlease set the colour scheme back to how it was and we need to discuss the changes that you have made.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/60",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "no lists from indexes working at all",
          "key": "KEA-61",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There doesn't appear to be any pages that take their data from the elastic search indices that are working.\n\nI have rebuilt all of the indices after a git pull and there is no data being displayed.\nThe symptom is that the pages are rendering properly but all lists are empty.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/61",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Did you run buildout? I suspect this could be that javascript error I mentioned to you earlier. It also depends on what branch that you are using. Each branch has a different path to the js file. I've included the file with reference to the line in question so you can see. The file in the provenance branch uses the new path to the js file which is correct (works in my development env at least).\n\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/templates/base.html#L34\nhttps://github.com/PlantandFoodResearch/Kea/blob/provenance/src/kea/kea/templates/base.html#L27\n",
              "created": "2014-07-22T04:01:28Z"
            },
            {
              "body": "Sorry, for any confusion that comment was from William, I'm logged in as encode's github account for some reason.\n",
              "created": "2014-07-22T04:02:30Z"
            },
            {
              "body": "Thanks for that, it's now working\n",
              "author": "zane.gilmore",
              "created": "2014-07-22T04:13:16Z"
            }
          ]
        },
        {
          "summary": "Successful import report says \"Created population POP0000\"",
          "key": "KEA-62",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After the EBrida file has been successfully imported the import report says  \"Created population POP0000\" before each time a new placeholder population is created.\n\nThis is obviously not a show stopper but it may cause confusion and it looks wrong.\nDoes it have any actual meaning?\n\nPlease note this is low priority right now.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/62",
          "labels": [
            "EBrida_interface",
            "UI Issue",
            "invalid",
            "question"
          ],
          "comments": [
            {
              "body": "Yes, it has meaning. It creates a population then the placeholder pedigree data is created for the mother parent plant and/or pollen parent plant for that population. Yes, it's confusing but all it's saying is exactly what got created in the order that it was created.\n",
              "created": "2014-08-12T23:25:26Z"
            },
            {
              "body": "we could move it to logger.debug instead of info, but then the creation log would not be complete on the info level as per the previous comment.\n",
              "created": "2014-08-12T23:32:43Z"
            },
            {
              "body": "No worries then let's leave it.\n",
              "author": "zane.gilmore",
              "created": "2014-08-12T23:39:21Z"
            }
          ]
        },
        {
          "summary": "Pedigree item should be genotype altname not plant altname",
          "key": "KEA-63",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The Column named \"Pedigree Item\" is being set as the plant altname.\nIt should be set as the genotype altname.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/63",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Crop drop down needs to be alphabetical",
          "key": "KEA-64",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The drop down where users choose which crop they are working on needs to be alphabetically sorted.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/64",
          "labels": [
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Plate maps in EBrida blank wells are b1 and c1 not a1 and b1",
          "key": "KEA-65",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The first two wells in the platemaps on the EBrida Batch spreadsheet should be blank (A1 and B1)\nRight now A1 is populated and B1 and C1 are blank.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/65",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Datagrid page format needs work",
          "key": "KEA-66",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The listing of data in the page of a datagrid needs to be denser and the listing manipulation widgets need to be put at the bottom of the page.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/66",
          "labels": [
            "Datagrid",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Done.\n",
              "created": "2014-09-29T04:15:26Z"
            }
          ]
        },
        {
          "summary": "Need location-type entry in Ebrida upload form",
          "key": "KEA-67",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "This is something I did not think of earlier and I'm sorry :-/\n\nWhen the Trayplate prefix is not given in the \"Group\" column then the location-type cannot be assumed to be a sample tray.\nSo we need to have some way for the user to be able to, say, apply orchard tree positions to plants if they want.\n\nWilliam, we need to discuss this at a bit more length as I think we may be able to make this obviate the need for the Trayplate prefix.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/67",
          "labels": [
            "EBrida_interface"
          ],
          "comments": []
        },
        {
          "summary": "Single sample-container-type drop-down not filtering out plates",
          "key": "KEA-68",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The drop down for \"Single sample container type\" is not filtering out the types containing the word \"plate\" (case insensitive).\n\nThis is a bit nonsensical  considering the context.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/68",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Altnames too long on EBrida upload",
          "key": "KEA-69",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "OK,\nthe problem is that the altname that we are creating from the EBrida Group column is creating an AltName that is longer than 50 chars\n\nThere are 2 routes we can take here:\n- Increase the size limit in the DB to, say, 100 chars: This has a potentially practical problem where the altname should be a unique identifier for the given entity. Should it ever be over 50chars? How much more complicated will it make the rollout to the servers?\n- Reduce the size of the created altname: Will this mean the altname has less value? Will it have less usable data?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/69",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "I am inclined to go for the expansion of the altname field.\nI think that the rollout should not be too complicated.\n",
              "author": "zane.gilmore",
              "created": "2014-08-21T01:13:04Z"
            },
            {
              "body": "The different alt name tables have a different length for the AltName column. It varies from 50 to 300. I think the reason it was 50 is because that was the legacy field length before the alt name changes.\n",
              "created": "2014-08-21T01:13:36Z"
            },
            {
              "body": "I agree with the expansion. expension done via south migration so it's done\nproperly with reverse if required\n\nMarek Kuziel // Encode Ltd\n\nOn 21 August 2014 13:13, Zane Gilmore notifications@github.com wrote:\n\n> I am inclined to go for the expansion of the altname field.\n> I think that the rollout should not be too complicated.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/69#issuecomment-52867245\n> .\n",
              "created": "2014-08-21T01:14:52Z"
            },
            {
              "body": "300 seems a little excessive.\nMake it 200, which is also a bit crazy but it should give us some wiggle room.\nIt might pay to expand any other altname tables to the same.\n",
              "author": "zane.gilmore",
              "created": "2014-08-21T01:16:32Z"
            },
            {
              "body": "Migrations have been added.\n",
              "created": "2014-08-21T01:25:44Z"
            }
          ]
        },
        {
          "summary": "filename for breeder batchname truncate path first",
          "key": "KEA-70",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The filename we are putting in for the breeder batch name in the plant location needs to have its preceding path lopped off before the end of the filename gets truncated.\n\nIt doesn't make much sense to have onlt a few chars of the actual file name when the file system path is preserved.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/70",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "all populations for batch are being applied to each plate",
          "key": "KEA-71",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the view plates datagrid\nFor all of the plates within a batch all of the populations for that batch are being applied to each of them.\n\ne.g. if a batch has popa with 94 samples popb with 30 samples sand popc has 30 samples\nThere will be 2 plates say platex and platey\n\nplate x should only list popa and platey should have popb and popc\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/71",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "bad plate altnames for Ebrida upload",
          "key": "KEA-72",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The uploads are producing a huge number of altnames for a given plate\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/72",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "2 blank wells between each population",
          "key": "KEA-73",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to be able to apply the 2 balnk wells between each population in the batch spreadsheet.\n\nThis will need to follow the same format as for the multi-population batch spreadsheets.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/73",
          "labels": [
            "EBrida_interface"
          ],
          "comments": [
            {
              "body": "This should be an option on the first form to be used or not.\nThe check-box should have the label:\"2 Blank Wells between each population\"\n",
              "author": "zane.gilmore",
              "created": "2014-08-26T23:46:47Z"
            }
          ]
        },
        {
          "summary": "Set test/staging instance to use test logo",
          "key": "KEA-74",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Can we please make the logo displayed on the test instance to be:\nkea-test-logo.png\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/74",
          "labels": [
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "location does not exist error when trying to delete altname for plant",
          "key": "KEA-75",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When you click on the pencil in browse Plants and try to delete an altname you just get an error complaining about the location for the plant not existing. \nAnd the altname is not deleted.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/75",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Finally tracked this one down. Bug is as follows:\n\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/pndata/models.py#L505\n\nSee limit_choices_to\n\nAnd here in the admin form\n\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/pndata/admin.py#L182\n\nThe form allows all locations but the model is restricting plant locations to those that match the filters in the limit_choices_to dicton save. Obviously this Plant has a location that does not match those filters. I'm not sure how that happened. It shouldn't be possible unless creating or updating the plant using raw sql.\n\nThere are different ways to fix this.\n\n1) Either we remove the limit_choices_to dict and allow a plant to have any location. \n2) We update the PlantAdminForm and filter the locations queryset with those same limit_choice_to dict filters.\n\n2 does not actually fix the problem because the location would still not be valid, it would just show a more useful error message. Also, another problem with 2 is that specific locations would be unvalid but the user would still be able to choose those invalid locations with the datagrid and would not be informed the location is invalid until the form is saved. To fix the problem using 2 and do it properly is actually rather difficult.\n\nI'll wait and hear your thoughts on this.\n",
              "created": "2014-09-12T01:35:37Z"
            },
            {
              "body": "There are many ways to apply a location to a plant.\nThe most common one is via the batch file upload mechanism.\n\nThis means that any plant location-type that can be chosen from the \"Location Type for Plant\" drop-down can be applied to a plant.\n\nIf we are going to restrict location types anywhere then we should be able to apply location-types everywhere. This means we will need to have a means of creating sets of location-types.\nAnd _that_ means that we need to create two new tables:\n- a location-type-set table \n- and a many to many to location-type.\n\nThen we can ensure that only location-types from a particular set are allowed in particular contexts.\nI do believe that we will eventually need this but right now it would be just too much.\n\nSo...\nOption 1 is the correct one for now.\n",
              "author": "zane.gilmore",
              "created": "2014-09-12T03:12:56Z"
            }
          ]
        },
        {
          "summary": "after deleting a plant (or anything) returning to the unfiltered list",
          "key": "KEA-76",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "If the user deletes a sample or plant or whatever from the view data area the page that is returned to is the unfiltered datagrid for the entity.\n\nThis needs to be set to return back to the same page that the user was working in.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/76",
          "labels": [
            "Datagrid",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Added with 9b82028b05a7eb6e21fe319b7b2ffc2d5200db9b\n",
              "created": "2014-09-29T04:12:35Z"
            },
            {
              "body": "However ... on delete and return to filtered datagrid: the item deleted still shows in the grid because it has not yet been deleted from elasticsearch index.\n\nPossible solution: On single item deletion act immediately to delete from index instead of passing to a deferred celery task.  Caution: On deletion of say, a population, many items will be deleted (plants, genotypes and sample) maybe causing a bottleneck (?).\n",
              "created": "2014-09-29T10:02:38Z"
            },
            {
              "body": "Does anyone see any issue with **not** deferring to celery a deletion from elasticsearch index. I've tried it out on my local box without any problem and it solves the issue I describe in my previous comment. In the scenario where a user is deleting a single item at a time then I don't see a problem. However if hundreds (or thousands) are deleted in a single action then it could have an impact. Comments?\n",
              "created": "2014-09-29T22:57:25Z"
            },
            {
              "body": "You would need some way of checking how many index entries are to be deleted for that one deletion.\nThen a threshhold value for deciding whether to defer to celery or not.\n\nI am inclined to say that this is a good idea. Especially for genotypes, plants, samples and sample-extracts.\nBasically for entities that are reasonably stand-alone. Populations might be a bit problematic as there could potentially be thousands of attached genotypes etc. (commonly hundreds)\n\nThis also means that perhaps we should identify which entities can be deleted or even modified or created without deferring to celery.\n",
              "author": "zane.gilmore",
              "created": "2014-09-30T00:33:15Z"
            },
            {
              "body": "Yes. Good summary of my own thoughts. I also noted Populations as being problematic (having deleted a couple and seeing how many connected objects there are).\n\nBecause `delete_from_elasticsearch` gets called from the `delete_model` signal a simple solution could be:\n\n```\nif isinstance(instance, Population):\n    defer(delete_from_elasticsearch.delay, get_model_identifier(instance))\nelse:\n    delete_from_elasticsearch(get_model_identifier(instance))\n```\n",
              "created": "2014-09-30T00:40:38Z"
            },
            {
              "body": "Does django trigger delete signals for all related data when deleting a population? or does it let the database preform deletions using database constraints? If django doesn't trigger delete signals for related models (eg it's done at database level) then it's not a problem.\n",
              "created": "2014-09-30T00:43:58Z"
            },
            {
              "body": "I believe that the delete signal is called on all objects deleted in the cascade, in fact it must be otherwise the index will be out of sync with the database.\n\nI just tried deleting a population with over 100 related objects without deferring to celery with no perceivable performance hit when being returned to the datagrid view. Checked my indices for plant, genotype, samples etc and all has been updated correctly.\n",
              "created": "2014-09-30T00:57:49Z"
            },
            {
              "body": "It looks like this was not addressed. And probably should be.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:46:52Z"
            }
          ]
        },
        {
          "summary": "When well is in brackets on \"from container\" of move samples the container is not accepted on upload",
          "key": "KEA-77",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the move to 96-well plate sub process the \"From Container\" column is often pre-populated in the spreadsheet that is downloaded.\nIf the container type is a 96-well plate then the well coord is appended in brackets.\n\nWhen the spreadsheet is then uploaded the container is not recognised because of the appended well coord.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/77",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "This is done now I think",
              "author": "zane.gilmore",
              "created": "2017-02-09T19:58:03Z"
            }
          ]
        },
        {
          "summary": "\"Column\" column truncating second digit for 10,11, and 12",
          "key": "KEA-78",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the data tab of an EBrida batch, the column named errr... \"Column\" is truncating the second digit so that 10,11, and 12 are being displayed as 1\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/78",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "ldap setup broken in Provenance buildout",
          "key": "KEA-79",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have just tried to run buildout on my Provenance instance on my laptop and I got this:\n\n```\nGetting distribution for 'python-ldap'.\ndefines: HAVE_SASL HAVE_TLS HAVE_LIBLDAP_R\nextra_compile_args: \nextra_objects: \ninclude_dirs: /opt/openldap-RE24/include /usr/include/sasl /usr/include\nlibrary_dirs: /opt/openldap-RE24/lib /usr/lib\nlibs: ldap_r\nfile Lib/ldap.py (for module ldap) not found\nfile Lib/ldap/controls.py (for module ldap.controls) not found\nfile Lib/ldap/extop.py (for module ldap.extop) not found\nfile Lib/ldap/schema.py (for module ldap.schema) not found\nwarning: no files found matching 'Makefile'\nwarning: no files found matching 'Modules/LICENSE'\nfile Lib/ldap.py (for module ldap) not found\nfile Lib/ldap/controls.py (for module ldap.controls) not found\nfile Lib/ldap/extop.py (for module ldap.extop) not found\nfile Lib/ldap/schema.py (for module ldap.schema) not found\nfile Lib/ldap.py (for module ldap) not found\nfile Lib/ldap/controls.py (for module ldap.controls) not found\nfile Lib/ldap/extop.py (for module ldap.extop) not found\nfile Lib/ldap/schema.py (for module ldap.schema) not found\nIn file included from Modules/LDAPObject.c:9:0:\nModules/errors.h:8:18: fatal error: lber.h: No such file or directory\n #include \"lber.h\"\n                  ^\ncompilation terminated.\nerror: Setup script exited with error: command 'x86_64-linux-gnu-gcc' failed with exit status 1\nAn error occurred when trying to install python-ldap 2.4.15. Look above this message for any errors that were output by easy_install.\nWhile:\n  Installing django.\n  Getting distribution for 'python-ldap'.\nError: Couldn't install: python-ldap 2.4.15\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/79",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "What's the last version of python-ldap you installed? Have a look in your eggs directory\n\nls -l eggs|grep ldap\n\nYou might be trying to install a more recent version. If that's the case you can tell buildout to install a specific version of python-ldap. This doesn't look buildout related to me. Looks more like a version problem, perhaps missing some package dependencies with apt that are required to compile?\n",
              "created": "2014-09-08T05:00:59Z"
            },
            {
              "body": "Firstly, this is a separate virtual environment to my main Kea setup.\nI am trying to get a separate instance going to test the provenance code.\n\nThe main reason is that I don't want to just switch branches as there are DB issues with migrations etc.\n\nMy main master instance is going fine.\n\nThere is no sign of any python-ldap egg in the egg dir\n",
              "author": "zane.gilmore",
              "created": "2014-09-08T05:09:00Z"
            },
            {
              "body": "So what version is it in your other instance then? The one that is working...\n",
              "created": "2014-09-08T05:11:09Z"
            },
            {
              "body": "Sorry...\npython_ldap-2.4.15-py2.7-linux-x86_64.egg\n",
              "author": "zane.gilmore",
              "created": "2014-09-08T05:13:27Z"
            },
            {
              "body": "Same version, which disproves my theory. Perhaps Darryl changed something in the buildout. I'm out of ideas for quick fixes I'm afraid.\n",
              "created": "2014-09-08T05:15:56Z"
            },
            {
              "body": "Could you give me a few clues of which files to look in?\n",
              "author": "zane.gilmore",
              "created": "2014-09-08T05:26:44Z"
            },
            {
              "body": "Make sure following are installed and up-to-date with apt\n\npython-dev\nbuild-essential\nlibldap2-dev\nlibsasl2-dev\n\nApart from that, try looking in buildout.cfg and/or development.cfg otherwise try google.\n",
              "created": "2014-09-08T05:31:14Z"
            },
            {
              "body": "Hi,\n\nI haven't made any changes to buildout.    \n\n```\n$ buildout -vN -c development.cfg > report.log\n$ grep ldap report.log | grep \"^Picked\"\nPicked: python-ldap = 2.4.15\nPicked: django-auth-ldap = 1.2.1\nPicked: python-ldap = 2.4.15\nPicked: django-auth-ldap = 1.2.1\nPicked: python-ldap = 2.4.15\nPicked: django-auth-ldap = 1.2.1\n```\n\nCheers,\nDarryl\n",
              "created": "2014-09-08T09:43:02Z"
            },
            {
              "body": "My cock-up.\nNetwork issue I think\n",
              "author": "zane.gilmore",
              "created": "2014-09-12T00:38:42Z"
            }
          ]
        },
        {
          "summary": "State of provenance",
          "key": "KEA-80",
          "status": "Done",
          "description": "Hi All,\n\nDoctests for provenance:\n- [The introduction](http://darrylcousins.net.nz/kea-docs/alternate_provenance/introduction.html)\n- [Creating a provenance](http://darrylcousins.net.nz/kea-docs/alternate_provenance/provenance.html)\n- [Import/export](http://darrylcousins.net.nz/kea-docs/alternate_provenance/definition_spreadsheet.html)\n- [Datagrid views](http://darrylcousins.net.nz/kea-docs/alternate_provenance/datagrid.html)\n- [Sample batch creation](http://darrylcousins.net.nz/kea-docs/alternate_provenance/create_samples.html)\n- [Plate well generator](http://darrylcousins.net.nz/kea-docs/alternate_provenance/plates.html)\n- [Batch initialisation form wizard](http://darrylcousins.net.nz/kea-docs/alternate_provenance/initialisation.html)\n- [Process run create view](http://darrylcousins.net.nz/kea-docs/alternate_provenance/processrun.html)\n\nRegards,\nDarryl\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/80",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Hey,\n\nMost recent commit at time of writing: 2b456cd642de3b7c293ed2f458a2e60f29e05bd9\n\nDoctests cover most of this (haven't tried to get `make coverage` working). Standing unit tests run without errors and I've done a fair bit of user testing acting within both crop and provenance. Here's a list of stuff that I see as working now on the provenance branch.\n- initialise sample batch\n- create process run\n- view and select process runs\n- view and search plates\n- view and search batch spreadsheets with filtered columns\n- sample edit and search views show filtered fields/columns\n\nIn user testing I find that in stepping through processes in a process run errors arise because the process expects a plant (or population or genotype). I'm certainly at the point to be working on process runs and sorting these problems out.\n\nI'm using keadbdev_20140909 as my database dump before running migrate. I've gained a bit of control over my elasticsearch instance with 3rd party plugins but still come across problems that I solve by deleting and rebuilding the indices.\n\nCheers,\nDarryl\n",
              "created": "2014-09-16T08:09:23Z"
            },
            {
              "body": "There's probably not much point in keeping this open now\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:48:21Z"
            }
          ]
        },
        {
          "summary": "ebrida batch population lists not equal",
          "key": "KEA-81",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The list of populations in the cover sheet of the ebrida batch spreadsheet seems to miss one population in the list that states the number of plants per population.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/81",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "Was this ever fixed?\n\nI seem to remember William working on it and I think he fixed it but not sure.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:49:50Z"
            }
          ]
        },
        {
          "summary": "duplicate altnames in upload batch just going to 500 error",
          "key": "KEA-82",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "We need to ensure that the the reporting of duplicate altnames in batch uploads are reported in a useful way.\n\nRight now the user is just sent a 500 error.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/82",
          "labels": [
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Don't know whether this was addressed.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:51:20Z"
            }
          ]
        },
        {
          "summary": "Provenance list admin form  ProvenanceDefinitionField drop down no good",
          "key": "KEA-83",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The drop down for the ProvenanceDefinitionField in the Provenancelist admin form is not populated with enough information to make the decisions required.\n\nWe will need to have the name of the provenancedefinition row that the field is connected to at least.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/83",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Closed via f43a3a35c66b6af72632fccbf9674d442c970aa5\n",
              "created": "2014-09-10T23:49:06Z"
            }
          ]
        },
        {
          "summary": "Provenance list admin form labels are covered by input widgets",
          "key": "KEA-84",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The labels for the inputs in the provenancelist admin form are being coverd up by the drop-downs etc.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/84",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Fixed via d4faec084cc96916835741e066351cbedf473867\n",
              "created": "2014-09-10T23:35:31Z"
            }
          ]
        },
        {
          "summary": "Provenance - sample search view columns",
          "key": "KEA-85",
          "status": "Done",
          "description": "Sample search views (and in choose widget) should only show the columns relevant to crop or provenance.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/85",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Closed via 004281afda952fe5206db244671a71e2ebabed04\n",
              "created": "2014-09-10T23:28:38Z"
            }
          ]
        },
        {
          "summary": "Provenance - sample change form",
          "key": "KEA-86",
          "status": "Done",
          "description": "Sample change form will only show fields relevant to crop or provenance.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/86",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Works in 2b456cd642de3b7c293ed2f458a2e60f29e05bd9\n",
              "created": "2014-09-16T07:25:42Z"
            }
          ]
        },
        {
          "summary": "Provenance - datagrid views with relevant columns",
          "key": "KEA-87",
          "status": "Done",
          "description": "As for #85 sample extract, plate and plate extract datagrid should only show columns relevant to crop or provenance.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/87",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Works in 2b456cd642de3b7c293ed2f458a2e60f29e05bd9\n",
              "created": "2014-09-16T07:26:08Z"
            }
          ]
        },
        {
          "summary": "Provenance - assignation of ids to samples",
          "key": "KEA-88",
          "status": "Done",
          "description": "In the creation of sample batches on a provenance the order of ids assigned is out of sync with other sample batch creation.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/88",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "FIxed in 2f0f1c0ccadc4421118e565d180740ca3b692a4c\n",
              "created": "2014-09-11T01:36:12Z"
            }
          ]
        },
        {
          "summary": "Provenance - plateChoose view fails",
          "key": "KEA-89",
          "status": "Done",
          "description": "In a provenance the plateChoose views has no data.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/89",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Works in 2b456cd642de3b7c293ed2f458a2e60f29e05bd9\n",
              "created": "2014-09-16T07:23:39Z"
            }
          ]
        },
        {
          "summary": "Population choice in initialisation not accepting some populations",
          "key": "KEA-90",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "For some reason initialising apple batches in both multi-pop and single-pop,  does not accept at least one population that is listed in the choice windows for apples POP0YZK id number 1922 to be precise.\n\nThere is a number of possibilities here:\n- why is that population not being allowed?\n- if there is a valid reason to exclude it then why is it being listed?\n\nI found this in my dev instance running against a test DB dump on the provenance branch.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/90",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "On further investigation I have found the the population is a Kiwifruit population.\nThis should not be being listed in the Apple sample initialisation.\n\nThe population crop_id is set to Kiwifruit.\nSo something is going wrong with the filtering of the populations presented to the population choosing widget.\n\nTagging this to provenance and datagrid\n",
              "author": "zane.gilmore",
              "created": "2014-09-11T23:55:42Z"
            },
            {
              "body": "Fixed in 255ca1bf7f88f3c4d3e902f0b3a8bf312fc59991\n",
              "created": "2014-09-12T03:19:02Z"
            }
          ]
        },
        {
          "summary": "View Data Datagrids not filtering on Crop",
          "key": "KEA-91",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "All of the view data datagrid pages are not filtering for the correct crops.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/91",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed in 255ca1bf7f88f3c4d3e902f0b3a8bf312fc59991\n",
              "created": "2014-09-12T03:19:17Z"
            }
          ]
        },
        {
          "summary": "Upload batch files not working.",
          "key": "KEA-92",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I attempt to upload the plant locations and altnames for a batch, nothing happens.\nThe form appears to reset with no feedback.\n\nThis happens for both multi-population and single population batches.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/92",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Uploading single population batches works now but the multi-pop batches still gives the same symptom.\n",
              "author": "zane.gilmore",
              "created": "2014-09-15T00:47:12Z"
            },
            {
              "body": "Just tried uploading a multi-pop batch on the test/staging server and it worked.\nSo labeling this bug as a provenance issue\n",
              "author": "zane.gilmore",
              "created": "2014-09-15T04:28:49Z"
            },
            {
              "body": "Works in 2b456cd642de3b7c293ed2f458a2e60f29e05bd9\n",
              "created": "2014-09-16T07:30:34Z"
            },
            {
              "body": "Fixed\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:52:15Z"
            }
          ]
        },
        {
          "summary": "Provenance - create/download spreadsheet",
          "key": "KEA-93",
          "status": "To Do",
          "description": "In 'execute process run' and 'plate view' a spreadsheet can be created and downloaded in two steps.\n\nNice to have: one step.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/93",
          "labels": [
            "Process Handling",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I agree :-)\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:53:13Z"
            }
          ]
        },
        {
          "summary": "Crop matching query failing on process upload",
          "key": "KEA-94",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the upload arrow is clicked an error like:\n`DoesNotExist at /processrun/execute/upload/342/344/\nCrop matching query does not exist.`\n\nThe line quoted is\n1451 in processExcel.py\n\nThis is a problem as I am still in crop mode.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/94",
          "labels": [
            "Process Handling",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "done now\n",
              "author": "zane.gilmore",
              "created": "2014-11-10T01:19:26Z"
            }
          ]
        },
        {
          "summary": "Crop pictures broken",
          "key": "KEA-95",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The crop pictures are not being found for some reason and we are getting 404 errors for them.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/95",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Have you run:\n\nbin/django collectstatic\n\n? Cheers, Darryl\n\nOn Wed, Sep 24, 2014 at 11:56 AM, Zane Gilmore notifications@github.com\nwrote:\n\n> The crop pictures are not being found for some reason and we are getting\n> 404 errors for them.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/95.\n",
              "created": "2014-09-23T23:59:16Z"
            },
            {
              "body": "Sure have\n",
              "author": "zane.gilmore",
              "created": "2014-09-24T00:02:29Z"
            },
            {
              "body": "After further testing...\nThe provenance images are ok and so is the blank-blank image\n(nothing on either drop down)\n",
              "author": "zane.gilmore",
              "created": "2014-09-24T00:24:54Z"
            },
            {
              "body": "Just had a look at the source of the pages and found the img tag link to the image is removing the capital off the image file name.\ne.g. \"Apple.jpg\" is becoming \"apple.jpg\"\n",
              "author": "zane.gilmore",
              "created": "2014-09-24T00:31:15Z"
            },
            {
              "body": "That shouldn't matter with http. My source html is also:\n\n<img height=\"100\" src=\"/static/crop_pictures/apple.jpg\">\n\nand\n\nls var/static/crop_pictures\n...\nApple.jpg\n...\n\nOn Wed, Sep 24, 2014 at 12:31 PM, Zane Gilmore notifications@github.com\nwrote:\n\n> Just had a look at the source of the pages and found the img tag link to\n> the image is removing the capital off the image file name.\n> e.g. \"Apple.jpg\" is becoming \"apple.jpg\"\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/95#issuecomment-56610334\n> .\n",
              "created": "2014-09-24T01:02:48Z"
            },
            {
              "body": "And ...\n\nhttp://localhost:9001/static/crop_pictures/Apple.jpg ==\nhttp://localhost:9001/static/crop_pictures/apple.jpg\n\nOn Wed, Sep 24, 2014 at 1:02 PM, Darryl Cousins darryljcousins@gmail.com\nwrote:\n\n> That shouldn't matter with http. My source html is also:\n> \n> <img height=\"100\" src=\"/static/crop_pictures/apple.jpg\">\n> \n> and\n> \n> ls var/static/crop_pictures\n> ...\n> Apple.jpg\n> ...\n> \n> On Wed, Sep 24, 2014 at 12:31 PM, Zane Gilmore notifications@github.com\n> wrote:\n> \n> > Just had a look at the source of the pages and found the img tag link to\n> > the image is removing the capital off the image file name.\n> > e.g. \"Apple.jpg\" is becoming \"apple.jpg\"\n> > \n> > 窶能n> > Reply to this email directly or view it on GitHub\n> > https://github.com/PlantandFoodResearch/Kea/issues/95#issuecomment-56610334\n> > .\n",
              "created": "2014-09-24T01:03:33Z"
            },
            {
              "body": "I don't think that is true.\nCertainly for the server part of the URL, the server DNS etc is case insensitive but not for the path part.\nThat would be OS dependent. And Linux _is_ case sensitive.\nA view source from the live instance is giving the file names with their capital letters intact.\n",
              "author": "zane.gilmore",
              "created": "2014-09-24T02:14:49Z"
            },
            {
              "body": "Ah. Righto. I've add capfirst filter to the src url in base template. The\nnew template is using 'slugify' which I think is fair enough (although no\ncurrent crops need it so). The 'capfirst' will rectify the problem.\n\nCheers,\nDarryl\n\nOn Wed, Sep 24, 2014 at 2:14 PM, Zane Gilmore notifications@github.com\nwrote:\n\n> I don't that is true.\n> Certainly for the server part of the URL, the server DNS etc is case\n> insensitive but not for the path part.\n> That would be OS dependent. And Linux _is_ case sensitive.\n> A view source from the live instance is giving the file names with their\n> capital letters intact.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/95#issuecomment-56616765\n> .\n",
              "created": "2014-09-24T03:14:13Z"
            }
          ]
        },
        {
          "summary": "Location type Datagrid list headers and data columns not aligned",
          "key": "KEA-96",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The headers for the location type list in the browse location types page are not aligned with the data columns.\nThis is the location type list which is got to from the Location handling menu item.\n\nThis is not a show stopper but it looks untidy and could potentially be confusing.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/96",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Should be good now.\n",
              "created": "2014-09-29T01:04:11Z"
            }
          ]
        },
        {
          "summary": "Seedling Tray up arrow icon no good",
          "key": "KEA-97",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Sorry but I don't think that the up arrow inside a circle is a very informative icon to use for the activation icon for this form.\n\nA right arrow might be better, but the up arrow implies uploading to my mind. \nElsewhere in Kea, an up arrow denotes uploading a file and I feel we should try to be consistent.\n\nLow priority but something I feel should be fixed.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/97",
          "labels": [
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Done\n",
              "created": "2014-09-29T01:03:15Z"
            }
          ]
        },
        {
          "summary": "Remove all links to pedigree data when in a provenance",
          "key": "KEA-98",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I think that we possibly need to think about what we put on the main page a bit more but the links on the main page and the links in the \"View Data\" tab  that point to pedigree/crop based data need to be removed when Kea is in one of the Alternate provenances.\n\nThe links don't really work anyway and it is reasonably untidy.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/98",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Done.\n",
              "created": "2014-09-29T01:03:44Z"
            }
          ]
        },
        {
          "summary": "plant and genotype is not showing up when it exists in DB",
          "key": "KEA-99",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The Plants with localids:\n 'Kiw1KA0K.01'  and 'Kiw1KA0G.01'\nor their genotypes are not being found on the \"View Data\" pages.\n\nThe plants and genotypes exist in the DB searching with the stored function:\ngetplantidfromlocalid()\nBut the index doesn't seem to contain it.\n\nI am a little worried.\nBTW those plants exist in our test DBs and the staging instance finds them OK\nWhat I am worried about is that the indexing seems to have ignored them on the live instance.\nCan anyone think of any reason why they might have been ignored?\nI have to now go and talk to the lab technician who has problems trusting Kea as it is.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/99",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "The lab technician rang again with 2 more missing plants and genotypes.\nI have added them in by hand using William's shell recipe.\nThis is really bad.\n\nThe 2 that I added yesterday are still there, which is very strange as I though that the whole thing was rebuilt from scratch every night.\n\nWe need to figure out why some plants and genotypes are becoming invisible on the datagrid.\nIs it because they are not in the index or because they being put in wrongly?\n\nThe trouble is that the moment that one is discovered missing we have to add it.\nI will be searching for another missing one now so we can track down what is happening.\n\nFor a start, I need a way of querying the elasticsearch DB to see exactly what is there.\nIs there an easy way of doing this?\n",
              "author": "zane.gilmore",
              "created": "2014-09-29T20:37:00Z"
            },
            {
              "body": "How to query elasticsearch using elasticutils.:\n\n```\nfrom kea.elasticsearch.utils.loading import get_mapping_type\n\nm = get_mapping_type('plant-data-for-search')\nqs = m.search().filter(name='xxx')\n```\n",
              "created": "2014-09-29T20:50:49Z"
            },
            {
              "body": "Now I am really worried\nThe elastic search count gives me:\n98485\n\nA `select count(*) from pndata_plant` get me:\n162266\n",
              "author": "zane.gilmore",
              "created": "2014-09-29T22:14:01Z"
            },
            {
              "body": "I've found these plugins very useful for having a look at the indices. HQ gives an immediate overview of the status and a list of indices, counts, shards, nodes, etc as well as other screens for checking all aspects of the cluster - filesystem use, cache and memory use etc. Inquisitor has less bells and whistles but I like its simpler interface for making practice json queries. \n\nhttps://github.com/royrusso/elasticsearch-HQ\n\n```\n  $ plugin -install royrusso/elasticsearch-HQ\n  $ open http://localhost:9200/_plugin/HQ/\n```\n\nhttps://github.com/polyfractal/elasticsearch-inquisitor\n\n```\n  $ plugin -install polyfractal/elasticsearch-inquisitor\n  $ open http://localhost:9200/_plugin/inquisitor/\n```\n",
              "created": "2014-09-29T22:29:28Z"
            },
            {
              "body": "Have you tried re-populating that index alone?\n\n```\n$ django populate_index plant-data-for-search\n```\n\nThe single index took about 15-20 mins on my machine. I don't know if that is possible on the production instance (performance wise).\n",
              "created": "2014-09-29T23:07:19Z"
            },
            {
              "body": "The trouble is that the problem is on at least genotypes and samples as well.\nHowever I suppose that we could see whether the index is re-created properly.\n",
              "author": "zane.gilmore",
              "created": "2014-09-30T00:35:26Z"
            },
            {
              "body": "All indexes get rebuilt from scratch every night, is that correct? Has it been running out of memory?\n\nHere's a couple of snapshots of my cluster (from HQ). Perhaps something similar may point to problems as yet unseen?\n\n![filesystem](https://cloud.githubusercontent.com/assets/93854/4451797/c937336c-483b-11e4-9706-43c8d9bf9a32.png)\n![memory](https://cloud.githubusercontent.com/assets/93854/4451798/c946575c-483b-11e4-9c73-4e9758e2dced.png)\n",
              "created": "2014-09-30T00:50:54Z"
            },
            {
              "body": "Unfortunately I only have a vague memory of what went wrong here.\nI think it was user error but am not sure.\n\nI can now see them where I should be able to see them so I will close the issue.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:58:40Z"
            }
          ]
        },
        {
          "summary": "ability to change genotype alt names en mass",
          "key": "KEA-100",
          "status": "To Do",
          "reporter": "vincent.borgers",
          "description": "Issue caused by eBrida population name being masked by user population alt name...\neBrida population auto number: K13.0183\neBrida population user number: K13.0393\neBrida genotype auto number: K13.0183.00494\n\nKea popn alt name: K13.0393\nKea genotype alt name: K13.0183.00494\n\nwe have changed eBrida genotype auto number to reflect user number \n\nNEW NAMES \n\neBrida population auto number: K13.0393\neBrida population user number: K13.0393\neBrida genotype auto number: K13.0393.00494\n\nThis has occurred in 90 genotypes. I will update them manually in Kea. it would be great if I could reupload the file that was used to initialise the sample with the corrected genotype alt names and overwrite the incorrect alt names in Kea. \nSimilar to the \"Old files\" option in the samples tab which would allow me to alter plant alt names but not genotype alt names...\n\nHave discussed with Zane\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/100",
          "labels": [
            "EBrida_interface",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I would like to explore whether using a batch file and uploading it with the new names doesn't fix this.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:02:00Z"
            },
            {
              "body": "See #330\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:40:52Z"
            }
          ]
        },
        {
          "summary": "Provenance and crop dropdowns are not displaying active choices properly",
          "key": "KEA-101",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The words for the chosen entries in the provenance and crop drop-downs appear to be partially obscured.\n\nThere seems to some sort of vertical offset or something.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/101",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Which dropdowns do you mean? Them in the header?\n\nThanks,\nDarryl\n",
              "created": "2014-09-29T00:32:06Z"
            },
            {
              "body": "Yes,\nThe main ones in the header\n",
              "author": "zane.gilmore",
              "created": "2014-09-29T03:07:18Z"
            },
            {
              "body": "Right, yes I see that in Firefox (all ok in Chrome). Will fix, thanks.\n\nOn Mon, Sep 29, 2014 at 4:07 PM, Zane Gilmore notifications@github.com\nwrote:\n\n> Yes,\n> The main ones in the header\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/101#issuecomment-57112386\n> .\n",
              "created": "2014-09-29T03:14:02Z"
            },
            {
              "body": "Closing. Looks good from here in chrome, firefox and safari.\n",
              "created": "2014-09-29T22:51:23Z"
            }
          ]
        },
        {
          "summary": "Datagrids are missing edit and delete links",
          "key": "KEA-102",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The links with the icons are not being displayed.\n\nI am also getting: \n`\"GET /static/components/fontawesome/css/font-awesome.min.css HTTP/1.1\" 404 1745`\n\non my runserver terminal\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/102",
          "labels": [],
          "comments": [
            {
              "body": "You'll need to run buildout. Font awesome is installed via bower into parts/bower.\n\nI do 'buildout -vN -c development.cfg'\n\nCheers,\nDarryl\n",
              "created": "2014-09-29T00:31:11Z"
            },
            {
              "body": "Closing as fixed.\n",
              "created": "2014-09-29T22:51:46Z"
            }
          ]
        },
        {
          "summary": "Upgrade Elasticsearch to 1.2.0 on all kea instances.",
          "key": "KEA-103",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "As the tests do not work at all right now with the versions of elastic utils etc\nwe need to make this work\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/103",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "elasticutils 0.10.1 works with elasticsearch 1.2.0\n\nCurrently elasticutils is fixed to 0.9.1 which works with elasticsearch 0.90.x\n\nWe can upgrade elasticutils when we upgrade elasticsearch to 1.2.0 on all servers and development environments.\n",
              "created": "2014-09-29T03:18:17Z"
            },
            {
              "body": "This is something we should do sometime soon.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:05:53Z"
            },
            {
              "body": "became moot from #228\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:52:15Z"
            }
          ]
        },
        {
          "summary": "Speeding up indexing",
          "key": "KEA-104",
          "status": "Done",
          "description": "Hi All,\n\nI've looked at the `extract_document` method of `SampleMappingType` because it is my assumption that this is where the bottleneck is. The result for 100 samples with the old method is:\n\n```\n>>> reset_queries()\n>>> def make_docs_old():\n...     for sample in Sample.objects.all():\n...         doc = SampleMappingType.extract_document(sample)\n>>> timeit.timeit(make_docs, number=10)\n13.682330131530762\n>>> len(connection.queries)\n14010\n```\n\nAnd my new method:\n\n```\n>>> reset_queries()\n>>> def make_docs_new():\n...     for sample in Sample.objects.all():\n...         doc = SampleMappingType.new_extract(sample)\n>>> timeit.timeit(make_docs, number=10)\n3.682511920928955\n>>> len(connection.queries)\n1010\n```\n\nThere is some small variations in the results but the new method takes consistently around 30% of the time.\n\nI spent around 3 hours on the method (and I need some more testing to ensure that I'm correctly indexing altnames in particular).\n\nI estimate then around 3-4 hours per mapping type (of which there are 9 in total).\n\nIs this worth me doing?\n\nThe other point of optimisation could also be updagrading to Django 1.6 which will also help. From William:\n\nFrom what I've read this is what Django uses to check for the existence of a particular record. I mentioned this earlier about how django preforms a select before update. This is silly and the behaviour actually changed in Django 1.6.\n\nCheers,\nDarryl\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/104",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "Further to yesterdays note I've had a look at optimising at the task level with these results:\n\n## Elasticsearch Indexing\n\nImports::\n\n```\n>>> from kea.elasticsearch.utils.models import get_model_identifier\n>>> from kea.elasticsearch.tasks import update_elasticsearch\n>>> from kea.elasticsearch.tasks import update_elasticsearch_new\n```\n\nold method::\n\n```\n>>> def make_docs():\n...     for sample in Sample.objects.all():\n...         reset_queries()\n...         model_identifier = get_model_identifier(sample)\n...         update_elasticsearch(model_identifier)\n>>> t1 = timeit.timeit(make_docs, number=10)\n>>> len(connection.queries)\n27\n```\n\nNew method::\n\n```\n>>> def make_docs():\n...     for sample in Sample.objects.all():\n...         reset_queries()\n...         model_identifier = get_model_identifier(sample)\n...         update_elasticsearch_new(model_identifier)\n>>> t2 = timeit.timeit(make_docs, number=10)\n>>> len(connection.queries)\n3\n```\n\nTime spent better than 25% of the old method (within 20-22% on repeated runs of\nthe test)::\n\n```\n>>> int(t2/t1*100) < 25\nTrue\n```\n\n## Elasticsearch Bulk Indexing\n\nImports::\n\n```\n>>> from kea.elasticsearch.tasks import bulk_index_elasticsearch\n>>> from kea.elasticsearch.tasks import bulk_index_elasticsearch_new\n```\n\nCreate the batch of model identifiers::\n\n```\n>>> batch = [get_model_identifier(mod) for mod in Sample.objects.all()]\n```\n\nWrap the methods to pass arguments to timeit::\n\n```\n>>> def wrapper(func, *args, **kwargs):\n...     def wrapped():\n...         return func(*args, **kwargs)\n...     return wrapped\n```\n\nOld method::\n\n```\n>>> reset_queries()\n>>> wrapped = wrapper(bulk_index_elasticsearch, *batch)\n>>> t1 = timeit.timeit(wrapped, number=10)\n>>> print(len(connection.queries)/10)\n270\n```\n\nNew method::\n\n```\n>>> reset_queries()\n>>> wrapped = wrapper(bulk_index_elasticsearch_new, *batch)\n>>> t2 = timeit.timeit(wrapped, number=10)\n>>> print(len(connection.queries)/10)\n11\n```\n\nTime spent ranges from 4-7% of the old method on repeated runs of the test\n(benefits increase with the number of items indexed)::\n\n```\n>>> int(t2/t1*100) < 10\nTrue\n```\n",
              "created": "2014-09-30T23:28:01Z"
            },
            {
              "body": "moot because of #228\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:52:57Z"
            }
          ]
        },
        {
          "summary": "Can't create population in sample initialisation",
          "key": "KEA-105",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I try to create a population in the single pop initialisation I get:\n`TypeError at /admin/pndata/population/add/\nexpected a character buffer object`\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/105",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed 866393a95d664341ffff2844c5191c7896980170\n\n**unicode** method should return unicode.\n",
              "created": "2014-10-02T22:33:50Z"
            }
          ]
        },
        {
          "summary": "Resample Population Plant Altname column bad",
          "key": "KEA-106",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The resample population is producing Excel files that have a column called \"Plant AltName\" which should be \"Plant AltNames\" this will not be uploadable via the \"Upload Plant Locations\" form.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/106",
          "labels": [
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "New Update processrun form could be disastrous",
          "key": "KEA-107",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Because of the way you are now editing the processrun data in the UpdateProcessRunView method we are going to have to either ensure that the processrun has not been processed at all and had data input into it. Or we need to NOT edit the processrun by first deleting all sampleprocess rows, as is now being done.\n\nEditing a processrun has always been a bit problematic but this would be disastrous if someone edited one after they had entered data.\n\nWhat I suggest is: that we do a check on the processrun to see that it hasn't been processed at all with uploaded data before we allow updates. This will be a lot easier. \nIt will mean that, at least, people can fix their initial mistakes.\n\nIn the long run we can either allow for addition of new samples and just add them or delete samples carefully, recursively working our way through the processrun structure.\nBut this is likely to take a lot of effort to do right.\n\n(this test writing looks useful already :-) )\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/107",
          "labels": [
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "We just need to display the data for the process run with a message saying:\n`Data entry has been started on this process-run so you may not edit it.`\n\nPerhaps you can easily \"grey out\" and disable the form but still display it's contents?\n",
              "author": "zane.gilmore",
              "created": "2014-10-15T04:15:10Z"
            },
            {
              "body": "Sure, I'll pick this up.\n\nDarryl\n",
              "created": "2014-10-15T04:17:26Z"
            },
            {
              "body": "You are a gentleman and a scholar!\nThanks\n",
              "author": "zane.gilmore",
              "created": "2014-10-15T04:20:16Z"
            },
            {
              "body": "Pushed.\n\nI've disabled the 'edit' button on the datagrid view, added your note and removed form if they do get there.\n\nLet me know if that is correct/enough.\n\nCheers,\nDarryl\n",
              "created": "2014-10-15T04:48:40Z"
            },
            {
              "body": "As is so often the case a little change like this highlights an oversight of mine. :-/\n\nJust disabling the edit link is a good idea. However I thought that I had better check to see that the users would not be loosing any access to any data etc.\n\nIt turns out that that I do not display the description, that I insist that they enter, anywhere else.\nCould you please put the description on the execute processrun page?\n\nPerhaps in a box just after the \"Execute Process Run XXXX\". Keep the lettering reasonably small.\n\nAlso could you make the disabled links to the edit more obvious that they are disabled?\nThey are only a little lighter and that will probably cause confusion.\n\nThe other possible gotcha there is that the ``has_started_data_entry()` method is fairly intensive on the DB round trips. Hopefully this won't be a problem as the page sizes will probably not get too much above 50 at a time.\n",
              "author": "zane.gilmore",
              "created": "2014-10-15T20:53:12Z"
            },
            {
              "body": "will do.\n",
              "created": "2014-10-15T21:03:21Z"
            },
            {
              "body": "Hi Zane,\n\nThat should have it covered:\n\nDescription on execute page (it is also on the datagrid)\nAdded disabling pointer (the link still works though)\nIncluded process run data on edit page along with message as to why it cannot be edited.\nI agree that the has_started_data_entry will not cause problems.\n\nHope that helps,\nDarryl\n",
              "created": "2014-10-15T21:57:20Z"
            },
            {
              "body": "That all looks really good.\n\nHowever the process-run list for the \"Apple\" crop is empty.\nNot sure why, but the cropid for apple is 1 so perhaps there is something happening there.\n",
              "author": "zane.gilmore",
              "created": "2014-10-15T22:31:46Z"
            },
            {
              "body": "Code is failing in new has_started_data_entry::\n\n``` python\n fst_subprocrun = ProcessRun.objects.get(ParentProcessRun = self,SubProcess = the_sub_procs[0])\n```\n\nThis is raising ObjectDoesNotExist.\n\nPlease give me a call when you're off the phone, thanks, Darryl\n",
              "created": "2014-10-15T23:11:20Z"
            },
            {
              "body": "Hi Zane,\n\nThis is the process run that causes the ObjectDoesNotExist\n\n<ProcessRun: 2013 Indoor leaf harvest POP0Y87>\n\nI've pushed a change to the file but would like to talk to you about it.\n",
              "created": "2014-10-15T23:38:27Z"
            },
            {
              "body": "I seem to remember that this was all fixed now.\nAm closing\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:09:08Z"
            }
          ]
        },
        {
          "summary": "Admin edit forms for entiries should have the unicode names in big letters",
          "key": "KEA-108",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When editing the the entities of a particular entity like Population the **unicode**() produced name of the entity should be prominently displayed.\nPerhaps as part of the H1 next to \"Change Population\"\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/108",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "a8288f3fc5b8d7ce05ae4e1b2869f65adcdc55ba\n",
              "created": "2014-10-21T00:35:53Z"
            }
          ]
        },
        {
          "summary": "Altname edit form lists displays name twice",
          "key": "KEA-109",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The list of altname editing forms in the admin forms are displaying the name above the text input for the same value. \nI don't think we need the extra uneditable text.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/109",
          "labels": [
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Update ProcessRun needs SampleProcess handling",
          "key": "KEA-110",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a processrun has had any spreadsheet files produced for it, a whole bunch of SampleProcess rows will have been produced.\n\nIt appears that when the samples chosen for the processrun are changed subsequently, these sampleprocess rows are not updated. So that spreadsheets produced for that processrun don't change appropriately.\n\nWe need to either ensure that the processrun samples can't be changed after spreadsheets are created or we need to change the sampleprocess rows appropriately.\nI think that latter is probably better but if any data has been uploaded then we should perhaps disallow sample removal or give warnings.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/110",
          "labels": [
            "Process Handling",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This issue should be considered attached to #107 \n",
              "author": "zane.gilmore",
              "created": "2014-10-07T21:08:07Z"
            },
            {
              "body": "I'm pretty sure that this is done now\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:54:18Z"
            }
          ]
        },
        {
          "summary": "Tray batch form action is pointing to wrong batch",
          "key": "KEA-111",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The forms in the left column of the Tray batch form have as in action attribute the the batch id of the batch which the trays are to be processed for.\n\nThese are completely wrong.\nI clicked on a Funnyfruit one and ended up with a pea batch.\n\nThis is so bad I am going to go to the live server and rename the template file to disable the page.\nIt will completely screw the data.\nI am still trying to figure out what has gone wrong.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/111",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Disaster not imminent.\nThe view on the live server is not running the new datagrid so it is correct.\n",
              "author": "zane.gilmore",
              "created": "2014-10-08T00:20:22Z"
            },
            {
              "body": "Thanks Zane. Fixed 73d09c44fac605c35d464dd43460467e937ebdfa\n",
              "created": "2014-10-08T00:43:05Z"
            }
          ]
        },
        {
          "summary": "Provenance sample init always giving exception",
          "key": "KEA-112",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I know we are not concentrating on provenance functionality but...\nThis always happens when I try to initialise sample in alt' prov:\n\n``````\nException at /provenance/batch/initialise/None/\nduplicate worksheet name u'Harvest'\nRequest Method: POST\nRequest URL:    http://localhost:8000/provenance/batch/initialise/None/\nDjango Version: 1.5.9\nException Type: Exception\nException Value:    \nduplicate worksheet name u'Harvest'\nException Location: /home/zane/programming/virtenv/kea/eggs/tablib-0.10.0-py2.7.egg/tablib/packages/xlwt/Workbook.py in add_sheet, line 322 ```\n``````\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/112",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nAll ok on my instance. Can you precisely describe what you are doing please?\n\nIs it 1. when downloading the empty spreadsheet at http://localhost:8000/provenance/batch/initialise/select-items/\n\nor 2. when uploading a spreadsheet at the same step?\n\nI think these are the only 2 options.\n\nThanks in advance,\nDarryl \n",
              "created": "2014-10-09T04:46:48Z"
            },
            {
              "body": "Sorry,\nNo this is when I am in a Provenance mode , any provenance and I have clicked  \"Initialise Samples\" in the \"Sample Initialisation\" menu drop down.\n\nI then choose a Definition from the drop-down and click next.\n",
              "author": "zane.gilmore",
              "created": "2014-10-09T20:36:04Z"
            },
            {
              "body": "Hi Zane,\n\nI think you may have Harvest twice defined for the provenance definition such that the ProvenanceList object has perhaps:\n\nProvenance = Sauvblanc\nProvenanceDefinition = Harvest\nProvenanceDefinitionField = sauvblanc Harvest identifier\nProvenanceType = SauvblancProperties\n\nIf Harvest is also in the ProvenanceType 'SauvblancProperties' then this will cause an error in creating the spreadsheet (duplicate worksheet name 'Harvest').\n\nThe spreadsheet creates a worksheet for each of the dynamic models defined: all those in the ProvenanceList.ProvenanceType and then the key model ProvenanceList.ProvenanceDefinition.\n\nI hope that helps.\nDarryl\n",
              "created": "2014-10-09T21:56:10Z"
            },
            {
              "body": "Sorted.\n",
              "created": "2014-10-10T02:41:31Z"
            }
          ]
        },
        {
          "summary": "Plateset size zero causing error",
          "key": "KEA-113",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to be able to handle 0 in either plate set size or single sample container set size\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/113",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed in 2536a989bdf11406365de6d7e1aabe407a30f659\n",
              "created": "2014-10-10T02:41:05Z"
            }
          ]
        },
        {
          "summary": "Setting up the permission system for provenances",
          "key": "KEA-114",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I am not sure that I can set up a user to have full access to the admin interfaces for the provenance tables right now.\nDo we need to set up some pages that we can give users access to those admin pages for the dynamic tables?\n\nThis is the ability to be able add rows into the dynamic tables etc not to change the tables.\n\nThey will need to be able to access them but I don't want to have to give them full access.\nThe dynamic tables are not listed in the \"Available Permissions\" list in the \"Change group\" form.\n\nSo how do we do this?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/114",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Two approaches 'off the top of my head':\n1. Dynamically set up a new set of permissions when a provenance dynamic table is created.\n2. Add interface to manually set up new set of permissions for each/any provenance table.\n\nI see both as being equal tasks (i.e. one not easier than the other) therefore I'd propose 1.\n",
              "created": "2014-10-17T05:20:23Z"
            },
            {
              "body": "I agree with Darryl re going for no.1, although no.2 sounds like a more generic solution which could be used later on for changing the permissions if required. \n\nCurrently we only need to worry about Sauvignon Blanc provenance tables which simplifies the task for now.\n\nOne way or another neither of the proposed ways sound like an easy one. We should discuss this properly before we start doing anything.\n\nPS: I disagree with this issue being labeled as \"UI bug\", because AFAIK there isn't any error that would make this a bug. The feature is simply missing completely rather than UI has a bug in it.\n",
              "created": "2014-10-20T00:28:37Z"
            },
            {
              "body": "When I think about it Marek, you are right.\nIt's not a UI bug.\nAnd yes it's definitely a good idea to talk about this.\nI get the impression Marek that you think that this is a more significant issue than I first thought.\n",
              "author": "zane.gilmore",
              "created": "2014-10-20T20:13:17Z"
            },
            {
              "body": "This has been done now\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:20:49Z"
            }
          ]
        },
        {
          "summary": "Location handling links all missing",
          "key": "KEA-115",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "All of the location handling links have been removed for ordinary users.\n\nboth the link to the location handling from the drop-down menu and the link from the main page has been removed for ordinary users.\nUsers need to be able to add and edit locations.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/115",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Hi,\n\nThis menu item is protected by the permission `perms.pndata.can_edit_locationtype`. Are you suggesting that it should not be permission protected? Or should all users be given this permission?\n\nNote that only the menu item is protected, the view apparently is not.\n\nRegards,\nDarryl\n",
              "created": "2014-10-21T00:58:50Z"
            },
            {
              "body": "No, I believe that the permissions should be for \"can edit location\"... not type.\nBut owing to the fact that all users should probably have access to it, perhaps, it should not be protected.\n",
              "author": "zane.gilmore",
              "created": "2014-10-21T02:13:01Z"
            },
            {
              "body": "Thanks Zane. I've allowed the link to all.\n\nA look at the list of permissions is in order.\n\nBest,\nDarryl\n",
              "created": "2014-10-21T08:16:25Z"
            }
          ]
        },
        {
          "summary": "Kea usage report link displayed for ordinary users",
          "key": "KEA-116",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Ordinary users don't need to be able to see the Kea usage report and when it is clicked on they only get a forbidden page anyway.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/116",
          "labels": [
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Need to capture plant altname clash on batch upload",
          "key": "KEA-117",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the user uploads the batch files to apply plant altnames and locations, we need to capture when there is a clash of altnames and give the user a more meaningful error message.\n\nRight now they are getting a useless 500.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/117",
          "labels": [
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nSee how that goes. It may be the fix required.\n\nDarryl\n",
              "created": "2014-10-21T21:59:21Z"
            },
            {
              "body": "Thanks for the fix Darryl,\nJust tested and looking good.\n",
              "author": "zane.gilmore",
              "created": "2014-10-22T01:44:42Z"
            },
            {
              "body": "Great, thank you.\n",
              "created": "2014-10-22T03:01:24Z"
            }
          ]
        },
        {
          "summary": "EBrida upload plate sequence bad",
          "key": "KEA-118",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I suspect that this is probably a problem for William.\n\nA user has tried to upload an EBrida file and discoverd that the plate well sequence and hence the plate maps are bad in the batch file.\n\nThe first four wells are blank and the 2 spillover does a strange thing with a mostly empty plate following.\n\nI will send you copies of the pertinent files.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/118",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Person name identification in process upload is space sensitive",
          "key": "KEA-119",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When a user uploads a spreadsheet in the process handling and they put in the name of a person in a column that takes a person, the mechanism that finds the person seems to be failing if the name of the person has been entered with a space prepended or appended.\n\nIt seems to be a continuing problem that when users enter the names of people in Kea they seem to want to either start with a space or end with one.\n\nWhen the code that then tries to identify the people  from that name it regards spaces. Some strip() calls in the right places would probably fix this.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/119",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Uploading companies doesn't find person",
          "key": "KEA-120",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the Company import wizard is used, it doesn't seem to be able to find the contact person.\nNot sure whether things have been set up properly to point at the Person table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/120",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "I'm pretty sure that I have now attached people to companies\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:22:19Z"
            }
          ]
        },
        {
          "summary": "When using add company get integrity error id already exists",
          "key": "KEA-121",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I tried to add a company using the /sauvblanc/company/add/ form I get an error...\n\n```\nIntegrityError: duplicate key value violates unique constraint \"sauvblanc_company_pkey\"\nDETAIL:  Key (id)=(1) already exists.\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/121",
          "labels": [],
          "comments": [
            {
              "body": "Non-egg line in error stack:\n\n```\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/admin.py\", line 306, in add_view\n    result = super(ProvenanceImportExportModelAdmin, self).add_view(request, *args, **kwargs)\n```\n",
              "author": "zane.gilmore",
              "created": "2014-10-28T04:10:50Z"
            },
            {
              "body": "Same thing happens for Vineyards\n",
              "author": "zane.gilmore",
              "created": "2014-10-28T04:13:06Z"
            },
            {
              "body": "Fixed now I got my wires crossed,\neither way I'm closing this\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:23:31Z"
            }
          ]
        },
        {
          "summary": "Spreadsheets with empty worksheets give index out of range",
          "key": "KEA-122",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When the user uploads an EBrida spreadsheet that has non-compliant worksheets i.e. empty ones that Excell adds by default an exception is generated \"IndexError: list index out of range\"\n\nNon-egg entries in the call stack:\n\n```\nFile \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 271, in handle_label\n    sheet_data += self.parse_sheet(sheet)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 314, in parse_sheet\n    for k, v in enumerate(sheet.row_values(0)):\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/122",
          "labels": [
            "EBrida_interface",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "For a work-around you can just delete the empty spreadsheets in the excel file then import it. It works then.\n",
              "created": "2014-10-29T03:23:54Z"
            },
            {
              "body": "Absolutely. However I thought that I had better record this bug to fix in a future release.\n",
              "author": "zane.gilmore",
              "created": "2014-10-29T03:24:50Z"
            },
            {
              "body": "Just had another scientist with this issue.\n",
              "author": "zane.gilmore",
              "created": "2015-04-20T01:25:06Z"
            },
            {
              "body": "This still needs to be done\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:59:54Z"
            }
          ]
        },
        {
          "summary": "Audited tables in batch spreadsheet definitions include audit columns",
          "key": "KEA-123",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The file created to upload data for defining a batch allows the addition of models/tables from non-dynamic tables.\n\nWhen I added the person table for the Sauvignon Blanc properties prov-type the worksheet was added as it should have been for the batch file spreadsheet for uploading for a batch.\nHowever the four auditing columns were added to the worksheet. These columns can be populated either automatically at upload and the user won't want to know about them.\n\nThis will be a problem for any tables/models that have the auditing columns.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/123",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Noted. This will be a quick fix. I'll get to it later today if not urgent.\n\nRegards,\nDarryl\n",
              "created": "2014-10-29T20:54:40Z"
            },
            {
              "body": "No worries that's fine.\nAlso we perhaps need to ensure that other columns like id are excluded.\nAnd columns like EntryDate need to be handled in a way that will default to the correct value, though I am hoping that the `(auto_now_add=True)` will be applied appropriately.\n",
              "author": "zane.gilmore",
              "created": "2014-10-29T20:59:45Z"
            },
            {
              "body": "Yes, I was surprised to see id on your spreadsheet (doesn't show in 'numbers'). I'll have to dig into the import_export package to find out why.\n\nI've not tested 'auto_now_add', let me know how that flies.\n",
              "created": "2014-10-29T21:03:38Z"
            },
            {
              "body": "I think that this is done now\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:25:19Z"
            },
            {
              "body": "Sorry this is not done.\nI have just seen those audit columns in the batch spreadsheet for person.\n",
              "author": "zane.gilmore",
              "created": "2015-03-04T00:16:54Z"
            },
            {
              "body": "I think this is a problem only if we retain multi-sheet excel imports during provenance sample initialisation which I'm pushing for discarding. #124\n",
              "created": "2015-03-09T21:26:02Z"
            },
            {
              "body": "24becedbd390f171ee12445ef17d19b02de07203\n",
              "created": "2015-04-12T02:48:51Z"
            }
          ]
        },
        {
          "summary": "Errors importing new person via batch spreadsheet upload",
          "key": "KEA-124",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have added person table to the prov' type for trial_plot batches\n\nWhen I try to add in a person then use them in the company sheet I get a bunch of errors:\n\n```\n\nCompany import errors:\n\n    Line number: 1 Person matching query does not exist.\n\nPerson import errors:\n\n    Line number: 1\n\n    get() returned more than one Person -- it returned 82!\n\n    Traceback (most recent call last):\n    File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\", line 323, in import_data\n    instance, new = self.get_or_init_instance(instance_loader, row)\n    File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\", line 150, in get_or_init_instance\n    instance = self.get_instance(instance_loader, row)\n    MultipleObjectsReturned: get() returned more than one Person -- it returned 82!\n    Line number: 2\n\n    get() returned more than one Person -- it returned 82!\n\n    Traceback (most recent call last):\n    File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\", line 323, in import_data\n    instance, new = self.get_or_init_instance(instance_loader, row)\n    File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\", line 150, in get_or_init_instance\n    instance = self.get_instance(instance_loader, row)\n    MultipleObjectsReturned: get() returned more than one Person -- it returned 82!\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/124",
          "labels": [
            "Provenance",
            "bug",
            "question"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\n> I have added person table to the prov' type for trial_plot batches\n\nAdded a person dynamic table? I don't understand. Do you mean the current\nPerson table is not enough?\n\nRegards,\nDarryl\n\n> When I try to add in a person then use them in the company sheet I get a\n> bunch of errors:\n> \n> Company import errors:\n> \n> ```\n> Line number: 1 Person matching query does not exist.\n> ```\n> \n> Person import errors:\n> \n> ```\n> Line number: 1\n> \n> get() returned more than one Person -- it returned 82!\n> \n> Traceback (most recent call last):\n> File\n> ```\n> \n> \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\",\n> line 323, in import_data\n>     instance, new = self.get_or_init_instance(instance_loader, row)\n>     File\n> \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\",\n> line 150, in get_or_init_instance\n>     instance = self.get_instance(instance_loader, row)\n>     MultipleObjectsReturned: get() returned more than one Person -- it\n> returned 82!\n>     Line number: 2\n> \n> ```\n> get() returned more than one Person -- it returned 82!\n> \n> Traceback (most recent call last):\n> File\n> ```\n> \n> \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\",\n> line 323, in import_data\n>     instance, new = self.get_or_init_instance(instance_loader, row)\n>     File\n> \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\",\n> line 150, in get_or_init_instance\n>     instance = self.get_instance(instance_loader, row)\n>     MultipleObjectsReturned: get() returned more than one Person -- it\n> returned 82!\n> \n> 窶能n> Reply to this email directly or view it on GitHub.\n",
              "created": "2014-10-29T23:31:20Z"
            },
            {
              "body": "No, I added the present non-dynamic person table to the provenance type to be used by the provenancelist object's provenancetype so that a person sheet appeared in the spreadsheet to be up-loaded\n",
              "author": "zane.gilmore",
              "created": "2014-10-29T23:35:18Z"
            },
            {
              "body": "Did we get this going?\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:26:42Z"
            },
            {
              "body": "Yes, works for me when importing Company\n",
              "created": "2015-02-26T01:41:32Z"
            },
            {
              "body": "This is still not working when I try it.\nThere is a very real possibility that you do not understand the issue or I am doing something wrong, so we should talk about this at some point.\n",
              "author": "zane.gilmore",
              "created": "2015-03-04T00:31:59Z"
            },
            {
              "body": "No, I get it now. I note also that the Person sheet also includes the Audit fields - not desirable.\n\nThis is because when the code creates the import/export Resource for a model in this situation it does its best to evaluate the fields on the model. For Biomarker I was customising each Resource almost on a per model basis to get fine-grained control over it. A possible solution would be to create a PersonResource.\n\nHowever, I'm still having serious doubts about using this multi-sheet import for creating the (e.g) 'harvest samples' in sample initialisation. I do understand that it is a better workflow for users to have a single multisheet spreadsheet rather than forcing them to sort out their companies, trial plots, vineyard blocks etc through /provenance/admin/ **before** sample initialisation but this will certainly be a more robust solution. What do you think?\n",
              "created": "2015-03-05T03:31:44Z"
            },
            {
              "body": "When I built the sample initialisation widget I allowed for users to upload a multi-sheet excel file with data loaded for all relevant tables in the provenance, i.e. company -> vineyard -> vineyardblock -> harvest. \n\nThe vineyard for example will have a foreign key to a company and my code allowed for the company to be created, vineyards created etc all on the same upload. Later a request was made for a 'custom' admin for a provenance which gives the user excel upload for each of the tables individually and avoids the problems of creating objects on the fly. I added a note on github for this issue suggesting that the multisheet upload on sample initialisation be dumped and only having the single sheet for say 'harvest' import to initialise samples (as for example the crop sample initialisation).\n",
              "created": "2015-03-09T20:53:56Z"
            },
            {
              "body": "OK,\nJust trying to upload batch file for a provenance.\nam getting this error:\n\n```\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/views/initialisation.py\", line 164, in process_step\ndryrun=False)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/excel/utils.py\", line 100, in import_provenance_definition\ndataset, dry_run=dryrun, raise_errors=raise_errors)\nIntegrityError: null value in column \"trial_plot_id\" violates not-null constraint\nDETAIL: Failing row contains (10, null, 2015, null, 2014-10-01, null, null, null, , null, null, null, null, 1.10, null, null, 6).\n\nAn import error occurred, please return to the previous step and check the fields in the spreadsheet, especially those that are referencing by name objects not yet created. \n```\n\nThis appears to be because I am trying to create a \"Cultivationdetail \" row that uses a foreign key to a row defined elsewhere in the spreadsheet.\nThat row for a trial plot has not yet been inserted into the table so the DB throws a constraint violation.\n\nWhat is needed is a bit of applied graph theory.\nYou need to create a tree structure of each of the classes/tables starting with the provenance list object at the root.\nEach child from the root describes a referential constraint.\nThen you use this tree structure to decide the order of the inserts into the DB.\nYou do a depth first search of the tree and whenever you get to a leaf node you know you can insert that. You then can move up to the parent of that node you have just inserted and if it has no more children you can insert that. If it does have any any children you follow that down until you get a leaf then rinse and repeat.\n\nUm... I hope I described that sufficiently.\n",
              "author": "zane.gilmore",
              "created": "2015-04-02T01:13:15Z"
            },
            {
              "body": "Just thinking about it here is some pseudo code for the algorithm:\n\n```\ndef insert_node(thenode):\n    thechildren =  get_the_children_of_node(thenode)\n    while len(thechildren) > 0:\n        this_child = get_the_next_child\n        insert_node(this_child)  # !!! recursive call !!!\n        delete this_child\n    insert thenode\n```\n\nThis is a pretty simple algorithm if you use recursion. And it's very scalable.\n",
              "author": "zane.gilmore",
              "created": "2015-04-02T01:58:12Z"
            },
            {
              "body": "The integrity tree object is working now for existing provenances and I'm confident that it is correctly discovering the ordering required for multisheet import to work.\n\nBut still not fixed is the Person sheet when Person table is included in ProvenanceType.\n",
              "created": "2015-04-16T03:19:07Z"
            },
            {
              "body": "I'm very sorry but I've had to give up on this. At the very least I've put it away for later.\n",
              "created": "2015-04-22T00:37:51Z"
            },
            {
              "body": "Righto,\nIt's best to step back from a problem that is looking intractable anyway.\n\nPerhaps we can brainstorm at some point.\n",
              "author": "zane.gilmore",
              "created": "2015-04-22T03:05:11Z"
            },
            {
              "body": "I think we just gave up on this one.\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:01:28Z"
            }
          ]
        },
        {
          "summary": "Resample populations returning empty lists",
          "key": "KEA-125",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a population is clicked on in the resampling view for re-sampling populations many but not all populations return empty lists of plants to re-sample.\n\nWith help from Darryl this was diagnosed.\nIt was because the plant lists for resampling were never converted to using the elasticsearch data.\nIt is still using the original denormalised \"PlantDataForSearch\" table that must be rebuilt by the \n\"run_denormalised_rebuilds()\" stored function on the database.\n\nSo we will need to convert the resample view to use the elasticsearch data instead of this table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/125",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Select plant for resampling view now uses elasticsearch.\n\nRegards,\nDarryl\n",
              "created": "2014-11-01T04:59:04Z"
            }
          ]
        },
        {
          "summary": "Can't do location handling without crop",
          "key": "KEA-126",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The location handling is insisting on a crop.\nThis is wrong location handling must be accessible form a provenance.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/126",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Changed view decorator to `require_provenance_or_crop`.\n",
              "created": "2014-11-06T23:21:34Z"
            }
          ]
        },
        {
          "summary": "Icon links in location handling swapped",
          "key": "KEA-127",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The edit link goes to the add new location and the plus link goes to the edit location lists\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/127",
          "labels": [],
          "comments": [
            {
              "body": "After discussion I believe we decided that the plus link is fine but the edit link needed correction. The edit link now points to locationtype/edit, include `next` in url and tweaked admin model to return to location type listing on save.\n\nAlso checking for permissions for these admin links (and the `Add LocationType` button).\n",
              "created": "2014-11-07T00:36:45Z"
            }
          ]
        },
        {
          "summary": "Add the ability to upload spreadsheets based on provenance types in admin",
          "key": "KEA-128",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the <provenance> Admin page we need to be able to add data without creating a sample batch.\nThe easiest way to do this would be to list all of the provenance-types for the provenance and be able to download and upload files based on those provenance-types.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/128",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I am not sure that I completely understand this issue but as far as I do understand this, it has been done.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:28:35Z"
            }
          ]
        },
        {
          "summary": "Change issue link to GitHub!",
          "key": "KEA-129",
          "status": "Done",
          "description": "currently link to Trac\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/129",
          "labels": [],
          "comments": [
            {
              "body": "Darryl,\nthis is a 5min job.\nCould you please?\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:30:39Z"
            },
            {
              "body": "Zane, I can't see from these comments what the issue is. Is this a duplicate of the tooltip issue #130?\n",
              "created": "2015-02-04T19:25:29Z"
            },
            {
              "body": "Sorry Darryl,\nOn the right hand side of the dark blue bar of Kea, where the breadcrumbs are and the dropdowns for crop and provenance there is a link \"Trac Reporting and Documentation\".\n\nCould you please change it to \"Github Issue Reporting\" and point to:\nhttps://github.com/PlantandFoodResearch/Kea/wiki/Issue-Entry-Instructions\n",
              "author": "zane.gilmore",
              "created": "2015-02-04T21:49:37Z"
            }
          ]
        },
        {
          "summary": "browse Process add/delete tooltip confusion",
          "key": "KEA-130",
          "status": "Done",
          "description": "Tooltip says add over del icon\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/130",
          "labels": [],
          "comments": [
            {
              "body": "I'm guessing this will be a datagrid view, which view please? Thanks in advance.\n",
              "created": "2014-12-17T21:56:36Z"
            },
            {
              "body": "That's the Browse Process datagrid.\nThe delete icon still has an \"Add\" tooltip.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:34:20Z"
            },
            {
              "body": "Fixed cb5b9ff\n",
              "created": "2015-04-09T20:39:39Z"
            }
          ]
        },
        {
          "summary": "Export to excel in datagrid not handling MS apostrophe",
          "key": "KEA-131",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "MS Office applications have a nasty habit of putting their own punctuation marks in instead of the usual ones.\n\nIf the original data has been added via MS Excel or any MS Office app' then apostrophes are u'\\u2019'\nAlso double quotes are stupid symmetrical things, also weird unicode chars.\n\nWhen the datagrid then tries to create the spreadsheet in an export it barfs.\n\nThis is very irritating, but to maintain compatibility we will need to fix this.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/131",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I seem to recall that Darryl had a look at this.\nNot sure how much progress was made.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:37:03Z"
            },
            {
              "body": "I don't think I had much of a look, nor fixed it.\n",
              "created": "2015-02-04T04:27:22Z"
            },
            {
              "body": "Please send me example of said apostrophes.\n\nThanks,\nDarryl\n",
              "created": "2015-03-02T22:41:25Z"
            },
            {
              "body": "Darryl,\nPlease find attached a file ready for import into the company table with a\ndescription containing the wonky quotes.\n\nI will have a quick Google around for how this is handled elsewhere.\n\nZane\n\nOn 3 March 2015 at 11:41, Darryl Cousins notifications@github.com wrote:\n\n> Please send me example of said apostrophes.\n> \n> Thanks,\n> Darryl\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/131#issuecomment-76842988\n> .\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T21:30:55Z"
            },
            {
              "body": "These characters are called \"smart quotes\" and make the quotes supposedly look pretty.\nThis code snippet looks like it could be quite useful.\nhttps://djangosnippets.org/snippets/2235/\n\nThis is another page that might show some more insight.\nhttp://stackoverflow.com/questions/6606291/how-can-i-decode-this-utf-8-string-picked-on-a-random-website-and-saved-by-the\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T21:41:38Z"
            },
            {
              "body": "Great, thank you!\n\nCheers,\nDarryl\n\nOn Wed, Mar 4, 2015 at 11:12 AM, Zane Gilmore notifications@github.com\nwrote:\n\n> Darryl,\n> These characters are called \"smart quotes\" and make the quotes supposedly\n> look pretty.\n> This code snippet looks like it could be quite useful.\n> https://djangosnippets.org/snippets/2235/\n> \n> This is another page that might show some more insight.\n> \n> http://stackoverflow.com/questions/6606291/how-can-i-decode-this-utf-8-string-picked-on-a-random-website-and-saved-by-the\n> \n> On 4 March 2015 at 10:30, Zane Gilmore zane.gilmore@gmail.com wrote:\n> \n> > Darryl,\n> > Please find attached a file ready for import into the company table with\n> > a\n> > description containing the wonky quotes.\n> > \n> > I will have a quick Google around for how this is handled elsewhere.\n> > \n> > Zane\n> > \n> > On 3 March 2015 at 11:41, Darryl Cousins notifications@github.com\n> > wrote:\n> > \n> > > Please send me example of said apostrophes.\n> > > \n> > > Thanks,\n> > > Darryl\n> > > \n> > > 窶能n> > > Reply to this email directly or view it on GitHub\n> > > <\n> > > https://github.com/PlantandFoodResearch/Kea/issues/131#issuecomment-76842988\n> > > \n> > > .\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/131#issuecomment-77047885\n> .\n",
              "created": "2015-03-03T22:51:52Z"
            },
            {
              "body": "Zane has added good notes and references here. My experience with Biomarker was that the error would come up when the attempt to 'open' the file, i.e. before any work by import_export.\n\n窶輝lan: 窶妓rite a test to isolate the problem which I believe will be when opening the uploaded file in the method kea.provenance.forms.validators.validate_spreadsheet.\n",
              "created": "2015-03-09T20:46:59Z"
            },
            {
              "body": "Added cleaning and search/replace to dynamic models and import to replace ms apostrophes.\n",
              "created": "2015-03-25T02:46:20Z"
            }
          ]
        },
        {
          "summary": "Import error reporting for sample init needs more detail",
          "key": "KEA-132",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the spreadsheet to import provenance data is used while initialisin samples in the alternate provenances and there are problems with it.\n\nThe error reporting for each error does not say what column the problem is occurring on.\nIt's good that the line number is reported but we also need the column.\ne.g.\n\n```\nVineyard Block import errors:\n\n    Line number: 1 '' value must be an integer.\n    Line number: 2 '' value must be an integer.\n    Line number: 3 '' value must be an integer. \n```\n\nThis makes it very difficult to figure out what is going wrong.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/132",
          "labels": [
            "Provenance",
            "UI Issue",
            "duplicate"
          ],
          "comments": [
            {
              "body": "This will need prioritisation too :-)\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T02:30:20Z"
            },
            {
              "body": "Hi Zane, Yes I am looking into this because changes I made to fix #138 have\nhad implications with spreadsheet import.\n\nOn Tue, Feb 3, 2015 at 3:30 PM, Zane Gilmore notifications@github.com\nwrote:\n\n> This will need prioritisation too :-)\n> \n> 窶能n> Reply to this email directly or view it on GitHub.\n",
              "created": "2015-02-03T03:16:47Z"
            },
            {
              "body": "Have now captured the column name at least.\n\nOn Tue, Feb 3, 2015 at 4:16 PM, Darryl Cousins darryljcousins@gmail.com wrote:\n\n> Hi Zane, Yes I am looking into this because changes I made to fix #138 have\n> had implications with spreadsheet import.\n> \n> On Tue, Feb 3, 2015 at 3:30 PM, Zane Gilmore notifications@github.com\n> wrote:\n> \n> > This will need prioritisation too :-)\n> > \n> > 窶能n> > Reply to this email directly or view it on GitHub.\n",
              "created": "2015-02-03T03:59:20Z"
            },
            {
              "body": "I think that the column name is the absolute requirement.\nEven if we didn't know exactly the problem at least we know which column.\n\nI just spent about half an hour trying to track down which column was failing on the harvest_sample export.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:07:14Z"
            },
            {
              "body": "This can be considered a duplicate of #30.\nHowever I have just noticed that this particular issue is for the Sample Init'\n\nSo perhaps we should just assume that this bug will not be closed until both imports are reporting the columns.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T22:34:46Z"
            },
            {
              "body": "Provisionally closing with the addition of column name where possible.\n",
              "created": "2015-02-04T05:28:55Z"
            }
          ]
        },
        {
          "summary": "E-brida import not processing breeder names.",
          "key": "KEA-133",
          "status": "Done",
          "description": "Uploading an e-brida file into the Kea/E-brida sample initiator failed for me, giving an error ending with this:\nFile \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 404, in create_samples\n    plant, genotype, population = self.create_pedigree_data(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 527, in create_pedigree_data\n    population = self.get_or_create_population(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 641, in get_or_create_population\n    p.Breeder = self.get_breeder(data_row)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 550, in get_breeder\n    breeder_name = data_row['BreederName']\nKeyError: 'BreederName'\n\nThe spreadsheet's column header was: breederName\nThe breeder's name was: Canhong Cheng\n, which exists in the database.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/133",
          "labels": [],
          "comments": [
            {
              "body": "Try changing the value in the column header from \"breederName\" to \"BreederName\" it will be case sensitive. That should allow you to import the spreadsheet.\n",
              "created": "2015-01-04T20:49:01Z"
            },
            {
              "body": "Hey that does work! \n\nI did try fiddling around with spaces and capital letters and things, but I can't have had the right combination. Which is odd, because given the dictionary key this would be the obvious combination to try!\n\nThanks for your help.\n",
              "created": "2015-01-04T21:05:25Z"
            }
          ]
        },
        {
          "summary": "Cannot find sample BAZ5937 from plate 1PS5",
          "key": "KEA-134",
          "status": "Done",
          "description": "I have a printed out kea plate sheet for 2014 Zespri plate 1PS5. The first sample in the plate is BAZ5937.\n\nSelecting look at data > plates and filtering for plate 1PS5 shows plate 1PS5 exists;\nSelecting look at data > samples and filtering for plate 1PS5 or sample BAZ5937 brings up nothing.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/134",
          "labels": [],
          "comments": [
            {
              "body": "I think that this seems a bit confusing for me.\n\nCould I please get a bit more detail?\nIs this on the Live instance?\n\nBecause none of those entities seem to exist on the live instance.\nOne of them exists in the test instance.\n",
              "author": "zane.gilmore",
              "created": "2015-02-03T23:50:59Z"
            },
            {
              "body": "This is on the live instance, and was part of the 2014 Zespri sex testing\nproject.\n\nThere was a sample batch created for that project, SaB10RW. It included a\nbunch of plates starting with 1PR- and 1PS-. We printed off the plate\nsheets, and collected the samples.\n\nTwo of the plates in that sample batch were called 1PS5 and 1PS6. We have\nthe printed plate sheets in a folder here. The sheet for 1PS5 says it is\nfrom the file 'Printer\nVersionebrida_sample_batch_SaB10RW-20140912-151553.xls'. It contains\nsamples from 'BAZ5847' to 'BAZ5936'.\n\nHowever, now when I log on to Kea and choose to look at samples and filter\nthe samples for that sample batch, doesn't show plates 1PS5 or 1PS6 - it\nstops at 1PS4. Searching for sample 'BAZ5847' doesn't show any results, and\nnor does filtering all samples for plate 1PS5.\n\nHowever, when I instead choose to look at plates, plate 1PS5 does indeed\nexist.\n\nMike\n\nOn 4 February 2015 at 12:51, Zane Gilmore notifications@github.com wrote:\n\n> I think that this seems a bit confusing for me.\n> \n> Could I please get a bit more detail?\n> Is this on the Live instance?\n> \n> Because none of those entities seem to exist on the live instance.\n> One of them exists in the test instance.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/134#issuecomment-72762200\n> .\n",
              "created": "2015-02-04T21:45:13Z"
            },
            {
              "body": "I have restored the missing data but still need to diagnose what went wrong.\n\nNot sure that I am going to be able to but will have a rummage around.\nWill also instrument the delete batch utility before I use it again.\n",
              "author": "zane.gilmore",
              "created": "2015-02-10T03:55:58Z"
            },
            {
              "body": "Cool. Did you manage to find it in the database and restore it somehow, or\ndid you have to create it from scratch using the spreadsheet I sent?\n\nOn 10 February 2015 at 16:55, Zane Gilmore notifications@github.com wrote:\n\n> I have restored the missing data but still need to diagnose what went\n> wrong.\n> \n> Not sure that I am going to be able to but will have a rummage around.\n> Will also instrument the delete batch utility before I use it again.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/134#issuecomment-73640506\n> .\n",
              "created": "2015-02-10T05:47:18Z"
            },
            {
              "body": "The latter.\nI probably could have done it from an old DB version but that would probably have taken just as long.\n",
              "author": "zane.gilmore",
              "created": "2015-02-10T22:16:06Z"
            },
            {
              "body": "Have now instrumented delete_batch command.\nAny more batches that are deleted will be fully logged.\n",
              "author": "zane.gilmore",
              "created": "2015-02-11T20:27:36Z"
            }
          ]
        },
        {
          "summary": "Deleting field in Provenance definition not working",
          "key": "KEA-135",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the Provenance Definition editor the delete column/field is not working.\n\nWhen I set the tick box and press save I get a 500 error with the following error email produced:\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 390, in wrapper\n    return self.admin_site.admin_view(view)(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/decorators/cache.py\", line 89, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/sites.py\", line 202, in inner\n    return view(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/transaction.py\", line 223, in inner\n    return func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 1124, in change_view\n    self.save_related(request, form, formsets, True)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 782, in save_related\n    self.save_formset(request, form, formset, change=change)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 770, in save_formset\n    formset.save()\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/forms/models.py\", line 514, in save\n    return self.save_existing_objects(commit) + self.save_new_objects(commit)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/forms/models.py\", line 630, in save_existing_objects\n    obj.delete()\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/base.py\", line 674, in delete\n    collector.delete()\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/deletion.py\", line 62, in decorated\n    func(self, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/deletion.py\", line 322, in delete\n    sender=model, instance=obj, using=self.using\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/dispatch/dispatcher.py\", line 170, in send\n    response = receiver(signal=self, sender=sender, **named)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/models.py\", line 291, in provenance_definition_field_post_delete\n    utils.delete_db_column(model_class, instance.name)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/utils.py\", line 193, in delete_db_column\n    db.delete_column(table_name, name)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 54, in _column_rm\n    return func(self, table, column, *args, **opts)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 911, in delete_column\n    self.execute(self.delete_column_string % params, [])\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 282, in execute\n    cursor.execute(sql, params)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 58, in execute\n    six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 54, in execute\n    return self.cursor.execute(query, args)\n\nDatabaseError: column \"location_lat_long\" of relation \"sauvignonblanc_vineyardblock\" does not exist\n\n\n\n<WSGIRequest\npath:/admin/provenance/provenancedefinition/12/,\nGET:<QueryDict: {}>,\nPOST:<QueryDict: {u'dynamic_model_fields-7-id': [u'89'], u'dynamic_model_fields-1-description': [u'What year the vines were planted'], u'dynamic_model_fields-7-table': [u'12'], u'dynamic_model_fields-5-order': [u'0'], u'dynamic_model_fields-6-id': [u'88'], u'dynamic_model_fields-0-name': [u'name'], u'dynamic_model_fields-9-name': [u'fruiting_wire_height'], u'dynamic_model_fields-__prefix__-id': [u''], u'dynamic_model_fields-8-name': [u'location_lat_long'], u'dynamic_model_fields-4-type': [u'django.db.models.fields.TextField'], u'dynamic_model_fields-TOTAL_FORMS': [u'10'], u'dynamic_model_fields-2-table': [u'12'], u'dynamic_model_fields-9-order': [u'0'], u'dynamic_model_fields-9-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"max_digits\":4,\\r\\n  \"decimal_places\":2,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-7-type': [u'django.db.models.fields.CharField'], u'dynamic_model_fields-1-order': [u'0'], u'name': [u'VineyardBlock'], u'dynamic_model_fields-1-id': [u'86'], u'dynamic_model_f\n ields-1-type': [u'django.db.models.fields.BigIntegerField'], u'dynamic_model_fields-5-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-9-table': [u'12'], u'dynamic_model_fields-1-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-__prefix__-type': [u''], u'dynamic_model_fields-5-name': [u'row_orientation'], u'dynamic_model_fields-MAX_NUM_FORMS': [u'1000'], u'dynamic_model_fields-0-table': [u'12'], u'description': [u'A block within a vineyard'], u'dynamic_model_fields-0-type': [u'django.db.models.fields.CharField'], u'dynamic_model_fields-__prefix__-name': [u''], u'dynamic_model_fields-6-description': [u'Which clone was used for the block'], u'dynamic_model_fields-4-id': [u'44'], u'dynamic_model_fields-8-type': [u'django.db.models.fields.related.ForeignKey'], u'dynamic_model_fields-8-options': [u'{\\r\\n  \"to\":\"pndata.Location\",\\r\\n  \"to_field\":\"Name\",\\r\\n  \"unique\":true,\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'],\n  u'dynamic_model_fields-0-options': [u'{\\r\\n  \"unique\":true,\\r\\n  \"max_length\":200\\r\\n}'], u'dynamic_model_fields-6-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"UCD1\",\\r\\n      \"UCD1\"\\r\\n    ],\\r\\n    [\\r\\n      \"MS\",\\r\\n      \"MS\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'dynamic_model_fields-2-name': [u'rootstock'], u'dynamic_model_fields-3-type': [u'django.db.models.fields.related.ForeignKey'], u'dynamic_model_fields-3-description': [u'The vineyard that this block is a part of.'], u'db_table': [u''], u'dynamic_model_fields-7-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"VSP\",\\r\\n      \"VSP\"\\r\\n    ],\\r\\n    [\\r\\n      \"VSP 2 canes\",\\r\\n      \"VSP 2 canes\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'app_label': [u'sauvignonblanc'], u'dynamic_model_fields-3-table': [u'12'], u'dynamic_model_fields-8-id': [u'115'], u'dynamic_model_fields-6-t\n able': [u'12'], u'dynamic_model_fields-7-name': [u'training_system'], u'dynamic_model_fields-4-description': [u'Some more misc details if required'], u'dynamic_model_fields-5-table': [u'12'], u'dynamic_model_fields-3-order': [u'0'], u'next': [u''], u'dynamic_model_fields-5-description': [u'What direction do the rows run?\\r\\nDegrees from north. ( <180)'], u'dynamic_model_fields-6-name': [u'clone'], u'dynamic_model_fields-__prefix__-order': [u'0'], u'dynamic_model_fields-5-type': [u'django.db.models.fields.BigIntegerField'], u'dynamic_model_fields-2-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"SO4\",\\r\\n      \"SO4\"\\r\\n    ],\\r\\n    [\\r\\n      \"101-14\",\\r\\n      \"101-14\"\\r\\n    ],\\r\\n    [\\r\\n      \"RG\",\\r\\n      \"RG\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'dynamic_model_fields-__prefix__-description': [u''], u'dynamic_model_fields-4-name': [u'description'], u'dynamic_model_fields-2-type': [u'django.db.model\n s.fields.CharField'], u'dynamic_model_fields-0-description': [u'The unique name for the block'], u'dynamic_model_fields-9-description': [u'height of fruiting wire meters'], u'dynamic_model_fields-3-name': [u'vineyard'], u'dynamic_model_fields-6-order': [u'0'], u'dynamic_model_fields-5-id': [u'85'], u'dynamic_model_fields-__prefix__-table': [u'12'], u'dynamic_model_fields-7-description': [u'Which training system was used for the block'], u'dynamic_model_fields-2-id': [u'87'], u'dynamic_model_fields-8-table': [u'12'], u'dynamic_model_fields-__prefix__-options': [u''], u'dynamic_model_fields-7-order': [u'0'], u'dynamic_model_fields-8-description': [u'The GPS location of the Vineyard block'], u'_save': [u'Save'], u'dynamic_model_fields-3-id': [u'43'], u'dynamic_model_fields-2-description': [u'Which rootstock was used for the block'], u'dynamic_model_fields-1-table': [u'12'], u'dynamic_model_fields-4-table': [u'12'], u'dynamic_model_fields-6-type': [u'django.db.models.fields.Char  Field'], u'csrfmiddlewaretoken': [u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa'], u'dynamic_model_fields-9-type': [u'django.db.models.fields.DecimalField'], u'dynamic_model_fields-0-order': [u'0'], u'dynamic_model_fields-4-order': [u'0'], u'dynamic_model_fields-2-order': [u'0'], u'dynamic_model_fields-4-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-3-options': [u'{\\r\\n  \"to\":\"sauvignonblanc.Vineyard\",\\r\\n  \"to_field\":\"name\"\\r\\n}'], u'dynamic_model_fields-8-DELETE': [u'on'], u'dynamic_model_fields-9-id': [u'100'], u'dynamic_model_fields-1-name': [u'year_planted'], u'dynamic_model_fields-0-id': [u'42'], u'dynamic_model_fields-INITIAL_FORMS': [u'10'], u'dynamic_model_fields-8-order': [u'0']}>,\nCOOKIES:{'csrftoken': 'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n 'sessionid': 'jvso4tbw1vkxey288i5n1vmsv97n20bb',\n 'username': 'cflzjg'},\nMETA:{'CONTENT_LENGTH': '13657',\n 'CONTENT_TYPE': 'multipart/form-data; boundary=---------------------------1889336725434027363648371802',\n u'CSRF_COOKIE': u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'csrftoken=y9ASniU60COVYoVJWMyZuVl8PSs81hEa; sessionid=jvso4tbw1vkxey288i5n1vmsv97n20bb; username=cflzjg',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_REFERER': 'http://keatest.pfr.co.nz/admin/provenance/provenancedefinition/12/',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101 Firefox/35.0',\n 'HTTP_X_FORWARDED_FOR': '10.38.8.102',\n 'HTTP_X_FORWARDED_HOST': 'keatest.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'keatest.pfr.co.nz',\n 'PATH_INFO': u'/admin/provenance/provenancedefinition/12/',\n 'QUERY_STRING': '',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'POST',\n 'REQUEST_URI': '/admin/provenance/provenancedefinition/12/',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb22.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb22.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x21255d0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x46e5d20>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/135",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nWhen I create a ProvenanceDefinition with a couple of\nProvenanceDefinitionFields then I can delete the fields without any trouble\nusing the admin edit form.\n\nI think the trouble you are having here is to do with this model and this\nfield. I am investigating.\n\nRegards,\nDarryl\n\nOn Tue, Feb 3, 2015 at 10:28 AM, Zane Gilmore notifications@github.com\nwrote:\n\n> In the Provenance Definition editor the delete column/field is not working.\n> \n> When I set the tick box and press save I get a 500 error with the\n> following error email produced:\n> \n> Traceback (most recent call last):\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n>     response = callback(request, _callback_args, *_callback_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 390, in wrapper\n>     return self.admin_site.admin_view(view)(_args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n>     response = view_func(request, _args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/decorators/cache.py\", line 89, in _wrapped_view_func\n>     response = view_func(request, _args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/sites.py\", line 202, in inner\n>     return view(request, _args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n>     return bound_func(_args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n>     response = view_func(request, _args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n>     return func(self, _args2, *_kwargs2)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/transaction.py\", line 223, in inner\n>     return func(_args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 1124, in change_view\n>     self.save_related(request, form, formsets, True)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 782, in save_related\n>     self.save_formset(request, form, formset, change=change)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 770, in save_formset\n>     formset.save()\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/forms/models.py\", line 514, in save\n>     return self.save_existing_objects(commit) + self.save_new_objects(commit)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/forms/models.py\", line 630, in save_existing_objects\n>     obj.delete()\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/base.py\", line 674, in delete\n>     collector.delete()\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/deletion.py\", line 62, in decorated\n>     func(self, _args, *_kwargs)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/deletion.py\", line 322, in delete\n>     sender=model, instance=obj, using=self.using\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/dispatch/dispatcher.py\", line 170, in send\n>     response = receiver(signal=self, sender=sender, **named)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/models.py\", line 291, in provenance_definition_field_post_delete\n>     utils.delete_db_column(model_class, instance.name)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/utils.py\", line 193, in delete_db_column\n>     db.delete_column(table_name, name)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 54, in _column_rm\n>     return func(self, table, column, _args, *_opts)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 911, in delete_column\n>     self.execute(self.delete_column_string % params, [])\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 282, in execute\n>     cursor.execute(sql, params)\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 58, in execute\n>     six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n> \n>   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 54, in execute\n>     return self.cursor.execute(query, args)\n> \n> DatabaseError: column \"location_lat_long\" of relation \"sauvignonblanc_vineyardblock\" does not exist\n> \n> <WSGIRequest\n> path:/admin/provenance/provenancedefinition/12/,\n> GET:<QueryDict: {}>,\n> POST:<QueryDict: {u'dynamic_model_fields-7-id': [u'89'], u'dynamic_model_fields-1-description': [u'What year the vines were planted'], u'dynamic_model_fields-7-table': [u'12'], u'dynamic_model_fields-5-order': [u'0'], u'dynamic_model_fields-6-id': [u'88'], u'dynamic_model_fields-0-name': [u'name'], u'dynamic_model_fields-9-name': [u'fruiting_wire_height'], u'dynamic_model_fields-__prefix__-id': [u''], u'dynamic_model_fields-8-name': [u'location_lat_long'], u'dynamic_model_fields-4-type': [u'django.db.models.fields.TextField'], u'dynamic_model_fields-TOTAL_FORMS': [u'10'], u'dynamic_model_fields-2-table': [u'12'], u'dynamic_model_fields-9-order': [u'0'], u'dynamic_model_fields-9-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"max_digits\":4,\\r\\n  \"decimal_places\":2,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-7-type': [u'django.db.models.fields.CharField'], u'dynamic_model_fields-1-order': [u'0'], u'name': [u'VineyardBlock'], u'dynamic_model_fields-1-id': [u'86'], u'dynamic_model_f\n>  ields-1-type': [u'django.db.models.fields.BigIntegerField'], u'dynamic_model_fields-5-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-9-table': [u'12'], u'dynamic_model_fields-1-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-__prefix__-type': [u''], u'dynamic_model_fields-5-name': [u'row_orientation'], u'dynamic_model_fields-MAX_NUM_FORMS': [u'1000'], u'dynamic_model_fields-0-table': [u'12'], u'description': [u'A block within a vineyard'], u'dynamic_model_fields-0-type': [u'django.db.models.fields.CharField'], u'dynamic_model_fields-__prefix__-name': [u''], u'dynamic_model_fields-6-description': [u'Which clone was used for the block'], u'dynamic_model_fields-4-id': [u'44'], u'dynamic_model_fields-8-type': [u'django.db.models.fields.related.ForeignKey'], u'dynamic_model_fields-8-options': [u'{\\r\\n  \"to\":\"pndata.Location\",\\r\\n  \"to_field\":\"Name\",\\r\\n  \"unique\":true,\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'],\n>   u'dynamic_model_fields-0-options': [u'{\\r\\n  \"unique\":true,\\r\\n  \"max_length\":200\\r\\n}'], u'dynamic_model_fields-6-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"UCD1\",\\r\\n      \"UCD1\"\\r\\n    ],\\r\\n    [\\r\\n      \"MS\",\\r\\n      \"MS\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'dynamic_model_fields-2-name': [u'rootstock'], u'dynamic_model_fields-3-type': [u'django.db.models.fields.related.ForeignKey'], u'dynamic_model_fields-3-description': [u'The vineyard that this block is a part of.'], u'db_table': [u''], u'dynamic_model_fields-7-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"VSP\",\\r\\n      \"VSP\"\\r\\n    ],\\r\\n    [\\r\\n      \"VSP 2 canes\",\\r\\n      \"VSP 2 canes\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'app_label': [u'sauvignonblanc'], u'dynamic_model_fields-3-table': [u'12'], u'dynamic_model_fields-8-id': [u'115'], u'dynamic_model_fields-6-t\n>  able': [u'12'], u'dynamic_model_fields-7-name': [u'training_system'], u'dynamic_model_fields-4-description': [u'Some more misc details if required'], u'dynamic_model_fields-5-table': [u'12'], u'dynamic_model_fields-3-order': [u'0'], u'next': [u''], u'dynamic_model_fields-5-description': [u'What direction do the rows run?\\r\\nDegrees from north. ( <180)'], u'dynamic_model_fields-6-name': [u'clone'], u'dynamic_model_fields-__prefix__-order': [u'0'], u'dynamic_model_fields-5-type': [u'django.db.models.fields.BigIntegerField'], u'dynamic_model_fields-2-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"SO4\",\\r\\n      \"SO4\"\\r\\n    ],\\r\\n    [\\r\\n      \"101-14\",\\r\\n      \"101-14\"\\r\\n    ],\\r\\n    [\\r\\n      \"RG\",\\r\\n      \"RG\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'dynamic_model_fields-__prefix__-description': [u''], u'dynamic_model_fields-4-name': [u'description'], u'dynamic_model_fields-2-type': [u'django.db.model\n>  s.fields.CharField'], u'dynamic_model_fields-0-description': [u'The unique name for the block'], u'dynamic_model_fields-9-description': [u'height of fruiting wire meters'], u'dynamic_model_fields-3-name': [u'vineyard'], u'dynamic_model_fields-6-order': [u'0'], u'dynamic_model_fields-5-id': [u'85'], u'dynamic_model_fields-__prefix__-table': [u'12'], u'dynamic_model_fields-7-description': [u'Which training system was used for the block'], u'dynamic_model_fields-2-id': [u'87'], u'dynamic_model_fields-8-table': [u'12'], u'dynamic_model_fields-__prefix__-options': [u''], u'dynamic_model_fields-7-order': [u'0'], u'dynamic_model_fields-8-description': [u'The GPS location of the Vineyard block'], u'_save': [u'Save'], u'dynamic_model_fields-3-id': [u'43'], u'dynamic_model_fields-2-description': [u'Which rootstock was used for the block'], u'dynamic_model_fields-1-table': [u'12'], u'dynamic_model_fields-4-table': [u'12'], u'dynamic_model_fields-6-type': [u'django.db.models.fields.Char  Field'\n>  ], u'csrfmiddlewaretoken': [u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa'], u'dynamic_model_fields-9-type': [u'django.db.models.fields.DecimalField'], u'dynamic_model_fields-0-order': [u'0'], u'dynamic_model_fields-4-order': [u'0'], u'dynamic_model_fields-2-order': [u'0'], u'dynamic_model_fields-4-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-3-options': [u'{\\r\\n  \"to\":\"sauvignonblanc.Vineyard\",\\r\\n  \"to_field\":\"name\"\\r\\n}'], u'dynamic_model_fields-8-DELETE': [u'on'], u'dynamic_model_fields-9-id': [u'100'], u'dynamic_model_fields-1-name': [u'year_planted'], u'dynamic_model_fields-0-id': [u'42'], u'dynamic_model_fields-INITIAL_FORMS': [u'10'], u'dynamic_model_fields-8-order': [u'0']}>,\n> COOKIES:{'csrftoken': 'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n>  'sessionid': 'jvso4tbw1vkxey288i5n1vmsv97n20bb',\n>  'username': 'cflzjg'},\n> META:{'CONTENT_LENGTH': '13657',\n>  'CONTENT_TYPE': 'multipart/form-data; boundary=---------------------------1889336725434027363648371802',\n>  u'CSRF_COOKIE': u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n>  'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,_/_;q=0.8',\n>  'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n>  'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n>  'HTTP_CONNECTION': 'Keep-Alive',\n>  'HTTP_COOKIE': 'csrftoken=y9ASniU60COVYoVJWMyZuVl8PSs81hEa; sessionid=jvso4tbw1vkxey288i5n1vmsv97n20bb; username=cflzjg',\n>  'HTTP_HOST': '127.0.0.1:54000',\n>  'HTTP_REFERER': 'http://keatest.pfr.co.nz/admin/provenance/provenancedefinition/12/',\n>  'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101 Firefox/35.0',\n>  'HTTP_X_FORWARDED_FOR': '10.38.8.102',\n>  'HTTP_X_FORWARDED_HOST': 'keatest.pfr.co.nz',\n>  'HTTP_X_FORWARDED_SERVER': 'keatest.pfr.co.nz',\n>  'PATH_INFO': u'/admin/provenance/provenancedefinition/12/',\n>  'QUERY_STRING': '',\n>  'REMOTE_ADDR': '127.0.0.1',\n>  'REQUEST_METHOD': 'POST',\n>  'REQUEST_URI': '/admin/provenance/provenancedefinition/12/',\n>  'SCRIPT_NAME': u'',\n>  'SERVER_NAME': 'aklweb22.pfr.co.nz',\n>  'SERVER_PORT': '54000',\n>  'SERVER_PROTOCOL': 'HTTP/1.1',\n>  'uwsgi.node': 'aklweb22.pfr.co.nz',\n>  'uwsgi.version': '2.0.5.1',\n>  'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x21255d0>,\n>  'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n>  'wsgi.input': <uwsgi._Input object at 0x46e5d20>,\n>  'wsgi.multiprocess': True,\n>  'wsgi.multithread': False,\n>  'wsgi.run_once': False,\n>  'wsgi.url_scheme': 'http',\n>  'wsgi.version': (1, 0)}>\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/135.\n",
              "created": "2015-02-03T19:36:28Z"
            },
            {
              "body": "Hi Zane,\n\nDELETE FROM \"provenance_provenancedefintionfield\" WHERE id=115;\nALTER TABLE \"sauvignonblanc_vineyardblock\" DROP COLUMN\n\"location_lat_long_id\" CASCADE;\n\nThat cleaned up the sauvignonblanc_vineyardblock table for me. And in doing\nso I see why the field was not deleted and I'll get it fixed: the admin\nattempted to delete column 'location_lat_long', the actual column is\n'location_lat_long_id'!\n\nRegards,\nDarryl\n\nOn Wed, Feb 4, 2015 at 8:36 AM, Darryl Cousins darryljcousins@gmail.com\nwrote:\n\n> Hi Zane,\n> \n> When I create a ProvenanceDefinition with a couple of\n> ProvenanceDefinitionFields then I can delete the fields without any trouble\n> using the admin edit form.\n> \n> I think the trouble you are having here is to do with this model and this\n> field. I am investigating.\n> \n> Regards,\n> Darryl\n> \n> On Tue, Feb 3, 2015 at 10:28 AM, Zane Gilmore notifications@github.com\n> wrote:\n> \n> > In the Provenance Definition editor the delete column/field is not\n> > working.\n> > \n> > When I set the tick box and press save I get a 500 error with the\n> > following error email produced:\n> > \n> > Traceback (most recent call last):\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n> >     response = callback(request, _callback_args, *_callback_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 390, in wrapper\n> >     return self.admin_site.admin_view(view)(_args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n> >     response = view_func(request, _args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/decorators/cache.py\", line 89, in _wrapped_view_func\n> >     response = view_func(request, _args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/sites.py\", line 202, in inner\n> >     return view(request, _args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n> >     return bound_func(_args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n> >     response = view_func(request, _args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n> >     return func(self, _args2, *_kwargs2)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/transaction.py\", line 223, in inner\n> >     return func(_args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 1124, in change_view\n> >     self.save_related(request, form, formsets, True)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 782, in save_related\n> >     self.save_formset(request, form, formset, change=change)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 770, in save_formset\n> >     formset.save()\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/forms/models.py\", line 514, in save\n> >     return self.save_existing_objects(commit) + self.save_new_objects(commit)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/forms/models.py\", line 630, in save_existing_objects\n> >     obj.delete()\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/base.py\", line 674, in delete\n> >     collector.delete()\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/deletion.py\", line 62, in decorated\n> >     func(self, _args, *_kwargs)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/deletion.py\", line 322, in delete\n> >     sender=model, instance=obj, using=self.using\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/dispatch/dispatcher.py\", line 170, in send\n> >     response = receiver(signal=self, sender=sender, **named)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/models.py\", line 291, in provenance_definition_field_post_delete\n> >     utils.delete_db_column(model_class, instance.name)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/utils.py\", line 193, in delete_db_column\n> >     db.delete_column(table_name, name)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 54, in _column_rm\n> >     return func(self, table, column, _args, *_opts)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 911, in delete_column\n> >     self.execute(self.delete_column_string % params, [])\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/South-1.0-py2.7.egg/south/db/generic.py\", line 282, in execute\n> >     cursor.execute(sql, params)\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 58, in execute\n> >     six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n> > \n> >   File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 54, in execute\n> >     return self.cursor.execute(query, args)\n> > \n> > DatabaseError: column \"location_lat_long\" of relation \"sauvignonblanc_vineyardblock\" does not exist\n> > \n> > <WSGIRequest\n> > path:/admin/provenance/provenancedefinition/12/,\n> > GET:<QueryDict: {}>,\n> > POST:<QueryDict: {u'dynamic_model_fields-7-id': [u'89'], u'dynamic_model_fields-1-description': [u'What year the vines were planted'], u'dynamic_model_fields-7-table': [u'12'], u'dynamic_model_fields-5-order': [u'0'], u'dynamic_model_fields-6-id': [u'88'], u'dynamic_model_fields-0-name': [u'name'], u'dynamic_model_fields-9-name': [u'fruiting_wire_height'], u'dynamic_model_fields-__prefix__-id': [u''], u'dynamic_model_fields-8-name': [u'location_lat_long'], u'dynamic_model_fields-4-type': [u'django.db.models.fields.TextField'], u'dynamic_model_fields-TOTAL_FORMS': [u'10'], u'dynamic_model_fields-2-table': [u'12'], u'dynamic_model_fields-9-order': [u'0'], u'dynamic_model_fields-9-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"max_digits\":4,\\r\\n  \"decimal_places\":2,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-7-type': [u'django.db.models.fields.CharField'], u'dynamic_model_fields-1-order': [u'0'], u'name': [u'VineyardBlock'], u'dynamic_model_fields-1-id': [u'86'], u'dynamic_model_f\n> >  ields-1-type': [u'django.db.models.fields.BigIntegerField'], u'dynamic_model_fields-5-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-9-table': [u'12'], u'dynamic_model_fields-1-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-__prefix__-type': [u''], u'dynamic_model_fields-5-name': [u'row_orientation'], u'dynamic_model_fields-MAX_NUM_FORMS': [u'1000'], u'dynamic_model_fields-0-table': [u'12'], u'description': [u'A block within a vineyard'], u'dynamic_model_fields-0-type': [u'django.db.models.fields.CharField'], u'dynamic_model_fields-__prefix__-name': [u''], u'dynamic_model_fields-6-description': [u'Which clone was used for the block'], u'dynamic_model_fields-4-id': [u'44'], u'dynamic_model_fields-8-type': [u'django.db.models.fields.related.ForeignKey'], u'dynamic_model_fields-8-options': [u'{\\r\\n  \"to\":\"pndata.Location\",\\r\\n  \"to_field\":\"Name\",\\r\\n  \"unique\":true,\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'],\n> >   u'dynamic_model_fields-0-options': [u'{\\r\\n  \"unique\":true,\\r\\n  \"max_length\":200\\r\\n}'], u'dynamic_model_fields-6-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"UCD1\",\\r\\n      \"UCD1\"\\r\\n    ],\\r\\n    [\\r\\n      \"MS\",\\r\\n      \"MS\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'dynamic_model_fields-2-name': [u'rootstock'], u'dynamic_model_fields-3-type': [u'django.db.models.fields.related.ForeignKey'], u'dynamic_model_fields-3-description': [u'The vineyard that this block is a part of.'], u'db_table': [u''], u'dynamic_model_fields-7-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"VSP\",\\r\\n      \"VSP\"\\r\\n    ],\\r\\n    [\\r\\n      \"VSP 2 canes\",\\r\\n      \"VSP 2 canes\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'app_label': [u'sauvignonblanc'], u'dynamic_model_fields-3-table': [u'12'], u'dynamic_model_fields-8-id': [u'115'], u'dynamic_model_fields-6-t\n> >  able': [u'12'], u'dynamic_model_fields-7-name': [u'training_system'], u'dynamic_model_fields-4-description': [u'Some more misc details if required'], u'dynamic_model_fields-5-table': [u'12'], u'dynamic_model_fields-3-order': [u'0'], u'next': [u''], u'dynamic_model_fields-5-description': [u'What direction do the rows run?\\r\\nDegrees from north. ( <180)'], u'dynamic_model_fields-6-name': [u'clone'], u'dynamic_model_fields-__prefix__-order': [u'0'], u'dynamic_model_fields-5-type': [u'django.db.models.fields.BigIntegerField'], u'dynamic_model_fields-2-options': [u'{\\r\\n  \"blank\":true,\\r\\n  \"unique\":false,\\r\\n  \"max_length\":10,\\r\\n  \"null\":true,\\r\\n  \"choices\":[\\r\\n    [\\r\\n      \"SO4\",\\r\\n      \"SO4\"\\r\\n    ],\\r\\n    [\\r\\n      \"101-14\",\\r\\n      \"101-14\"\\r\\n    ],\\r\\n    [\\r\\n      \"RG\",\\r\\n      \"RG\"\\r\\n    ]\\r\\n  ]\\r\\n}'], u'dynamic_model_fields-__prefix__-description': [u''], u'dynamic_model_fields-4-name': [u'description'], u'dynamic_model_fields-2-type': [u'django.db.model\n> >  s.fields.CharField'], u'dynamic_model_fields-0-description': [u'The unique name for the block'], u'dynamic_model_fields-9-description': [u'height of fruiting wire meters'], u'dynamic_model_fields-3-name': [u'vineyard'], u'dynamic_model_fields-6-order': [u'0'], u'dynamic_model_fields-5-id': [u'85'], u'dynamic_model_fields-__prefix__-table': [u'12'], u'dynamic_model_fields-7-description': [u'Which training system was used for the block'], u'dynamic_model_fields-2-id': [u'87'], u'dynamic_model_fields-8-table': [u'12'], u'dynamic_model_fields-__prefix__-options': [u''], u'dynamic_model_fields-7-order': [u'0'], u'dynamic_model_fields-8-description': [u'The GPS location of the Vineyard block'], u'_save': [u'Save'], u'dynamic_model_fields-3-id': [u'43'], u'dynamic_model_fields-2-description': [u'Which rootstock was used for the block'], u'dynamic_model_fields-1-table': [u'12'], u'dynamic_model_fields-4-table': [u'12'], u'dynamic_model_fields-6-type': [u'django.db.models.fields.Char  Field'\n> >  ], u'csrfmiddlewaretoken': [u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa'], u'dynamic_model_fields-9-type': [u'django.db.models.fields.DecimalField'], u'dynamic_model_fields-0-order': [u'0'], u'dynamic_model_fields-4-order': [u'0'], u'dynamic_model_fields-2-order': [u'0'], u'dynamic_model_fields-4-options': [u'{\\r\\n  \"null\":true,\\r\\n  \"blank\":true\\r\\n}'], u'dynamic_model_fields-3-options': [u'{\\r\\n  \"to\":\"sauvignonblanc.Vineyard\",\\r\\n  \"to_field\":\"name\"\\r\\n}'], u'dynamic_model_fields-8-DELETE': [u'on'], u'dynamic_model_fields-9-id': [u'100'], u'dynamic_model_fields-1-name': [u'year_planted'], u'dynamic_model_fields-0-id': [u'42'], u'dynamic_model_fields-INITIAL_FORMS': [u'10'], u'dynamic_model_fields-8-order': [u'0']}>,\n> > COOKIES:{'csrftoken': 'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n> >  'sessionid': 'jvso4tbw1vkxey288i5n1vmsv97n20bb',\n> >  'username': 'cflzjg'},\n> > META:{'CONTENT_LENGTH': '13657',\n> >  'CONTENT_TYPE': 'multipart/form-data; boundary=---------------------------1889336725434027363648371802',\n> >  u'CSRF_COOKIE': u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n> >  'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,_/_;q=0.8',\n> >  'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n> >  'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n> >  'HTTP_CONNECTION': 'Keep-Alive',\n> >  'HTTP_COOKIE': 'csrftoken=y9ASniU60COVYoVJWMyZuVl8PSs81hEa; sessionid=jvso4tbw1vkxey288i5n1vmsv97n20bb; username=cflzjg',\n> >  'HTTP_HOST': '127.0.0.1:54000',\n> >  'HTTP_REFERER': 'http://keatest.pfr.co.nz/admin/provenance/provenancedefinition/12/',\n> >  'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101 Firefox/35.0',\n> >  'HTTP_X_FORWARDED_FOR': '10.38.8.102',\n> >  'HTTP_X_FORWARDED_HOST': 'keatest.pfr.co.nz',\n> >  'HTTP_X_FORWARDED_SERVER': 'keatest.pfr.co.nz',\n> >  'PATH_INFO': u'/admin/provenance/provenancedefinition/12/',\n> >  'QUERY_STRING': '',\n> >  'REMOTE_ADDR': '127.0.0.1',\n> >  'REQUEST_METHOD': 'POST',\n> >  'REQUEST_URI': '/admin/provenance/provenancedefinition/12/',\n> >  'SCRIPT_NAME': u'',\n> >  'SERVER_NAME': 'aklweb22.pfr.co.nz',\n> >  'SERVER_PORT': '54000',\n> >  'SERVER_PROTOCOL': 'HTTP/1.1',\n> >  'uwsgi.node': 'aklweb22.pfr.co.nz',\n> >  'uwsgi.version': '2.0.5.1',\n> >  'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x21255d0>,\n> >  'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n> >  'wsgi.input': <uwsgi._Input object at 0x46e5d20>,\n> >  'wsgi.multiprocess': True,\n> >  'wsgi.multithread': False,\n> >  'wsgi.run_once': False,\n> >  'wsgi.url_scheme': 'http',\n> >  'wsgi.version': (1, 0)}>\n> > \n> > 窶能n> > Reply to this email directly or view it on GitHub\n> > https://github.com/PlantandFoodResearch/Kea/issues/135.\n",
              "created": "2015-02-03T20:59:41Z"
            }
          ]
        },
        {
          "summary": "in Provenance data entry form dropdowns against large tables is silly",
          "key": "KEA-136",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a foreign key is defined for a provenance table the data entry form will just add a drop down to select from the foreign table.\n\nWhen that table is huge (e.g. location) then the dropdown is so large that the page takes a while to download to the browser.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/136",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Currently this is a problem more with kea tables rather than dynamic tables.\nPlan: Use the choose.widgets.ChooseWidgetWrapper in place of the standard SelectWidget on the relevant admin form. The ChooseWidgetWrapper select widget works with both kea and dynamic tables and with database and elasticsearch lookups.\n",
              "created": "2015-03-09T20:42:14Z"
            },
            {
              "body": "Widget needs more work because of to_field values on dynamic tables.\n",
              "created": "2015-03-11T02:49:54Z"
            }
          ]
        },
        {
          "summary": "A column in provenance data entry is not allowing nulls when it should",
          "key": "KEA-137",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Although a table has a field with the JSON defining null=true and blank=true, trying to save a data entry form with the value not chosen gives a 500 error with email as below:\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 390, in wrapper\n    return self.admin_site.admin_view(view)(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/decorators/cache.py\", line 89, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/sites.py\", line 202, in inner\n    return view(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/admin.py\", line 307, in add_view\n    result = super(ProvenanceImportExportModelAdmin, self).add_view(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/transaction.py\", line 223, in inner\n    return func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 1025, in add_view\n    self.save_model(request, new_object, form, False)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 758, in save_model\n    obj.save()\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/base.py\", line 546, in save\n    force_update=force_update, update_fields=update_fields)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/base.py\", line 650, in save_base\n    result = manager._insert([self], fields=fields, return_id=update_pk, using=using, raw=raw)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/manager.py\", line 215, in _insert\n    return insert_query(self.model, objs, fields, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/query.py\", line 1675, in insert_query\n    return query.get_compiler(using=using).execute_sql(return_id)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/sql/compiler.py\", line 943, in execute_sql\n    cursor.execute(sql, params)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 56, in execute\n    six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/backends/postgresql_psycopg2/base.py\", line 54, in execute\n    return self.cursor.execute(query, args)\n\nIntegrityError: null value in column \"location_lat_long_id\" violates not-null constraint\nDETAIL:  Failing row contains (2, Tahi, Harry's Place, blah blah, null, 1990, null, null, null, null, null).\n\n\n\n<WSGIRequest\npath:/admin/sauvignonblanc/vineyardblock/add/,\nGET:<QueryDict: {}>,\nPOST:<QueryDict: {u'row_orientation': [u''], u'training_system': [u''], u'name': [u'Tahi'], u'_save': [u'Save'], u'clone': [u''], u'rootstock': [u''], u'year_planted': [u'1990'], u'next': [u''], u'vineyard': [u\"Harry's Place\"], u'location_lat_long': [u''], u'fruiting_wire_height': [u''], u'csrfmiddlewaretoken': [u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa'], u'description': [u'blah blah']}>,\nCOOKIES:{'csrftoken': 'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n 'sessionid': 'jvso4tbw1vkxey288i5n1vmsv97n20bb',\n 'username': 'cflzjg'},\nMETA:{'CONTENT_LENGTH': '1637',\n 'CONTENT_TYPE': 'multipart/form-data; boundary=---------------------------94113004517951735722116753048',\n u'CSRF_COOKIE': u'y9ASniU60COVYoVJWMyZuVl8PSs81hEa',\n 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'csrftoken=y9ASniU60COVYoVJWMyZuVl8PSs81hEa; sessionid=jvso4tbw1vkxey288i5n1vmsv97n20bb; username=cflzjg',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_REFERER': 'http://keatest.pfr.co.nz/admin/sauvignonblanc/vineyardblock/add/',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101 Firefox/35.0',\n 'HTTP_X_FORWARDED_FOR': '10.38.8.102',\n 'HTTP_X_FORWARDED_HOST': 'keatest.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'keatest.pfr.co.nz',\n 'PATH_INFO': u'/admin/sauvignonblanc/vineyardblock/add/',\n 'QUERY_STRING': '',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'POST',\n 'REQUEST_URI': '/admin/sauvignonblanc/vineyardblock/add/',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb22.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb22.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x21255d0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x7f1c1f7dfac8>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/137",
          "labels": [
            "Provenance",
            "bug",
            "question"
          ],
          "comments": [
            {
              "body": "This seems to be working?\n",
              "created": "2015-02-26T22:23:25Z"
            },
            {
              "body": "I am trying to upload a vineyard block spreadsheet without any \"location_lat_long\" values and it is insisting that this column is not null:\n\"IntegrityError: null value in column \"location_lat_long_id\" violates not-null constraint\"\nHowever this is the JSON in the defn for this column:\n\n```\n{\n  \"related_name\":\"block_location\",\n  \"null\":true,\n  \"to_field\":\"Name\",\n  \"to\":\"pndata.Location\",\n  \"blank\":true,\n  \"unique\":true\n}\n```\n\nNot sure whether setting this to unique as well as setting it nullable is confusing things but it shouldn't.\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T00:38:23Z"
            },
            {
              "body": "Righto, I'll take another look.\n\nCheers,\nDarryl\n",
              "created": "2015-03-03T01:11:55Z"
            },
            {
              "body": "The original error seems to be OK though :-)\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T03:25:32Z"
            },
            {
              "body": "This may effect only foreign key columns that point to a kea table, a brief test of a dynamic table with foreign key to another dynamic table allowed a null value.\n\nPlan: make a test, check the import_export widget used by KeaModelResource, check what is happening in the 'clean' method of the widget.\n",
              "created": "2015-03-09T20:31:17Z"
            },
            {
              "body": "I'll have another look though by reimporting the db Zane previously sent me with the location fields because that is the only one that seems to fail?\n\nZane, please check your database, with the dump I have the column location_lat_long:\n\nlocation_lat_long_id character varying(200) NOT NULL,\n\nwhich clearly should fail. I changed that manually with:\n\nALTER TABLE sauvignonblanc_vineyardblock ALTER COLUMN location_lat_long_id DROP NOT NULL;\n\nAnd then all good. I know the the definition field says allow null which may indicate 1. the table was initially incorrectly created or 2. the definition field was changed after creation and as we know the db table is not altered (the todo project). I don't think it was 1 because I can create fields with null:true and the table column is correctly created.\n\nUpshot is that I am confident that this is no longer an issue - provided the database table column allows null.\n",
              "created": "2015-03-12T01:30:18Z"
            }
          ]
        },
        {
          "summary": "Cultivation details and plant developments data display and entry not showing 1st 3 fields",
          "key": "KEA-138",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the Sauvignon Blanc provenance the tables:\n\"Cultivation Details\" and \"Plant Development\" are not showing the the first three fields.\n\nThey are missing from both the Browse page and the Data entry form.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/138",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed\n",
              "created": "2015-02-23T19:55:51Z"
            }
          ]
        },
        {
          "summary": "Digit number Error while importing harvest sample",
          "key": "KEA-139",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After trying to upload a one line spreadsheet into harvest_sample got this error:\n\n```\nTraceback (most recent call last):\nFile \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/provimport.py\", line 163, in done\ndryrun=False)\nFile \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/excel/utils.py\", line 100, in import_provenance_definition\ndataset, dry_run=dryrun, raise_errors=raise_errors)\nInvalidOperation: quantize result has too many digits for current context\nAn import error occurred, please return to the previous step and check the fields in the spreadsheet, especially those that are referencing by name objects not yet created. \n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/139",
          "labels": [
            "Provenance",
            "bug",
            "question"
          ],
          "comments": [
            {
              "body": "I'm not sure why this error occurred. I've made a fix for #142 which may have helped.\n\nIf you could show me the value used then that would be helpful.\n\nThank you, Darryl\n",
              "created": "2015-02-25T23:45:14Z"
            },
            {
              "body": "I can now successfully upload a spreadsheet, closing this for now.\n",
              "created": "2015-03-05T03:04:23Z"
            }
          ]
        },
        {
          "summary": "Vintage drop down on harvest_sample data input page wrong",
          "key": "KEA-140",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The dropdown created for the harvest_sample table for entering the Vintage is swapping the year number and the id field.\nThis means that the id is being displayed and the year number is the hidden value.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/140",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "fixed commit c857f31\n",
              "created": "2015-02-04T19:23:14Z"
            }
          ]
        },
        {
          "summary": "Uploading plant_development or cultivation details only entered one row",
          "key": "KEA-141",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I tried to enter in a whole bunch of plant_development rows or cultivation_details rows via the import excel mechanism, only one row was entered in.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/141",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug",
            "question"
          ],
          "comments": [
            {
              "body": "The source of the problem is that these models do not have a unique field to look up against so each row as parsed thinks that it is updating the object.\n",
              "created": "2015-02-04T04:49:11Z"
            },
            {
              "body": "So we need to ensure that every provenance table has a unique identifier.\nOr that we revisit the schema and ensure that the data is attached to the correct entities.\n",
              "author": "zane.gilmore",
              "created": "2015-02-17T20:43:53Z"
            },
            {
              "body": "Looking at plant_development for example it seems to me that it needs 'unique_together = ('trial_plot', 'vintage').\n\nBut we have no way to edit directly the Meta of dynamic model.\n",
              "created": "2015-02-26T22:22:42Z"
            },
            {
              "body": "窶亀his was failing because these tables do not have a unique column that can be used by KeaModelResource to look up the row in the database - hence the discussion of LocalID that then can be used on any table that doesn't have an unique identifier.\n\nThe other more complex solution would be to create an admin resource to allow the editing of Meta attributes for dynamic tables (currently not implemented) so that thing like 'unique_together' can be used - this will be a major task in my opinion and not likely to be approved in the near future. (Probably best I don't mention it).\n窶輝lan: 窶季et LocalID working as unique identifier for dynamic tables without own identifier (#146)\n",
              "created": "2015-03-09T21:22:13Z"
            },
            {
              "body": "autogenerated LocalIDField now available for tables without a unique identifier. The field accepts 'min-length' and 'prefix'.\n",
              "created": "2015-03-24T21:38:02Z"
            }
          ]
        },
        {
          "summary": "Harvest_sample import insisting on \"Fruit Quality\"",
          "key": "KEA-142",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "If the \"Fruit Quality\" field is left out of the Excel import file then a \"must be an integer\" style error is produced and the import fails.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/142",
          "labels": [
            "Provenance",
            "bug",
            "question"
          ],
          "comments": [
            {
              "body": "This may be attached to #137\n",
              "author": "zane.gilmore",
              "created": "2015-02-17T20:46:44Z"
            }
          ]
        },
        {
          "summary": "After a sample initialisation the samples are not appearing in the browse page",
          "key": "KEA-143",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a sample initialisation is performed via the \"View Data\" -> \"Samples\" page the new samples do not appear.\n\nThe samples are definitely created in the database but are not displayed via the datagrid.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/143",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "This seems to have fixed itself!\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T03:23:01Z"
            }
          ]
        },
        {
          "summary": "Add provenance IDs to every row in the sample batch data tab",
          "key": "KEA-144",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There has been a request that for every sample row in the \"Data\" tab of a sample batch spreadsheet the provenance identifier is listed. \nNot just for the first sample.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/144",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Fixed\n",
              "created": "2015-04-12T02:50:45Z"
            }
          ]
        },
        {
          "summary": "Kea not starting up on a test DB",
          "key": "KEA-145",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Provenance validation on start up seems to be failing.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/145",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Nah, still broken. Trying another fix.\n",
              "created": "2015-02-23T22:25:17Z"
            },
            {
              "body": "c4a80f0adc4f7bf90b82bd232eef31a161f66b74\n",
              "created": "2015-02-23T22:29:16Z"
            }
          ]
        },
        {
          "summary": "Ensure LocalID column types are working correctly",
          "key": "KEA-146",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "While addressing #141 we discovered that a unique id will be required for some tables that might not otherwise need them.\nSo we need to ensure that the autoincrementing etc of LocalIDs work.\n\nWhich means being able to leave this column blank for new entries\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/146",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Just checked this out on plant_development table where I have added a new localid column\n\nWhen I uploaded a spreadsheet with that column empty it reported\"\n\n```\nLine number: 1 development_LocalID This field cannot be null. \n```\n",
              "author": "zane.gilmore",
              "created": "2015-03-03T23:17:21Z"
            },
            {
              "body": "窶紀 believe this will require a custom widget to be used by KeaModelResource. The file kea.provenance.resource already has some custom widgets and hooked up with the method KeaModelResouce.get_fields.\n",
              "created": "2015-03-09T21:16:14Z"
            },
            {
              "body": "LocalIDField now available for tables without clear identifier.\n\nThis is a readonly field that auto-generates a local id. The field accepts 'min_length' and 'prefix':\n\n{'min_length': 5, 'prefix': 'PFR'} produces localids like: PFR00001, PFR00002 etc\n\nunique=True and null=False are natural attributes of this field.\n",
              "created": "2015-03-24T21:44:20Z"
            }
          ]
        },
        {
          "summary": "After changes max chars on column didn't change in DB",
          "key": "KEA-147",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I changes the maximum chars in a column's JSON  the varchar field didn't change at the DB end.\nIf this is too difficult then perhaps I need to delete the column and then add it again with the correct length.\nHowever if the table has data then it might be a problem.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/147",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Thanks for pointing that out.\n\nThis will be on the lines of #43. I haven't looked at that yet.\n\nCheers,\nDarryl\n",
              "created": "2015-03-03T01:28:05Z"
            },
            {
              "body": "Moot with #242\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:02:17Z"
            }
          ]
        },
        {
          "summary": "Row orientation big int column not storing zeroes",
          "key": "KEA-148",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I uploaded a file which had zeroes as a value for \"row orientation\" the value was stored as null not zero.\nWhen the value was entered in \"by hand\" via the form the value was stored OK as zero.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/148",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Thanks Zane. I understand, that'd be for sauvignonblanc vineyardblock.\n\nI'll take a look at the validation for the field - the fault will be in the widget me thinks.\n\nCheers,\nDarryl\n",
              "created": "2015-03-03T02:33:44Z"
            },
            {
              "body": "Customised IntegerWidget from import_export to allow zero values for integer fields.\n",
              "created": "2015-03-05T02:56:18Z"
            }
          ]
        },
        {
          "summary": "Browse Sample page needs Provenance type",
          "key": "KEA-149",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the sample browse page we have the provenance column but for it to be properly useful we will need to also list the type next to it.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/149",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Plan: 窶軌ff the top of my head I think this will be achieved altering the attribute 'provenance_fields' of the view kea.samples.views.search.SampleSearchViewBase. But it may not be as simple as that sounds and may also need some changes to the 'backend' used by the view.\n",
              "created": "2015-03-09T21:08:10Z"
            },
            {
              "body": "1. updated sample and sample extract indices\n2. included provenance name in sample search view\n\ncommit: d93884a61fd58648039bb6ed5bcc3b90804ffe21\n\nThe indexes will need to be rebuilt:\n\ndjango delete_index keadev_sample-extract-index  keadev_sample-index\ndjango populate_index --create-index sample-extract-data-for-search sample-data-for-search\n",
              "created": "2015-03-27T00:41:30Z"
            }
          ]
        },
        {
          "summary": "Mandatory columns in upload spreadsheets need highlighting",
          "key": "KEA-150",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The columns in spreadsheets for uploading via the table import and the batch spreadsheets that are mandatory i.e. are not nullable and need entering, need to be highlighted in some way.\nIn the process handling the headers have a yellow background.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/150",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Plan: This should be relatively straightforward. The headers are written by import_export.resources.Resource in the method get_export_headers, this method can be overwritten by the provenance resource: kea.provenance.resource.KeaModelResource (a skeleton method has been added).\n",
              "created": "2015-03-09T21:04:12Z"
            },
            {
              "body": "tablib.Dataset has been subclassed to include style definitions on a per header and per column basis. This is used then to highlight (in yellow) headers of not nullable fields and also to grey column for localid fields (i.e. readonly)\n",
              "created": "2015-03-24T21:36:41Z"
            }
          ]
        },
        {
          "summary": "Links to entities like samples edit forms need to be externally linkable",
          "key": "KEA-151",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It turns out that the EBrida users have been putting links to samples into EBrida.\nThey were putting the link to the edit page of a sample.\ne.g. \n\n```\nhttp://keatest.pfr.co.nz/admin/pndata/sample/87306/\n```\n\nThis was working about 9 months ago but is now not working.\nI notice that now there seems to be a crap load of session-type data in the URL of a sample edit page:\n\n```\nhttp://keatest.pfr.co.nz/admin/pndata/sample/87306/?next=http%3A%2F%2Fkeatest.pfr.co.nz%2Fsamples%2Fsearch%2Fsamples%2F%3Fqueries%255Bsample_local_id%255D%3DBAG8817%26data_format%3Djson\n```\n\nWhen the url of the sample edit page is entered \nThis error is produced:\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 390, in wrapper\n    return self.admin_site.admin_view(view)(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/decorators/cache.py\", line 89, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/sites.py\", line 202, in inner\n    return view(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/samples/admin.py\", line 94, in change_view\n    result = super(SampleAdmin, self).change_view(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 91, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/transaction.py\", line 223, in inner\n    return func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 1086, in change_view\n    obj = self.get_object(request, unquote(object_id))\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/admin/options.py\", line 499, in get_object\n    model = queryset.model\n\nAttributeError: 'NoneType' object has no attribute 'model'\n\n\n<WSGIRequest\npath:/admin/pndata/sample/87302/,\nGET:<QueryDict: {}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{'csrftoken': 'pT34a7urWl0i6A4l0E8CyPsX753iC1Yo',\n 'sessionid': 'sz1gjif7vh59j7v117q42w4p5ogol8m0',\n 'username': 'hrlnxb'},\nMETA:{u'CSRF_COOKIE': u'pT34a7urWl0i6A4l0E8CyPsX753iC1Yo',\n 'HTTP_ACCEPT': 'text/html, application/xhtml+xml, */*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-NZ',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'csrftoken=pT34a7urWl0i6A4l0E8CyPsX753iC1Yo; sessionid=sz1gjif7vh59j7v117q42w4p5ogol8m0; username=hrlnxb',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko',\n 'HTTP_X_FORWARDED_FOR': '10.16.1.168',\n 'HTTP_X_FORWARDED_HOST': 'kea.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'kea.pfr.co.nz',\n 'PATH_INFO': u'/admin/pndata/sample/87302/',\n 'QUERY_STRING': '',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/admin/pndata/sample/87302/',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb21.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb21.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x307a6f0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x58a6ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/151",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "We have now addressed this by adding a sample status page.\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T21:25:31Z"
            }
          ]
        },
        {
          "summary": "Kea initiate eBrida samples  error",
          "key": "KEA-152",
          "status": "Done",
          "description": "Uploading workbook as per sheet \n**eBrida Sheet for KEA**\nin \n[http://iplant.pfr.co.nz/science/bg/portfolio/kiwi/research/VitC KF leaf harvest info KerkeriTePuke 2014.xlsx](http://iplant.pfr.co.nz/science/bg/portfolio/kiwi/research/VitC KF leaf harvest info KerkeriTePuke 2014.xlsx)\n\n---\n## Ebrida Sample Batch Status 94f78750-003d-4588-9165-d7fe9ba785ac\n### Error message\n\n```\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.14-py2.7.egg/celery/app/trace.py\", line 240, in trace_task\n    R = retval = fun(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.14-py2.7.egg/celery/app/trace.py\", line 437, in __protected_call__\n    return self.run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/celery/tasks/logging.py\", line 52, in run_decorator\n    func_output = self.wrapped_run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/tasks.py\", line 53, in initialise_ebrida_samples\n    stdout=out)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/management/__init__.py\", line 161, in call_command\n    return klass.execute(*args, **defaults)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/management/base.py\", line 255, in execute\n    output = self.handle(*args, **options)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/management/base.py\", line 355, in handle\n    label_output = self.handle_label(label, **options)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 281, in handle_label\n    self.create_samples(sheet_data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 404, in create_samples\n    plant, genotype, population = self.create_pedigree_data(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 527, in create_pedigree_data\n    population = self.get_or_create_population(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 626, in get_or_create_population\n    if data_row['From Ped. Item'] in self.populations.keys():\nKeyError: 'From Ped. Item'\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/152",
          "labels": [
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "If you're still having this problem, check the E-brida spreadsheet. The column which should be called 'From Ped. Item' is sometimes labelled 'From Ped. Item (origin)'. Editing the spreadsheet then reuploading should make it work...\n",
              "created": "2015-09-30T01:59:53Z"
            },
            {
              "body": "Email from @vnniyB 24/9/2015\n\nby which I understand is that we need to update the KEA import expectations to match eBrida column identifiers\n\nIs this correct?\n\n```\nAttached is the ebrida export that was used to generate the block 60 ids in Kea. \n\nOne dumb thing that has changed and we could probably ask Zane to change is the column named 窶牢ynonyms窶 is actually an EBrida crossId now, and you may notice is equal to the 窶炉rom Ped. Item窶 column. \nWhen this was setup we were storing human generated crossIds in a field named synonyms. Now we use the Ebrida generated crossId. \n\nIt will be trivial to write some SQL which will pull this structure out.\nIn fact I窶冦 going to start writing a script in R now to do so窶ｦ\n\nIll tag you when I commit ♀\n\nVincent \n\n```\n",
              "created": "2015-09-30T20:16:37Z"
            },
            {
              "body": "I think perhaps that we need to make those column names configurable items somehow.\nSome sort of mechanism where column names can be attached to Kea pedigree data etc\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:05:22Z"
            },
            {
              "body": "Latest init issues on test: \n[PaulDKKCollectionNov2016.xlsx](https://github.com/PlantandFoodResearch/Kea/files/570413/PaulDKKCollectionNov2016.xlsx)\n\n```\nIntegrityError: duplicate key value violates unique constraint \"plants_plantaltname_AltName_key\"\nDETAIL:  Key (\"AltName\")=(KKCB03|0241) already exists.\n```\n\nSee :\nhttp://keatest.pfr.co.nz/samples/search/samples/?queries%5BPlant+AltNames%5D=KKCB03%7C0241&data_format=json\n",
              "created": "2016-11-04T01:04:56Z"
            },
            {
              "body": "Interestingly when I try to init on test with \n[RedGoldSelectionsKK_Keainit.xls.xlsx](https://github.com/PlantandFoodResearch/Kea/files/579712/RedGoldSelectionsKK_Keainit.xls.xlsx)\n\nI get the error \n\n```\nIntegrityError: duplicate key value violates unique constraint \"plants_plantaltname_AltName_key\"\nDETAIL:  Key (\"AltName\")=(KKCB03|0240) already exists.\n```\n\nbut the barcode in the error message is **NOT** in the set I am trying to init..they are all TP barcodes\n\nWeird\n",
              "created": "2016-11-09T00:49:35Z"
            },
            {
              "body": "That file DOES have that barcode though...\n",
              "author": "zane.gilmore",
              "created": "2016-11-09T03:58:39Z"
            },
            {
              "body": "Need to standardize what comes out of ebrida too. so kea can know what its receiving. \nThis will resolve the column headings as well as data integrity. Data integrity has been an issue we need to fix. \n\n@cfljam could be a job for @hymmikong to write a function that accepts barcodes, or a trial as arguments and returns data in the correct structure for Kea to accept then implement as an app.\n\n@cfljam think you need to double check the barcodes in your files. The uploaded are _ALL_ KK barcodes.\n`PaulDKKCollectionNov2016.xlsx` = contains 'KKCB03|0241'\n`RedGoldSelectionsKK_Keainit.xls.xlsx` = contains ' KKCB03|0240'\n\nBoth those barcodes exist in Kea test already\n\nhttp://keatest.pfr.co.nz/plants/search/?queries%5BPlant+AltNames%5D=KKCB03%7C024%25&data_format=json\n",
              "author": "vincent.borgers",
              "created": "2016-11-09T09:44:15Z"
            },
            {
              "body": "ahh, I see thats already in progress\nhttps://github.com/Actinidia/ActR/blob/master/R/keaFunctions.R#L46\n",
              "author": "vincent.borgers",
              "created": "2016-11-09T09:46:51Z"
            },
            {
              "body": "I understood that this initialisation path would allow setting up multiple collections from multiple populations. Is this not the case? \n",
              "created": "2016-11-09T16:23:12Z"
            },
            {
              "body": "old now.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:35:14Z"
            }
          ]
        },
        {
          "summary": "Proper checking of column headers in EBrida spreadsheets",
          "key": "KEA-153",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have just got an error report from an attempt to upload an EBrida spreadsheet.\nThe last lines of the traceback is:\n\n```\nFile \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 626, in get_or_create_population\n    if data_row['From Ped. Item'] in self.populations.keys():\nKeyError: 'From Ped. Item'\n```\n\nIt looked like the spreadsheet was missing a column that it needed to do the job.\nSo I hunted around trying to find where the checks were done to ensure that the spreadsheet complies with the minimum requirements for the upload.\n\nAnd I can't find anywhere where this is happening.\n\"ebrida_import.parse_sheet\" seems to be the sensible place to apply these checks but there is no sign of spreadsheet validation here. The spreadsheet sheet is read but it just dumps the contents into an array of dictionaries as is.\n\nPresenting the user with an opaque error is not very useful so I think we need to capture this as the spreadsheets produced by EBrida are completely user defined and need to be defined absolutely correctly for our import.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/153",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "Earlier sheet that worked:\n\n| Pedigree Item | Plot | Group | Start Date | Mother | Father | From Ped. Item | Barcode | keaSampleID | Synonyms | FundingName | BreederName |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| T08.33-01-11a | 0025 | T08.33-01-11a | 2008 44-6 | CK75_01 | T02.13-07-02e | GU28 | TP08B33 | 0025 |  |  | KRIP |\n| T08.33-01-11c | 0026 | T08.33-01-11c | 2008 44-6 | CK75_01 | T02.13-07-02e | GU28 | TP08B33 | 0026 |  |  | KRIP |\n| T08.33-01-11e | 0027 | T08.33-01-11e | 2008 44-6 | CK75_01 | T02.13-07-02e | GU28 | TP08B33 | 0027 |  |  | KRIP |\n\n### Latest one that didnt\n\n| Pedigree Item | Plot | Group | Mother | Father | Selection from | Barcode | keaID | Synonyms | fundingNameCr | breederName |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| K10.60-05-11g | 0001 | K10.60-05-11g | T01.11-14-04a | T02.16-02-03c | T09/AS/KKb60,62/AB19 | KK10B60 | 0001 |  | T09/AS/KKb60,62/AB19 | Commercial |\n| K10.60-06-13b | 0002 | K10.60-06-13b | T01.11-14-04a | T96.13-03-06c | T09/AS/KKb60,62/AB22 | KK10B60 | 0002 |  | T09/AS/KKb60,62/AB22 | Commercial |\n| K10.60-06-13c | 0003 | K10.60-06-13c | T01.11-14-04a | T96.13-03-06c | T09/AS/KKb60,62/AB22 | KK10B60 | 0003 |  | T09/AS/KKb60,62/AB22 | Commercial |\n",
              "created": "2015-03-05T23:44:57Z"
            },
            {
              "body": "I think that this is done now",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:34:13Z"
            }
          ]
        },
        {
          "summary": "Provenance migration handling",
          "key": "KEA-154",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "As provenances get complicated and take a long time to develop we will need to be able to develop them on a non-live instance then transfer the developed provenance to the live instance ready to be used.\n\nHaving to enter the new provenance by hand on the live instance just using the entries on the other instance is going to be fraught with problems and also very time consuming.\n\nI thought perhaps just a way of dumping the inserts for the pertinent rows in the provenance definition tables then running the insert script against the live DB and restarting the live system.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/154",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "How about using django fixtures with dumpdata and loaddata commands?\n",
              "created": "2015-03-26T01:09:33Z"
            },
            {
              "body": "Dumpdata in django 1.5 does not have the --pks option to restrict models to dump. So for example we can dump all provenance data with:\n\ndjango dumpdata --indent 2 provenance\n\nThis dumps all provenance records, including the provenance users and all provenances with definitions etc and will therefore require a a good deal of manual editing to trim it down to the required rows.\n\nThe users can be excluded easily:\n\ndjango dumpdata provenance --indent 2 --exclude provenance.provenanceuser\n\nBut still we have **all** provenance definitions dumped and manual edit will be required to get to the provenance we want to dump.\n\nSo, it seems to me that a management command will be required to dump a provenance, e.g.:\n\ndjango dumpprovenance sauvignonblanc\n\nI imagine that this will lever off the django dumpdata command, but will exclude pks, and collect the definition, fields, type and list objects required for the full provenance.\n\nThen the matching command will be something like:\n\ndjango loadprovenance sauvblanc.json\n\nWhile I don't believe this to be a difficult task it will required some hours work to complete.\n\nMy thoughts and experiments.\n",
              "created": "2015-03-26T19:50:12Z"
            },
            {
              "body": "What about later versions of Django?\nYou said Django 1.5 doesn't have the capability do later versions?\n\nWould this simplify the process?\n",
              "author": "zane.gilmore",
              "created": "2015-03-26T20:49:29Z"
            },
            {
              "body": "Yes, later versions would help the process. I still think that a custom management command will be the best solution (giving us more control) but later versions provide more options to the dumpdata command that can be levered for our custom command.\n\nI also think we should use natural keys (https://docs.djangoproject.com/en/1.8/topics/serialization/#topics-serialization-natural-keys) which are also available from Django 1.5.\n",
              "created": "2015-03-26T21:00:08Z"
            },
            {
              "body": "Completed with b05b130 and others.\n",
              "created": "2015-04-01T02:01:08Z"
            }
          ]
        },
        {
          "summary": "filter/search strings in datgrid not working",
          "key": "KEA-155",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There appears to be a problem in the datagrid.\n\nThe entry for putting in a search string or filter is not working.\nThis is a show stopper.\nSo could you fix it ASAP please?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/155",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Yes, all of them.\nPerhaps this is an issue with my latest buildout.\n\nWhen I click on the search entry box of any datagrid header, nothing happens.\nThis happens in both Firefox and Chromium.\n",
              "author": "zane.gilmore",
              "created": "2015-03-31T20:18:15Z"
            },
            {
              "body": "Running buildout will update javascript libraries using bower. Perhaps there is a new version of one of the javascript libraries that was updated when the buildout was run. You could compare the versions of the js libraries on keatest vs your dev and see if there are any differences. js library versions can be fixed in the buildout.cfg file if required.\n",
              "created": "2015-03-31T20:42:30Z"
            },
            {
              "body": "Hi Marek,\n\nYes, exactly what I'm investigating with Zane.\n\nOn Wed, Apr 1, 2015 at 9:42 AM, Marek Kuziel notifications@github.com\nwrote:\n\n> Running buildout will update javascript libraries using bower. Perhaps\n> there is a new version of one of the javascript libraries that was updated\n> when the buildout was run. You could compare the versions of the js\n> libraries on keatest vs your dev and see if there are any differences. js\n> library versions can be fixed in the buildout.cfg file if required.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/155#issuecomment-88238238\n> .\n",
              "created": "2015-03-31T20:44:13Z"
            },
            {
              "body": "It's William, not Marek. I'm usually logged in to github using Encodes github account.\n",
              "created": "2015-03-31T20:47:08Z"
            },
            {
              "body": "Pinned javascript package versions in buildout.cfg.\n",
              "created": "2015-03-31T21:24:15Z"
            }
          ]
        },
        {
          "summary": "Selenium test for Population editor not showing altnames",
          "key": "KEA-156",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The inline formsets that display the altnames and allow for entering new ones for a population are not being displayed in the population editor during Selenium testing for Integration tests.\n\nWhen those same pages and hence the same functionality is tested \"by hand\" they are fine.\nThere is something very weird going on that I do not have the time to solve.\n\nSo am creating this issue to record it.\nIn the meantime I will be just commenting out the salient tests and calling it a success.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/156",
          "labels": [
            "bug",
            "question",
            "wontfix"
          ],
          "comments": [
            {
              "body": "This is some weird artifact of the selenium system.\nIf it is still doing it then we can't do anything about it.\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:38:21Z"
            }
          ]
        },
        {
          "summary": "Vintage field in Cultivation Details has black header but errors when left blank",
          "key": "KEA-157",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have filled in a skeleton spreadsheet and tried to use it for a sample batch.\n\nThe vintage field in one of my tables \"vintage\" is displayed with a black header but when I tried to import the spreadsheet it errored with \n`Line number: 1 窶忻intage窶 This field cannot be null.`\n\nThe field has not got \n`null:true;  blank:true`\nin its description so is probably defaulting to false so it should be displaying as yellow for a mandatory field.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/157",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed  dc5ba58c0e8b0f37f3b665163f9d21bae65fe2dc\n",
              "created": "2015-04-16T03:13:56Z"
            }
          ]
        },
        {
          "summary": "Need provenance deletion utility",
          "key": "KEA-158",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to be able to delete an entire provenance along with a previous data dump.\nBelow is the script that Darryl and I have found did the job by raw SQL script.\n\n```\n-- to delete an entire provenance\n\nstart transaction;\n\ndelete from samples_samplecontaineraltname where \"SampleContainer_id\" in(\n    select id from pndata_samplecontainer where \"ProvenanceTable_id\" in(\n            select id from provenance_provenancedefinition where app_label = 'sauvignonblanc'\n));\n\ndelete from pndata_samplecontainer where \"ProvenanceTable_id\" in(\n            select id from provenance_provenancedefinition where app_label = 'sauvignonblanc'\n);\n\n\ndelete from pndata_sample where \"ProvenanceTable_id\" in(\n    select id from provenance_provenancedefinition where app_label = 'sauvignonblanc');\n\n\n-- delete all of the rows from the definition field table for this provenance\ndelete from provenance_provenancedefinitionfield where table_id in \n    (select id from provenance_provenancedefinition where app_label = 'sauvignonblanc');\n\n\n\ndelete from provenance_provenancetype_provenance_definitions where provenancetype_id in (\n    select \"ProvenanceType_id\" from provenance_provenancelist where \"Provenance_id\" = \n        (select id from provenance_provenance where \"Name\" = 'sauvignonblanc'));\n\n-- delete all of the table definitions from the definition table\ndelete from provenance_provenancedefinition where app_label = 'sauvignonblanc';\n\n\n\ndelete from provenance_provenancetype where id in(\n    select \"ProvenanceType_id\" from provenance_provenancelist where \"Provenance_id\" = \n        (select id from provenance_provenance where \"Name\" = 'sauvignonblanc'));\n\n\ndelete from provenance_provenancelist where \"Provenance_id\" = \n        (select id from provenance_provenance where \"Name\" = 'sauvignonblanc');\n\ndelete from auth_permission where content_type_id in(\n    select id from django_content_type where app_label = 'sauvignonblanc'\n);\n\ndelete from django_admin_log where content_type_id in(\n    select id from django_content_type where app_label = 'sauvignonblanc'\n);\n\n\n\ndelete from django_content_type where app_label = 'sauvignonblanc';\n\ndelete from provenance_provenanceuser where \"Provenance_id\" = \n    (select id from provenance_provenance where \"Name\" = 'sauvignonblanc');\n\ndelete from provenance_provenance where \"Name\" = 'sauvignonblanc';\n\n\ndrop table sauvignonblanc_harvest_sample;\ndrop table sauvignonblanc_bunch;\ndrop table sauvignonblanc_cultivation_details;\ndrop table sauvignonblanc_plant_development;\ndrop table sauvignonblanc_variety;\ndrop table sauvignonblanc_vintage;\ndrop table sauvignonblanc_vine;\ndrop table sauvignonblanc_trial_plot;\ndrop table sauvignonblanc_vineyardblock;\ndrop table sauvignonblanc_vineyard;\ndrop table sauvignonblanc_company;\n\n\nrollback;\n--commit;\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/158",
          "labels": [
            "Provenance"
          ],
          "comments": []
        },
        {
          "summary": "Provenance dump not handling non-Prov tables",
          "key": "KEA-159",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There appears to be a problem when I run the the dump utility for my provenance.\nIt throws a wobbly when it gets to the Person table references.\n\nI have just run a set trace on the code and it throws:\n\n```\nDoesNotExist: ProvenanceDefinition matching query does not exist.\n```\n\nFrom line 95 (ish) because there is no ProvenanceDefinition for the Person table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/159",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed in  24796f5.\n",
              "created": "2015-04-07T21:47:59Z"
            }
          ]
        },
        {
          "summary": "samplebatch creation not working on loaded dump",
          "key": "KEA-160",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 68, in view\n    return self.dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/formtools/wizard/views.py\", line 227, in dispatch\n    response = super(WizardView, self).dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/decorators.py\", line 19, in _wrapped\n    return view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/mixins.py\", line 20, in dispatch\n    request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 86, in dispatch\n    return handler(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/formtools/wizard/views.py\", line 657, in post\n    return super(NamedUrlWizardView, self).post(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/contrib/formtools/wizard/views.py\", line 284, in post\n    self.storage.set_step_data(self.steps.current, self.process_step(form))\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/initialisation.py\", line 117, in process_step\n    export_data = utils.export_provenance_definition(provenance_definition)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/excel/utils.py\", line 40, in export_provenance_definition\n    worksheets.append(resource_class().export(queryset))\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/resource.py\", line 210, in export\n    headers = self.get_export_headers()\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/resource.py\", line 197, in get_export_headers\n    return super(KeaModelResource, self).get_export_headers()\n\n  File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\", line 388, in get_export_headers\n    headers = [force_text(field.column_name) for field in self.get_fields()]\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/resource.py\", line 319, in get_fields\n    to_field = model_field.rel.get_related_field().get_attname()\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/fields/related.py\", line 940, in get_related_field\n    data = self.to._meta.get_field_by_name(self.field_name)\n\nAttributeError: 'unicode' object has no attribute '_meta'\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/160",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed. The 'to' on juice sample foreign key field to `sauvignonblanc.Vintage` was mistyped on the json dump.\n\nTODO: \n1. Surely all these `to` definitions can be case-insensitive?\n",
              "created": "2015-04-08T00:11:51Z"
            },
            {
              "body": "Sample batch creation should now be working.\n",
              "created": "2015-04-12T02:51:29Z"
            }
          ]
        },
        {
          "summary": "Uploading vineyardblock spreadsheet gives 500 error",
          "key": "KEA-161",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Am getting a 500 error when I try to upload a vineyard block spreadsheet.\nWill send the spreadsheet and error report via email.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/161",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Just thinking about this...\nI suspect that it might have something to do with the Location table reference?\n",
              "author": "zane.gilmore",
              "created": "2015-04-08T04:57:34Z"
            },
            {
              "body": "I have removed any data from the location column and it stopped 500 error.\nBut now there is something funky going on with the name of the tab name.\nIt seems to be expecting \"Vineyard Block\"\nAnd it gets past the dry run and displays the data OK.\nBut when I press confirm it returns \n\n```\nSpreadsheet should contain a Vineyardblock definition sheet \n```\n",
              "author": "zane.gilmore",
              "created": "2015-04-08T05:08:00Z"
            },
            {
              "body": "Hi Zane,\n\nI've run through this myself and yes I'm finding some problems.\n1. Dry run did not check uniqueness of latlong, but did display nice user error on 'complete' but without creating objects.\n2. The 'to be created' user feedback is not working as expected and could well be confusing for the user.\n3. After importing successfully (with latlong and all the rest) I was not able to use the import form to update rows - dryrun complained that objects already existed. That surprised me, we've tested that before - needs investigation.\n\nBut none of those are the errors you describe:\n\n**1. 500 error when including latlong**: I've no idea, as stated I could excel import using 'Name' from pndata.Location objects. I received user feedback of errors on dryrun when attempting to import with non-unique latlongs in column. Note that location_lat_long field is 'unique' (check your forwarded spreadsheet where the column of latlongs is not unique).\n\n**2. Spreadsheet should contain a Vineyardblock definition sheet**: Yes I understand this error, but provided the same title is used as for the downloaded skeleton spreadsheet - in this case \"Vineyard Block\" - then all is good on my instance. I don't understand why your instance should be requesting the title: Vineyardblock. Have definition names been changed on your instance?\n\n**3. Column ordering on spreadsheets**: This can be changed by editing the order of the provenance definition fields of the provenance definition in the admin. But you know that. The \"dump_provenance\" command preserves the ordering, but as you have noted, if the ordering has not been changed then the 'order' field is the default value, 0. You can verify this in the sauvignonblanc_dump.json file. So the ordering of columns is arbitrary until ordered.\n\nHope that helps.\n\nDarryl\n",
              "created": "2015-04-08T08:38:17Z"
            },
            {
              "body": "Spreadsheet upload should now be working.\n",
              "created": "2015-04-12T02:51:58Z"
            }
          ]
        },
        {
          "summary": "drop_provenance integrity error",
          "key": "KEA-162",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Attempting to drop sauvblanc prov' on my dev instance gives:\n\n```\nIntegrityError: update or delete on table \"django_content_type\" violates foreign key constraint \"contenttype_id_refs_id_140870f1\" on table \"provenance_provenancetype_provenance_definitions\"\nDETAIL:  Key (id)=(80) is still referenced from table \"provenance_provenancetype_provenance_definitions\".\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/162",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nPlease check your sauvblanc provenance.\n\nThe script to discover the rows to be deleted relies on the ProvenanceList objects - this is an absolute requirement because this is the route by which the ProvenanceTypes to be deleted are discovered.\n\nMy guess is that at some point a ProvenanceType has been created that is no longer (or ever) referenced in a ProvenanceList.\n\nHope that helps,\nDarryl\n",
              "created": "2015-04-15T21:09:55Z"
            },
            {
              "body": "P.S. I was able to duplicate this error by creating an orphaned ProvenanceType.\n",
              "created": "2015-04-15T21:13:46Z"
            },
            {
              "body": "Added more integral tables to drop_provenance command.\n\n276021062447c9ba87c1fb711aa70a37f3912684\n",
              "created": "2015-04-16T03:12:15Z"
            },
            {
              "body": "This hopefully could be closed, it does depend also on #163 which picks on the same tables and data.\n",
              "created": "2015-04-22T03:50:36Z"
            },
            {
              "body": "Drop provenance appears to work now.\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T21:21:28Z"
            }
          ]
        },
        {
          "summary": "provenance data dump",
          "key": "KEA-163",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to explore creating a utility for dumping all of the data attached to a provenance.\nThe dump will need to be loadable onto an instance where the provenance exists.\n\nThe main anticipated issue will probably be dumping the likes of samples, sampleprocess, sampleextractprocess and processrun rows. There will be a few more too.\nWe will not be able to dump those entire tables but only those rows that are pertinent.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/163",
          "labels": [],
          "comments": [
            {
              "body": "The drop_provenance management command seems now to be picking up all rows in all tables that are related to the data in the provenance's dynamic tables (these are all through the sample table).\n\nUsing this collection it should be relatively trivial to collect the data that needs to be dumped.\n",
              "created": "2015-04-16T03:42:05Z"
            },
            {
              "body": "This is done now and also moot\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T21:22:48Z"
            }
          ]
        },
        {
          "summary": "Error message for new location-name clash",
          "key": "KEA-164",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I tried to add a new location and it gave a 500 error.\nThe error email produced stated it was a clash with another Location name.\n\nThis error should captured and provide an appropriate error message for the user not a 500 error.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/164",
          "labels": [
            "Location",
            "bug"
          ],
          "comments": [
            {
              "body": "How are new locations added? I can't find them in the django table-admin, only LocationTypes.\n\nThanks.\n",
              "created": "2015-04-16T03:45:54Z"
            },
            {
              "body": "The location handling is in pndata/forms.py.\n\nThe method is locationAdminWithType on line 371\n\nCan't remember the details but some sort of check to see that the location\nname doesn't already exist before trying to save might be in order.\n\nLocations do have a fair bit of complexity so if you need me to explain\nthings please give me a yell.\nTen minutes of my time to explain is probably better than half a day for\nyou to figure it out.\n\nThis is relatively low priority so if you can't do it quickly then feel\nfree to put it on the back-burner.\n\nOn 16 April 2015 at 15:45, Darryl Cousins notifications@github.com wrote:\n\n> How are new locations added? I can't find them in the django table-admin,\n> only LocationTypes.\n> \n> Thanks.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/164#issuecomment-93630753\n> .\n",
              "author": "zane.gilmore",
              "created": "2015-04-16T21:59:29Z"
            }
          ]
        },
        {
          "summary": "Location choice pop-up on provenance models needs work",
          "key": "KEA-165",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The pop-up for choosing locations for a Provenance entry needs to list the location type not the id.\nAnd the parent location needs to list the name not the id.\n\nAm also thinking that a new column type might be in order where we can define the location-type and hence filter the location-type in the pop-up.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/165",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Closed by mistake.\n",
              "created": "2015-04-22T03:45:22Z"
            }
          ]
        },
        {
          "summary": "Crop user and provenance user editing interfaces re-instated",
          "key": "KEA-166",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The user interface for maintaining the crop-user and provenance-user relations that was rewritten by William, is not good enough and does not provide the same functionality as my one did.\n\nI want either the same functionality provided by the new interface or my old interface reinstated.\n\nEvery time I use this thing I am irritated by how clunky it is.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/166",
          "labels": [
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Hello Zane,\n\nI have time to look at this either this afternoon or tomorrow. I can do one of two things. Either pull the old code out of git and switch back to that or enhance the new functionality. If you choose the latter you'll need to tell me what you want to change.\n\nThanks,\n\nWilliam.\n",
              "created": "2015-05-13T23:20:31Z"
            },
            {
              "body": "William,\nI am happy to have those interfaces reinstated from the original code.\nHowever, as I told Marek, if you can see any potential issues that need to be addressed then we will need to talk.\n\nThanks,\nZane\n",
              "author": "zane.gilmore",
              "created": "2015-05-14T00:45:26Z"
            }
          ]
        },
        {
          "summary": "Handling many-to-many field types in Provenance table",
          "key": "KEA-167",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have now added a many to many field into the Company table and the spreadsheet download (and I assume upload) seems to be excluding the many to many field.\n\nI can certainly understand why as the table itself will actually contain the field.\n\nI think we will be needing to construct a means of handling this relationship in a user-sensible way.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/167",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "There is a TODO comment in code for creating tables for manytomany relationships which is still to be done.\n",
              "created": "2015-04-22T03:51:54Z"
            },
            {
              "body": "It should be noted that this work is for uploading data via the spreadsheets.\nBoth in the one table at a time Provenance admin upload and also the SampleBatch multitable/multisheet upload.\nAlso the data to be added into the spreadsheets should be definable a la the foreign key mechanism that is already used where the foreign entities are defined by a unique column on the foreign table which is defined by JSON on the provenance definition.\n\nThis may mean that the many to many table may have to contain the actual text-based (or whatever) data but... whatever works. The important thing is the user only needs to use things like LocalIDs or names to identify the foreign table row.\n",
              "author": "zane.gilmore",
              "created": "2015-05-12T23:54:56Z"
            },
            {
              "body": "I have just uploaded a new DB dump that contains a many to many between trial_plot and treatment.\nThere as also another one between company and contact.\n",
              "author": "zane.gilmore",
              "created": "2015-05-13T00:21:29Z"
            },
            {
              "body": "Another thing that has just occurred to me is that many to many relationships are symmetrical.\nIt might be useful to be able to upload from both ends of the relationship, but if this looks too hard then we can just keep it from the direction that it was first defined like Django seems to like.\n",
              "author": "zane.gilmore",
              "created": "2015-05-13T00:24:29Z"
            },
            {
              "body": "Hi Zane,\n\ngoing to figure out how this is suppose to work. When I first worked on this I had troubles to come up with a bullet proof solution for m2m that none-computer savy persons could figure out. I believe I left it for later :/\nCan you send me a sample spreadsheet that uses a m2m relation? That would help me figuring out how to parse the data and insert/update them in the DB tables.\n\nThanks\nStefan\n",
              "created": "2015-05-20T02:39:53Z"
            },
            {
              "body": "This will need more doing then I was hoping for. Django's ORM does not support _to_field_ arguments for M2M fields. This will not work with the example spreadsheet since it refers to the _treatment.name_ field not the tables pk.\n\nNot sure if a custom M2M field is the way to go or create a m2m through table. Latter will remove many ORM features and might cause big headaches with excel import/export. Not sure if a custom M2M field could take the _to_field_ parameter and take care to \"translate\" pk to the _to_field_ value. I can see big performance problems with that since it might cause a huge amount of SQLs.\n\nHave to think about this!\n\nWork is pushed to branch [issue-167].\n",
              "created": "2015-05-25T04:40:02Z"
            },
            {
              "body": "Stefan,\nMy apologies.\nThere is a many-to-many column type that has been added and is working inside the admin interface.\nThis is why there are 2 tables that have been created in the sauvignonblanc provenance called:\nsauvignonblanc_trial_plot_treatment\nand sauvignonblanc_company_contact_person\nThese were created by the provenance definition mechanism and work fine (or well enough for now) in the admin interface.\nWhat we will need is something that can process something like comma limited lists of the appropriate unique human readable names of the foreign table in a spreadsheet upload.\nI realise that this is likely to be a non-trivial task.\nI am thinking maybe that something that records both the human readable and id key of foreign table in the m2m? \n\nPerhaps we can talk tomorrow?\n",
              "author": "zane.gilmore",
              "created": "2015-05-25T05:06:43Z"
            },
            {
              "body": "The [issue-167] branch has my first try of this.\nCreated a new field _Many2ManyOnUniqueField_ (name up for change) that can take the _to_field_ parameter like FK fields. M2M values in spreadsheet are comma separated.\nBecause of the way Django ORM handles M2M values, they are missing in the excel import confirmation view but should work in the confirmed import.\n\nThough I did not manage to create a spreadsheet that imports. All I got were integrity errors for ids to _sauvignonblanc_vineyardblock_. Hope I get behind that in two days.\n",
              "created": "2015-05-27T06:24:52Z"
            },
            {
              "body": "Thanks for all that Stefan.\nThe field name is OK and not that important right now.\nThe to_field on that sounds like exactly what I want.\n\nHowever I think that we will need to display the data in the upload confirmation. Otherwise user confusion will be rampant.\n\nThanks again, and please keep me posted,\n",
              "author": "zane.gilmore",
              "created": "2015-05-28T01:18:23Z"
            },
            {
              "body": "Pushed a first working version, needs some solid testing though.\nFeel free to pull from [issue-167] branch or merge changes.\n",
              "created": "2015-06-02T01:39:15Z"
            },
            {
              "body": "FYI, only tested import. Did not play with updates nor deletes.\n\nZane, if you give me some feedback about the import and how things work for you I will spent time on update and delete.\n",
              "created": "2015-06-02T01:42:45Z"
            },
            {
              "body": "Stefan,\nI just pulled and only got 3 insertions.\nIs that correct?\nAre they big insertions?\n\nJust thought I had better make sure you are working off the master branch. \nWe aren't working from the provenance branch any more.\n",
              "author": "zane.gilmore",
              "created": "2015-06-02T02:48:02Z"
            },
            {
              "body": "Oops just read your earlier comment.\nWill need to figure out that mechanism.\n",
              "author": "zane.gilmore",
              "created": "2015-06-02T02:49:11Z"
            },
            {
              "body": "Just tried to upload some trial plots. And go this error:\n\n```\n Line number: 1 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'D1'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'D1'\nLine number: 2 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'D2'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'D2'\nLine number: 3 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'M1'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'M1'\nLine number: 4 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'M3'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'M3'\nLine number: 5 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'S2'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'S2'\n```\n",
              "author": "zane.gilmore",
              "created": "2015-06-03T01:19:15Z"
            },
            {
              "body": "This looks pretty much like the problem we had before.\nI used this file:\nhttps://drive.google.com/file/d/0B4TupZPfpeyxNVJuYjF4UGtrcGc/view?usp=sharing\n",
              "author": "zane.gilmore",
              "created": "2015-06-03T01:22:44Z"
            },
            {
              "body": "Did you add the \"to_field\" parameter to the ManyToManyOnUnique field in the schema definition?\nOn 2 Jun 2015 6:19 pm, Zane Gilmore notifications@github.com wrote:Just tried to upload some trial plots. And go this error:\n\n Line number: 1 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'D1'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'D1'\nLine number: 2 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'D2'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'D2'\nLine number: 3 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'M1'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'M1'\nLine number: 4 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'M3'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'M3'\nLine number: 5 窶懌拿n\n窶懌 invalid literal for int() with base 10: 'S2'\n\nTraceback (most recent call last):\nFile \"/home/zane/programming/virtenv/kea/src/django_import_export/import_export/resources.py\", line 341, in import_data\nself.import_obj(instance, row, real_dry_run)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/resource.py\", line 471, in import_obj\nfield.widget.value = field.clean(data, obj)\nValueError: invalid literal for int() with base 10: 'S2'\n\n窶燃eply to this email directly or view it on GitHub.\n",
              "created": "2015-06-03T01:44:59Z"
            },
            {
              "body": "OK,\nI changed the field to type \"ManyToManyonUnique\"\nand added the \"to_field\" parm.\nAnd got this:\n\n```\nFieldDoesNotExist at /provenance/import/sauvignonblanc/trial_plot/1/\n\ntrial_plot_treatment has no field named None\n\nRequest Method:     POST\nRequest URL:    http://localhost:8000/provenance/import/sauvignonblanc/trial_plot/1/\nDjango Version:     1.5.9\nException Type:     FieldDoesNotExist\nException Value:    \n\ntrial_plot_treatment has no field named None\n\nException Location:     /home/zane/programming/virtenv/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/options.py in get_field, line 333\n```\n\nWhat am I doing wrong now?\n",
              "author": "zane.gilmore",
              "created": "2015-06-03T02:58:05Z"
            },
            {
              "body": "Can you send me a db dumb please?\nOn 2 Jun 2015 7:58 pm, Zane Gilmore notifications@github.com wrote:OK,\nI changed the field to type \"ManyToManyonUnique\"\nand added the \"to_field\" parm.\nAnd got this:\n\nFieldDoesNotExist at /provenance/import/sauvignonblanc/trial_plot/1/\n\ntrial_plot_treatment has no field named None\n\nRequest Method:     POST\nRequest URL:    http://localhost:8000/provenance/import/sauvignonblanc/trial_plot/1/\nDjango Version:     1.5.9\nException Type:     FieldDoesNotExist\nException Value:    \n\ntrial_plot_treatment has no field named None\n\nException Location:     /home/zane/programming/virtenv/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/options.py in get_field, line 333\n\nWhat am I doing wrong now?\n\n窶燃eply to this email directly or view it on GitHub.\n",
              "created": "2015-06-03T03:44:36Z"
            },
            {
              "body": "Just got around testing your excel spreadsheet you send me and it went in fine.\nCan you make sure the parameters for the ManyToManyOnUniqueField are something like this:\n\n``` json\n{\n  \"related_name\": \"trial_plot_treatment\",\n  \"to_field\": \"name\",\n  \"null\": true,\n  \"to\": \"sauvignonblanc.treatment\",\n  \"blank\": true\n}\n```\n\nAfter that drop the current _sauvignonblanc_trial_plot_treatment_ table and restart kea to have it recreated.\n",
              "created": "2015-06-04T00:46:18Z"
            },
            {
              "body": "Cheers, thanks for that will try it out as soon as I can.\nAlso have sent you a Google drive thingy for the DB dump.\n",
              "author": "zane.gilmore",
              "created": "2015-06-04T02:40:48Z"
            },
            {
              "body": "Just took your db dump and tested it with the test spreadsheet.\n\nChanged field type and added the _to_field_ parameter. Then went to import the spreadsheet and got the same error you did\n\n```\ntrial_plot_treatment has no field named None\n```\n\nThough after a simple restart of django, which loads the dynamic models into the registry again, it worked.\n",
              "created": "2015-06-04T03:38:18Z"
            },
            {
              "body": "Wow!\nYou are quite correct.\nI cranked up my runserver and reimported that spreadsheet and it imported the trial_plots.\n\nHowever...\nNow when I try to edit the entries via the admin list by clicking on the pencil I get a big fat ugly exception.\n",
              "author": "zane.gilmore",
              "created": "2015-06-05T03:55:15Z"
            },
            {
              "body": "Turns out that this is actually an issue with handling readonly LocalIDFields. Pushed a fix and merge everything into master. Consider this as fixed.\n",
              "created": "2015-06-07T01:37:44Z"
            },
            {
              "body": "Stefan,\nAfter pulling that stuff I am still getting an exception on clicking the edit in the admin.\nShould I be deleting these records now?\nHere's some of the exception report:\n\n```\nValueError at /admin/sauvignonblanc/trial_plot/9/\n\ninvalid literal for int() with base 10: 'Juice Index'\n\nRequest Method:     GET\nRequest URL:    http://localhost:8000/admin/sauvignonblanc/trial_plot/9/?next=http%3A%2F%2Flocalhost%3A8000%2Fprovenance%2Fsearch%2Fsauvignonblanc%2Ftrial_plot%2F%3Fdata_format%3Djson\nDjango Version:     1.5.9\nException Type:     ValueError\nException Value:    \n\ninvalid literal for int() with base 10: 'Juice Index'\n\nException Location:     /home/zane/programming/virtenv/kea/eggs/Django-1.5.9-py2.7.egg/django/db/models/fields/__init__.py in get_prep_value, line 555\n```\n",
              "author": "zane.gilmore",
              "created": "2015-06-07T21:56:34Z"
            },
            {
              "body": "I could only reproduce an error when saving an imported record. Loading the trial_plot view was no issue. Can you try to reproduce this with an import on a clean trial_plot table?\n",
              "created": "2015-06-07T23:58:42Z"
            },
            {
              "body": "Will do that.\nBut just to be absolutely clear, so that we are talking about the same thing:\nWhen I go to the screen that says \"Browse Trial-Plots\"\nThere is a list of the trial plots that I have imported and are in the trial-plot table.\nOn the left side of each row are 2 icons: one that looks like a blue pencil on a piece of paper and one that is a red diagonal cross.\nWhen I click on the blue pencil and paper is when I get the exception.\n",
              "author": "zane.gilmore",
              "created": "2015-06-08T00:46:20Z"
            },
            {
              "body": "I think that this one has been done to death\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:33:10Z"
            }
          ]
        },
        {
          "summary": "Some tweaks for the upload confirmation of provenance data",
          "key": "KEA-168",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I think we need to tweak the confirmation screen that is displayed immediately after uploading a spreadsheet for data input into a Provenance table:\n- remove the crossed out \"To be created\" for when the entry is found and OK\n- Change the \"to be created\" for a missing entry to \"Missing!\" highlighted in red\n- Display the missing datum\n- Show the spreadsheet line numbers\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/168",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "What you've done looks good but you still need to display the datum that couldn't be found.\n(bullet point 3)\nThe displayed line numbers make it possible to easily see what I'm missing in the spreadsheet but for completeness and to make it as easy as possible for the user I still think you need to display what you couldn't find.\n",
              "author": "zane.gilmore",
              "created": "2015-04-23T03:18:24Z"
            },
            {
              "body": "And you also need to increment the reported row numbers by 1 to match the row numbers in the spreadsheet.\n",
              "author": "zane.gilmore",
              "created": "2015-04-23T03:23:28Z"
            },
            {
              "body": "Hi Zane, I need some discussion of what you want displayed when there is a missing object.\n",
              "created": "2015-04-23T20:03:52Z"
            },
            {
              "body": "These have been addressed and fixed\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T21:17:57Z"
            }
          ]
        },
        {
          "summary": "Data being lost on admin pages after missing data",
          "key": "KEA-169",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a datum is missing on save for adding a row into a provenance table using the admin forms, the error message is displayed but any chosen entries from the selection lists is lost.\n\nThen when this is not noticed a 500 error is created.\n\nThis is very ugly and can mean work is lost.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/169",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Excel Dump on Datagrid no-go",
          "key": "KEA-170",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The link that produces an Excel dump of a data-grid data set is just producing a 500 error right now.\n\nThe error reported via email has the call stack below:\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 68, in view\n    return self.dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/crops/decorators.py\", line 17, in _wrapped\n    return view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/crops/views/mixins.py\", line 17, in dispatch\n    request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/base.py\", line 64, in dispatch\n    return super(DataGridView, self).dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 86, in dispatch\n    return handler(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 33, in post\n    return self.form_valid(form)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 52, in form_valid\n    json_data = self.to_excel(form)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 108, in to_excel\n    create_spreadsheet(DatagridSpreadsheet, context, filepath)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/utils/spreadsheet.py\", line 8, in create_spreadsheet\n    spreadsheet.create()\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\", line 97, in create\n    self.create_sheets(self.context)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/excel.py\", line 15, in create_sheets\n    title = datagrid.data_model._meta.verbose_name.title()\n\nAttributeError: type object 'PopulationMappingType' has no attribute '_meta'\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/170",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "datagrid excel dump failing because of smart quotes",
          "key": "KEA-171",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a user clicks the \"Export to Excel\" button in the datagrid and there are any of those pesky Microsoft smart quotes anywhere in the data then the Excel dump fails with:\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 68, in view\n    return self.dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/crops/decorators.py\", line 17, in _wrapped\n    return view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/crops/views/mixins.py\", line 17, in dispatch\n    request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/base.py\", line 64, in dispatch\n    return super(DataGridView, self).dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 86, in dispatch\n    return handler(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 33, in post\n    return self.form_valid(form)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 52, in form_valid\n    json_data = self.to_excel(form)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 108, in to_excel\n    create_spreadsheet(DatagridSpreadsheet, context, filepath)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/utils/spreadsheet.py\", line 8, in create_spreadsheet\n    spreadsheet.create()\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\", line 97, in create\n    self.create_sheets(self.context)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/excel.py\", line 34, in create_sheets\n    sheet.write(row, col, context['datagrid'].get_column_value(obj, column_name))\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\", line 120, in write\n    width = int(len(str(label)) * 367)\n\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\u2019' in position 5: ordinal not in range(128)\n\n\n<WSGIRequest\npath:/populations/search/,\nGET:<QueryDict: {}>,\nPOST:<QueryDict: {u'per_page': [u'50'], u'data_format': [u'excel'], u'page': [u'1'], u'offset': [u'0']}>,\nCOOKIES:{'csrftoken': 'cWhF211DsWwLuSDezVbJA0ciuGY0fOz1',\n 'sessionid': 'f7od1qs7pbrdgnu5ydob75l6ljln9ryu',\n 'username': 'cflzjg'},\nMETA:{'CONTENT_LENGTH': '45',\n 'CONTENT_TYPE': 'application/x-www-form-urlencoded; charset=UTF-8',\n 'HTTP_ACCEPT': 'application/json, text/javascript, */*; q=0.01',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n 'HTTP_CACHE_CONTROL': 'no-cache',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'csrftoken=cWhF211DsWwLuSDezVbJA0ciuGY0fOz1; sessionid=f7od1qs7pbrdgnu5ydob75l6ljln9ryu; username=cflzjg',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_PRAGMA': 'no-cache',\n 'HTTP_REFERER': 'http://kea.pfr.co.nz/populations/search/',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0',\n 'HTTP_X_FORWARDED_FOR': '10.38.8.14',\n 'HTTP_X_FORWARDED_HOST': 'kea.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'kea.pfr.co.nz',\n 'HTTP_X_REQUESTED_WITH': 'XMLHttpRequest',\n 'PATH_INFO': u'/populations/search/',\n 'QUERY_STRING': '',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'POST',\n 'REQUEST_URI': '/populations/search/',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb21.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb21.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x12c16f0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x2cbb888>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/171",
          "labels": [],
          "comments": [
            {
              "body": "This particular error is different to the one I sent yesterday.\nThe bottom of the stack trace is the most worrying:\n`UnicodeEncodeError: 'ascii' codec can't encode character u'\\xa0' in position 9: ordinal not in range(128)`\n\nI think we have an encoding problem in the Datagrid. As far as I can tell it is using just some ASCII encoding. Where it should be using at least something like UTF8 or similar.\n\nThe problem is that my \"sledgehammer\" fix to just search and replace smart quotes is not going to work.  I'm not even sure how I would find out what character u'\\xa0' is, and even then how many others will there be?\n\n```\nTraceback (most recent call last):\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/core/handlers/base.py\", line 113, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 68, in view\n    return self.dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 25, in _wrapper\n    return bound_func(*args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/crops/decorators.py\", line 17, in _wrapped\n    return view_func(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/utils/decorators.py\", line 21, in bound_func\n    return func(self, *args2, **kwargs2)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/crops/views/mixins.py\", line 17, in dispatch\n    request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/base.py\", line 64, in dispatch\n    return super(DataGridView, self).dispatch(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.5.9-py2.7.egg/django/views/generic/base.py\", line 86, in dispatch\n    return handler(request, *args, **kwargs)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 33, in post\n    return self.form_valid(form)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 52, in form_valid\n    json_data = self.to_excel(form)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/views/dynatable.py\", line 108, in to_excel\n    create_spreadsheet(DatagridSpreadsheet, context, filepath)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/utils/spreadsheet.py\", line 8, in create_spreadsheet\n    spreadsheet.create()\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\", line 97, in create\n    self.create_sheets(self.context)\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/datagrid/excel.py\", line 34, in create_sheets\n    sheet.write(row, col, context['datagrid'].get_column_value(obj, column_name))\n\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\", line 120, in write\n    width = int(len(str(label)) * 367)\n\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xa0' in position 9: ordinal not in range(128)\n\n\n<WSGIRequest\npath:/populations/search/,\nGET:<QueryDict: {u'data_format': [u'json']}>,\nPOST:<QueryDict: {u'per_page': [u'50'], u'data_format': [u'excel'], u'page': [u'1'], u'offset': [u'0']}>,\nCOOKIES:{'csrftoken': 'cWhF211DsWwLuSDezVbJA0ciuGY0fOz1',\n 'sessionid': 'f7od1qs7pbrdgnu5ydob75l6ljln9ryu',\n 'username': 'cflzjg'},\nMETA:{'CONTENT_LENGTH': '45',\n 'CONTENT_TYPE': 'application/x-www-form-urlencoded; charset=UTF-8',\n 'HTTP_ACCEPT': 'application/json, text/javascript, */*; q=0.01',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-US,en;q=0.5',\n 'HTTP_CACHE_CONTROL': 'no-cache',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'csrftoken=cWhF211DsWwLuSDezVbJA0ciuGY0fOz1; sessionid=f7od1qs7pbrdgnu5ydob75l6ljln9ryu; username=cflzjg',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_PRAGMA': 'no-cache',\n 'HTTP_REFERER': 'http://kea.pfr.co.nz/populations/search/?data_format=json',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0',\n 'HTTP_X_FORWARDED_FOR': '10.38.8.14',\n 'HTTP_X_FORWARDED_HOST': 'kea.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'kea.pfr.co.nz',\n 'HTTP_X_REQUESTED_WITH': 'XMLHttpRequest',\n 'PATH_INFO': u'/populations/search/',\n 'QUERY_STRING': 'data_format=json',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'POST',\n 'REQUEST_URI': '/populations/search/?data_format=json',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb21.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb21.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x12c16f0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x5200fd8>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n```\n",
              "author": "zane.gilmore",
              "created": "2015-05-19T21:53:42Z"
            },
            {
              "body": "Hi Zane,\n\nI have committed a change that I think will fix the problem\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/0988cf2998241222d52e8db56d0485e143a2a3e7\n\nSimply replace str() with unicode(). As long as the string is valid unicode it should work. Can you have a quick test and see if this fixes the problem?\n\nThanks,\n\nWilliam.\n",
              "created": "2015-05-20T00:55:30Z"
            },
            {
              "body": "I believe that does fix it.\nI have just applied it to the test instance and it works.\n\nThanks\n",
              "author": "zane.gilmore",
              "created": "2015-05-20T01:45:47Z"
            },
            {
              "body": "I have added code in for a new db adapter that strips smart quotes on all queries. Code has unit tests that are passing.\n",
              "created": "2015-05-25T01:43:16Z"
            }
          ]
        },
        {
          "summary": "localid field is not handleld properly for trial plots",
          "key": "KEA-172",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "For the trial plot table in the sauvignonblanc provenance the localid column is not being displayed according to it's definition from the prov'defn table.\n\nIt is only displaying the integer and should have the prefix and base conversion.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/172",
          "labels": [],
          "comments": [
            {
              "body": "done was bad DB schema unsynched with prov-def\n",
              "author": "zane.gilmore",
              "created": "2015-05-21T04:54:21Z"
            }
          ]
        },
        {
          "summary": "Assess Django upgrade to latest practical version",
          "key": "KEA-173",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to assess how much work to migrate Kea to Django 1.x (min 1.7)\n\nWe need to be able to manage Provenance schema migrations using Django migrations.\nGetting it going using South would be unwise as it is discontinued\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/173",
          "labels": [],
          "comments": [
            {
              "body": "Recommend upgrade to django 1.8 django 1.8 is LTS (long term support) which means it gets security updates for 3 years\n\nSee https://docs.djangoproject.com/en/1.8/internals/release-process/#long-term-support-lts-releases\n\nAlso https://www.djangoproject.com/weblog/2015/apr/01/release-18-final/\n\nDjango 1.6\n\nhttps://docs.djangoproject.com/en/1.8/releases/1.6/\n- Transactions\n- disable autocommit for transactions\n- enable transaction per request\n- DiscoverRunner now bundled with django (can remove dependency on django-discover-runner)\n- Update speed improvements (previously django runs select before update now just tries to update)\n- foreign keys can now specify constraints https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.ForeignKey.db_constraint\n- ModelAdmin get_query_set renamed to get_queryset\n- replace django-transaction-signals which is used for elasticsearch updates. Can most likely replace with another library or remove elasticsearch altogether as we discussed (https://django-transaction-hooks.readthedocs.org/en/latest/)\n\nDjango 1.7\n\nhttps://docs.djangoproject.com/en/1.8/releases/1.7/\n- Remove south and replace with django migrations\n- django.utils.importlib replace with importlib from python\n- util modules renamed to utils\n\nDjango 1.8\n\nhttps://docs.djangoproject.com/en/1.8/releases/1.8/\n- model meta api changed. May break elasticsearch relational lookup code and provenance perhaps?\n\nThis is the list that I've come up with. I suspect that the most likely things to break will be the elasticsearch and provenance stuff. I don't know how long  it will take to fix those if it does break because those are complicated parts of the system. At the very least we're probably looking at 2 - 3 days. Could be up to two weeks if things go horribly wrong. For this sort of upgrade I wish we had full test coverage.\n",
              "created": "2015-05-27T02:36:25Z"
            },
            {
              "body": "The official OK has been given for this.\nMatthew says that we should be running only supported stuff so we can defend the expenditure.\n\nThanks.\n",
              "author": "zane.gilmore",
              "created": "2015-05-28T04:29:30Z"
            },
            {
              "body": "I think that this is done now\n",
              "author": "zane.gilmore",
              "created": "2015-10-06T00:46:25Z"
            }
          ]
        },
        {
          "summary": "Trail -plot browse list and edit page not displaying the LocalIDs correctly",
          "key": "KEA-175",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have created this as a separate issue but I think that it may be associated with #167  as the Vineyard Block table is displaying its LocalID correctly.\n\nIn the Browse Trial_Plots page the Plot Identifier column is not being displayed according to the rules of the JSON in the ProvenanceDefinition field:\n\n```\n{\n  \"min_length\":3,\n  \"prefix\":\"TP-\",\n  \"unique\":true\n}\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/175",
          "labels": [],
          "comments": [
            {
              "body": "Not sure why that is but the LocalID field for trial plot is a character varying(50) in the DB not a bigint like the other LocalID fields (vineyard block ...).\nDid you change that field at any time from character to LocalID type?\nI tried to come up with a quick SQL but there are to many fk relations to that field from other tables. This might take some to figure untangle.\n",
              "created": "2015-06-16T02:04:11Z"
            },
            {
              "body": "This is most likely caused by the provenance definition being changed at some point and the db tables not being updated to reflect it (seen such things before). This is exactly the problem we are trying to solve by upgrading to djago 1.8 and using migrations to handle schema changes to the dynamic provenance models. Will see what Zane has to say though.\n",
              "created": "2015-06-16T02:08:21Z"
            },
            {
              "body": "You are dead right.\nThanks for that Stefan.\n\nWill have a closer look at the tables to see if I can just fix it at the DB level.\nLeave it for now. \nAnd thanks again for your time.\n",
              "author": "zane.gilmore",
              "created": "2015-06-16T05:34:28Z"
            },
            {
              "body": "This is done now I think\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:33:54Z"
            }
          ]
        },
        {
          "summary": "type \"serial\" does not exist: error on Provenance load",
          "key": "KEA-176",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the provenance is dumped then dropped and reloaded an error is generated:\n\n```\nFATAL ERROR - The following SQL query failed: ALTER TABLE \"sauvignonblanc_harvest_sample\" ALTER COLUMN \"id\" TYPE serial, ALTER COLUMN \"id\" SET NOT NULL, ALTER COLUMN \"id\" DROP DEFAULT;\nThe error was: type \"serial\" does not exist\n\nDatabaseError: Problem installing fixture 'sauvignonblanc__provdump_20150619.json': Could not load provenance.ProvenanceDefinition(pk=15): type \"serial\" does not exist\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/176",
          "labels": [],
          "comments": [
            {
              "body": "The django 1.8 branch makes the fix for this redundant. The problem is how the provenance models are created automatically when the provenance definitions are imported when loading the json file using signal receivers and south. The django 1.8 branch solves this because it removes the signal receivers and handles migration of provenance models using django migrations.\n\nPlease let me know if you still want to fix this or would rather focus on 1.8 branch solution.\n",
              "created": "2015-06-24T01:06:51Z"
            },
            {
              "body": "We need to check the dump and load of provenances on this Django 1.8 branch.\nIf it works then we have done this issue.\n\nWe also need to ensure that the fact that under this new 1.8 regime that we will have to do a syncdb after the load is documented somewhere. Perhaps that /docs/ thing?\n",
              "author": "zane.gilmore",
              "created": "2015-06-24T02:21:06Z"
            },
            {
              "body": "I had to make a few small alterations to the dump and drop provenance scripts. I've managed to drop and load back in the funny provenance. If you have any problems with it please let me know.\n",
              "created": "2015-06-25T02:10:40Z"
            },
            {
              "body": "Forgot to add. After loading in a provenance with loaddata you need to run migrations with bin/django migrate.\n",
              "created": "2015-06-25T02:13:46Z"
            }
          ]
        },
        {
          "summary": "error on trial plot upload",
          "key": "KEA-177",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I tried to upload some trial plots on the sauvignonblanc provenance I got this error\nhttps://drive.google.com/file/d/0B4TupZPfpeyxQWRuX1RUWllSdjg/view?usp=sharing\n\n(trying out this mechanism for attaching a file to a GitHub issue)\nThe file I was trying to upload is this one:\nhttps://drive.google.com/file/d/0B4TupZPfpeyxV2pLMGFuSXNUM0k/view?usp=sharing\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/177",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Trial plot import errors",
          "key": "KEA-178",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "This looks a lot like #167\nhttps://drive.google.com/file/d/0B4TupZPfpeyxNU1QQll5SGZQb28/view?usp=sharing\n\nHas Stefan's new code even been merged into this branch?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/178",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I have merged stefans code into django18 branch. I've had a quick look around and everything seems ok. No obvious errors.\n",
              "created": "2015-06-29T04:45:07Z"
            },
            {
              "body": "This still does not seem to be fixed.\nAm still getting the same error.\n",
              "author": "zane.gilmore",
              "created": "2015-06-29T23:26:09Z"
            },
            {
              "body": "I looked at Stefan's code. He has added a custom m2m field. I'm guessing here but I think his idea was to not use ManyToManyField but use his custom field for m2m relations instead. Did he mention anything to you about that?\n\nMany2ManyOnUniqueField\n",
              "created": "2015-06-30T01:10:37Z"
            },
            {
              "body": "The following fixes the problem. Error caused by required upgrade of django-import-export to work with django18 branch.\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/c6cfb80e085c43e9ac6158b80cfc8dc9b09c416b\n\nhttps://github.com/PlantandFoodResearch/django-import-export/commit/1f8ffbab6783a3d2e878615359f9b9f7b8a54774\n\nWill need to pull src/django_import_export also.\n\nNeed to update provenance definitions to use Many2ManyOnUnqiueField. See to_field is required to specify which field on the related model to use as lookup to parse values from spreadsheet.\n\n{\n \"related_name\":\"trial_plot_treatment\",\n \"to_field\":\"name\",\n \"null\":true,\n \"to\":\"sauvignonblanc.treatment\",\n \"blank\":true\n}\n\nAll m2m fields must be updated in all prov defs.\n",
              "created": "2015-06-30T02:17:28Z"
            },
            {
              "body": "I think we can call this closed. I have had no problems recently with this.\n",
              "author": "zane.gilmore",
              "created": "2015-10-20T01:33:49Z"
            }
          ]
        },
        {
          "summary": "Comma delimited list for provenance table upload seems space sensitive",
          "key": "KEA-179",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It appears that if a space is inserted after the comma in the list of a M2M upload then that entry is ignored.\nI was uploading this file:\nhttps://drive.google.com/file/d/0B4TupZPfpeyxZlkteXloOEllaDA/view?usp=sharing\ninto Company table.\n\nAfter changing the the company contact to the \"on unique field\" M2M field type and adding the \"to_field\" to the JSON.\n\nThe upload work fine except that this problem occurred.\nWe need to ensure that white space on either side of the comma is trimmed and ignored.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/179",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "The whitespace is already being trimmed.\n\n\"Damien  Yvon\" isn't imported because the names don't match. See it has a double space in the name in the contacts table. Also Jeff Clark is spelt \"Jeff Clarke\".\n\nThere is no problem with the code. The problem is with the data.\n",
              "created": "2015-07-01T23:16:25Z"
            },
            {
              "body": "Doh!\nThank you.\nAlthough this demonstrates my personal dullness :-/\nIt also demonstrates a user interface bug, in that it silently ignores data.\nI now think that we need to ensure that unfound entries in the m2m column are displayed on the confirmation screen in red and treated like any other unfound entries.\n\nAnd perhaps we need to ensure that white-space is ignored in any searches.\n",
              "author": "zane.gilmore",
              "created": "2015-07-01T23:35:04Z"
            }
          ]
        },
        {
          "summary": "M2M fields not being listed in Browse lists",
          "key": "KEA-180",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When you go to the browse data page for a prov' table the M2M fields are not being included.\n\nI am quite sure that the users will complain about this in the future.\nI don't see this as a show-stopper but if you can assess how difficult this would be to do I would be much obliged.\n\nI seem to remember that Stefan had actually got this going but my memory may be playing tricks on me.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/180",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Going to have a look at this with the trial plot to treatment M2M. I assume \"browse data page\" is this http://localhost:8000/provenance/search/sauvignonblanc/trial_plot/\n\nWill try to list them comma separated with one space behind the comma.\n",
              "created": "2015-07-05T18:54:57Z"
            },
            {
              "body": "Stefan,\nYour are correct about the page.\n\nAnd what you suggest for the lists would be great.\n\nAnd please work on django18 branch for now, thanks.\n",
              "author": "zane.gilmore",
              "created": "2015-07-05T21:36:46Z"
            },
            {
              "body": "just to make sure I don't go down the wrong path but has any non provenance \"browse data page\" ever displayed m2m values? I am digging into the datagrid views to add displaying m2m atm and currently they don't seem to manage them at all. Is that correct?\n",
              "created": "2015-07-05T22:04:03Z"
            },
            {
              "body": "I never added in support to handle m2m values. I'm not sure if Darryl did or not. It was originally designed to display a flat list of values (think postgres view) rather than m2m relational data. I think you should be safe to assume that m2m wasn't handled unless Zane says otherwise.\n\nThanks,\n\nWilliam.\n",
              "created": "2015-07-05T22:10:56Z"
            },
            {
              "body": "done in 05d8fcb8de5c1838fd690df757cf42071a61f2e0 and 7ad5aeecbadcfce0690c8f55a45ba2a64c5a6951 has changes to order columns according to the field ordering of the provenance definition.\n",
              "created": "2015-07-06T04:11:03Z"
            }
          ]
        },
        {
          "summary": "Error from 1st step of Sample initialisation",
          "key": "KEA-181",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "For sample initialisation on Provenance.\nWhen I choose a definition and click next, I get the attached error.\n\nhttps://drive.google.com/file/d/0B4TupZPfpeyxRHd1T1U2VVJaQ0E/view?usp=sharing\n\nThis is a show stopper.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/181",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Batch upload confirmation list uses underlines",
          "key": "KEA-182",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It is the convention that underlined text is hyperlinked text.\nWe need to remove those underlines for that confirmation text.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/182",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "I am reasonably sure that this has been done\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:51:42Z"
            }
          ]
        },
        {
          "summary": "Colour coding of missing objects in batch upload wrong",
          "key": "KEA-183",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The reports of missing objects in the batch upload confirmation is in green.\nThis is the same as the success type data report.\n\nThis should be in red or similar.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/183",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Zane, do you mean the excel import step 2 \"Confirm ... import\" view where rows marked **New** are green?\nIf it is the confirmation and success reports use the same logic to generate the diff with the colour coding. It might be possible to hack this with CSS but I feel that will not work and bigger changes to the import-export library are needed.\nAre you okay with the colours for the other states (**skip**, **delete**, **update**)?\n",
              "created": "2015-07-11T23:11:57Z"
            },
            {
              "body": "Fixed in #219\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:50:24Z"
            }
          ]
        },
        {
          "summary": "Default plate set size should be zero step 4 of provenance sample init",
          "key": "KEA-184",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The default number of plates for sample initialisation in Provenance Sample initialisation should be set to 0.\nThe single sample container set size is correct with 1.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/184",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Perhaps we should make these defaults entries in the settings file.\n- Default Crop Plate Set Size\n- Default Crop Single Sample Container Set Size\n- Default Provenance Plate Set Size\n- Default Provenance Single Sample Container Set Size\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:48:03Z"
            },
            {
              "body": "Have set both to zero",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:02:13Z"
            }
          ]
        },
        {
          "summary": "Datagrid data columns expand horizontally differently to the column headers",
          "key": "KEA-185",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the datagrid.\nWhen the page is expand and contracted horizontally the part of the table that contains all of the data changes with the page.\nHowever the column headers containing the names of the columns and the filters etc remains static.\nThis means that the data columns and the headers very rarely match up properly.\n\nThis looks quite bad and can actually cause confusion.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/185",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nCan we have a chat about this sometime today? I have tried to replicate the problem but have been unable to.\n",
              "created": "2015-07-28T19:00:13Z"
            }
          ]
        },
        {
          "summary": "Merge django18 branch with master and tag release",
          "key": "KEA-186",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Before we start on rolling out the new version of Kea, we need to merge the django18 branch into master and also set up the release.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/186",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Merge has been done\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/f28edcfa2cd46a253e96e212f0f6c69b1a088183\n",
              "created": "2015-07-16T22:08:09Z"
            }
          ]
        },
        {
          "summary": "django rebuild_indexes is failing",
          "key": "KEA-187",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Just tried to rebuild by elastic search indices and got this:\n\n```\nDeleting index keadev_population-index\nDeleting index keadev_plant-index\nDeleting index keadev_genotype-index\nDeleting index keadev_extract-plate-index\nDeleting index keadev_plate-index\nDeleting index keadev_sample-extract-index\nDeleting index keadev_sample-index\nDeleting index keadev_location-index\nDeleting index keadev_provenance-index\nCreating index keadev_population-index\nCreating index keadev_plant-index\nCreating index keadev_genotype-index\nCreating index keadev_extract-plate-index\nCreating index keadev_plate-index\nCreating index keadev_sample-extract-index\nCreating index keadev_sample-index\nCreating index keadev_location-index\nCreating index keadev_provenance-index\nTraceback (most recent call last):\n  File \"/home/zane/programming/virtenv/kea18/Kea/bin/django\", line 94, in <module>\n    sys.exit(djangorecipe.binscripts.manage('kea.settings.development'))\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/djangorecipe-2.1.1-py2.7.egg/djangorecipe/binscripts.py\", line 9, in manage\n    management.execute_from_command_line(sys.argv)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 338, in execute_from_command_line\n    utility.execute()\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 330, in execute\n    self.fetch_command(subcommand).run_from_argv(self.argv)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 390, in run_from_argv\n    self.execute(*args, **cmd_options)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 441, in execute\n    output = self.handle(*args, **options)\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/elasticsearch/management/commands/rebuild_indexes.py\", line 36, in handle\n    call_command('populate_index', **options)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 100, in call_command\n    command = load_command_class(app_name, name)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 40, in load_command_class\n    module = import_module('%s.management.commands.%s' % (app_name, name))\n  File \"/usr/lib/python2.7/importlib/__init__.py\", line 37, in import_module\n    __import__(name)\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/elasticsearch/management/commands/populate_index.py\", line 10, in <module>\n    from django.db.backends import BaseDatabaseWrapper\nImportError: cannot import name BaseDatabaseWrapper\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/187",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "I'm running the populate_index command now. Seems to be running ok so far.\n",
              "created": "2015-07-16T03:50:04Z"
            },
            {
              "body": "Well I managed to get it going by commenting out line 10 in\n/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/elasticsearch/management/commands/populate_index.py\n\nand changing \nclose_connection to close_old_connections on about line 103\n",
              "author": "zane.gilmore",
              "created": "2015-07-16T04:13:42Z"
            },
            {
              "body": "I have no idea whether that was a good hack but it worked at the time :-)\n",
              "author": "zane.gilmore",
              "created": "2015-07-16T04:14:48Z"
            },
            {
              "body": "Yes, that's similar to what I did.\n",
              "created": "2015-07-16T04:15:50Z"
            }
          ]
        },
        {
          "summary": "Top level provenance schema structure needs tweaking",
          "key": "KEA-188",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After trying to get the process handling going with the provenance system it has become apparent that we have not quite got things right for the structure of our schema.\n\nThe \"Provenance\" table is really the app within Kea that is created when we create a new Provenance.\n\nThis means that we should be making the \"app_label\" column on the \"ProvenanceDefinition\" table a foreign key to the \"Provenance\" table. Then we use the name column of the Provenance table as the app name.\n\nThis has become an issue when we apply a Provenance to a Sample container.\nOn a plate if there are samples that come from multiple specimen-types then we are in trouble.\nThe column in the SampleContainer table should not be ProvenanceTable but rather Provenance.\n\nIn the meantime, I am going to have to kludge it for the sample-containers in process handling but we do need to address this.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/188",
          "labels": [
            "Process Handling",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Notes on running migrations\n\nRun migrations but skip the dynamic provenance models as these will not work until migrations are run.\n\nSKIP_DYNAMIC_MODELS=yes bin/django migrate\n\nOpen psql or whichever GUI you like.\n\nbin/django dbshell\n\nprovenance_id set to 1 initially. Need to fix manually. Look at all provenance definitiions and update the provenance_id fkey as required. The following worked for me. The last select is to check everything looks ok.\n\n> select \\* from provenance_provenancedefinition;\n> update provenance_provenancedefinition set provenance_id = 3 where id not in (6, 7);\n> select \\* from provenance_provenancedefinition;\n\nRequired to run migrations a second time.\n\nbin/django migate\n",
              "author": "will.buick",
              "created": "2015-07-31T00:12:34Z"
            },
            {
              "body": "Please check my migration for the postgres trigger function to make sure it is correct.\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/458a541f276981b4384da3f8a1d79ed6999f6c65#diff-fc0957a9d8c504b58f6c32716ec271a5R1\n\nAlso I just checked the diff and noticed I committed in a change to the db connection string. Please change as required\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/458a541f276981b4384da3f8a1d79ed6999f6c65#diff-7c9665a74c97316058827cee9b1ca5adL39\n",
              "author": "will.buick",
              "created": "2015-07-31T00:15:01Z"
            }
          ]
        },
        {
          "summary": "Change the name of ProvenanceList to SpecimenType",
          "key": "KEA-189",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have been racking my brains for a better name for this table for months and I think that the name \"SpecimenType\" is a better name.\n\nProvenanceList is a stupid meaningless name that only causes confusion and needs to be changed ASAP.\n\nIt defines the list of tables, that samples are directly attached to, for a given Provenance (dynamic app).\nThese tables define the entities from which a sample is taken. The crop analog is the Plant table but for the provenance context there could be more than one entity from which samples will be taken.\n\nAfter quizzing a few scientists around the place I have found that there is no generic word that means \"entity from which a sample is taken\". \nI had a flash of inspiration in the weekend and thought of the the word \"specimen\". It is not a direct match but it is close enough and, I think, manages to convey the meaning I want.\nSo in the spirit of computer (and other) scientists everywhere we are going to hijack the word specimen and redefine it as the \"entity from which a sample is taken\"... at least for within the Kea context.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/189",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "And so we dumped the \"Type\" off the end of that and just used \"Specimen\"\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:40:13Z"
            }
          ]
        },
        {
          "summary": "Error when saving edits on things with an altname",
          "key": "KEA-190",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the save button is clicked after editing Populations, Genotypes or Plants in the admin page for these entities, an exception is raised example stacktrace below.\nThis only seems to happen for something that already has an AltName.\n\n```\nInternal Server Error: /admin/pndata/genotype/242423/ Traceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/handlers/base.py\", line 132, in get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 145, in inner\n    return func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/contrib/admin/options.py\", line 616, in wrapper\n    return self.admin_site.admin_view(view)(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 110, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/views/decorators/cache.py\", line 57, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/contrib/admin/sites.py\", line 233, in inner\n    return view(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/pndata/admin.py\", line 161, in change_view\n    result = super(GenotypeAdmin, self).change_view(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/contrib/admin/options.py\", line 1519, in change_view\n    return self.changeform_view(request, object_id, form_url, extra_context)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 34, in _wrapper\n    return bound_func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 110, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 30, in bound_func\n    return func.__get__(self, type(self))(*args2, **kwargs2)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 145, in inner\n    return func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/contrib/admin/options.py\", line 1466, in changeform_view\n    if all_valid(formsets) and form_validated:\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/formsets.py\", line 439, in all_valid\n    if not formset.is_valid():\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/formsets.py\", line 304, in is_valid\n    self.errors\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/formsets.py\", line 278, in errors\n    self.full_clean()\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/formsets.py\", line 326, in full_clean\n    form = self.forms[i]\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/functional.py\", line 60, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/formsets.py\", line 142, in forms\n    forms = [self._construct_form(i) for i in range(self.total_form_count())]\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/models.py\", line 872, in _construct_form\n    form = super(BaseInlineFormSet, self)._construct_form(i, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/models.py\", line 587, in _construct_form\n    pk = self.data[pk_key]\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/datastructures.py\", line 322, in __getitem__\n    raise MultiValueDictKeyError(repr(key))\nMultiValueDictKeyError: \"u'altnames-0-id'\"\n\nRequest repr(): \n<WSGIRequest\npath:/admin/pndata/genotype/242423/,\nGET:<QueryDict: {u'next': [u'http://kea.pfr.co.nz/genotypes/search/?queries%5Bgenotype_altnames%5D=T09.35-05-09%25&data_format=json']}>,\nPOST:<QueryDict: {u'altnames-0-AltName': [u'T09.35-05-09d'], u'altnames-2-Genotype': [u'242423'], u'altnames-3-AltNameType': [u''], u'altnames-3-AltName': [u''], u'Sex': [u''], u'_save': [u'Save'], u'altnames-1-AltNameType': [u''], u'Description': [u'eBrida - auto import , Mislabelled vine. Possibly incorrect DNA sample. contact Vincent Borgers'], u'next': [u'http://kea.pfr.co.nz/genotypes/search/?queries%5Bgenotype_altnames%5D=T09.35-05-09%25&data_format=json'], u'altnames-2-AltNameType': [u''], u'csrfmiddlewaretoken': [u'wRBc0melUiXVucWvqU4hZkkguE1l3eyF'], u'Population': [u'2277'], u'altnames-0-Genotype': [u'242423'], u'altnames-MAX_NUM_FORMS': [u'1000'], u'altnames-1-Genotype': [u'242423'], u'altnames-1-AltName': [u''], u'altnames-__prefix__-AltNameType': [u''], u'altnames-__prefix__-AltName': [u''], u'altnames-MIN_NUM_FORMS': [u'0'], u'LastPlantID': [u'1'], u'altnames-3-Genotype': [u'242423'], u'altnames-2-AltName': [u''], u'altnames-__prefix__-Genotype': [u'242423'], u'a\n ltnames-TOTAL_FORMS': [u'4'], u'altnames-0-AltNameType': [u'25'], u'altnames-INITIAL_FORMS': [u'1'], u'Ploidy': [u''], u'Species': [u'5']}>,\nCOOKIES:{'JSESSIONID': '(J2EE503357100)ID2088523650DB41d3fb24e145fdbe48b0484799db8a780529ed60End',\n 'csrftoken': 'wRBc0melUiXVucWvqU4hZkkguE1l3eyF',\n 'sessionid': '5ss1k817foq8gzl74if4tou0kd7gjdjv',\n 'username': 'hrtvxb'},\nMETA:{'CONTENT_LENGTH': '3255',\n 'CONTENT_TYPE': 'multipart/form-data; boundary=----WebKitFormBoundaryA2mMnmvDlj2BsGK6',\n u'CSRF_COOKIE': u'wRBc0melUiXVucWvqU4hZkkguE1l3eyF',\n 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'en-GB,en-US;q=0.8,en;q=0.6',\n 'HTTP_CACHE_CONTROL': 'max-age=0',\n 'HTTP_CONNECTION': 'Keep-Alive',\n 'HTTP_COOKIE': 'JSESSIONID=(J2EE503357100)ID2088523650DB41d3fb24e145fdbe48b0484799db8a780529ed60End; csrftoken=wRBc0melUiXVucWvqU4hZkkguE1l3eyF; username=hrtvxb; sessionid=5ss1k817foq8gzl74if4tou0kd7gjdjv',\n 'HTTP_HOST': '127.0.0.1:54000',\n 'HTTP_ORIGIN': 'http://kea.pfr.co.nz',\n 'HTTP_REFERER': 'http://kea.pfr.co.nz/admin/pndata/genotype/242423/?next=http%3A%2F%2Fkea.pfr.co.nz%2Fgenotypes%2Fsearch%2F%3Fqueries%255Bgenotype_altnames%255D%3DT09.35-05-09%2525%26data_format%3Djson',\n 'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.134 Safari/537.36',\n 'HTTP_X_FORWARDED_FOR': '10.40.4.17',\n 'HTTP_X_FORWARDED_HOST': 'kea.pfr.co.nz',\n 'HTTP_X_FORWARDED_SERVER': 'kea.pfr.co.nz',\n 'PATH_INFO': u'/admin/pndata/genotype/242423/',\n 'QUERY_STRING': 'next=http%3A%2F%2Fkea.pfr.co.nz%2Fgenotypes%2Fsearch%2F%3Fqueries%255Bgenotype_altnames%255D%3DT09.35-05-09%2525%26data_format%3Djson',\n 'REMOTE_ADDR': '127.0.0.1',\n 'REQUEST_METHOD': 'POST',\n 'REQUEST_URI': '/admin/pndata/genotype/242423/?next=http%3A%2F%2Fkea.pfr.co.nz%2Fgenotypes%2Fsearch%2F%3Fqueries%255Bgenotype_altnames%255D%3DT09.35-05-09%2525%26data_format%3Djson',\n 'SCRIPT_NAME': u'',\n 'SERVER_NAME': 'aklweb21.pfr.co.nz',\n 'SERVER_PORT': '54000',\n 'SERVER_PROTOCOL': 'HTTP/1.1',\n 'uwsgi.node': 'aklweb21.pfr.co.nz',\n 'uwsgi.version': '2.0.5.1',\n 'wsgi.errors': <open file 'wsgi_errors', mode 'w' at 0x4b2c4b0>,\n 'wsgi.file_wrapper': <built-in function uwsgi_sendfile>,\n 'wsgi.input': <uwsgi._Input object at 0x5839030>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 0)}>\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/190",
          "labels": [
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Add new vineyard form is empty  on add vineyardblock form",
          "key": "KEA-191",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the plus icon in the the add new vineyard block form is clicked the dialog for adding a new vineyard is empty.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/191",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "vineyard block admin form entry not allowing blank multi year block ids",
          "key": "KEA-192",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Leaving the multiyearblockid column blank is not being allowed\nComplaining about existing entry\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/192",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "make skeleton spreadsheets for provenance uploads use dropdowns",
          "key": "KEA-193",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Where appropriate dropdowns would make things easier to enter in spreadsheets\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/193",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Follow a population/samplebatch/tree/something...",
          "key": "KEA-194",
          "status": "To Do",
          "description": "Copy/paste from my email to Zane:\n\nI was wondering it would be feasible to add support to Kea for a following/notification system, where a Kea user can choose to \"follow\" a sample batch (or population, or set of plates, or something...), and then get an email update when work is done on them.\n\nThis would be useful for example in Kiwifruit sex testing, where if we upload some sex testing results to Kea, a Kea user in Te Puke will receive a notification telling them their results are ready.\n\nIt may also be useful for a scientist who is working with a particular population to receive a notification when another scientist, working independently, screens their population with some marker - which they might otherwise never find out about.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/194",
          "labels": [
            "Process Handling",
            "enhancement",
            "question"
          ],
          "comments": []
        },
        {
          "summary": "Creating sample batch won't let me add population",
          "key": "KEA-195",
          "status": "Done",
          "description": "I just tried to create a new sample batch, but it failed because I could not select the population.\nSample initialisation menu -> Initialise samples brings up the form for creating a sample batch. The sixth field is labelled \"Population\". It has a drop-down menu with a magnifying glass and a plus sign for searching or adding populations respectively.\nChoosing a population from the search box adds it to the drop down menu, although it is listed as \"POP0ZXX (L15.052)\" instead of just \"POP0ZXX\". When I select it and click Submit, it gives me a popup saying \"You must choose an item from the list\", although one has clearly been selected.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/195",
          "labels": [],
          "comments": [
            {
              "body": "This happens in both Kea and Keatest.\n",
              "created": "2015-08-17T01:57:50Z"
            },
            {
              "body": "So I've tried this again and it's working fine. If you fixed it, good work! If not, it might be difficult to reproduce... :-)\n",
              "created": "2015-08-19T05:24:15Z"
            },
            {
              "body": "If it works .... it works :-)\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:37:39Z"
            }
          ]
        },
        {
          "summary": "Possible to display Genotype altnames in sample browser?",
          "key": "KEA-196",
          "status": "Done",
          "description": "We will face quite a bit of resistance to Kea uptake in kiwi  if we cant see genotype altnames (ie vine locations like T08.33-06-15f ) in the sample browser...\n\nCould this be added?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/196",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "![image](https://cloud.githubusercontent.com/assets/268441/13797595/a4c23c7a-eb73-11e5-94c5-6202e11c2964.png)\n",
              "created": "2016-03-15T23:36:19Z"
            }
          ]
        },
        {
          "summary": "500 error on excel import",
          "key": "KEA-197",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When excel import in provenance browse is clicked get a 500 error.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/197",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Error on runserver start",
          "key": "KEA-198",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have just added a new provenance.\nWhile I was adding it I was getting a strange socket error.\nBut it was adding the entries as I was going.\nIt turned out that I did not seem to be running the celery thingy .\n\nNow when I try to restart my dev runserver I get this:\n\n```\n(Kea)zane@zane-HP-EliteBook-8570w:Kea$ django runserver\nTraceback (most recent call last):\n  File \"/home/zane/programming/virtenv/kea18/Kea/bin/django\", line 94, in <module>\n    sys.exit(djangorecipe.binscripts.manage('kea.settings.development'))\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/djangorecipe-2.1.1-py2.7.egg/djangorecipe/binscripts.py\", line 9, in manage\n    management.execute_from_command_line(sys.argv)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 338, in execute_from_command_line\n    utility.execute()\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 312, in execute\n    django.setup()\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/__init__.py\", line 18, in setup\n    apps.populate(settings.INSTALLED_APPS)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/apps/registry.py\", line 115, in populate\n    app_config.ready()\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/provenance/apps.py\", line 23, in ready\n    reregister_in_admin(dynamic_model)\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/provenance/admin.py\", line 461, in reregister_in_admin\n    utils.reregister_in_admin(admin.site, model_class, admin_class)\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/provenance/utils.py\", line 48, in reregister_in_admin\n    unregister_from_admin(admin_site, model)\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/provenance/utils.py\", line 37, in unregister_from_admin\n    reload(import_module('kea.urls.base'))\n  File \"/home/zane/programming/virtenv/kea18/Kea/src/kea/kea/urls/base.py\", line 10, in <module>\n    admin.autodiscover()\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/contrib/admin/__init__.py\", line 24, in autodiscover\n    autodiscover_modules('admin', register_to=site)\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/utils/module_loading.py\", line 86, in autodiscover_modules\n    if module_has_submodule(app_config.module, module_to_search):\n  File \"/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/utils/module_loading.py\", line 113, in module_has_submodule\n    name = \".\".join([package.__name__, module_name])\nAttributeError: 'NoneType' object has no attribute '__name__'\n\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/198",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Not sure whether the lack of celery server is pertinent here.\nBut just mentioned it for completeness.\n",
              "author": "zane.gilmore",
              "created": "2015-09-10T04:19:10Z"
            },
            {
              "body": "Will require a copy of your database to replicate\n",
              "author": "will.buick",
              "created": "2015-09-10T04:19:20Z"
            },
            {
              "body": "I suppose that I should also mention that I have added some recursive foreign keys to the provenance that I am making right now. \nJust in case this is also pertinent.\n",
              "author": "zane.gilmore",
              "created": "2015-09-10T04:20:49Z"
            },
            {
              "body": "I think that this is being covered by #200\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:36:26Z"
            }
          ]
        },
        {
          "summary": "Command to initialise new provenance",
          "key": "KEA-199",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Because of the requirement for file system additions for each provenance, we need something that will create those new dirs etc.\n\nSo a command is in order, I think.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/199",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I have created this command now.\nI have also commented out the admin register lines for the admin provenance CRUD.\n(lines 261-263 of provenance/admin.py)\nI don't think we ever want to be adding a provenance via the admin interface.\n\nWilliam could you please have a look at this to see whether there are any other possible bad consequences with doing this?\nI am afraid that there is code that is only fired when the admin interface is used that I should be firing in the create_provenance command.\n\nI will push my changes as soon as I have done some testing.\n",
              "author": "zane.gilmore",
              "created": "2015-09-25T03:17:10Z"
            },
            {
              "body": "That's pushed now\n",
              "author": "zane.gilmore",
              "created": "2015-09-25T04:10:28Z"
            },
            {
              "body": "The command looks good to me. That pretty much covers all of the manual steps required to create a provenance.\n\nOne thing to note though. Your regex on line 78 looks wrong. I think it should be ^\\d e.g. starts with a digit. Your regex is checking if there is a digit anywhere in the string.\n",
              "author": "will.buick",
              "created": "2015-09-27T20:00:07Z"
            },
            {
              "body": "Also I'll add that you can have the provenance model in the admin, just change the permissions so only superusers can edit if you like. I've copied this from the django admin docs.\n\nModelAdmin.has_add_permission(request)ﾂｶ\nShould return True if adding an object is permitted, False otherwise.\n\nModelAdmin.has_change_permission(request, obj=None)ﾂｶ\nShould return True if editing obj is permitted, False otherwise. If obj is None, should return True or False to indicate whether editing of objects of this type is permitted in general (e.g., False will be interpreted as meaning that the current user is not permitted to edit any object of this type).\n\nModelAdmin.has_delete_permission(request, obj=None)ﾂｶ\nShould return True if deleting obj is permitted, False otherwise. If obj is None, should return True or False to indicate whether deleting objects of this type is permitted in general (e.g., False will be interpreted as meaning that the current user is not permitted to delete any object of this type).\n\nSomething like this. Cannot add or delete via admin but edit is possible if superuser. Change to suit obviously. You can also define things like readonly fields etc to suit. Just a thought if you wanted to be able to change the provenance name or description via the admin.\n\n``` python\nclass ProvenanceAdmin(admin.ModelAdmin):\n    def has_add_permission(self, request):\n        return False\n\n    def has_change_permission(self, request, obj=None):\n        if request.user.is_superuser:\n            return True\n        return False\n\n    def has_delete_permission(self, request, obj=None):\n        return False\n```\n",
              "author": "will.buick",
              "created": "2015-09-27T20:06:40Z"
            },
            {
              "body": "Thanks William,\nThat looks like a good idea for the Provenance admin.\n\nAs for the regex being wrong.\nYou will notice that I used match rather than search as I did for the other checks.\nThis does not make the regex explicit but it has the same effect.\n( I have tested it)\n",
              "author": "zane.gilmore",
              "created": "2015-09-27T20:31:42Z"
            },
            {
              "body": "OK. I have now made your suggested changes to the admin.\nAs well as one of my own.\nI think that this is done now.\n",
              "author": "zane.gilmore",
              "created": "2015-09-27T22:09:15Z"
            }
          ]
        },
        {
          "summary": "Better handling of bad provenance definitions",
          "key": "KEA-200",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The fact that I had to hack with SQL to fix a mistake in my provenance definitions is not very acceptable.\nThe runserver did not even start up until I fixed some missing related names fields in the JSON.\n\nThis cannot continue.\nWe need better exception handling than this.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/200",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "moot now\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:11:44Z"
            }
          ]
        },
        {
          "summary": "provenance data dump giving exception",
          "key": "KEA-201",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have just tried to dump the data for the sauvignonblanc provenance and got this exception:\nThis looks like the provenance app_label schema change hasn't been fixed for this functionality.\n\n```\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/bin/django\", line 72, in <module>\n    sys.exit(djangorecipe.binscripts.manage('kea.settings.staging'))\n  File \"/home/keaapp/.virtualenvs/kea/eggs/djangorecipe-2.1.1-py2.7.egg/djangorecipe/binscripts.py\", line 9, in manage\n    management.execute_from_command_line(sys.argv)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 338, in execute_from_command_line\n    utility.execute()\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 330, in execute\n    self.fetch_command(subcommand).run_from_argv(self.argv)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 390, in run_from_argv\n    self.execute(*args, **cmd_options)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 441, in execute\n    output = self.handle(*args, **options)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/management/commands/data_dump_provenance.py\", line 63, in handle\n    app_label__iexact=provenance.Name)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/manager.py\", line 127, in manager_method\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/query.py\", line 679, in filter\n    return self._filter_or_exclude(False, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/query.py\", line 697, in _filter_or_exclude\n    clone.query.add_q(Q(*args, **kwargs))\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/sql/query.py\", line 1304, in add_q\n    clause, require_inner = self._add_q(where_part, self.used_aliases)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/sql/query.py\", line 1332, in _add_q\n    allow_joins=allow_joins, split_subq=split_subq,\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/sql/query.py\", line 1144, in build_filter\n    lookups, parts, reffed_aggregate = self.solve_lookup_type(arg)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/sql/query.py\", line 1030, in solve_lookup_type\n    _, field, _, lookup_parts = self.names_to_path(lookup_splitted, self.get_meta())\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/sql/query.py\", line 1391, in names_to_path\n    \"Choices are: %s\" % (name, \", \".join(available)))\ndjango.core.exceptions.FieldError: Cannot resolve keyword 'app_label' into field. Choices are: db_table, description, dynamic_model_fields, id, name, provenance, provenance_id, provenance_specimen, sample\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/201",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Simple instructions on how to create and edit provenances",
          "key": "KEA-202",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Our present set up for creating and editing provenances is starting to look pretty complicated.\n\nWhat we need is a set of instructions to cover is to cover in a simple way:\n- How to create a new provenance\n- How to edit a provenance and cope with mistakes while editing.\n- How to transfer a completed new provenance from one server to another.\n- How to update a provenance schema using the migration mechanisms.\n\nI think that a good place to put them is in the Sphinx doc server thingy.\nTry to put them into a sensible place with an easy way to find them amongst whatever else is in there.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/202",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Could you also ensure that you are aware of all of the tools that Darryl built for this sort of thing. e.g. provenance data dump. (which is currently broken #201 )\n",
              "author": "zane.gilmore",
              "created": "2015-09-14T00:41:26Z"
            }
          ]
        },
        {
          "summary": "Uploading data to prov produced 500 error",
          "key": "KEA-203",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have just tried to upload some data to a new provenance on the test instance unsuccessfully.\nI will forward the original error email and spreadsheet.\nI can also make a DB dump available.\n\nThis is the stack trace:\n\n```\nFrom: errors@keatest.pfr.co.nz [mailto:errors@keatest.pfr.co.nz] \nSent: Wednesday, 16 September 2015 5:18 p.m.\nTo: Zane Gilmore\nSubject: [Django] ERROR (EXTERNAL IP): Internal Server Error: /provenance/import/cereal_breeding/cross/1/\n\nInternal Server Error: /provenance/import/cereal_breeding/cross/1/\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/handlers/base.py\", line 132, in get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 145, in inner\n    return func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/views/generic/base.py\", line 71, in view\n    return self.dispatch(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/provimport.py\", line 82, in dispatch\n    return super(ProvenanceAdminImportView, self).dispatch(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\", line 237, in dispatch\n    response = super(WizardView, self).dispatch(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 34, in _wrapper\n    return bound_func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/decorators.py\", line 19, in _wrapped\n    return view_func(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 30, in bound_func\n    return func.__get__(self, type(self))(*args2, **kwargs2)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/mixins.py\", line 20, in dispatch\n    request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/views/generic/base.py\", line 89, in dispatch\n    return handler(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\", line 686, in post\n    return super(NamedUrlWizardView, self).post(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\", line 290, in post\n    if form.is_valid():\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\", line 184, in is_valid\n    return self.is_bound and not self.errors\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\", line 176, in errors\n    self.full_clean()\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\", line 392, in full_clean\n    self._clean_fields()\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\", line 410, in _clean_fields\n    value = getattr(self, 'clean_%s' % name)()\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/forms/provimport.py\", line 26, in clean_spreadsheet\n    return validate_spreadsheet(self, self.cleaned_data['spreadsheet'])\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/forms/validators.py\", line 43, in validate_spreadsheet\n    form.definition, default_excel_storage.path(filename))\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/excel/utils.py\", line 88, in import_provenance_definition\n    dataset, dry_run=dryrun, raise_errors=raise_errors)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 145, in inner\n    return func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/transaction.py\", line 216, in __exit__\n    connection.savepoint_commit(sid)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/base/base.py\", line 264, in savepoint_commit\n    self._savepoint_commit(sid)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/base/base.py\", line 218, in _savepoint_commit\n    cursor.execute(self.ops.savepoint_commit_sql(sid))\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/utils.py\", line 64, in execute\n    return self.cursor.execute(sql, params)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/utils.py\", line 97, in __exit__\n    six.reraise(dj_exc_type, dj_exc_value, traceback)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/utils.py\", line 62, in execute\n    return self.cursor.execute(sql)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/core/db/backends/postgresql_psycopg2/base.py\", line 32, in execute\n    return self.cursor.execute(operation, params)\nInternalError: current transaction is aborted, commands ignored until end of transaction block\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/203",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nI cannot find the copy of the error email or spreadsheet. The only spreadsheet I have found was for #204. I did try uploading that spreadsheet and it did work correctly for me. Perhaps fixing #204 also fixed #203. Can you check please and get back to me?\n\nThanks,\n\nWilliam.\n",
              "author": "will.buick",
              "created": "2015-10-19T23:13:08Z"
            },
            {
              "body": "I think this has been dealt with\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:34:08Z"
            }
          ]
        },
        {
          "summary": "Data not being read on prov data upload",
          "key": "KEA-204",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I am finding that when I try to upload some data into the cross table some of the data just seems to be invisible to whatever is reading the spreadsheet.\n\nSome of the data is being read OK but some is just being ignored.\nThe columns are for the mother and pollen cross columns which are the recursive ones.\n\nI have checked to see that the cross references are good and they should be.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/204",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I cannot fo rthe life of me figure out why this should be happening. So I will be needing some help from you\n",
              "author": "zane.gilmore",
              "created": "2015-09-17T22:35:07Z"
            }
          ]
        },
        {
          "summary": "Get the doctests running",
          "key": "KEA-205",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After the prov' def' changes in the DB schema that broke a lot of the doctests that Darryl wrote.\nWe need to get them going again.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/205",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "The doctests are actually running now. See my commit here\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/befd71ea8d7e37e883bd310024f9f77c554e63ef\n\nAlmost all of the tests are failing. Essentially testing provenances is problematic. Darryl was testing using the sauvblanc provenance. Any future changes you make to the sauvblanc provenance could essentially break the doctests because of the migrations stored on the filesystem and model definitions stored in the db. As it is anyway some of the doctests don't work because the tests are creating provenance models that do not have migrations on the filesystem.\n\nRun the tests and see for yourself.\n\nmake doc-test\n",
              "author": "will.buick",
              "created": "2015-10-04T21:36:27Z"
            },
            {
              "body": "OK.\nWhat I suggest is that we do not use the SauvBlanc provenance but use the Funny Provenance instead.\nSo we may need to create a funny provenance that has the required complexity to properly exercise the code but we will need to do this.\nTesting against a proper provenance was probably a bad idea anyway but we could also just try to get the original sauvblanc prov and shoe-horn it into funny.\n",
              "author": "zane.gilmore",
              "created": "2015-10-04T22:44:45Z"
            },
            {
              "body": "Changing it to use a different provenance will be a lot of work. You would essentially be rewriting most of the tests from scratch. One solution with less effort would be to copy the sauvblanc provenance, give it a different prov name and app_label and use that instead. So you would end up with a sauvblanc prov for testing but the app_label/name would be something like sauvblanc_test\n",
              "author": "will.buick",
              "created": "2015-10-04T22:49:32Z"
            },
            {
              "body": "That was pretty much what I was suggesting.\nHowever, for political reasons, I would prefer it if you not use any variant of sauvblanc or sauvignonblanc in the name of the provenance.\n\nYou will also have to deal with the new version of the provenance infrastructure table schemas.\ni.e. specimen and the app_label foreign key in provenancedefinition.\n",
              "author": "zane.gilmore",
              "created": "2015-10-04T22:57:02Z"
            },
            {
              "body": "I spent most of yesterday playing around with this. There are a few really weird things going on.\n1. Bug in postgres primary key sequences. Creating test objects fails because it's trying to create two objects in the same table with pkey of 1. No idea why. When I stuck a set_trace in it worked perfectly.\n2. Tried to get around this by running each doctest in a transaction and rolling back to previous db state. This is the same way that the TestCase class in django works. this seemed to fix the postgres sequence bug. However now the doctests get about 2/3 through and hang. The test suite does not finish.\n\nI have no idea what is going on here. Would like to have a chat to you about it today some time and perhaps get you to run the doctests to see if they hang for you.\n\nNot sure how much time I have to spend on fixing these tests but at the moment it looks like 1 step forward and 3 back.\n",
              "author": "will.buick",
              "created": "2015-10-06T21:20:54Z"
            },
            {
              "body": "Actually never mind the problem with the tests hanging. I've fixed that. However getting these tests running is taking quite a bit of time.\n",
              "author": "will.buick",
              "created": "2015-10-07T01:03:24Z"
            },
            {
              "body": "Hi Zane,\n\nI've now spent another day on this. I can happily say I am now making good progress in getting the tests working. All of the strange issues relating to provenances  and dynamic models seem to have been resolved based on the changes I have made. Now I'm going through the doctests using --failfast and fixing each error I come across. At the current rate I expect to have the suite passing in another day or two. Would you like me to continue working on this?\n\nThanks,\n\nWilliam.\n",
              "author": "will.buick",
              "created": "2015-10-15T02:30:12Z"
            },
            {
              "body": "William,\nIf you need to spend more than one more day please give me a yell before\nproceeding.\n\nI think that we need to keep an eye on the amount we spend on this.\nEspecially seeing as though we need to address a whole bunch more issues.\n\nThanks,\nZane\n\nOn 15 October 2015 at 15:30, wilbuick notifications@github.com wrote:\n\n> Hi Zane,\n> \n> I've now spent another day on this. I can happily say I am now making good\n> progress in getting the tests working. All of the strange issues relating\n> to provenances and dynamic models seem to have been resolved based on the\n> changes I have made. Now I'm going through the doctests using --failfast\n> and fixing each error I come across. At the current rate I expect to have\n> the suite passing in another day or two. Would you like me to continue\n> working on this?\n> \n> Thanks,\n> \n> William.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/205#issuecomment-148259146\n> .\n",
              "author": "zane.gilmore",
              "created": "2015-10-15T03:25:09Z"
            },
            {
              "body": "The tests are still not all passing. I've hit another snag relating to test cleanup that I have been unable to resolve as yet. The problem is related to provenances being used in a test environment where I have been unable to find a way to cleanup after the test case and then it fails. Such problems do not exist if you were to run the tests one at a time rather than in a suite.\n\nI want to commit/push what I have so far and move onto other things for a while. We can come back to this later. Are you happy with that approach?\n",
              "author": "will.buick",
              "created": "2015-10-18T19:21:19Z"
            },
            {
              "body": "Yes,\n thanks William.\nI think that we need to get on to those other issues ASAP.\n\nOn 19 October 2015 at 08:21, wilbuick notifications@github.com wrote:\n\n> The tests are still not all passing. I've hit another snag relating to\n> test cleanup that I have been unable to resolve as yet. The problem is\n> related to provenances being used in a test environment where I have been\n> unable to find a way to cleanup after the test case and then it fails. Such\n> problems do not exist if you were to run the tests one at a time rather\n> than in a suite.\n> \n> I want to commit/push what I have so far and move onto other things for a\n> while. We can come back to this later. Are you happy with that approach?\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/205#issuecomment-149040269\n> .\n",
              "author": "zane.gilmore",
              "created": "2015-10-18T20:04:04Z"
            },
            {
              "body": "This is going now I think\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:14:52Z"
            },
            {
              "body": "No, it's not. The tests are only partially passing and the changes that I'm making to the provenance again currently will break everything again.\n",
              "author": "will.buick",
              "created": "2015-12-22T02:16:31Z"
            }
          ]
        },
        {
          "summary": "Set up Travis CI for Kea",
          "key": "KEA-206",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Travis has recently been made available for us at PFR and it has been suggested that we can use it for Kea.\n\nSo can we please put together a plan and and estimate for what we want to do and how to do it.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/206",
          "labels": [
            "question"
          ],
          "comments": [
            {
              "body": "Only problem I see here is that the integration tests run off a copy of the development database. So we would need to figure out a way around that.\n",
              "author": "will.buick",
              "created": "2015-09-23T07:28:46Z"
            },
            {
              "body": "@wilbuick and @zanejg I have code that enable access to development database.\n\n@zanejg you will be able to see [deploy-tools](https://github.com/PlantandFoodResearch/deploy-tools).\n",
              "author": "roy.storey",
              "created": "2015-09-30T23:31:00Z"
            },
            {
              "body": "The alternative is to have a test data set that gets initialised on Travis servers, but this ends up being too simple for true testing? This is currently the approach in [kakapo](https://github.com/PlantandFoodResearch/kakapo)\n",
              "author": "roy.storey",
              "created": "2015-09-30T23:59:02Z"
            },
            {
              "body": "We could run the unit tests using a dataset that gets initialised on the travis servers. The integration tests are more problematic though because they depend on things like elasticsearch and essentially a copy of the development or production database.\n\nThe way the integration tests work at the moment is as follows.\n- In development environment start to run the integration tests:\n\nmake integration-test\n- This creates a new test database using the dev db as the template. Something like this:\n\nCREATE DATABASE test_keadbdev TEMPLATE keadbdev;\n- There is an optional step to populate the elasticsearch indexes too. From memory the ES indexes get prefixed with test_ during the test suite run. They are not deleted when the test suite completes because they do take a long time to populate with data.\n- All integration tests are run against the test_keadbdev database.\n- test suite complete, integration test db is dropped.\n\nWith a copy of the dev/prod db and elasticsearch indexes the size required on disk ends up being  somewhat large. Hopefully that won't be a problem. I know when I've used travis-ci in the past there was a 3 GB disk limit which I think would be a problem here.\n",
              "author": "will.buick",
              "created": "2015-10-04T20:17:16Z"
            },
            {
              "body": "We need to see how much space we have to work with on the Travis server.\nWe're not sure how much space we'll need right now but it is likely to be non-trivial.\n",
              "author": "zane.gilmore",
              "created": "2015-10-05T00:24:18Z"
            }
          ]
        },
        {
          "summary": "E-brida information on harvest sheets",
          "key": "KEA-207",
          "status": "To Do",
          "description": "Sample harvests will be made a lot simpler if the Kea generated harvest sheets have the information that is on the actual trees/trays being harvested on them, instead of the kea codes, which are generally meaningless to the person harvesting.\n\nSo ideally platesheets for harvests created with the Initialise from E-brida function should have the tray name as well as the Kea ID, and then in each well should have the barcode or tree location. Is this doable? It would eliminate the need for a lot of cross-checking and the possiblity of human error. Chur'.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/207",
          "labels": [
            "EBrida_interface",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Initialise E-brida columns and formats",
          "key": "KEA-208",
          "status": "Done",
          "description": "It seems that there can be a bit of variation in the spreadsheets output by E-brida for Kea upload. I'm not sure whose problem this is to fix, but I thought Kea should be aware - here are some examples I've come across:\n\nThe column 'synonyms' is sometimes called 'Synonym' or, once, 'BreederCrCode'.\nThe column 'BreederName' is sometimes called 'breederName'.\nThe column 'From Ped. Item' is sometimes called 'From Ped. Item (origin)'.\nThe format of the 'Start Date' column is now 'DD/MM/YYYY' (it used to be 'YYYY-MM DD').\n\nThe sheet to be read by Kea should be called 'Sheet1', but I've come across some with other names.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/208",
          "labels": [
            "EBrida_interface"
          ],
          "comments": [
            {
              "body": "Oh, I've just noticed there's already some discussion about this. Sorry.\n",
              "created": "2015-09-30T05:14:00Z"
            }
          ]
        },
        {
          "summary": "Bug in E-brida initialisation?",
          "key": "KEA-209",
          "status": "Done",
          "description": "Normally when we initialise samples from E-brida using the platetrays option, there are 94 samples from one population, or 46 samples from each of two populations, or 30 samples from each of three populations, so that adding two empty wells per population means there are 96 wells per plate tray.\n\nWe just tried to initialise some platetrays that had fewer than this number of samples, eg. 70 samples all from one population.\n\nIn theory Kea should know to start a new plate after this many samples by reading the 'Group' column in the E-brida spreadsheet, but it looks like it's ignoring this and continuing to fill the plate with the next samples.\n\nI've just tried to attach the spreadsheets, but github is saying something went really wrong, and they can't process this file.\n\nIn related news, SaB10S9 should probably be deleted.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/209",
          "labels": [
            "EBrida_interface"
          ],
          "comments": [
            {
              "body": "GitHub will be happy if you convert excel to markdown ...you can use http://www.tablesgenerator.com/markdown_tables for this.. eg\n\n---\n\nMy Demo Data  pasted from [iPLant](https://iplant.plantandfood.co.nz/project/I150114/Research/Block33%20Pedigree%20Items.xlsx?Web=1)\n\n| Sample Local Id | Sample Batch Local Id | Plant Local Id | Population Local Id | Sample Altnames | Plant Altnames | Population Altnames |\n| --- | --- | --- | --- | --- | --- | --- |\n| BBD4135 | SaB10VM | Kiw1P6SG.01 | POP0ZMM |  | TP08B33 | 0030 |\n| BBD4140 | SaB10VM | Kiw1P6SR.01 | POP0ZMT |  | TP08B33 | 0035 |\n| BBD4142 | SaB10VM | Kiw1P6SW.01 | POP0ZMX |  | TP08B33 | 0037 |\n| BBD4147 | SaB10VM | Kiw1P6T4.01 | POP0ZN2 |  | TP08B33 | 0042 |\n| BBD4154 | SaB10VM | Kiw1P6TG.01 | POP0ZNA |  | TP08B33 | 0049 |\n| BBD4159 | SaB10VM | Kiw1P6TN.01 | POP0ZNC |  | TP08B33 | 0054 |\n| BBD4162 | SaB10VM | Kiw1P6TV.01 | POP0ZNF |  | TP08B33 | 0057 |\n| BBD4167 | SaB10VM | Kiw1P6V5.01 | POP0ZNP |  | TP08B33 | 0062 |\n| BBD4174 | SaB10VM | Kiw1P6VF.01 | POP0ZMJ |  | TP08B33 | 0069 |\n| BBD4179 | SaB10VM | Kiw1P6VL.01 | POP0ZMP |  | TP08B33 | 0074 |\n| BBD4181 | SaB10VM | Kiw1P6VN.01 | POP0ZMP |  | TP08B33 | 0076 |\n| BBD4186 | SaB10VM | Kiw1P6VV.01 | POP0ZMT |  | TP08B33 | 0081 |\n| BBD4193 | SaB10VM | Kiw1P6W2.01 | POP0ZMZ |  | TP08B33 | 0088 |\n| BBD4198 | SaB10VM | Kiw1P6W9.01 | POP0ZP0 |  | TP08B33 | 0093 |\n",
              "created": "2016-01-19T04:33:22Z"
            },
            {
              "body": "hoping I fixed this",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:30:51Z"
            }
          ]
        },
        {
          "summary": "Specimen admin form provenance dfn field needs sorting",
          "key": "KEA-210",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The drop down in the speciment admin form for ProvenanceDefintionField needs some serious work.\nIt is all but unusable as it is.\n\nThis dropdown lists all of the definition fields for all dynamic tables. \nTrying to find the correct field is bloody awful.\n\nThe easiest way of dealing with it would be to sort by table but the most elegant way would be to filter the contents of the drop-down by the ProvenanceDefinition selection just above it. Perhaps even disabling the field selection until a selection has been made there.\n\nSo if you can do the latter reasonably easily please do but failing that just a decent ordering would, at least, make it usable.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/210",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Hi Zane,\n\nCan you get in touch with me sometime today to discuss this?\n",
              "author": "will.buick",
              "created": "2015-10-04T19:44:07Z"
            }
          ]
        },
        {
          "summary": "Provenance Browse table interface not showing insert data links",
          "key": "KEA-211",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The Browse data interfaces for displaying and entering data has a row of links on the top right hand side of the screen:\nAdd new XXXX\nExcel Import\nFull Screen\nCopy URL\nExport to Excel\nReset Search\n\nAt present there seems to be a problem with one of the users where the first two of the above list is non-existent.\nWe really need this fixed ASAP.\nIs it a problem with non-sysadmin users?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/211",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "This is a permissions problem. Code uses django permissions check to determine if the buttons should be shown or not. You can adjust this yourself in the django admin area by adjusting a users permissions. Superusers by definition have access to all models and do not need permissions to be set\n",
              "author": "will.buick",
              "created": "2015-10-04T22:44:23Z"
            },
            {
              "body": "Cheers William.\nHave done that, now I need to test the damn thing.\nGetting LDAP user accounts are a pain in the proverbial.\n",
              "author": "zane.gilmore",
              "created": "2015-10-04T23:12:29Z"
            },
            {
              "body": "May I suggest this\n\nhttps://pypi.python.org/pypi/django-impersonate\n",
              "author": "will.buick",
              "created": "2015-10-04T23:17:23Z"
            },
            {
              "body": "This is dealt with now\n",
              "author": "zane.gilmore",
              "created": "2015-10-08T00:19:46Z"
            }
          ]
        },
        {
          "summary": "Foreign keys to localids are not displaying properly in batches",
          "key": "KEA-212",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "On page 3 of the sample initialisation and also in the spreadsheets when there is a foreign key that points at a localid . That localid is not being properly displayed but being printed as its basic number.\n\nIt needs to be converted to its proper ID.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/212",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Do you have a database dump containing actual data in the sauvblanc provenance? That would be useful for fixing this. Would also like to discuss to ensure I understand correctly.\n",
              "author": "will.buick",
              "created": "2015-10-20T00:52:08Z"
            },
            {
              "body": "William,\nI hope these get to you.\n\nYou may have to tweak these files to import them.\nBut it will be a good exercise for you to see how it should work. :-)\n\nPlease treat them like they are confidential because the the contacts one\nis.\nGive me a call if you need help.\n\nOn 20 October 2015 at 13:52, wilbuick notifications@github.com wrote:\n\n> Do you have a database dump containing actual data in the sauvblanc\n> provenance? That would be useful for fixing this. Would also like to\n> discuss to ensure I understand correctly.\n> \n> 窶能n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/212#issuecomment-149387986\n> .\n",
              "author": "zane.gilmore",
              "created": "2015-10-20T01:44:07Z"
            },
            {
              "body": "You can use berry_collection for this.\n",
              "author": "will.buick",
              "created": "2015-10-20T02:19:10Z"
            }
          ]
        },
        {
          "summary": "Ordering of specimen rows in data tab of batch file",
          "key": "KEA-213",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Please ensure that the order of the specimen entities listed in the data tab of the batch file is via the main key of the table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/213",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "We need to discuss this one to clarify.\n",
              "author": "will.buick",
              "created": "2015-10-20T01:12:13Z"
            },
            {
              "body": "This requires that an order be set in the provenance definition being used for the specimen.\n",
              "author": "will.buick",
              "created": "2015-10-21T02:36:55Z"
            }
          ]
        },
        {
          "summary": "Batch upload file needs to be able to internally link to entities that don't yet have their LocalID",
          "key": "KEA-214",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When a batch upload file is referencing a row in another tab that is for an entity that is referenced via a localid, then that the file can't reference it because the the foreign table entity does not yet have the LocalID assigned yet.\n\nI am thinking that perhaps some sort of standard external reference syntax may be required.\ne.g.some thing like  @TabName:rownum\nWhich would look like @Cross:23\n\nDon't care particularly about the exact syntax but we need something that works.\nI believe that I did discuss this with Darryl at some point but I don't think that he implemented anything.\n\nI imagine that this is not a trivial exercise but it will be required to get the last of the functionality going.\n\nCould you please give me an estimate before you start if it looks too big.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/214",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Ordering of dynamic table columns is not working",
          "key": "KEA-215",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Whenever I try to reorder columns in the provenencedefinition form using the drag and drop interface I get a \"Please correct the errors below\" error message with no errors highlighted.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/215",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I have investigated this and discovered that the django-admin-sortable2 library does not seem to work with django 1.8. It may just be the way that we are using the library but so far I have not been able to prove that theory.\n\nI should be able to fix this but would need to fork the package to do so. Are you happy to fork the library on github? Not sure what the PFR policy is on forking and fork using my account or it can be done using the PFR account.\n\nThe other option if you don't want to fork another package is to remove the fancy drag-drop thing and just show the integer field that sets the order instead. Then you just type in a integer and you're done.\n\nWill wait until I hear from you.\n",
              "author": "will.buick",
              "created": "2015-10-19T18:58:02Z"
            },
            {
              "body": "Go for the latter option.\nI am happy to type the numbers in.\nBut please remember to put in some checking to ensure that I have not made any mistakes like putting in the same number for two entries.\nThanks\n",
              "author": "zane.gilmore",
              "created": "2015-10-20T01:19:46Z"
            }
          ]
        },
        {
          "summary": "Provenance doesn't see schema changes after django migrate",
          "key": "KEA-216",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have made changes to the cereal breeding provenance.\nThe provenance on test has some data that will be relatively difficult to rebuild so I thought that I would use the migrate mechanism to update the schema instead of the usual drop and load.\n\nThe changes have been made to the Postgres tables but those changes are not appearing in the browse pages or spreadsheets.\n\nHow do we make those changes appear where they need to?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/216",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Sounds like you forgot to make the changes to the provenance definitions on test. Can you confirm that?\n",
              "author": "will.buick",
              "created": "2015-10-08T21:45:43Z"
            },
            {
              "body": "Sorry, perhaps I didn't explain myself sufficiently.\n\nI created the prov on my dev box and rolled it out to the test box hence giving the users access to playing around with it.\nI have put data into the test instance and so have the users.\n\nI then made the changes on my dev box and tried to do the:\n- makemigrations on dev\n- push from dev\n- pull to test\n- migrate on test\n- restart test\n\nAnd the new stuff is not showing up on the test instance.\nFYI the changes were the addition of a column and removing some unique constraints.\n",
              "author": "zane.gilmore",
              "created": "2015-10-08T23:40:24Z"
            },
            {
              "body": "Ahh,\nDid you mean that I also need to do a dump from dev and load on test?\nThis is not apparent from your instructions.\n",
              "author": "zane.gilmore",
              "created": "2015-10-08T23:42:16Z"
            },
            {
              "body": "I have created a wiki page on this GitHub repo:\nhttps://github.com/PlantandFoodResearch/Kea/wiki/DB-Provenance-release-work-flow\n\nCould you please review this page and make any changes to the step by step instructions.\n",
              "author": "zane.gilmore",
              "created": "2015-10-08T23:47:12Z"
            },
            {
              "body": "I have updated your wiki page. Please pay close attention to my warning. It is important. If you want some way to apply modifications to the provenance definitions that is not manual then you need version control of the provenance definition table in the database to be able to track changes. But even then things could go horribly wrong.\n\nThe only safe way to deploy changes to the provenance definitions is by either trashing the entire provenance and data or make changes to the provenance definitions manually.\n\nHappy to explain further over hangout if needed.\n",
              "author": "will.buick",
              "created": "2015-10-09T00:25:13Z"
            },
            {
              "body": "I think we have done this to death\n",
              "author": "zane.gilmore",
              "created": "2015-10-22T20:31:50Z"
            }
          ]
        },
        {
          "summary": "Cross browse page is showing species common name when the to field is scientific name",
          "key": "KEA-217",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have added a species foreign key field to a table in the cereal breeding prov.\n\nThe to-field that I set was the scientific name, but the title of the column in the browse window and the spreadsheet is \"commonName\".\n\nIt should be noted that both of these fields are set as unique in the species table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/217",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I think I will be needing a new copy of the DB before I can start on this. My cereal breeding provenance does not seem to match the description in this ticket. Either that or I do not fully understand the issue. Could you send me the latest copy of your development db please? Otherwise talk to me on hangout to clarify.\n",
              "author": "will.buick",
              "created": "2015-10-19T19:05:11Z"
            }
          ]
        },
        {
          "summary": "Need updating mechanism that works for provenances",
          "key": "KEA-218",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When changes are made to a provenance schema the workflow that has to happen is to apply the django migrations then apply the changes by hand to the provenance of the server instance.\n\nThis is unacceptable and was addressed by the dump and load mechanisms before we moved django 1.8.\nHaving to apply changes by hand between instances will only cause trouble.\nWe will need to write something that can see the differences between two provenance dumps and make the necessary changes on the DB and set the prov' defns appropriately.\n\nThis will get us back to where we were before the upgrade to 1.8.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/218",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "#242 will hopefully fix this\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:18:37Z"
            }
          ]
        },
        {
          "summary": "Missing message on upload confirmation screen for provenance Excel import",
          "key": "KEA-219",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When data is imported via the excel import for a provenance table and there is a foreign key.\nIf the entry is not found in the referred table then there is a \"missing!\" displayed.\n\nIt would be better if that \"missing!\" in in red so that it stands out.\nAt present it is difficult to see the missing ones.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/219",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Contact list not sorted for add new company",
          "key": "KEA-220",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The add new company form has a list of contacts for the contact list.\n\nIt is not sorted correctly. It needs to be sorted alphabetically.\nA better list box would be better too but not sure whether it's worth it the trouble.\n\nSo... we need to make sure that many to manys list-boxes are sorted.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/220",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "I assume you're talking about the Company model in the sauvignonblanc provenance. In which case this is a dynamic model and you cannot apply generic sorting to all dynamic models because the fields will differ.\n\nThe way that django does this is by defining the Meta class as shown below\n\n``` python\n\nclass Company(models.Model):\n\n    \"\"\"How to provide default sorting on a django model.\"\"\"\n\n    name = models.CharField()\n    name2 = models.CharField()\n    name3 = models.CharField()\n\n    class Meta:\n        ordering = ('name', '-name2',)\n\n```\n\nTo provide the functionality that you want you would need a new field in the ProvenanceDefinition table that would contain a comma separated list of model fields for ordering. We could then take that value and place it into the model meta when the model class is created.\n\nAre you happy with this solution?\n",
              "author": "will.buick",
              "created": "2015-10-19T03:18:51Z"
            },
            {
              "body": "That could work but avoiding changes to the basic DB schema is important right now.\nWhat about another field for the json for each field?\nBecause that would be better.\nPerhaps something along the lines of \"ordering\":n\nWhere n is an integer.\nWhere you look at each field for that field and order them relative to each other according to the relative number magnitude (negative for reverse order).\nThe lowest number being the first one to order by.\n\nWhat do you think?\n",
              "author": "zane.gilmore",
              "created": "2015-10-20T01:16:13Z"
            },
            {
              "body": "I'm not sure exactly sure how that would work? Would need to discuss that with you\n",
              "author": "will.buick",
              "created": "2015-10-20T01:23:06Z"
            },
            {
              "body": "Actually I do know what you mean after I read that twice. I like my approach better to be honest. My solution does require migrations but doesn't change the model schema at all. You're better off doing things the django way, you will end up with less problems in the long run.\n",
              "author": "will.buick",
              "created": "2015-10-20T01:26:15Z"
            }
          ]
        },
        {
          "summary": "Add new entity windows not closing after submit",
          "key": "KEA-221",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The pop-up form windows that are for adding new foreign key entities in the admin forms produced by clicking on the green cross are not closing after the submit.\n\nThis has caused some confusion with the users.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/221",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Exception raised on browsing table with many to many field",
          "key": "KEA-222",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the \"Grape and Wine\" provenance (nee Sauvignon Blanc) there are 2 tables that have many to many fields.\n\nWhen either of them are visited via the Browse data pages the an exception is thrown:\n\nException Type:     AttributeError\nException Value:    \n\n'ManyToManyRel' object has no attribute 'field_name'\n\nException Location:     /home/zane/programming/virtenv/kea18/Kea/src/kea/kea/provenance/views/datagrid.py in column_order, line 85\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/222",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Can't add tables",
          "key": "KEA-223",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Whenever I try to add any kind of table in the prov editor I get:\n\"Order by field does not exist in the model\"\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/223",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "View data page is getting exception",
          "key": "KEA-224",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "DoesNotExist at /provenance/admin/\n\nContentType matching query does not exist.\n\nException Type:     DoesNotExist\nException Value:    \n\nContentType matching query does not exist.\n\nException Location:     /home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/query.py in get, line 334\n\nBut I'm going home.\nTalk on Wednesday.\nI'm in Wellington on Tuesday.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/224",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "ContentTypes are built into django. They should be created automatically when you define a new model I thought. Did you make and run the migrations?\n",
              "author": "will.buick",
              "created": "2015-10-23T03:33:09Z"
            },
            {
              "body": "Is this issue still relevant?\n",
              "author": "will.buick",
              "created": "2015-11-03T23:56:13Z"
            },
            {
              "body": "No, I think that this was dealt with.\n",
              "author": "zane.gilmore",
              "created": "2015-11-04T01:07:18Z"
            }
          ]
        },
        {
          "summary": "Samples and sample extracts view data pages empty",
          "key": "KEA-225",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The \"View Data\" pages for Samples and Sample Extracts are not showing any data.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/225",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "a temporary problem fixed long ago\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:19:29Z"
            }
          ]
        },
        {
          "summary": "Order column numbers are being changed every time the table is viewed in editor",
          "key": "KEA-226",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Not sure exactly how this is happening but every time that I go to a table in the provenance definition editor the numbers in the order column all seem to have 1000 added to them.\n\nWhat really bothered me was that one table seemed to only add a thousand to 2 of the columns in the table.\n\nAlso, and very disturbingly, whenever I did a refresh on the editor the numbers in the order column incremented by 1000.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/226",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "It's a dirty hack by me to get around problems with form validation.\n\nBasically it works like this\n\nCurrent order of prov def fields\n\n1,2,3,4\n\nyou set the new order of the prov def fields to to change field order.\n\n2,3,4,1\n\nDjango complains because 1,2,3,4 are already being used. This means form validation fails and you cannot save the form ever. If you want to save the form you need to do it in two steps\n1. change order from 1,2,3,4 to 20,40,30,10 for example\n2. Change from 20,40,30,10 back into 2,4,3,1\n\nThat is essentially what the hack of adding 1000 does. Because remember there is a unique constraint on the order column.\n\nWhere my little hack falls over is when you save the form and the form validation fails. When this happens the fields in the order column get incremented by 1000. This is because I need to increment the fields in the order table by 1000 before validating the form and when form validation fails the order is already saved. We could potentially subtract 1000 from the order and resave when the form fails it's validation. That might fix the problem.\n",
              "author": "will.buick",
              "created": "2015-11-02T03:46:50Z"
            }
          ]
        },
        {
          "summary": "provenance dump is missing tables",
          "key": "KEA-227",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After trying to load a json dump we discovered that there were some missing tables.\n\nThis was tracked down to the dump code.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/227",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Explore moving the sample view for the datagrid out of Elastic search and back to SQL",
          "key": "KEA-228",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We want to explore the possibility of pulling the use of Elastic Search for populating the datagrid widgets.\n\nI think that there are 2 other ways of populating the datagrid widget one uses the ORM and the other uses raw SQL.\n\nWe will need to explore both possibilities for different datagrids. Presumably dependent on the complexity of the query being presented.\n\nSo, to start with I have suggested replacing the View Sample grid for the alt provenances and checking that out on a branch to assess its speed etc.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/228",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "Let's try a different approach and get you to move the population datagrid away from the Elasticsearch and onto the raw SQL.\nJust to start with.\nMarek has also suggested that we make it a settings file entry to be able to switch where the datagrid gets its data from, but each data source will need to be defined.\n",
              "author": "zane.gilmore",
              "created": "2015-11-18T02:30:21Z"
            },
            {
              "body": "Changing the populations datagrid turned out to be pretty easy in the end. There was already a populations datagrid view that Darryl added in  that ran off raw sql. This was in the file populations/views/resample_search.py. I ended up copying over the code and it seems to work.\n\nThings to be aware of.\n- Powering the datagrid from rawsql is making use of postgres stored functions.\n- Getting a list of csv separated altnames requires using postgres stored function\n- Getting localid requires postgres stored function.\n\nHave a look and then we can discuss.\n",
              "author": "will.buick",
              "created": "2015-11-19T23:09:11Z"
            },
            {
              "body": "done and dusted\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:10:32Z"
            }
          ]
        },
        {
          "summary": "Samples not showing in alternate provenances",
          "key": "KEA-229",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When samples are intiated in the alternate provenances they are not making it through to the view samples page.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/229",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Samples appeared on the samples page almost straight away (within a few seconds) in my development environment. Code seems fine to me. I did make a small change to the way the signals.py file from being loaded, but that shouldn't have made any difference. We can try my changes on the keatest instance and see if it does anything but I don't think it will. In that case the bug would appear to be related to a particular instance(s).\n",
              "author": "will.buick",
              "created": "2015-11-08T21:44:22Z"
            },
            {
              "body": "You seem to be quite correct.\nI have just initialised some samples and they turned up just perfectly on the test instance.\n\nIt does worry me a bit that they definitely did not turn up fine when I was demo-ing it in Blenheim for Marc Greven.\nIt looks like the Elastic Search must have just lost it's marbles.\n\nI suppose that this is more reason to try to remove the whole Elastic Search thing ASAP.\nI will leave this open as a reminder\n",
              "author": "zane.gilmore",
              "created": "2015-11-08T22:17:34Z"
            }
          ]
        },
        {
          "summary": "Better formatting of Spreadsheets for Kiwifruit orchard collections",
          "key": "KEA-230",
          "status": "Done",
          "description": "The formatting and sorting of records in spreadsheets and plate templates is ordered by population, not orchard location. The formatting in blocks with population labels prevents re-sorting by orchard location.\nPlates need to be ordered by orchard location to minimise walking and potential for error\n\n2 options:\n1. query eBrida for location and sort by location **Prefferred option**\n2. place population id in a column so that sheets can be sorted by location\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/230",
          "labels": [
            "Requirement",
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "On an unrelated note, that second option would make it easier to parse the spreadsheet with other tools that need the population data. \n",
              "created": "2015-11-16T00:25:40Z"
            },
            {
              "body": "Init Worksheet for sampling from collection blocks. Population Just needs to be a column so this is a square data sheet that can be easily edited and sorted. Kiwifruit locations are now standardised so plant location should come in from init sheet and can be checked in advance\n\n![screen shot 2016-02-26 at 1 23 44 pm](https://cloud.githubusercontent.com/assets/268441/13339244/247b2536-dc8c-11e5-9348-5dfec275d99d.png)\n",
              "created": "2016-02-26T00:26:08Z"
            },
            {
              "body": "If it was possible to reformat this table as a square block, it would also be possible to automatically generate the eBrida data for Block row bay and parent location and simply paste this into the sheet..impossible while this is blocked by Population. Although an API might remove need to for this we need to have something working quite soon for spring...\n\n| PlantID | Sample ID | Plant Alt Names | Plant Location:Kiwifruit Orchard Vine | Row | Block | Vine ID | Bay Number | Plant Parent Location |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| Kiw1NPTE.01 | BBF2776 | TPCB21 | 0146 |  |  |  |  |  |\n| Kiw1NR28.01 | BBF2779 | TPCB39 | 0272 |  |  |  |  |  |\n| Kiw1KL6W.02 | BBF2782 | TPCB24 | 0351 |  |  |  |  |  |\n| Kiw1NR29.01 | BBF2785 | TPCB24 | 0367 |  |  |  |  |  |\n| Kiw1NPTV.01 | BBF2788 | TPCB24 | 0062 |  |  |  |  |  |\n| Kiw1NPTX.01 | BBF2791 | TPCB24 | 0341 |  |  |  |  |  |\n",
              "created": "2016-06-28T04:45:31Z"
            },
            {
              "body": "What will be needed is a tick box or radio button to choose between the two formats for these spreadsheets.\nSo when the \"Populations as column\" format is chosen the populations are just added as an extra column in the list on data tab. And the separation of populations no longer happens in that data list.\n",
              "author": "zane.gilmore",
              "created": "2016-08-04T02:10:41Z"
            }
          ]
        },
        {
          "summary": "500 error during process execution",
          "key": "KEA-231",
          "status": "Done",
          "description": "I'm trying to run a process on some kiwifruit samples, but after selecting the spreadsheet file to upload and clicking Okay, I'm getting a 500 error. I've retried again, and again on another sample batch, but no luck.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/231",
          "labels": [
            "invalid"
          ],
          "comments": [
            {
              "body": "I've just had a quick look at the exception stacks on that.\nI will try to get that fixed ASAP.\n",
              "author": "zane.gilmore",
              "created": "2015-11-16T02:30:49Z"
            },
            {
              "body": "Sweet-bix. I assume this error occurred before Kea had a chance to see the spreadsheet I was uploading? If it matters, it was a spreadsheet I made from scratch (i.e. I didn't use the one Kea generates as part of the process run with my results copy/pasted in), but it is in the same format as the Kea generated one.\n",
              "created": "2015-11-16T02:36:50Z"
            },
            {
              "body": "You were right! Using the Excel file Kea generated and pasting my data into it works.\n",
              "created": "2015-11-17T01:12:19Z"
            }
          ]
        },
        {
          "summary": "Multi column unique constraints for prov tables",
          "key": "KEA-232",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "It has become apparent that the users need to be able to ensure that entities must be able to have uniqueness tests that are applicable at the time of the Excel upload.\nWe have a table called trial_plot whose primary identifier is a localid so the uploaded spreadsheet can't contain the localid that will uniquely identify the row.\n\nHowever the user has uploaded the same spreadsheet twice and ended up with two sets of identical trial_plots. Although the identifier can still stay as the localid we can, for instance, make a set of columns define the row.\n\nI remember that someone mentioned that Django can do multi-column unique constraints in some version or other. So am hoping that we can apply this somehow.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/232",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Create a docker container for Kea",
          "key": "KEA-233",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to be able to create dev and live instances of Kea on Docker for easy installations.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/233",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "Marek,\nHere it is :-)\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T01:28:48Z"
            },
            {
              "body": "This is moot now.\nSo am closing\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:06:26Z"
            }
          ]
        },
        {
          "summary": "Confirm import page needs error report at top of page",
          "key": "KEA-234",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The confirm import page for the Excel import of data into a provenance needs to have a report of whether there were any errors found and details of what line the errors were on.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/234",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Oops. I meant to say that the report needs to be a line at the top of the page.\nA line that is in green if all is well and if any errors are found then the line needs to be in red stating the nature of the error and at what line.\n",
              "author": "zane.gilmore",
              "created": "2015-11-26T21:24:21Z"
            },
            {
              "body": "Hi Zane,\n\nI have done some research into this and we should probably discuss what I've found.\n\nThe library that darryl is using (django-import-export) does not provide  any sort of validation that I am aware of. Instead it accepts everything and lets django models/database handle the validation which is why you get those lovely exception tracebacks.\n\nFor example, how the code handles integer fields\n1. Try convert the value to an integer\n2. If cannot convert return None\n\nIt is essentially ignoring errors. The only custom validation that we have there that I can see is the \"Missing!\" handler. This doesn't actually validate anything or prevent you from importing the data.\n\nSo, if you want validation without showing those exception tracebacks I think we would be looking at a custom solution built on top of the django-import-export library. That is unfortunately not a 5 minute job.\n",
              "author": "will.buick",
              "created": "2015-11-27T03:39:25Z"
            },
            {
              "body": "OK let's have a good discussion about this.\nIt would be nice to have at least a vague notion of how long it would take (i.e. how much moola) to do all of this.\n",
              "author": "zane.gilmore",
              "created": "2015-11-29T23:16:10Z"
            },
            {
              "body": "this is still extant and needs to be addressed \nI think\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:08:11Z"
            },
            {
              "body": "I'm pretty sure that we have done this to the extent that it is now useful.",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:05:48Z"
            }
          ]
        },
        {
          "summary": "Unique key violation errors need better reporting",
          "key": "KEA-235",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "For the uploading of data via Excel spreadsheets in provenances.\nIf any unique constraint violations are found in the spreadsheet we need to ensure that we detect them BEFORE the actual upload i.e. at the confirmation stage.\nAnd we need to highlight them.\nWe do not want to report them via some ghastly exception call stack after the upload failure.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/235",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Please see https://github.com/PlantandFoodResearch/Kea/issues/234\n\nThese two issues are related.\n",
              "author": "will.buick",
              "created": "2015-11-27T03:45:36Z"
            },
            {
              "body": "Not sure what happened here\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:05:48Z"
            },
            {
              "body": "Attached  to #369\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:33:24Z"
            },
            {
              "body": "Attached #292\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:36:01Z"
            },
            {
              "body": "This is now done.",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:06:46Z"
            }
          ]
        },
        {
          "summary": "Nullable columns appear to be seeing empty cells as values",
          "key": "KEA-236",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We have a nullable and unique column that is refusing to upload a spreadsheet that has multiple rows with empty values.\n\nThis does not appear to be behaving as I expect.\n\nThere are definitely no duplicates amongst those rows with values.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/236",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "The problem column is old_multi_year_blockid\nIn the vineyardblock table.\n[Kea_vineyardblock.xlsx](https://github.com/PlantandFoodResearch/Kea/files/45290/Kea_vineyardblock.xlsx)\n",
              "author": "zane.gilmore",
              "created": "2015-11-26T22:12:37Z"
            }
          ]
        },
        {
          "summary": "import and add icon columns closer to table names",
          "key": "KEA-237",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the data page for a provenance the column of icon pairs for the lists of tables need to be closer the the names. \nApparently it is too difficult to match the icons to the names.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/237",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Do you mean this page?\n\nhttp://localhost:8000/provenance/admin/\n\nAnd are you referring to the blue/green icons?\n",
              "author": "will.buick",
              "created": "2015-12-01T22:15:12Z"
            }
          ]
        },
        {
          "summary": "NoReverseMatch exception on prov' admin page for cereal prov",
          "key": "KEA-238",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I tweaked the order of a table in the cereal provenance and now am getting an exception when I go to the View data page.\nWill send you the dump of the DB I am running.\n\nException is only raised on the cereal breeding prov'.\nSeems to be something funky with the location foreign key in the cereal_plant table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/238",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "A traceback would be useful. Also, if you did this on test or prod did you try restarting uwsgi?\n",
              "author": "will.buick",
              "created": "2015-12-01T02:58:00Z"
            },
            {
              "body": "```\nNoReverseMatch at /provenance/admin/\n\nReverse for 'pndata_location_add' with arguments '()' and keyword arguments '{}' not found. 0 pattern(s) tried: []\n\nRequest Method:     GET\nRequest URL:    http://localhost:8000/provenance/admin/\nDjango Version:     1.8.2\nException Type:     NoReverseMatch\nException Value:    \n\nReverse for 'pndata_location_add' with arguments '()' and keyword arguments '{}' not found. 0 pattern(s) tried: []\n\nException Location:     /home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/urlresolvers.py in _reverse_with_prefix, line 496\nPython Executable:  /home/zane/programming/virtenv/kea18/Kea/bin/python\nPython Version:     2.7.6\nPython Path:    \n\n['/home/zane/programming/virtenv/kea18/Kea/src/kea',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/psycopg2-2.6.1-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/python_ldap-2.4.22-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/python_memcached-1.57-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/python_dateutil-2.4.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_auth_ldap-1.2.7-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_bootstrap3-6.2.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/selenium-2.48.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/factory_boy-2.6.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Pillow-3.0.0-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pyasn1-0.1.9-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/xlrd-0.9.4-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/xlwt-1.0.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/xlutils-1.7.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/requests-2.8.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/mock-1.3.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/celery-3.1.19-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/elasticutils-0.9.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/src/django_import_export',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_extensions-1.5.7-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_haystack-2.4.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/sphinx_rtd_theme-0.1.9-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/jsonfield-1.0.3-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_transaction_hooks-0.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_formtools-1.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/South-1.0.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Werkzeug-0.10.4-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/jedi-0.9.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pep257-0.7.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/coverage-4.0.1-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Fabric-1.10.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/django_debug_toolbar-1.4-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/bpython-0.14.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/flake8-2.5.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/flake8_docstrings-0.2.1.post1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/djangorecipe-2.1.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Django-1.8.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/zc.recipe.egg-2.0.3-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/zc.buildout-2.4.6-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/mccabe-0.3.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pep8-1.5.7-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/setuptools-18.4-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pyflakes-1.0.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/ndg_httpsclient-0.4.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pyOpenSSL-0.15.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/six-1.10.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/greenlet-0.4.9-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/curtsies-0.1.19-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Pygments-2.0.2-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/sqlparse-0.1.18-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/paramiko-1.15.3-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Sphinx-1.3.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/diff_match_patch-20121119-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/tablib-0.10.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/elasticsearch-0.4.5-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/kombu-3.0.29-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/billiard-3.3.0.21-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pytz-2015.7-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/funcsigs-0.4-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pbr-1.8.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/fake_factory-0.5.3-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/cryptography-1.1-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/blessings-1.6-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/ecdsa-0.13-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pycrypto-2.6.1-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/alabaster-0.7.6-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Babel-2.1.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/snowballstemmer-1.2.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/docutils-0.12-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/Jinja2-2.8-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/urllib3-1.12-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/amqp-1.4.7-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/anyjson-0.3.3-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/cffi-1.3.0-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/ipaddress-1.0.14-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/enum34-1.0.4-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/idna-2.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/MarkupSafe-0.23-py2.7-linux-x86_64.egg',\n '/home/zane/programming/virtenv/kea18/Kea/eggs/pycparser-2.14-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea',\n '/home/zane/programming/virtenv/kea18/Kea/src/kea/tests',\n '/home/zane/programming/virtenv/kea18/Kea/bin',\n '/home/zane/programming/virtenv/kea18/Kea/local/lib/python2.7/site-packages/setuptools-18.0.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/local/lib/python2.7/site-packages/xlwt-1.0.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7/site-packages/setuptools-18.0.1-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7/site-packages/xlwt-1.0.0-py2.7.egg',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7/plat-x86_64-linux-gnu',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7/lib-tk',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7/lib-old',\n '/home/zane/programming/virtenv/kea18/Kea/lib/python2.7/lib-dynload',\n '/usr/lib/python2.7',\n '/usr/lib/python2.7/plat-x86_64-linux-gnu',\n '/usr/lib/python2.7/lib-tk',\n '/home/zane/programming/virtenv/kea18/Kea/local/lib/python2.7/site-packages',\n '/home/zane/programming/virtenv/kea18/Kea']\n```\n",
              "author": "zane.gilmore",
              "created": "2015-12-01T03:47:47Z"
            },
            {
              "body": "And no it was only on my dev instance\n",
              "author": "zane.gilmore",
              "created": "2015-12-01T03:48:20Z"
            },
            {
              "body": "Have found the problem. The problem is that a table has a foreign key to the pndata.Location table. This table is not a provenance table and causes the whole system to crash.\n\nThe provenance admin page (http://localhost:8000/provenance/admin/) shows a list of all of the tables in the provenance. The integrity tree code is what does this. This also follows any foreign keys that a provenance definition has. This is what detects the pndata.Location table and adds it to the list of models on the provenance admin page.\n\nThe NoReverseMatch exception is raised because the pndata.Location table is not registered in the django admin. The provenance admin page tries to include a link to the Location admin add page (which does not exist because the model is not registered in the admin).\n\nI did check the pndata/admin.py file and discovered that the LocationAdmin was originally registered in the admin but is now commented out. I am not sure of the reason for this so you will need to let me know.\n\nI did try enable the LocationAdmin class and the page did load but that uncovered more errors because the provenance admin page is not designed to handle non provenance models. The error was that the link to browse all records in the table did not work (datagrid). This is caused by the pndata.Location model is not a provenance model.\n\nWould like to get your thoughts on the best way to solve this problem.\n",
              "author": "will.buick",
              "created": "2015-12-01T22:09:05Z"
            },
            {
              "body": "I think that something that just skips any tables that are not in the provenance for the integrity tree would be in order.\n\nI don't understand why the integrity tree is being used in that code. I thought it was only for figuring out the order of inserts in the batch upload file.\n",
              "author": "zane.gilmore",
              "created": "2015-12-03T02:01:40Z"
            },
            {
              "body": "Closing this now.\n",
              "author": "zane.gilmore",
              "created": "2015-12-10T04:17:59Z"
            }
          ]
        },
        {
          "summary": "Context-specific help for initialisation",
          "key": "KEA-239",
          "status": "Done",
          "description": "It would be nice to provide a link or popup to explain the format requirements for initialization files at  \nhttp://kea.pfr.co.nz/ebrida/initialise-ebrida-samples/\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/239",
          "labels": [
            "EBrida_interface",
            "Requirement",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I agree.\nWill try to get this done when I have the time :-)\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T20:30:24Z"
            },
            {
              "body": "Eric has created a wiki instance for us for this purpose.\nNow we need to attach it via links etc.\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:03:01Z"
            },
            {
              "body": "Sorry the url for the wiki is \nhttp://keawiki.pfr.co.nz/wiki/Main_Page\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:04:21Z"
            },
            {
              "body": "documentation is now there.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:28:23Z"
            }
          ]
        },
        {
          "summary": "Ebrida initialisation: Populations and Groups.",
          "key": "KEA-240",
          "status": "Done",
          "description": "Kea's Initialise Ebrida function was originally added for Kiwifruit sex testing. The Populations in the Ebrida generated spreadsheets had 'nice' numbers of plants (eg. 30, or 46, or 94, or 188), so that populations filled up plates nicely. The Groups column had 'nice' numbers too: 3x30, or 2x46, or 1x94, (populations x samples) so that each Group - meaning one Tray - corresponded to a full Kea plate. This worked nicely (or did, until the Ebrida spreadsheet formats all changed...). Things do not work so nicely when the numbers are not so 'nice'...\n\nOne example is in my issue #209 - Groups don't correspond to Plates when there are fewer than one population of 94 samples, or 2 populations of 46 samples, or 3 populations of 30 samples in a Group. Paradoxically, Mareike received an Ebrida spreadsheet where the entries in the Group column were the orchard position of the plant, and therefore every entry was unique. Initialising plates in Kea meant that each sample was put into its own plate. Although this was a while after I posted #209 and something may have changed since then?\n\nFor some harvests, there are only one or two samples from each population. Unchecking 'Leave two blank wells between populations' removes the two blank wells from the start of each plate, too. These two blank wells at the start of each plate should always be there.\n\nKea imposes a limit of _94 plants per Group_, even when there are no plates being collected (only bags or tubes), and even when no blank wells are to be left. The error message for exceeding this limit says there is a limit of _96 plants per Group_.\n\nThese issues are quite important: combined with the non-uniformity of the Ebrida spreadsheets themselves (column titles changing; Pedigree Item sometimes being Orchard Position and sometimes K14.018.001 or whatever; different date formats...), they mean that sometimes up to ten trial runs are needed on keatest to make sure things are going to work as expected. They have resulted in the creation of more than one rubbish Sample Batch, and there is still an Ebrida Sample Batch from October that I have been unable to create in Kea.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/240",
          "labels": [
            "EBrida_interface",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Marek, we will need to spend some time on the EBrida import issues like this next year.\n",
              "author": "zane.gilmore",
              "created": "2015-12-22T02:22:57Z"
            },
            {
              "body": "Mike,\nI have done some work on all of this.\nPerhaps these issues have been addressed?\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:28:55Z"
            },
            {
              "body": "Cool! I'll leave a report if I find any problems.\n\nYou may have fixed this in your most recent update, but I just noticed that in that big Ebrida spreadsheet I sent you (Trays 108-224 or something), if you look at tray 223 it should be half full, and tray 224 should be full. The Kea platesheets I initialised a week or two ago from this spreadsheet puts the first half of the tray 224 samples into tray 223, and the second half of the tray 224 samples into the first half of tray 224. In other words, it did what my paragraph two in the opening comment described. Did it work correctly when you tested this spreadsheet?\n",
              "created": "2016-10-20T22:34:13Z"
            },
            {
              "body": "This seems to be fixed now",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:09:05Z"
            }
          ]
        },
        {
          "summary": "RawSQL backend needs work",
          "key": "KEA-241",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The datagrids using RawSQL were not really working properly.\nFiltering is really not working.\nNot sure about sorting\n\nThis really needs to be working for any reports.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/241",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "I have also removed use of the model raw method.\nIt was causing all sorts of problems.\nWe are now using connection cursors and properly raw SQL.\nI have escaped single quote chars to mitigate SQL injections but not sure whether that will \"cut the mustard\"\n\nAlso any action methods in a class that calls this needs to use obj['id'] not obj.id because of the way that the results are returned in the cursor.\n\nSeems to work. \n",
              "author": "zane.gilmore",
              "created": "2015-12-10T04:31:14Z"
            },
            {
              "body": "Pretty sure the issues raised here are pretty much done.\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:59:13Z"
            }
          ]
        },
        {
          "summary": "Provenance schema editing to be done via the Django models.py",
          "key": "KEA-242",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In an attempt to get access to decent version control for provenances we need to pull back from the idea of editing the provenances via the web GUI.\n\nThis has provided too much complexity and it means we can't make use of the Django migration mechanisms.\n\nSo it has been mooted that we now define all provenances in their own models.p file and then provide some infrastructure around the rest of the alternate provenance functionality.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/242",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "This has been done in the provenance_refactor branch. All of the provenance functionality I'm aware of has been tested.\n",
              "created": "2016-01-22T03:51:34Z"
            },
            {
              "body": "We've rolled this out so it better be done :-)\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:00:54Z"
            }
          ]
        },
        {
          "summary": "Searches are case sensitive",
          "key": "KEA-243",
          "status": "Done",
          "description": "Priority: medium\n\nSearches in columns are case sensitive. Researchers would prefer it to be case insensitive.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/243",
          "labels": [
            "Datagrid",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Righto.\nYou're not the first to mention this recently.\nWe are changing some back-end stuff on the Datagrids and I will try to include this in those changes.\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T20:22:01Z"
            },
            {
              "body": "This is done\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:31:35Z"
            }
          ]
        },
        {
          "summary": "Initiate Samples from EBrida",
          "key": "KEA-244",
          "status": "Done",
          "description": "Priority: High\n\nResearchers export an excel sheet from ebrida to niotiate KEA samples. The column headiers do not exactly m,atch which drives them nuts:\n\nExamples:\n- The meaning of the header Group differs between KEA and EBRida. EBRida exports the location on the field as a group. but KEA interprets that as a sample layout. A side remark: The sample layout is in KEA restricted to 96 samples, but they have now boxes with 100 sample!\n- No start date in the ebrida excel export\n- ebrida headers have lower case characters in the headers where KEA uses upper case letters\n- Tree barcode does not get imported\n- Plant location should not be imported to plan alt name it should be a separate field \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/244",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "I think we need to figure this out between everybody that uses this import functionality.\nIt looks like the potato people will be using it soon too.\n\nI put together things like the group column to be used for plate layout because that is what some people asked for.\n\nTo be able to handle other plate or multi-sample containers comprehensively we need to do some fairly significant work.\n\nThe translation of fields from EBrida to KEa certainly does need some work but be need to be sure we get it as right as we can so I suggest we get together everybody who has a stake and everybody who has the required knowledge and nut it out.\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T20:43:41Z"
            },
            {
              "body": "eBrida upload done now. Hoping this fixes it",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:27:04Z"
            }
          ]
        },
        {
          "summary": "Onclicks in tables",
          "key": "KEA-245",
          "status": "To Do",
          "description": "Priority: High\n\nTo give an example: When browsing populations it would be great if you could click on a population name. The onclick would open a window with detail information about that population.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/245",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This requires a population report a la sample_status.\nAbout a day or two of work.\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T20:46:19Z"
            }
          ]
        },
        {
          "summary": "STtoring DNA concentration on a sample",
          "key": "KEA-246",
          "status": "Done",
          "description": "Priority: medium\n\nThe researchers need to quickly see what DNA concentration they achieved on a sample. The researchers would really appreciate the ability to store that value on a sample particular for communication purposes across sites. \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/246",
          "labels": [
            "Process Handling",
            "Requirement",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I can write reports to do this but the Sample Staus report will contain this data if it has been entered\ne.g. http://kea.pfr.co.nz/reports/sample_status/BAO5391/\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T20:15:50Z"
            },
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:25:24Z"
            }
          ]
        },
        {
          "summary": "Definitaion of a genotype",
          "key": "KEA-247",
          "status": "Done",
          "description": "Priority: Medium\n\nCurrently the genotype is defined as a plant. However, in some cases the reearchers deal with clones. Thus, you can have many clones of the same genotype. Thus, many plants are part of the same genotype.  \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/247",
          "labels": [
            "question"
          ],
          "comments": [
            {
              "body": "Are you talking about the EBrida import?\nIf you are then that is not really true.\n\nBarcode defines the plant and 'Pedigree Item' defines the Genotype.\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T20:55:26Z"
            }
          ]
        },
        {
          "summary": "Look-up table admin does not filter by crop",
          "key": "KEA-248",
          "status": "Done",
          "description": "Priority: medium\n\nOn the home screen you filter by crop. However, when browsing to the Look-up table admin screen you will get lists across all crops. This makes it hard to find things and dangerous as kiwi people can for instance manipulate onion genotypes.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/248",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "You are right.\nWe need to tidy things up in there.\nI think that I would be more likely to remove those tables completely from there as samples and genotypes etc are not lookup tables and there are more appropriate ways of dealing with that data.\n\nWe should also be doing things like filtering species to crops etc.\nHowever this is likely to be a fairly time consuming job.\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T21:01:56Z"
            },
            {
              "body": "I think that most of this is done now.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:24:49Z"
            }
          ]
        },
        {
          "summary": "Browse Plants no ebrida barcode",
          "key": "KEA-249",
          "status": "To Do",
          "description": "Priority: medium\n\nThis report needs also the unique plant ID in form of the barcode. Researchers have problems with labels that have a shortened pedigree item ID which might make a sample unrecognisable.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/249",
          "labels": [
            "EBrida_interface",
            "Process Handling",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Another report a la sample status then.\nBTW the EBrida barcode should have been added as an altname for the plant.\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T21:04:31Z"
            }
          ]
        },
        {
          "summary": "Browse plants:  Genotype Altnames ",
          "key": "KEA-250",
          "status": "Done",
          "description": "What is that!?!? Content unclear.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/250",
          "labels": [
            "Process Handling",
            "enhancement",
            "invalid"
          ],
          "comments": [
            {
              "body": "We need to talk\n",
              "author": "zane.gilmore",
              "created": "2016-01-24T21:05:43Z"
            }
          ]
        },
        {
          "summary": "Sample init: who did it?",
          "key": "KEA-251",
          "status": "To Do",
          "description": "Priority: medium\n\nResearchers would like to see who initiated samples and have it reported when browsing samples. Could be an additional field when init samples.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/251",
          "labels": [
            "Process Handling",
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Can do this now with the auditcreated by field being filled in.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:21:46Z"
            }
          ]
        },
        {
          "summary": "Sample Layout Excel Sheet",
          "key": "KEA-252",
          "status": "To Do",
          "description": "Priority; very high\n\nThe researchers walk with the layout sheet in to the field. However, the sheet does not contain any information about the plant location (particularly from ebrida) which makes browsing through the field very difficult.  It also constitutes a major error source.\n\nAlso please consider the ability to let the researcher order the list by location. \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/252",
          "labels": [
            "Process Handling",
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This should be simple to automate now. This sheet needs to be firstly made into a square sheet with Population as a column, and row/bay/column extracted from the location/barcode. Use of warehoused eBrida trials will make it simple to collect across trials. Plant parent location(s) would be very handy but if the intention is to collect them then they just need to be in their own sampling row and not an afterthought.\n\n---\n\n| PlantID | Sample ID | Plant Alt Names | Collection Date | Plate No | Position on Plate(s) | Plant Location:Orchard | Street/Road Name | City/Town | Orchard Road ID | Plant Parent Location |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n|  |  |  |  |  |  |  |  |  |  |  |\n| Population | POP10H3 (T96.13-03-16j) |  |  |  |  |  |  |  |  |  |\n| Kiw1R6EK.01 | BBK3458 | TPCB24 | 0363 |  |  |  | T15.24-08-11c |  |  |  |\n|  |  |  |  |  |  |  |  |  |  |  |\n| Population | POP10H5 (T03.32-02-11a) |  |  |  |  |  |  |  |  |  |\n| Kiw1R6EM.01 | BBK3459 | TPCB24 | 0333 |  |  |  | T14.24-08-03d |  |  |  |\n|  |  |  |  |  |  |  |  |  |  |  |\n| Population | POP10H7 (T03.32-04-15c) |  |  |  |  |  |  |  |  |  |\n| Kiw1R6EP.01 | BBK3460 | TPCB24 | 0336 |  |  |  | T08.24-08-04c |  |  |  |\n|  |  |  |  |  |  |  |  |  |  |  |\n| Population | POP10HA (Gold 9) |  |  |  |  |  |  |  |  |  |\n| Kiw1R6ET.01 | BBK3461 | TPCB24 | 0139 |  |  |  | T15.24-02-11f |  |  |  |\n|  |  |  |  |  |  |  |  |  |  |  |\n| Population | POP0Y1D (Actinidia parents) |  |  |  |  |  |  |  |  |  |\n| Kiw1KL6W.02 | BBK3462 | TPCB24 | 0351 |  |  |  | T08.24-08-08b |  |  |  |\n",
              "created": "2016-01-26T03:45:10Z"
            }
          ]
        },
        {
          "summary": "Breadcrumb links should be to Provenance admins not Django admins",
          "key": "KEA-253",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I am trying to add some e.g. filial gen's I wanted to quickly open another tab of the existing ones.\n\nI just tried to open it from the breadcrumbs and that just opened the standard Django admin page.\nWe want them to point to the correct admin pages.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/253",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "It looks like this has always been a problem so am removing it from the refactor milestone\n",
              "author": "zane.gilmore",
              "created": "2016-01-26T23:10:21Z"
            }
          ]
        },
        {
          "summary": "Dropdowns should show local ID of chosen entity in add form",
          "key": "KEA-254",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a foreign key entity is chosen in the add new entity forms the we need it to display a meaningfull name of the chosen entity.\ne.g. the chosen cross in the add new filial generation form.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/254",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Done\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:24:03Z"
            }
          ]
        },
        {
          "summary": "Sample initialisation is not creating samples.",
          "key": "KEA-255",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I look for samples after initialising some they are not turning up in the sample datagrid.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/255",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I've already mentioned to you that I haven't tested the datagrid/elasticsearch code because you've removed it in another branch and we agreed that it was redundant to test it. We would be better off to merge in the code from your sql based datagrid branch before testing this.\n",
              "created": "2016-01-26T23:08:49Z"
            },
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:53:20Z"
            }
          ]
        },
        {
          "summary": "Sample provenance wrong",
          "key": "KEA-256",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It seems that all of the existing samples have a provenance of PLOT with plots that don't exist.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/256",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I think that this is going now\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:50:14Z"
            }
          ]
        },
        {
          "summary": "step 3 of sample init is not displaying M2M relations properly",
          "key": "KEA-257",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When initialising samples the confirmation list displayed on step 3 is not handling the M@M relations properly.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/257",
          "labels": [
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "Done\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:23:37Z"
            }
          ]
        },
        {
          "summary": "changing entity names that are used as foreign keys",
          "key": "KEA-258",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a field is changed in a table which is used as a freign key and there are entities tahta re \"pointing\" to it then the admin form is throwing a 500 error then when back is pressed a succes message is displayed. This is a filthy lie.\n\nWe need to deal with this whole scenario.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/258",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:20:10Z"
            }
          ]
        },
        {
          "summary": "Migration must work against live DB",
          "key": "KEA-259",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The migration for when we move to our new provenance scheme needs to work against the live DB.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/259",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "done and rolled out\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:51:33Z"
            }
          ]
        },
        {
          "summary": "Sample table to have Provenance column",
          "key": "KEA-260",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to add the Provenance of the sample to the sample table.\nThis will mean 3 columns to define the provenance of a sample but will probably mean some simplification of things for containers and processes later.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/260",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:52:51Z"
            }
          ]
        },
        {
          "summary": "Sample Search Datagrid to include extra provenance column",
          "key": "KEA-261",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to get the Datagrid for Sample Search using raw SQL working with the new column in the Sample table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/261",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:52:02Z"
            }
          ]
        },
        {
          "summary": "raw SQL for Plants",
          "key": "KEA-262",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Implement the raw SQL backend for Plants\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/262",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This has been done.\n",
              "created": "2016-02-15T00:54:00Z"
            },
            {
              "body": "The datagrid sorting and searching very very slow.\nSo we will have to make some modifications for it to work satisfactorily.\n\nWe have decided that adding a LocalID_str column to the plant table that is automatically populated should solve this. Then we can index on it and get things humming along nice and fast.\nThe same things also apply for #263.\n\nTo start with we will add the columns in the models.py file for pndata.\nThen we populate the columns:\n- Plants: `update pndata_plant set \"LocalID_str\" = getplantlocalid(id);`   This took approx 45 minutes on my dev' machine.\n- Genotypes: `update pndata_genotype set \"LocalID_str\" = getgenotypelocalid(id);` And this took about an hour!\n",
              "author": "zane.gilmore",
              "created": "2016-02-17T01:09:02Z"
            },
            {
              "body": "Now we will have to write the trigger for automatically populating the column.\n",
              "author": "zane.gilmore",
              "created": "2016-02-17T01:11:38Z"
            },
            {
              "body": "OK...\nThe trigger code for the plant table is:\n`\ndrop trigger if exists populate_localid_str on pndata_plant;\nCREATE TRIGGER populate_localid_str\n  BEFORE INSERT OR UPDATE OR DELETE\n  ON pndata_plant\n  FOR EACH ROW\n  EXECUTE PROCEDURE populate_plant_localid_str_column();\n`\nand:\n\n`\nCREATE OR REPLACE FUNCTION populate_plant_localid_str_column()  \nRETURNS TRIGGER AS $$\nDECLARE\n    localid varchar;\n    genotypeLocalIDnum int;\n    genotypeID  int;\n    cropPrefix varchar;\n    plantLocalIDstr varchar;\n\nBEGIN\n    select g.\"LocalID\",g.\"id\", cr.\"IDPrefix\" into  genotypeLocalIDnum,genotypeID,cropPrefix\n    from pndata_genotype g \n        join pndata_species sp on sp.id = g.\"Species_id\"\n        join pndata_crop cr on cr.id=sp.\"Crop_id\"\n    where g.\"id\" = NEW.\"Genotype_id\";\n\n```\nplantLocalIDstr := trim(both from to_char(NEW.\"LocalID\",'00'));\n\nlocalid := cropPrefix || convert_base(genotypeLocalIDnum,32) || '.' || plantLocalIDstr;\n\nNEW.\"LocalID_str\" := localid;\n\nRETURN NEW; \n```\n\nEND;\n$$ language 'plpgsql';\n`\n",
              "author": "zane.gilmore",
              "created": "2016-02-17T02:10:22Z"
            },
            {
              "body": "The pushed changes include some tweaked migrations that take 2 hours to run.\nWilliam.\nI have not checked that migration code yet.\nCould you try it out on your DB?\n",
              "author": "zane.gilmore",
              "created": "2016-02-17T04:07:34Z"
            },
            {
              "body": "I have run the migration in question. It took several hours to run but it ran without error.\n",
              "author": "will.buick",
              "created": "2016-02-22T20:45:30Z"
            },
            {
              "body": "Looks good now\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:49:36Z"
            }
          ]
        },
        {
          "summary": "Raw SQL for Genotypes",
          "key": "KEA-263",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Implement the raw SQL backend for Genotypes\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/263",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "This has been done\n",
              "created": "2016-02-15T00:53:24Z"
            },
            {
              "body": "We have extreme slowness issues with this see #262 \n",
              "author": "zane.gilmore",
              "created": "2016-02-17T01:10:04Z"
            }
          ]
        },
        {
          "summary": "Raw SQL for Sample Extracts",
          "key": "KEA-264",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Implement the raw SQL backend for Sample Extracts\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/264",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "This datagrid has been changed to run on the raw sql backend\n",
              "author": "will.buick",
              "created": "2016-02-23T01:43:47Z"
            },
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:48:38Z"
            }
          ]
        },
        {
          "summary": "Raw SQL for Plates",
          "key": "KEA-265",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Implement the raw SQL backend for Plates\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/265",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "This datagrid has been changed to run on the raw sql backend\n",
              "author": "will.buick",
              "created": "2016-02-23T01:43:39Z"
            },
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:48:24Z"
            }
          ]
        },
        {
          "summary": "Raw SQL for Extract Plates",
          "key": "KEA-266",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Implement the raw SQL backend for Extract Plates\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/266",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "This datagrid has been changed to run on the raw sql backend\n",
              "author": "will.buick",
              "created": "2016-02-23T01:43:10Z"
            },
            {
              "body": "Done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:48:12Z"
            }
          ]
        },
        {
          "summary": "Get reports going with the new Provenance schema",
          "key": "KEA-267",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "A lot of those reports are using suavblanc etc\n\nSo we will need tweak them to get them going\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/267",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Done now\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:47:53Z"
            }
          ]
        },
        {
          "summary": "chosen specimens in intialise samples need better formatting",
          "key": "KEA-268",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to display a better string than the id number and the LocalID number in the listbox in step 2\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/268",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "I'm pretty sure this is good now\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:50:53Z"
            }
          ]
        },
        {
          "summary": "Display of chosen data in step 3 is bad",
          "key": "KEA-269",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Need to get the display of the list of the chosen specimens correct.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/269",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Old files list is empty",
          "key": "KEA-270",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "At present the old batch files list is just presenting an empty list.\nAnd also producing a 500 error \nAttributeError: 'dict' object has no attribute 'File Name'\nInvisible to the user.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/270",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Initialise eBrida Sample Initialisation  column requirements and Exception handling ",
          "key": "KEA-271",
          "status": "Done",
          "description": "**NB** \n## THIS ISSUE REFERS to Initialise eBrida option\n\n---\n\nTwo issues here:\n1. Spaces and periods in a table name are quite user-hostile for generating these tables/sheets by code\n2.  some gentler exception handling would be nice  \n\n```\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 240, in trace_task\n    R = retval = fun(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 438, in __protected_call__\n    return self.run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/celery/tasks/logging.py\", line 52, in run_decorator\n    func_output = self.wrapped_run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/tasks.py\", line 53, in initialise_ebrida_samples\n    stdout=out)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 120, in call_command\n    return command.execute(*args, **defaults)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 441, in execute\n    output = self.handle(*args, **options)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 619, in handle\n    label_output = self.handle_label(label, **options)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 282, in handle_label\n    self.create_samples(sheet_data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 405, in create_samples\n    plant, genotype, population = self.create_pedigree_data(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 528, in create_pedigree_data\n    population = self.get_or_create_population(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 627, in get_or_create_population\n    if data_row['From Ped. Item'] in self.populations.keys():\nKeyError: 'From Ped. Item'\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/271",
          "labels": [
            "EBrida_interface",
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "this is still a big problem!\n\n```\n{\"status\": \"FAILURE\", \"traceback\": \"Traceback (most recent call last):\\n  File \\\"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\\\", line 240, in trace_task\\n    R = retval = fun(*args, **kwargs)\\n  File \\\"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\\\", line 438, in __protected_call__\\n    return self.run(*args, **kwargs)\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/celery/tasks/logging.py\\\", line 52, in run_decorator\\n    func_output = self.wrapped_run(*args, **kwargs)\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/tasks.py\\\", line 53, in initialise_ebrida_samples\\n    stdout=out)\\n  File \\\"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\\\", line 120, in call_command\\n    return command.execute(*args, **defaults)\\n  File \\\"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\\\", line 441, in execute\\n    output = self.handle(*args, **options)\\n  File \\\"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\\\", line 619, in handle\\n    label_output = self.handle_label(label, **options)\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\\\", line 285, in handle_label\\n    self.create_batch_spreadsheet()\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\\\", line 351, in create_batch_spreadsheet\\n    create_spreadsheet(SampleBatchSpreadsheet, context, filepath)\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/utils/spreadsheet.py\\\", line 8, in create_spreadsheet\\n    spreadsheet.create()\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\\\", line 97, in create\\n    self.create_sheets(self.context)\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/batch/excel/batch.py\\\", line 79, in create_sheets\\n    self.create_data_sheet(context)\\n  File \\\"/home/keaapp/.virtualenvs/kea/src/kea/kea/batch/excel/batch.py\\\", line 155, in create_data_sheet\\n    if context['population_as_column'] is True:\\nKeyError: 'population_as_column'\\n\"}\n```\n",
              "created": "2016-08-14T23:31:45Z"
            },
            {
              "body": "This issue is still open and will prevent using Kea effectively for orchard collections this spring \n",
              "created": "2016-09-13T03:46:24Z"
            },
            {
              "body": "This seems to be acutely sensitive to date formatting and Excel has a habit of being so helpful it makes it harder. \n\nIm now able to get it to work ..._most of the time_ but it seems strangely unpredictable.\n\nI have been generating init sheets using the app at http://shiny-dev.powerplant.pfr.co.nz/LookupLoc-eg/\n\nIm finding it VERY hard to work out if this is an excel issue or a Kea issue.\n\nExcel simply cant be trusted with dates so is  there is any way to make the parsing more robust or drop the date column altogether ?\n\n---\n\n## PS I dont actually see why Kea needs to have the date...this kind of trial meta-data **is eBridas job**\n",
              "created": "2016-09-13T04:17:36Z"
            }
          ]
        },
        {
          "summary": "Hard-coded for < 96 samples?",
          "key": "KEA-272",
          "status": "Done",
          "description": "Uploading a list of 220 samples collected to bags with settings shown gives:\n\n```\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 282, in handle_label\n    self.create_samples(sheet_data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 372, in create_samples\n    raise Exception('Cannot fit more than 96 samples into 96 well plate')\nException: Cannot fit more than 96 samples into 96 well plate\n```\n## We need to handle > 96 quite often\n\n![screen shot 2016-02-26 at 3 10 12 pm](https://cloud.githubusercontent.com/assets/268441/13341170/31497f74-dc9b-11e5-8c81-684dafce3097.png)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/272",
          "labels": [
            "EBrida_interface",
            "Requirement",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "this is still an issue and major pain . Any more than 94 samples throws an error . This historical hard-coding **must** be removed and replaced by assigning across multiple plates \n",
              "created": "2016-08-29T00:36:53Z"
            },
            {
              "body": "Could you please give us the spreadsheet file that produced the problem?\nMore than one would be useful too.\n",
              "author": "zane.gilmore",
              "created": "2016-08-29T20:58:00Z"
            },
            {
              "body": "@hymmikong has an app to do this. I.e generate a valid sheet from barcodes. Just need one over 94 entries in length. Hymmi can you please provide as I'm off site? I just generated using example PIs in app\n\nSent from my iPhone\n\nOn 30/08/2016, at 8:58 AM, Zane Gilmore <notifications@github.com<mailto:notifications@github.com>> wrote:\n\nCould you please give us the spreadsheet file that produced the problem?\nMore than one would be useful too.\n\n窶能nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/PlantandFoodResearch/Kea/issues/272#issuecomment-243253839, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AAQYmdr5moYRUQ9jhp4jz69c5TnnucL3ks5qk0fZgaJpZM4HjZs5.\n\nThe contents of this e-mail are confidential and may be subject to legal privilege.\n If you are not the intended recipient you must not use, disseminate, distribute or\n reproduce all or any part of this e-mail or attachments.  If you have received this\n e-mail in error, please notify the sender and delete all material pertaining to this\n e-mail.  Any opinion or views expressed in this e-mail are those of the individual\n sender and may not represent those of The New Zealand Institute for Plant and\n Food Research Limited.\n",
              "created": "2016-08-29T21:39:43Z"
            },
            {
              "body": "Fixed\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:23:13Z"
            }
          ]
        },
        {
          "summary": "Attempt to get the integration tests passing",
          "key": "KEA-273",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I tried to run the integration tests last week I was having problems the crop changing form.\nIt was producing an exception which appeared to be produced by a call to cursor execute.\n\nThis meant that none of the tests will pass as they are all initialised by a call to this form.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/273",
          "labels": [
            "Testing"
          ],
          "comments": []
        },
        {
          "summary": "Layout of sample intit wizard needs work",
          "key": "KEA-274",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The relative positions of buttons etc for the sample initialisation in provenance.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/274",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:19:41Z"
            }
          ]
        },
        {
          "summary": "Merge refactor_provenance with master",
          "key": "KEA-275",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Do the merge to get the provenance refactoring and removal of elastic search into master for roll out\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/275",
          "labels": [
            "Datagrid",
            "Provenance"
          ],
          "comments": [
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T22:54:23Z"
            }
          ]
        },
        {
          "summary": "Need to View and Browse by Experiments",
          "key": "KEA-276",
          "status": "Done",
          "description": "Since the most obvious question any end-user would like to ask is :\n\n> Where are/what are samples collected for experiment XXXXX?\n\nThere needs to be \n- a  view option for Experiments\n- an Experiment field in most browse screens\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/276",
          "labels": [
            "Requirement",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Also added genotypes for #196 \n",
              "author": "zane.gilmore",
              "created": "2016-03-15T23:34:56Z"
            }
          ]
        },
        {
          "summary": "exception raise when trying to init samples in grape and wine",
          "key": "KEA-277",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "NameError at /provenance/batch/initialise/select-items/\nglobal name 'model' is not defined\n\nThis is a show stopper and we will need it fixed reasonably quickly.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/277",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Just had a look and it seems to happen on all provenances\n",
              "author": "zane.gilmore",
              "created": "2016-03-09T02:57:56Z"
            }
          ]
        },
        {
          "summary": "test issue with api",
          "key": "KEA-278",
          "status": "Done",
          "description": "wibble wibble foobar\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/278",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Kea Form:blah blah blah",
          "key": "KEA-279",
          "status": "Done",
          "description": "## Posted by Zane Gilmore (zane) on the Issue Form in Kea\n\nkljhaflkjfhlakjfhlkjahflakjfhlakjfhlakjhlkj\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/279",
          "labels": [],
          "comments": [
            {
              "body": "blab blab wibble\n\n---\n\njhgljkhlkjhlkjhlkjhlkjhlkjh\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T01:57:37Z"
            }
          ]
        },
        {
          "summary": "Kea Form:And another test",
          "key": "KEA-280",
          "status": "Done",
          "description": "Posted by Zane Gilmore (zane) on the Issue Form in Kea\n\n---\n\nElephants are large mammals of the family Elephantidae and the order Proboscidea. Two species are traditionally recognised, the African elephant (Loxodonta africana) and the Asian elephant (Elephas maximus), although some evidence suggests that African bush elephants and African forest elephants are separate species (L. africana and L. cyclotis respectively). Elephants are scattered throughout sub-Saharan Africa, South Asia, and Southeast Asia. Elephantidae is the only surviving family of the order Proboscidea; other, now extinct, members of the order include deinotheres, gomphotheres, mammoths, and mastodons. Male African elephants are the largest extant terrestrial animals and can reach a height of 4 m (13 ft) and weigh 7,000 kg (15,000 lb). All elephants have several distinctive features the most notable of which is a long trunk or proboscis, used for many purposes, particularly breathing, lifting water and grasping objects.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/280",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Kea Form:yet another test",
          "key": "KEA-281",
          "status": "Done",
          "description": "Posted by Zane Gilmore (zane) on the Issue Form in Kea\n\n---\n\nElephants are large mammals of the family Elephantidae and the order Proboscidea. Two species are traditionally recognised, the African elephant (Loxodonta africana) and the Asian elephant (Elephas maximus), although some evidence suggests that African bush elephants and African forest elephants are separate species (L. africana and L. cyclotis respectively). Elephants are scattered throughout sub-Saharan Africa, South Asia, and Southeast Asia. Elephantidae is the only surviving family of the order Proboscidea; other, now extinct, members of the order include deinotheres, gomphotheres, mammoths, and mastodons. Male African elephants are the largest extant terrestrial animals and can reach a height of 4 m (13 ft) and weigh 7,000 kg (15,000 lb). All elephants have several distinctive features the most notable of which is a long trunk or proboscis, used for many purposes, particularly breathing, lifting water and grasping objects.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/281",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Kea Form:and yet another test",
          "key": "KEA-282",
          "status": "Done",
          "description": "Posted by Zane Gilmore (zane) on the Issue Form in Kea\n\n---\n\nElephants are large mammals of the family Elephantidae and the order Proboscidea. Two species are traditionally recognised, the African elephant (Loxodonta africana) and the Asian elephant (Elephas maximus), although some evidence suggests that African bush elephants and African forest elephants are separate species (L. africana and L. cyclotis respectively). Elephants are scattered throughout sub-Saharan Africa, South Asia, and Southeast Asia. Elephantidae is the only surviving family of the order Proboscidea; other, now extinct, members of the order include deinotheres, gomphotheres, mammoths, and mastodons. Male African elephants are the largest extant terrestrial animals and can reach a height of 4 m (13 ft) and weigh 7,000 kg (15,000 lb). All elephants have several distinctive features the most notable of which is a long trunk or proboscis, used for many purposes, particularly breathing, lifting water and grasping objects.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/282",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Have added a new library PyGithub",
          "key": "KEA-283",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I have added a form for submitting Github issues without needing to have a Github login.\n\nThe problem is that it makes use of a library called PyGithub.\nI think that we need to ensure that it is handled via buildout or whatever.\nSo please set it up properly in the config etc.\nThanks\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/283",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Page 3 of the prov' sample init' wizard needs datagrid",
          "key": "KEA-284",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The third page of the provenance sample initialisation wizard needs to display its data in a datagrid.\nFor it to be useful as a view to confirm that the correct data has been chosen the user needs to be able to sort and filter etc.\n\nIt has been mentioned that this will require a new variation on the datagrid. \nIf this is the case then please ensure that we can easily make use of that variation elsewhere.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/284",
          "labels": [
            "Datagrid",
            "Provenance",
            "Sample Init",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Oops I sort did do this ticket earlier in #269.\n",
              "author": "zane.gilmore",
              "created": "2016-03-15T21:57:26Z"
            }
          ]
        },
        {
          "summary": "Appropriate Default Print Behaviour from Browse Samples",
          "key": "KEA-285",
          "status": "Done",
          "description": "Is there any reason why the default download as Excel behaviour is to only download the default view of 50 records?\n\nI would predict that the majority of users would want to download **all** records meeting their filter, not just the top 50 and that in fact this default might cause confusion\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/285",
          "labels": [
            "question"
          ],
          "comments": [
            {
              "body": "John,\nWhat if their filter matches 50,000 records?\nI have been arguing that only the current page should written to a spreadsheet.\nYou can easily increase the page size to whatever you want\n",
              "author": "zane.gilmore",
              "created": "2016-03-16T22:33:18Z"
            },
            {
              "body": "not gonna fix",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:19:05Z"
            }
          ]
        },
        {
          "summary": "Remove page 3 of prov' sample init'  and make selected list on page 4 the datagrid",
          "key": "KEA-286",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Page 3 of the sample init' in Provenances seems to be redundant considering the same list is provided in the fourth and final form.\nSo we may as well remove it.\n\nThe list should be the datagrid that we had in the 3rd screen.\nThis will also obviate the problem with the extraneous data being displayed.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/286",
          "labels": [
            "Datagrid",
            "Provenance",
            "invalid"
          ],
          "comments": [
            {
              "body": "This issue us cancelled because page three is required for when the specimen entities are created via spreadsheet\n",
              "author": "zane.gilmore",
              "created": "2016-03-22T19:51:02Z"
            }
          ]
        },
        {
          "summary": "DNA Alternative Provenance Requirements",
          "key": "KEA-287",
          "status": "To Do",
          "description": "# Draft Notes on an Alternative Provenance for Kiwifruit DNA Samples\n## GOAL\n\n> to be able to assign a unique ID and track usage of **historical** DNA (or RNA) samples that have not been collected though a KEA best practice process\n### What we want to remember\n- old location (lab, location)\n- person providing\n- local identifier\n- putative eBrida PI the sample is _believed_ to have come from\n- other metadata about sample\n  - extraction method\n  - concentration or other QC\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/287",
          "labels": [
            "Provenance",
            "Requirement",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Quick fix of the data display issues with the Prov' based sample init",
          "key": "KEA-288",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The specimen data being displayed on page 3 and 4 of the sample init' is showing all sorts of crap.\nProbably some artifact of the foreign key mechanisms we have in place for the provenances.\n\nWe will probably need to revisit this in the near future but we need to fix this quickly as we are strapped for time.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/288",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "buildout  for pygithub doesn't work on servers",
          "key": "KEA-289",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "This is not urgent but when I ran the buildout on the test server to install pygithub it didn't work.\n\n```\n(kea)[keaapp@aklweb22 kea]$ bin/buildout -c staging.cfg\n\nmr.developer: Queued 'django_import_export' for checkout.\nPassword:\nmr.developer: Can't update package 'django_import_export' because its URL doesn'                                          t match.\nmr.developer: Updated 'django_import_export' with git.\nDevelop: '/home/keaapp/.virtualenvs/kea/src/kea'\nDevelop: '/home/keaapp/.virtualenvs/kea/src/django_import_export'\nUninstalling crontab_rebuild_indexes.\nRunning uninstall recipe.\nUninstalling scriptgen.\nUninstalling django.\nUpdating _mr.developer.\nInstalling django.\ndjango: There's no directory named after our project. Probably you want to run '                                          bin/django startproject kea'\nGetting distribution for 'pygithub'.\nzip_safe flag not set; analyzing archive contents...\ngithub.tests.Framework: module references __file__\nGot PyGithub 1.26.0.\nWhile:\n  Installing django.\n  Getting distribution for 'pygithub'.\nError: Picked: PyGithub = 1.26.0\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/289",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Again this is not urgent!\nI ran `pip install pygithub` no problems.\n",
              "author": "zane.gilmore",
              "created": "2016-03-24T00:19:31Z"
            },
            {
              "body": "This is not a problem. You need to run buildout with the testing.cfg configuration file to update the versions.cfg file. That's all the problem is. Either that or just edit versions.cfg manually and stick in the following line\n\nPyGithub = 1.26.0\n",
              "author": "will.buick",
              "created": "2016-03-24T01:11:16Z"
            },
            {
              "body": "Thanks William\nDidn't know that we had renamed the config file to testing\nOn 24/03/2016 2:11 PM, \"wilbuick\" notifications@github.com wrote:\n\n> This is not a problem. You need to run buildout with the testing.cfg\n> configuration file to update the versions.cfg file. That's all the problem\n> is. Either that or just edit versions.cfg manually and stick in the\n> following line\n> \n> PyGithub = 1.26.0\n> \n> 窶能n> You are receiving this because you authored the thread.\n> Reply to this email directly or view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/289#issuecomment-200604179\n",
              "author": "zane.gilmore",
              "created": "2016-03-24T04:05:34Z"
            }
          ]
        },
        {
          "summary": "Provenance creation script",
          "key": "KEA-290",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I remember that we had a script that would create a provenance in the DB and also create the correct dir's.\n\nNow I can't find it.\nWilliam, do you know what happened to it?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/290",
          "labels": [
            "Provenance",
            "question"
          ],
          "comments": [
            {
              "body": "No, I don't I've had a look. I thought it might have been a management command somewhere, but there doesn't seem to be one. That's the script that you wrote I think? I have no idea what happened to it.\n",
              "author": "will.buick",
              "created": "2016-04-01T01:51:29Z"
            },
            {
              "body": "Bugger! I think you're right. I'm going to have to find the bloody thing\n",
              "author": "zane.gilmore",
              "created": "2016-04-01T02:28:57Z"
            },
            {
              "body": "Found it.\nI knew I written it at some point\nhttps://github.com/PlantandFoodResearch/Kea/blob/db2a0a5f02da0d05ab8ea6a40ceefdeac9a8a3db/src/kea/kea/provenance/management/commands/create_provenance.py\n\nDon't know how we lost it!\nWe will be needing it.\n",
              "author": "zane.gilmore",
              "created": "2016-04-01T04:24:14Z"
            },
            {
              "body": "This is the commit\nhttps://github.com/PlantandFoodResearch/Kea/commit/db2a0a5f02da0d05ab8ea6a40ceefdeac9a8a3db\n",
              "author": "zane.gilmore",
              "created": "2016-04-01T04:25:16Z"
            },
            {
              "body": "William,\nCould you please re-institute this so it works?\n\nThanks.\n",
              "author": "zane.gilmore",
              "created": "2016-04-01T04:28:51Z"
            },
            {
              "body": "William. Have you run this to ensure that it works?\n",
              "author": "zane.gilmore",
              "created": "2016-04-04T00:09:31Z"
            },
            {
              "body": "Yes\n",
              "author": "will.buick",
              "created": "2016-04-04T00:45:48Z"
            }
          ]
        },
        {
          "summary": "Process slickgrid datagrid not sorting dates",
          "key": "KEA-291",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Need to get the javascript slickgrid sorting by date properly.\n\nNot an especially high priority yet as mostly sample processing is done on the same day for a process-run.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/291",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Re-merge Import export library with main OS project",
          "key": "KEA-292",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There has been some technical debt accrued because we have forked the Import-Export library.\n\nSo we need to re-merge the changes we have made with the original open source project.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/292",
          "labels": [],
          "comments": [
            {
              "body": "Done",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:23:07Z"
            }
          ]
        },
        {
          "summary": "Examine and address exceptions from email logs",
          "key": "KEA-293",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "We are getting exceptions being produced and sent from Kea via email every day.\nWe need to have a good look at these and work through fixing them so that Kea deals with them more gracefully or fix any bugs.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/293",
          "labels": [
            "question"
          ],
          "comments": []
        },
        {
          "summary": "Change \"Content type\" in Provenance sample init to \"Specimen type\"",
          "key": "KEA-294",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The first page in sample init wizard needs to have its lable changed to \"Specimen type\" from \"Content type\"\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/294",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "I have change this to \"what is being sampled\"",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:24:15Z"
            }
          ]
        },
        {
          "summary": "When changing Crop or Provenance default to home page",
          "key": "KEA-295",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When changing the active Crop or Provenance via the drop-downs, often a 404 will be shown.\nBecause the page that was active is not accessible within the new Crop or Provenance.\n\nWe should detect this and redirect to the home page on this case.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/295",
          "labels": [
            "UI Issue"
          ],
          "comments": [
            {
              "body": "not going to home but displaying something useful now",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:17:13Z"
            }
          ]
        },
        {
          "summary": "Fix and upgrade test instance",
          "key": "KEA-296",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Right now the test instance of Kea is down.\nThe celery executable is missing and there appear to be various things wrong.\n\nWe will also upgrade things as necessary.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/296",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Add KnownName to table pndata_person",
          "key": "KEA-297",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Needed as a user readable foreign key in provenance tables.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/297",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Grape and Wine provenance changes: clones and vineyard people",
          "key": "KEA-298",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Marc wants:\n- the variety to be directly attached to vineyard block. Not just via clone. Because clone should be nullable but variety should not.\n- there should be people attached to vineyards. Not just on company.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/298",
          "labels": [
            "Provenance"
          ],
          "comments": []
        },
        {
          "summary": "Ensure that tastypie and its \"Friends\" are in the autoinstall for Kea",
          "key": "KEA-299",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need the tastpie API stuff to be in the automatic config stuff for Kea.\n\nRight now we are using buildout so let's get the stuff in there.\nSo the modules are:\n- django-tastypie 0.13.3\n- python-mimeparse 1.5.1\n- defusedxml 0.4.1\n- lxml 3.6.0\n- pyYAML 3.11\n\nPlease test the config to ensure it works.\n\nIn the meantime I will just be pip installing them.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/299",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "This is moot now as William used DjangoREST",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:26:07Z"
            }
          ]
        },
        {
          "summary": "Tweaks to Grape and Wine Provenance",
          "key": "KEA-300",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After some discussion with Marc Greven we have decided on some changes to the Grape and Wine Provenance:\n- A non-nullable Variety attribute should be added to the VineyardBlock table. Clone can give us the Variety but that should be nullable.\n- Vineyard needs a Contact attribute. As work is done at that level.\n- Need a \"Program\" table which will be linked to from Project as it will be the next level up of funding.\n- A new specimen table called \"Locus\" similar to TrialPlot\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/300",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Kea Form:api test from home",
          "key": "KEA-301",
          "status": "Done",
          "description": "Posted by Zane Gilmore (cflzjg) on the Issue Form in Kea\n\n---\n\nElephants are large mammals of the family Elephantidae and the order Proboscidea. Two species are traditionally recognised, the African elephant and the Asian elephant, although some evidence suggests ...\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/301",
          "labels": [],
          "comments": []
        },
        {
          "summary": "SampleExtract plates page empty",
          "key": "KEA-302",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I suspect that the query that defines this page is using a join to a table that now longer exists.\nSo I need to get it going against the new process tables.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/302",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "Changed stored function that defined the links etc to the process\n",
              "author": "zane.gilmore",
              "created": "2016-07-20T02:03:12Z"
            }
          ]
        },
        {
          "summary": "Sample plates not showing any process links",
          "key": "KEA-303",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I suspect that the query that defines this page is using a join to a table that now longer exists.\nSo I need to get it going against the new process tables.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/303",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "needed changes to a stored function\n",
              "author": "zane.gilmore",
              "created": "2016-07-20T02:02:09Z"
            }
          ]
        },
        {
          "summary": "Build usable security model for Kea API",
          "key": "KEA-304",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After some discussion we have decided to use a token based security model for Kea.\nWhere the user will go to a page on Kea and produce the \"magic number\" which can be copied and used for authentication by an API client.\n\nSome work to ensure that the present API endpoints are properly making use of this mechanism is also required.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/304",
          "labels": [
            "API",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I've committed the changes to this into a branch called api_token. The reason for this is I've recently switched over to debian (then ubuntu a week later... broken graphics drivers...) on my laptop and in order to easily do so I've needed to make my development environments more portable hence the switch to developing with docker. The advantage of this is that it takes minutes rather than hours to build myself a development environment from scratch. This change meant rather considerable changes to the repository structure so I branched it. This branch has vagrant stripped out replaced with docker and removed buildout to replace with pip. Feel free to take whatever you want from this branch but the pertinent code for this issue can be found in the commit referenced above.\n",
              "author": "will.buick",
              "created": "2016-07-11T04:55:32Z"
            },
            {
              "body": "This actually might fit in with the fact that we need to set up a brand new Kea instance on a new later version Centos box.\nI do have to admit that the present structure is a bit complex.\nI hope you have tried to reduce the complexity :-)\n\nDo you think that this might be applicable to the production instances?\ni.e. test and live.\n",
              "author": "zane.gilmore",
              "created": "2016-07-12T00:51:17Z"
            },
            {
              "body": "I've merged my changes into master and it should work. I see that you've done more work on the api since I've branched it. Your changes are still there but are disabled in the urls in favour of my own. All my work is in api.py where you now have api_crop_based, api_process and api_sample. I'll need to integrate that with what I've done. You should be able to test the api but the new changes that you've made to the api won't be available until I've merged the code properly.\n",
              "author": "will.buick",
              "created": "2016-07-12T04:54:36Z"
            },
            {
              "body": "Thank William.\nI think that the Docker stuff is probably a good move but we will need to\ntreat it as a separate project.\n\nOn 12 July 2016 at 16:54, wilbuick notifications@github.com wrote:\n\n> I've merged my changes into master and it should work. I see that you've\n> done more work on the api since I've branched it. Your changes are still\n> there but are disabled in the urls in favour of my own. All my work is in\n> api.py where you now have api_crop_based, api_process and api_sample. I'll\n> need to integrate that with what I've done. You should be able to test the\n> api but the new changes that you've made to the api won't be available\n> until I've merged the code properly.\n> \n> 窶能n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/PlantandFoodResearch/Kea/issues/304#issuecomment-231937071,\n> or mute the thread\n> https://github.com/notifications/unsubscribe/AAykogkpQ-Aa2cX_c76v-9pmKRlfUFEwks5qUx4NgaJpZM4I_pTc\n> .\n",
              "author": "zane.gilmore",
              "created": "2016-07-12T23:48:04Z"
            },
            {
              "body": "I have taken into account the following api notes\n\nhttps://github.com/PlantandFoodResearch/Kea/wiki/API-Notes\n\nThe following endpoints are done\n- samples\n- sample containers\n- crops\n- species\n- populations\n- plants\n- genotypes\n- locations\n- location types\n- processes - read only endpoint currently.\n- provenances\n- provenance specimens\n- all dynamic provenance models\n- sample batch initialisation for crops\n\nThe sample batch initialisation will need to be discussed to determine the best way to implement it and the provenance batch initialisation requires some thought because it's a multi step process which is more problematic to implement using an api.\n",
              "author": "will.buick",
              "created": "2016-08-04T01:23:34Z"
            },
            {
              "body": "Done but still need to put Kea on a TLS server",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:55:07Z"
            }
          ]
        },
        {
          "summary": "500 server error for a 'Split samples into plate' process",
          "key": "KEA-305",
          "status": "Done",
          "description": "I just tried to run the process 'Split samples into plate' on some kiwifruit samples in the test database. \n\nCreating the process run and adding the samples worked fine, but trying to run it produced a 500 server error. This didn't happen with the 'Move to 96-well plate' process.\n\nIncidentally, what should be entered into the 'To Plate' column in the process spreadsheet? Is this just a name (so that Kea knows which samples share a plate) that becomes an altName? Or does it have to be PlateIDs in Kea? And if so, how should we create the empty plates in Kea that the samples are being moved into?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/305",
          "labels": [],
          "comments": [
            {
              "body": "I got a 500 for the real database for 'Move to 96-well plate' too.\n",
              "created": "2016-07-03T22:55:11Z"
            },
            {
              "body": "I have just put in a change (which I have rolled out to test) to fix this.\nb14202c901ff35940859bc327479b28614141d1f\nThere have been a few problems caused by a refactor I did recently and some which are a bit older.\n",
              "author": "zane.gilmore",
              "created": "2016-07-11T01:50:28Z"
            },
            {
              "body": "Hi Zane,\n\nI haven't tested the 'Split samples into plate' process which gave me this error yet, but I just tried the 'Sex screening into plate' process run and got a 500 server error . This time I was able to create the process run and add the samples, and run the process, and download the spreadsheet  just fine. However, when I tried to upload the Excel file with the process run data in it, it first gave me an error message about the format of my date column, but after I fixed that and tried to re-upload the corrected spreadsheet it gave me the 500 server error.\n",
              "created": "2016-08-04T21:19:44Z"
            }
          ]
        },
        {
          "summary": "Apply Django permissions for API to tables",
          "key": "KEA-306",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Please apply the same Django user permissions to the database tables as the rest of Kea.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/306",
          "labels": [
            "API",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This has been done.\n",
              "author": "will.buick",
              "created": "2016-08-04T01:11:55Z"
            },
            {
              "body": "This stuff has been pretty much done now",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:26:53Z"
            }
          ]
        },
        {
          "summary": "multi-pop sample init' showing \"From multiple locations\" ",
          "key": "KEA-307",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "This SHOULD be be populations not locations.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/307",
          "labels": [
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "done in bccbb373152cf85e3032b7e30a0f4eb2a98c46f8\n",
              "author": "zane.gilmore",
              "created": "2016-07-20T01:57:27Z"
            }
          ]
        },
        {
          "summary": "Ebrida initialisation  giving \"broken pipe\" error",
          "key": "KEA-308",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When trying to upload an ebrida file for sample init the \"upload\" button dosn't do any thing except produce a \"broken pipe\" error on the log.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/308",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "It rurned this was a Samba directory with a spreadsheet file open elsewhere\n",
              "author": "zane.gilmore",
              "created": "2016-09-23T02:27:21Z"
            }
          ]
        },
        {
          "summary": "location selection for default location in multipop init empty",
          "key": "KEA-309",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The location selection pop up is empty when trying to choose default location for multi pop \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/309",
          "labels": [
            "Datagrid",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "Same for single population default location too.\n",
              "author": "zane.gilmore",
              "created": "2016-07-19T04:29:05Z"
            },
            {
              "body": "OK.\nThanks to William for the quick diagnosis here.\n\nIt turns out that this thing is still trying to use the Elastic search backend.\nSo we need to change the kea.locations.views.choose.py file to use the correct backend.\n",
              "author": "zane.gilmore",
              "created": "2016-07-19T04:31:47Z"
            },
            {
              "body": "Done in bccbb373152cf85e3032b7e30a0f4eb2a98c46f8\n",
              "author": "zane.gilmore",
              "created": "2016-07-20T01:56:59Z"
            }
          ]
        },
        {
          "summary": "change \"apply filter\" to \"Search\"",
          "key": "KEA-310",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the pop up in filter for datagrid change the button to \"Search\" from \"apply filter\"\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/310",
          "labels": [],
          "comments": [
            {
              "body": "done\n",
              "author": "zane.gilmore",
              "created": "2016-07-20T01:55:40Z"
            }
          ]
        },
        {
          "summary": "sample search is accessible without logging in",
          "key": "KEA-311",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The sample search page can be accessed without logging in.\nIt doesn't show plants or provenance but clicking on the sample status links shows everything\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/311",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Not sure what was happening here.\nIt seems to have been fixed.\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:18:23Z"
            }
          ]
        },
        {
          "summary": "go to page is not working in datagrid",
          "key": "KEA-312",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a page number is put into the page number field of the datagrid and the \"Go to page\"\nbutton is pressed, an empty page is returned.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/312",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "This appears to be working now.\nNot sure what was going on.\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:14:20Z"
            }
          ]
        },
        {
          "summary": "Kiwifuit plate data needs cleaning up",
          "key": "KEA-313",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Due to the EBrida batch creation bug where every sample was put into it's own plate, there are now hundreds of plates with only one sample in them.\n\nI'm not sure whether those samples a re still extant or they were just replaced after the bug was fixed.\nEither way we do need to tidy it all up.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/313",
          "labels": [
            "EBrida_interface",
            "question"
          ],
          "comments": []
        },
        {
          "summary": "Key error when trying to initialise samples in potato_auditing provenance",
          "key": "KEA-314",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I tried to initialise some samples in the new potato_auditing provenance I got a 500.\n\n```\nInternal Server Error: /provenance/batch/initialise/None/\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/handlers/base.py\", line 132, in get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 145, in inner\n    return func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/views/generic/base.py\", line 71, in view\n    return self.dispatch(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\", line 237, in dispatch\n    response = super(WizardView, self).dispatch(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 34, in _wrapper\n    return bound_func(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/decorators.py\", line 19, in _wrapped\n    return view_func(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\", line 30, in bound_func\n    return func.__get__(self, type(self))(*args2, **kwargs2)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/mixins.py\", line 20, in dispatch\n    request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/views/generic/base.py\", line 89, in dispatch\n    return handler(request, *args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\", line 686, in post\n    return super(NamedUrlWizardView, self).post(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\", line 293, in post\n    self.process_step(form))\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/views/initialisation.py\", line 147, in process_step\n    export_data = utils.export_provenance_definition(model)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/excel/utils.py\", line 31, in export_provenance_definition\n    worksheets.append(resource_class().export(queryset))\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/resource.py\", line 330, in export\n    headers = self.get_export_headers()\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/resource.py\", line 307, in get_export_headers\n    return super(KeaModelResource, self).get_export_headers()\n  File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/resources.py\", line 439, in get_export_headers\n    headers = [force_text(field.column_name) for field in self.get_fields()]\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/provenance/resource.py\", line 474, in get_fields\n    field=model_field, **widget_kwargs))\n  File \"/home/keaapp/.virtualenvs/kea/src/django_import_export/import_export/widgets.py\", line 212, in __init__\n    self.model = kwargs['django_field'].rel.to\nKeyError: u'django_field'\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/314",
          "labels": [
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "Now when I try to upload a spreadsheet in the sample init wizard I get this:\n\n```\n\nTraceback:\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/core/handlers/base.py\" in get_response\n  132.                     response = wrapped_callback(request, *callback_args, **callback_kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\" in inner\n  145.                     return func(*args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/views/generic/base.py\" in view\n  71.             return self.dispatch(request, *args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\" in dispatch\n  237.         response = super(WizardView, self).dispatch(request, *args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\" in _wrapper\n  34.             return bound_func(*args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/decorators.py\" in _wrapped\n  19.         return view_func(request, *args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\" in bound_func\n  30.                 return func.__get__(self, type(self))(*args2, **kwargs2)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/views/mixins.py\" in dispatch\n  20.             request, *args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/views/generic/base.py\" in dispatch\n  89.         return handler(request, *args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\" in post\n  686.         return super(NamedUrlWizardView, self).post(*args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/django_formtools-1.0-py2.7.egg/formtools/wizard/views.py\" in post\n  290.         if form.is_valid():\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\" in is_valid\n  184.         return self.is_bound and not self.errors\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\" in errors\n  176.             self.full_clean()\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\" in full_clean\n  392.         self._clean_fields()\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/forms/forms.py\" in _clean_fields\n  410.                     value = getattr(self, 'clean_%s' % name)()\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/forms/initialisation.py\" in clean_spreadsheet\n  94.         return validate_spreadsheet(self, self.cleaned_data['spreadsheet'])\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/forms/validators.py\" in validate_spreadsheet\n  43.             form.model, default_excel_storage.path(filename))\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/provenance/excel/utils.py\" in import_provenance_definition\n  85.             dataset, dry_run=dryrun, raise_errors=raise_errors)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/utils/decorators.py\" in inner\n  145.                     return func(*args, **kwargs)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/transaction.py\" in __exit__\n  216.                             connection.savepoint_commit(sid)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/base/base.py\" in savepoint_commit\n  264.         self._savepoint_commit(sid)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/base/base.py\" in _savepoint_commit\n  218.             cursor.execute(self.ops.savepoint_commit_sql(sid))\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/utils.py\" in execute\n  79.             return super(CursorDebugWrapper, self).execute(sql, params)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/utils.py\" in execute\n  64.                 return self.cursor.execute(sql, params)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/utils.py\" in __exit__\n  97.                 six.reraise(dj_exc_type, dj_exc_value, traceback)\nFile \"/home/zane/programming/virtenv/kea/eggs/Django-1.8.2-py2.7.egg/django/db/backends/utils.py\" in execute\n  62.                 return self.cursor.execute(sql)\nFile \"/home/zane/programming/virtenv/kea/src/kea/kea/core/db/backends/postgresql_psycopg2/base.py\" in execute\n  32.         return self.cursor.execute(operation, params)\n\nException Type: InternalError at /provenance/batch/initialise/select-items/\nException Value: current transaction is aborted, commands ignored until end of transaction block\n\n```\n",
              "author": "zane.gilmore",
              "created": "2016-07-22T00:51:13Z"
            },
            {
              "body": "After more research I have discovered it happens for the data import via the spreadsheet import in the provenance data admin as well.\n\nAfter removing the recursive foreign key in the potato_plant table it worked.\nSo our problem is definitely with that column and probably because of the recursive foreign key.\n",
              "author": "zane.gilmore",
              "created": "2016-07-22T02:23:20Z"
            }
          ]
        },
        {
          "summary": "Optional fields need error reports too for missing foreign keys",
          "key": "KEA-315",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When an optional field is filled in for a data import spreadsheet and that foreign key does not exist then we still want a missing error report on the confirmation page.\n\nApparently this does not happen right now.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/315",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "A start has been made on this in the import_export_validations branch. It removes the dependency on the forked version of django-import-export and uses modelforms to preform validation checks before importing data. It is a proof of concept only and will require more work to tidy things up.\n\nI've included a image showing how the validation checks look. The branch can be found here\n\nhttps://github.com/PlantandFoodResearch/Kea/tree/import_export_validations\n\n![2016-08-01-130729_3360x1080_scrot](https://cloud.githubusercontent.com/assets/1711526/17280816/94138068-57e9-11e6-84f3-84fe72d0fe63.png)\n",
              "author": "will.buick",
              "created": "2016-08-01T01:13:13Z"
            }
          ]
        },
        {
          "summary": "Add New Sample Doesn't",
          "key": "KEA-316",
          "status": "Done",
          "description": "I was trying to add a sample to a batch and the dialog objected to my entering a valid batch id (pasted) so I seem to have ended up with a zombie sample. The http://kea.pfr.co.nz/admin/pndata/sample/add/ dialog doesnt have any lookup in the batch field  which is suspicious\n\n![capture](https://cloud.githubusercontent.com/assets/268441/17159078/b34165da-53ee-11e6-903c-7184ccca2118.PNG)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/316",
          "labels": [
            "Sample Init",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Ye gods.\nThat form really needs work!\nLooks like we need to get a whole heap of stuff fixed on that.\n\nI suppose that adding samples is usually done via Sample Initialisation so this form has never been a priority.\n",
              "author": "zane.gilmore",
              "created": "2016-07-27T21:27:20Z"
            },
            {
              "body": "Don't add samples via this form :-)",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:15:15Z"
            }
          ]
        },
        {
          "summary": "Add __str__ methods to provenance models",
          "key": "KEA-317",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "So that chosen foreign keys can be shown correctly in forms we need to add **str**() methods to models.\n\nTim, perhaps you could go through the provenance models and add these.\n\nIn the grape_and_wine provenance there are a few already done.\nTrial and Trialplot have one each.\n\nSome of them also have **idstr** but don't worry about that for now.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/317",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Yup, I'll get onto it.\n",
              "author": "tim.millar",
              "created": "2016-07-27T04:19:21Z"
            },
            {
              "body": "@zanejg can you explain more specifically how the `__str__` method will be used in this context?\ni.e. why did you choose to format these specific attributes in `grape_and_wine.Trialplot`?:\n\n```\n__str__(self):\n        return \"{0} Field#{1} Trial:{2}\".format(self.plot_identifier,\n                                                self.trial_plot_number,\n                                                self.trial)\n```\n\nIs the string meant to be a summary of that instance of the entity?\n\nAlso should we be creating a `__str__` method for all classes or just those that are referenced as a foreign key?\n",
              "author": "tim.millar",
              "created": "2016-07-28T04:28:38Z"
            },
            {
              "body": "One of the main uses of this method is to display something sensible when one of these entities is chosen from a drop-down or similar.\nSo ensure that you put a LocalID if there is one or the name column... that sort of thing.\n",
              "author": "zane.gilmore",
              "created": "2016-08-05T03:46:25Z"
            }
          ]
        },
        {
          "summary": "Print tray maps not working at file download",
          "key": "KEA-318",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the spreadsheet is downloaded \"file not found\" error is produced.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/318",
          "labels": [
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Turns out that the filename was all screwed up because there was a tab in an altname for the population.\nThis put a tab into the filename and made it impossible for anything to find it.\nSo now this issue morphs into the requirement for proper stripping of input for altnames.\n",
              "author": "zane.gilmore",
              "created": "2016-07-29T03:13:01Z"
            },
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:14:30Z"
            }
          ]
        },
        {
          "summary": "Populations not listed as proper LocalIDs in multi-population spreadsheet",
          "key": "KEA-319",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the new format for the multiple population spreadsheet the populations are being listed as a large number not as their LocalIDs.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/319",
          "labels": [
            "Sample Init",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Can't run server after pulling new api code",
          "key": "KEA-320",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "I can't start the server after pulling the master branch yesterday.\nThe new dependencies (crispy_forms and rest api) installed without issue. and I removed `.pyc` files.\n\n@wilbuick, any ideas?\n\nboth `django migrate` and `django runserver` fail with:\n\n```\nTraceback (most recent call last):\n  File \"/home/kea/Kea/bin/django\", line 95, in <module>\n    sys.exit(djangorecipe.binscripts.manage('kea.settings.development'))\n  File \"/home/kea/Kea/eggs/djangorecipe-2.1.2-py2.7.egg/djangorecipe/binscripts.py\", line 9, in manage\n    management.execute_from_command_line(sys.argv)\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 338, in execute_from_command_line\n    utility.execute()\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 312, in execute\n    django.setup()\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/__init__.py\", line 18, in setup\n    apps.populate(settings.INSTALLED_APPS)\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/apps/registry.py\", line 115, in populate\n    app_config.ready()\n  File \"/home/kea/Kea/eggs/django_debug_toolbar-1.4-py2.7.egg/debug_toolbar/apps.py\", line 15, in ready\n    dt_settings.patch_all()\n  File \"/home/kea/Kea/eggs/django_debug_toolbar-1.4-py2.7.egg/debug_toolbar/settings.py\", line 228, in patch_all\n    patch_root_urlconf()\n  File \"/home/kea/Kea/eggs/django_debug_toolbar-1.4-py2.7.egg/debug_toolbar/settings.py\", line 216, in patch_root_urlconf\n    reverse('djdt:render_panel')\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/urlresolvers.py\", line 550, in reverse\n    app_list = resolver.app_dict[ns]\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/urlresolvers.py\", line 352, in app_dict\n    self._populate()\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/urlresolvers.py\", line 285, in _populate\n    for pattern in reversed(self.url_patterns):\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/urlresolvers.py\", line 402, in url_patterns\n    patterns = getattr(self.urlconf_module, \"urlpatterns\", self.urlconf_module)\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/core/urlresolvers.py\", line 396, in urlconf_module\n    self._urlconf_module = import_module(self.urlconf_name)\n  File \"/usr/lib/python2.7/importlib/__init__.py\", line 37, in import_module\n    __import__(name)\n  File \"/home/kea/Kea/src/kea/kea/urls/development.py\", line 28, in <module>\n    url(r'', include('kea.urls.base')),\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/conf/urls/__init__.py\", line 33, in include\n    urlconf_module = import_module(urlconf_module)\n  File \"/usr/lib/python2.7/importlib/__init__.py\", line 37, in import_module\n    __import__(name)\n  File \"/home/kea/Kea/src/kea/kea/urls/base.py\", line 183, in <module>\n    (r'^api/', include('kea.api.urls')),\n  File \"/home/kea/Kea/eggs/Django-1.8.2-py2.7.egg/django/conf/urls/__init__.py\", line 33, in include\n    urlconf_module = import_module(urlconf_module)\n  File \"/usr/lib/python2.7/importlib/__init__.py\", line 37, in import_module\n    __import__(name)\n  File \"/home/kea/Kea/src/kea/kea/api/urls.py\", line 4, in <module>\n    from kea.api.views import *\n  File \"/home/kea/Kea/src/kea/kea/api/views/__init__.py\", line 1, in <module>\n    from .crop import *\n  File \"/home/kea/Kea/src/kea/kea/api/views/crop.py\", line 36, in <module>\n    class CropFilter(FilterSet):\nTypeError: Error when calling the metaclass bases\n    cannot create 'NoneType' instances\n\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/320",
          "labels": [
            "API"
          ],
          "comments": [
            {
              "body": "I think you're missing this package. Install it if you haven't already.\n\nhttps://pypi.python.org/pypi/django-filter\n",
              "author": "will.buick",
              "created": "2016-08-09T22:16:42Z"
            },
            {
              "body": "That was it thanks!\n",
              "author": "tim.millar",
              "created": "2016-08-09T22:33:05Z"
            }
          ]
        },
        {
          "summary": "POST Samples,plants gentoypes and populations API endpoint needs to create new localids",
          "key": "KEA-322",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I try to post a new sample using the API, it returns an error complaining that it needs the localid.\n\nI am assuming that this also happens with plants and genotypes and populations.\n\nThese should not have the localids sent via the API. The localids should be left null and they should be generated. We should also send back the newly created localids as a return value.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/322",
          "labels": [
            "API",
            "bug"
          ],
          "comments": [
            {
              "body": "API changes are now in the branch found here\n\nhttps://github.com/PlantandFoodResearch/Kea/tree/api_write_access\n\nPopulations, Genotypes and Plants now all set LocalID's correctly.\n\nThese endpoints now also correctly restrict related (foreign key) querysets to the crop context provided in the url. These three endpoints should be safe to now provide write access. \n\nZane should review these endpoints to check if any further validation checks are required when creating records.\n\nThe sample and sample container endpoints are now read only. We may allow these endpoints to update (but not create). Further discussion is required to decide what fields should be editable in this case and what extra validation checks are required.\n\nThe current thinking is that creating samples and sample containers will be restricted to sample batch initialization only.\n\nThe provenance model endpoint is an automatically generated endpoint based on the model schema. As such it is not possible to have extra validation checks. If this becomes necessary then further work would be required to allow for this functionality.\n\nTake this provenance model endpoint as an example cereal_breeding.CerealPlant\n\nhttp://localhost:8000/api/provenance/5/model/213/\n\nThis endpoint allows posting data for the plant_localid field. Assuming that the localid fields should not be editable via the api the model schema would need to be changed to set editable=False (same as pndata local ids) on all localid fields.\n\nAll provenance models should be tested through this endpoint to ensure that the api behaves as expected.\n",
              "author": "will.buick",
              "created": "2016-08-11T05:04:09Z"
            },
            {
              "body": "Assuming we did this",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:14:07Z"
            }
          ]
        },
        {
          "summary": "Move samples process only applying the last location to all samples",
          "key": "KEA-323",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When different locations are entered for samples in the move sample process only the first location is applied to all of them.\n\nThis is potentially disastrous.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/323",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "Note to self:\nLook at processExcel.py lines 1880-1896\nThis is might be where the problem resides.\n\nAlso look at moveSampleFromProcRun function at line 2863\nparticularly in the else clause on line 2938\n",
              "author": "zane.gilmore",
              "created": "2016-09-14T05:12:36Z"
            },
            {
              "body": "After looking at this in more detail I believe I had it wrong.\nThings were happening correctly.\nThe samples that were getting the same location were all on plates.\nSo the location was being applied to the plate, which is correct.\n",
              "author": "zane.gilmore",
              "created": "2016-09-20T01:29:29Z"
            }
          ]
        },
        {
          "summary": "some provenance select popups are not populating",
          "key": "KEA-324",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The datagrids for selecting from some lookup tables are not populating and getting 500 errors.\nNotably the vintage one.\n\nThis is happening in the forms for entering data the one where this was discovered was for start_season in the trial_plot entry form.\n\nAnother entity that's doing this is clone. (see the vineyard_block entry form)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/324",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Move bays and rows from trial_plot to vine in grape and wine prov",
          "key": "KEA-325",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It has become apparent that trial_plots should not have the bay and row in them as attributes.\n\nTrial_plots could have vines across multiple bays and rows.\nSo the entity that needs these attributes should be vine.\n\nThe exact attributes/columns are \"bay_of_row\" and \"vineyard_row\"\nand they should be moved to the Vine table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/325",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "PR #332 \n",
              "author": "tim.millar",
              "created": "2016-08-18T02:23:49Z"
            }
          ]
        },
        {
          "summary": "Vine needs to be a specimen table.",
          "key": "KEA-326",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Please set up the Vine table as a specimen table.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/326",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "PR #332\n",
              "author": "tim.millar",
              "created": "2016-08-18T02:24:13Z"
            }
          ]
        },
        {
          "summary": "Kea Initialise eBrida  Broken",
          "key": "KEA-327",
          "status": "Done",
          "description": "Spreadsheets that previously worked now fail with initialise eBrida\n\n```\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 240, in trace_task\n    R = retval = fun(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 438, in __protected_call__\n    return self.run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/celery/tasks/logging.py\", line 52, in run_decorator\n    func_output = self.wrapped_run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/tasks.py\", line 53, in initialise_ebrida_samples\n    stdout=out)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 120, in call_command\n    return command.execute(*args, **defaults)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 441, in execute\n    output = self.handle(*args, **options)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 619, in handle\n    label_output = self.handle_label(label, **options)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 285, in handle_label\n    self.create_batch_spreadsheet()\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 351, in create_batch_spreadsheet\n    create_spreadsheet(SampleBatchSpreadsheet, context, filepath)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/utils/spreadsheet.py\", line 8, in create_spreadsheet\n    spreadsheet.create()\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/excel/helpers.py\", line 97, in create\n    self.create_sheets(self.context)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/batch/excel/batch.py\", line 79, in create_sheets\n    self.create_data_sheet(context)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/batch/excel/batch.py\", line 155, in create_data_sheet\n    if context['population_as_column'] is True:\nKeyError: 'population_as_column'\n```\n\nIs there a test spreadsheet somewhere????\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/327",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "These worked previously\n\n[keainit.xlsx](https://github.com/PlantandFoodResearch/Kea/files/417360/keainit.xlsx)\n[rJL_297init.xlsx](https://github.com/PlantandFoodResearch/Kea/files/417361/rJL_297init.xlsx)\n",
              "created": "2016-08-15T00:15:22Z"
            },
            {
              "body": "Populations as column doesn't appear to be working\n",
              "author": "zane.gilmore",
              "created": "2016-08-15T04:45:49Z"
            },
            {
              "body": "It does work you just need to restart celery so the python code gets reloaded.\n",
              "author": "will.buick",
              "created": "2016-08-15T04:54:31Z"
            },
            {
              "body": "I am not sure what you mean. I started supervisord then restarted it on my dev box.\nHow else do I restart celery?\n",
              "author": "zane.gilmore",
              "created": "2016-08-15T05:06:04Z"
            },
            {
              "body": "bin/supervisorctl stop celery\nbin/supervisorctl start celery\n\nAre you sure you're on the right branch? I got caught out by forgetting to restart celery which is why I mentioned it. It wasn't working for me until I did now it works fine.\n",
              "author": "will.buick",
              "created": "2016-08-15T05:08:40Z"
            },
            {
              "body": "That's interesting \nbin/supervisorctl restart all\ndidn't work.\nBut the explicit stopping and start did.\nI believe you now... it does work  :-)\n",
              "author": "zane.gilmore",
              "created": "2016-08-15T05:15:58Z"
            }
          ]
        },
        {
          "summary": "500 server error for a 'Split samples into plate' process",
          "key": "KEA-328",
          "status": "Done",
          "description": "Sorry, don't have permission (or was possibly too stupid...) to reopen the old issue...\n\nI just tried to run the 'Split samples into plate' process in the test database and it throws a server 500 error.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/328",
          "labels": [],
          "comments": [
            {
              "body": "Is this still an error?\n",
              "author": "zane.gilmore",
              "created": "2016-09-14T00:08:24Z"
            },
            {
              "body": "I think that this was fixed.\nIt was a process refactor issue\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:12:15Z"
            }
          ]
        },
        {
          "summary": "500 server error when deleting stuff in the admin page",
          "key": "KEA-329",
          "status": "To Do",
          "description": "I just tried to delete a mistakenly created genotype via the admin page. After it asked me if I was sure, it threw a 500 server error.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/329",
          "labels": [
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This may be a relatively difficult one to address.\nI am guessing you were generating a badly handled DB referential integrity error.\nWe would have to handle a cascading delete so it may take a while to code.\n",
              "author": "zane.gilmore",
              "created": "2016-09-14T00:07:19Z"
            },
            {
              "body": "Just had a thought that we can, at least, handle it more gracefully with a meaningful error message.",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:53:50Z"
            }
          ]
        },
        {
          "summary": "Bulk upload of Plant Altnames",
          "key": "KEA-330",
          "status": "Done",
          "description": "I understand it's possible to upload a spreadsheet of plant altnames using the Upload Plant Locations command from the Initialise Samples menu. However, this requires that one adds plant locations too. It should also be possible to upload a spreadsheet containing only plant altnames.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/330",
          "labels": [
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I have had a quick look at this and it seems that you re replacing the existing altnames if the altname already exists\nI think we need to just add the new one without deleting the old ones.\n\nIf we want to ensure that a plant only has one altname of any given type then we need to add the altname type choice drop-down to the upload form and a tickbox to say whether they want to replace one that already exists returning an error message if they don't and it does exist.\n",
              "author": "zane.gilmore",
              "created": "2016-10-04T22:46:05Z"
            },
            {
              "body": "William.\nHave you done this?\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:10:45Z"
            },
            {
              "body": "Not yet\n",
              "author": "will.buick",
              "created": "2016-10-20T22:14:45Z"
            }
          ]
        },
        {
          "summary": "Need to Have Multipopulation Plate Layouts Sorted as Block Layout",
          "key": "KEA-331",
          "status": "Done",
          "description": "re enhancements in https://github.com/PlantandFoodResearch/Kea/commit/285bd5a8fa9f9bface615839c58eaf6dcb531000\n\nFollowing discussions with @mareikek ..\nSquare sheet formats with \"Populations as column\"  option look good but we need plate layout to mirror sheet layout \n\ni.e. Samples ordering should be in order\n1. Block\n2. Row\n3. Bay\n4. Position\n\nregardless of populations\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/331",
          "labels": [
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Also please display barcode/location in plate layout sheet!\n",
              "created": "2016-08-25T01:57:16Z"
            },
            {
              "body": "I am thinking that perhaps some sort of report is in order. This means we can have a bit more flexibility.  What will definitely be required is for the locations to be put in before the spreadsheet is produced\n",
              "author": "zane.gilmore",
              "created": "2016-08-25T22:14:43Z"
            },
            {
              "body": "Hi gang,\nJust to clarify, there are three issues here:\n1/ The trees are labelled with what Kea calls AltNames and not with Kea LocalIDs. Therefore, the platesheets or sample lists should contain these in addition to or instead of Kea LocalIDs so we know what we're meant to be collecting.\n2/ The sample information should be sorted in the order the plants appear in the field so that the collectors don't have to walk back and forwards up the same rows. This will drastically decrease the time required for the harvests.\n3/ The samples should be collected in the order they will go into the plates. That is, we can't just leave the assigned plates and wells as they are and order the collection sheets by tree location because although this will deal with the previous problem, it will mean that for example the first sample should be collected into Plate 1, well D6; the second into Plate 3, well E9; etc., which increases the chance of error. Therefore the samples should be ordered by orchard position and then assigned plates and wells in that order.\nThe orchard positions look like \"TP14.34-17-06c\".\nTP - Te Puke site\n14 - I think this means planted in 2014, so it can be ignored.\n34 - block 34\n17 - row 17\n06 - bay 6\nc - the third plant in bay 6\nThere are typically about six trees in each bay, but I've seen it go up to i.\nPlease point out where I've misunderstood.\n",
              "created": "2016-09-09T05:12:39Z"
            },
            {
              "body": "Exact same issues with initialise eBrida\n\nSent from my iPhone\n\nOn 9/09/2016, at 5:16 PM, mcvmcv <notifications@github.com<mailto:notifications@github.com>> wrote:\n\nHi gang,\nJust to clarify, there are three issues here:\n1/ The trees are labelled with what Kea calls AltNames and not with Kea LocalIDs. Therefore, the platesheets or sample lists should contain these in addition to or instead of Kea LocalIDs so we know what we're meant to be collecting.\n2/ The sample information should be sorted in the order the plants appear in the field so that the collectors don't have to walk back and forwards up the same rows. This will drastically decrease the time required for the harvests.\n3/ The samples should be collected in the order they will go into the plates. That is, we can't just leave the assigned plates and wells as they are and order the collection sheets by tree location because although this will deal with the previous problem, it will mean that for example the first sample should be collected into Plate 1, well D6; the second into Plate 3, well E9; etc., which increases the chance of error. Therefore the samples should be ordered by orchard position and then assigned plates and wells in that order.\nThe orchard positions look like \"TP14.34-17-06c\".\nTP - Te Puke site\n14 - I think this means planted in 2014, so it can be ignored.\n34 - block 34\n17 - row 17\n06 - bay 6\nc - the third plant in bay 6\nThere are typically about six trees in each bay, but I've seen it go up to i.\nPlease point out where I've misunderstood.\n\n窶能nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/PlantandFoodResearch/Kea/issues/331#issuecomment-245821174, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AAQYmY6a17CgfNOUbhCYhlOydL8uo8iFks5qoOrHgaJpZM4Jl76s.\n\nThe contents of this e-mail are confidential and may be subject to legal privilege.\n If you are not the intended recipient you must not use, disseminate, distribute or\n reproduce all or any part of this e-mail or attachments.  If you have received this\n e-mail in error, please notify the sender and delete all material pertaining to this\n e-mail.  Any opinion or views expressed in this e-mail are those of the individual\n sender and may not represent those of The New Zealand Institute for Plant and\n Food Research Limited.\n",
              "created": "2016-09-09T05:57:14Z"
            },
            {
              "body": "Is that TPxxx number the EBrida barcode?\n",
              "author": "zane.gilmore",
              "created": "2016-09-12T23:29:30Z"
            },
            {
              "body": "It's not. I don't know what it's called in Ebrida sorry - it doesn't appear in the spreadsheets we usually get emailed for plate tray initialisation because they're still seedlings...\n",
              "created": "2016-09-12T23:36:55Z"
            },
            {
              "body": "Well we won't be able to sort samples by that number unless the number is there.\n\nWe will need to have some mechanism for getting those numbers attached to plants.\n",
              "author": "zane.gilmore",
              "created": "2016-09-13T00:58:50Z"
            },
            {
              "body": "Have started to work on this via #337.\n",
              "author": "zane.gilmore",
              "created": "2016-09-14T00:00:09Z"
            },
            {
              "body": "This has been coded but some debugging still required?",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:52:30Z"
            },
            {
              "body": "closing this now",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:12:00Z"
            }
          ]
        },
        {
          "summary": "Django not altering field from not-null to nullable correctly",
          "key": "KEA-333",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Field `trial_plot_id` of Table `grape_and_wine_vine` is notnull in the DB despite being set to `null=True` in `grape_and_wine/models.py`. \nThis does not seem to be picked up by `django makemigrations` and was not corrected by explicitly  adding a `migrations.AlterField` to grape and wine migration `0006_auto_20160817.py` (see PR #332)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/333",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Same as #347?",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:51:23Z"
            },
            {
              "body": "@zanejg yes I believe so",
              "author": "tim.millar",
              "created": "2016-12-14T21:27:43Z"
            }
          ]
        },
        {
          "summary": "Non normalised data in grape_and_wine",
          "key": "KEA-334",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Data is poorly normalised for grape and wine.\nThis is most obvious between the Bunch, Vine and TrialPlot entities:\n- A Bunch can come from a TrialPlot and/or a Vine\n- A Vine can have no TrialPlot or one that differs from its child Bunch\n- Both Vine and TrialPlot can have vineyard_row and bay_of_row (even if the Vine comes from a TrialPlot with differing row and bay)\n\nThese issues mainly stem from TrialPlot being a specimen table which is necessary for sampling methods in which single vines are not identified\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/334",
          "labels": [
            "Provenance",
            "wontfix"
          ],
          "comments": [
            {
              "body": "For now, I think we can ignore bunch.\nThe Vine TrialPlot thing I think we can live with for now.\nThe row and bay for the specimen, we can assume are the ones that will take precedence.\nIf this becomes a problem we can address it but right now let's not make more work for ourselves.\n",
              "author": "zane.gilmore",
              "created": "2016-09-13T23:58:39Z"
            },
            {
              "body": "Sounds good. I think the root issue is #348 and once we have started doing that the solution will be clearer.\n",
              "author": "tim.millar",
              "created": "2016-09-14T01:26:13Z"
            }
          ]
        },
        {
          "summary": "HarvestSample and TrialPlot LocalIDFields have the same prefix 'TP-'",
          "key": "KEA-335",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Harvest sample should have 'HS-' or similar for prefix\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/335",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed with PR #344 \n",
              "author": "tim.millar",
              "created": "2016-09-05T05:08:22Z"
            }
          ]
        },
        {
          "summary": "Kea INIT sheet layout for orchard locations",
          "key": "KEA-337",
          "status": "Done",
          "description": "Currently the location details are in order\n\n![image](https://cloud.githubusercontent.com/assets/268441/17953999/16d6883e-6acc-11e6-970d-f91ae5615800.png)\n\nthey  should be in Block Row Bay VineID order\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/337",
          "labels": [
            "EBrida_interface",
            "Location",
            "enhancement"
          ],
          "comments": [
            {
              "body": "See #331. A report will get this done quickly.\n",
              "author": "zane.gilmore",
              "created": "2016-08-25T22:16:33Z"
            },
            {
              "body": "After a long discussion with John I have finally worked out what is required here and it will take some development work from William and Hymmi to get done.\n\nHymmi's Shiny app that produces the spreadsheets for the EBrida Initialisation will need to have an extra column added to it called Plot Location.\n\nThe EBrida-file code in Kea to parse the upload file will need to be able to parse the locations as they are.\nSo we will need to asses whether the location conforms to the standard and if it doesn't then ignore it with an error.\nThen we will need to search for the pertinent location and if it does not exist then add it.\nThen the list of plants being listed in the spreadsheet will need to be sorted according to:\n1. block\n2. row\n3. bay\n4. vine\n\nThe list of plants in the data tab can then be in that order and the plate sequence can be added as before.\n",
              "author": "zane.gilmore",
              "created": "2016-09-13T23:13:30Z"
            },
            {
              "body": "This is an example of one of the locations we might expect.\n**T03.32-05-17c**\n- **T03.** The first 4 chars say the site and year of creation. In this case it means T for Te Puke and 2003. For our purposes we can ignore the year. The sites are T for Te Puke ( I think K for Kerikeri and M for Motueka but that needs confirmation)\n- **32** Denotes block number\n- **05** Is row number\n- **17** Is bay number\n- **c** Is the Vine id\n\nJohn could you please confirm this?\n",
              "author": "zane.gilmore",
              "created": "2016-09-13T23:36:15Z"
            },
            {
              "body": "added Plot Location column to the csv from the app @ [9196c9c](https://github.com/hymmikong/eBrida/commit/9196c9cfdf7d2ba2a2cd80a7e951ee5c0d2c40b4) :+1:\n",
              "author": "hymmi.kong",
              "created": "2016-09-14T02:08:14Z"
            },
            {
              "body": "as discussed today @jasi1986 ...lets check this out with red parent collections\n",
              "created": "2016-09-14T06:37:08Z"
            },
            {
              "body": "[Luis_Males4MarkerTesting_JS.xlsx](https://github.com/PlantandFoodResearch/Kea/files/471415/Luis_Males4MarkerTesting_JS.xlsx)\n\nis an example of collection planned by @jasi1986 and @luisgea for testing, exported from eBrida\n",
              "created": "2016-09-14T06:40:05Z"
            },
            {
              "body": "I've just tried this spreadsheet in keatest. There are a couple of problems:\n1/ There's a second sheet with some other information. Solved by deleting the second sheet.\n2/ The tree location is in the 'group' column, which Kea understands as the plate name, so each sample is harvested into its own plate.\n3/ There are a lot of different populations on the two plates. In this situation, we would want the option to not leave two empty wells between each population, but still have two empty wells at the start of each plate. The checkbox for empty wells does sets them both.\n",
              "created": "2016-09-14T21:35:02Z"
            },
            {
              "body": "Also, the 'From Ped. Item' column is a copy of the 'Pedigree Item' column - normally if the Pedigree Item is 'K10.0031.00586', the 'From Ped. Item' column will be 'K10.0031', which I think becomes a Kea Population AltName. So by importing this sheet, we end up with each plant in it's own population, despite what the 'breederCrCode' column says, or what the 'From Ped. Item' column would usually say.\n",
              "created": "2016-09-14T21:42:10Z"
            },
            {
              "body": "Ok so I just tried the following with the above file:\n1. Pasted the pedigree items into the app at http://shiny-dev.powerplant.pfr.co.nz/LookupLoc-eg/\n2. Selected **create kea init**  in single sample mode and exported the csv file which I saved  as \n\n[LuisMaleskeainit.xlsx](https://github.com/PlantandFoodResearch/Kea/files/473544/LuisMaleskeainit.xlsx)\n3. Uploaded this to **Initialise eBrida**\n4. Downloaded the file \n[ebrida_sample_batch_SaB10VS-20160915-100433.xlsx](https://github.com/PlantandFoodResearch/Kea/files/473547/ebrida_sample_batch_SaB10VS-20160915-100433.xlsx)\n\nSo as far as I can see the issues are:\n1. Kea is assigning each genotype to its own population as @mcvmcv has noted. \n2. The barcodes need to be accompanied by locations i.e. 'Group' in eBrida speak\n3. ...and the genotypes could then be sorted in data sheet by Block/Row/Bay/Position whether in single or plate collections and \n4. The plate ordering needs to be sorted in the same way\n",
              "created": "2016-09-14T22:11:26Z"
            },
            {
              "body": "I have updated the app to get the CrossName in the 'From Ped. Item' column. Hopefully will solve the individual population issue\n",
              "author": "hymmi.kong",
              "created": "2016-09-15T00:46:36Z"
            },
            {
              "body": " @jasi1986 can you comment please? \n",
              "created": "2016-09-15T03:55:06Z"
            },
            {
              "body": "I have written some changes to the upload facility.\nSo now I need a realistic example of the sort of data that this might be used for.\n\nCan someone please send me a list of genotypes that can be put into Hymmi's Shiny app so we can test things out?\n",
              "author": "zane.gilmore",
              "created": "2016-09-16T01:38:33Z"
            },
            {
              "body": "Try the list of genotypes in the first column of @jasi1986 and @luisgea s spreadsheet I added above. Note that ideally we would like to be able to generate init sheets from the barcodes, especially for post-collection Kea init  (like has happened already in this case) \n",
              "created": "2016-09-16T04:54:40Z"
            },
            {
              "body": "I just tried Initialise eBrida with the same sheet uploaded above. Sorting  good but the one improvement would be to order columns.\n\n```\nBlock | Row  | Bay Number | Vine ID\n```\n\ninstead of \n\n```\n| PlantID     | Sample ID | Population | Plant Alt Names | Collection Date | Plate No | Position on Plate(s) | Plant Location:Kiwifruit Orchard Vine | Row | Block | Vine ID | Bay Number | Plant Parent Location |\n```\n",
              "created": "2016-09-22T22:03:50Z"
            },
            {
              "body": "I also tried generating another sheet from barcodes as follows:\n\n```\n> barcodes\n [1] \"TP13B55|1263\"  \"TP13B54Z|1434\" \"TP13B54Z|1672\" \"TP13B54Z|1961\" \"TPCB16|0017\"   \"TPCB16|0021\"   \"TPCB16|0028\"   \"TPCB16|0042\"   \"TPCB16|0046\"   \"TPCB16|0047\"  \n[11] \"TPCB16|0048\"   \"TPCB16|0049\"   \"TPCB16|0052\"   \"TPCB16|0059\"   \"TPCB16|0060\"   \"TPCB16|0071\"   \"TPCB16|0076\"   \"TPCB16|0080\"   \"TPCB16|0084\"   \"TPCB16|0028\"  \n[21] \"TPCB16|0042\"   \"TPCB16|0048\"   \"TPCB16|0059\"   \"TPCB16|0071\"   \"TPCB16|0076\"   \"TPCB25|0141\"   \"TPCB25|0143\"   \"TPCB25|0157\"   \"TPCB25|0163\"  \n> ActR::createKeaInit(barcodes,export_csv = TRUE)\nOutput is exported to keainit.csv in /Users/cfljam\n   Pedigree Item Plot  LotId Group         Mother        Father       Barcode        BreederName       Synonyms From Ped. Item Start Date\n1  T13.54-50-13c 1434 164423        T07.42-04-15b T99.40-06-16c TP13B54Z|1434 Elizabeth Popowski           <NA> K11.0399.00041 2013-04-25\n2  T13.54-48-05a 1672 154073        T08.47-06-16a T06.45-07-01c TP13B54Z|1672 Elizabeth Popowski           <NA> K11.0413.00570 2013-04-25\n3  T13.54-47-12a 1961 154425        T08.47-06-16a T06.45-07-01c TP13B54Z|1961 Elizabeth Popowski           <NA> K11.0413.00922 2013-04-25\n4  T13.55-16-10f 1263 155833        T06.45-15-15a           M33  TP13B55|1263          Alan Seal           <NA> K11.0347.00050 2013-04-25\n5  T11.16-01-03f   17 724814       T01.12E-03-12c       CK51_09   TPCB16|0017               <NA>           <NA>  T07.56-05-05c 2015-10-05\n6  T11.16-01-04d   21 724818       T01.12E-01-17j       CK51_09   TPCB16|0021       Russell Lowe T06/RL/b56/A03  T07.56-06-08e 2015-10-05\n7  T12.16-01-06b   28 724825       T01.12E-07-11g       CK51_09   TPCB16|0028       Russell Lowe          MC341  T07.54-46-08b 2015-10-05\n8  T11.16-02-04a   42 724839       T01.12E-07-11g       CK51_09   TPCB16|0042       Russell Lowe           <NA>  T07.54-45-13b 2015-10-05\n9  T11.16-02-04e   46 724843       T01.12E-07-11g       CK51_09   TPCB16|0046       Russell Lowe           <NA>  T07.54-47-10i 2015-10-05\n10 T11.16-02-04f   47 724844       T01.12E-07-11g       CK51_09   TPCB16|0047       Russell Lowe           <NA>  T07.54-47-12a 2015-10-05\n11 T11.16-02-05a   48 724845       T01.12E-07-11g       CK51_09   TPCB16|0048       Russell Lowe           <NA>  T07.54-46-12f 2015-10-05\n12 T11.16-02-05b   49 724846       T01.12E-07-11g       CK51_09   TPCB16|0049       Russell Lowe           <NA>  T07.54-48-05a 2015-10-05\n13 T11.16-02-05e   52 724849       T01.12E-07-11g       CK51_09   TPCB16|0052       Russell Lowe           <NA>  T07.54-51-09j 2015-10-05\n14 T12.16-02-07a   59 724856       T01.12E-07-11g       CK51_09   TPCB16|0059       Russell Lowe          MC387  T07.54-50-11h 2015-10-05\n15 T12.16-02-07b   60 724857        T01.16-13-13d T94.30-01-11f   TPCB16|0060               <NA>           <NA>  T07.55-22-06j 2015-10-05\n16 T11.16-03-03a   71 724868       T01.12E-07-11g       CK51_09   TPCB16|0071       Russell Lowe           <NA>  T07.54-47-05i 2015-10-05\n17 T11.16-03-05a   76 724873       T01.12E-07-11g       CK51_09   TPCB16|0076       Russell Lowe           <NA>  T07.54-52-10g 2015-10-05\n18 T12.16-03-06e   80 724877       T01.12E-07-11g       CK51_09   TPCB16|0080               <NA>           <NA>  T07.54-50-13c 2015-10-05\n19 T12.16-03-07c   84 724881       T01.12E-07-11g T94.30-03-10f   TPCB16|0084       Russell Lowe           <NA>  T07.55-16-10f 2015-10-05\n20 T15.25-04-01c  141 733545       T01.12E-07-11g       CK51_09   TPCB25|0141       Russell Lowe           <NA>  T07.54-46-12f 2003-01-01\n21 T15.25-04-02a  143 733547       T01.12E-07-11g       CK51_09   TPCB25|0143       Russell Lowe           <NA>  T07.54-47-05i 2003-01-01\n22 T15.25-04-05c  157 733561       T01.12E-07-11g       CK51_09   TPCB25|0157       Russell Lowe          MC387  T07.54-50-11h 2003-01-01\n23 T15.25-04-07a  163 733567       T01.12E-07-11g       CK51_09   TPCB25|0163       Russell Lowe           <NA>  T07.54-52-10g 2003-01-01\n```\n\nand saved the output in \n[keainit_LuisRussellReds.xlsx](https://github.com/PlantandFoodResearch/Kea/files/488465/keainit_LuisRussellReds.xlsx)\n\nafter editing NAs to blank cells\n\nOn upload this threw the following errors:\n\n```\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 240, in trace_task\n    R = retval = fun(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 438, in __protected_call__\n    return self.run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/celery/tasks/logging.py\", line 52, in run_decorator\n    func_output = self.wrapped_run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/tasks.py\", line 58, in initialise_ebrida_samples\n    stdout=out)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 120, in call_command\n    return command.execute(*args, **defaults)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 441, in execute\n    output = self.handle(*args, **options)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 619, in handle\n    label_output = self.handle_label(label, **options)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 294, in handle_label\n    self.create_samples(sheet_data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 467, in create_samples\n    plant, genotype, population = self.create_pedigree_data(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 592, in create_pedigree_data\n    plant = self.get_or_create_plant(data, genotype, population)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 860, in get_or_create_plant\n    AltNameType=AltNameType.objects.get(Name='eBrida Barcode - %s' % self.crop))\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/manager.py\", line 127, in manager_method\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/query.py\", line 346, in create\n    obj = self.model(**kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/base.py\", line 468, in __init__\n    setattr(self, field.name, rel_obj)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/db/models/fields/related.py\", line 668, in __set__\n    (value, self.field.rel.to._meta.object_name)\nValueError: Cannot assign \"<Plant: Kiw1P2AR.00 >\": \"Plant\" instance isn't saved in the database.\n```\n",
              "created": "2016-09-22T22:09:04Z"
            },
            {
              "body": "This has mostly been done but now I have witnessed the issue of a new population being created for each plant.\nIt turned out that the data from the uploaded spreadsheet was bad.\n",
              "author": "zane.gilmore",
              "created": "2016-09-23T02:33:14Z"
            },
            {
              "body": "Can you please define **BAD** @zanejg ?\n\nWe want to collect these tomorrow and its throwing\n\n```\nValueError: Cannot assign \"<Plant: Kiw1P2AR.00 >\": \"Plant\" instance isn't saved in the database.\n```\n\n[Workbook9.xlsx](https://github.com/PlantandFoodResearch/Kea/files/492217/Workbook9.xlsx)\n",
              "created": "2016-09-26T04:32:53Z"
            },
            {
              "body": "This file for samples to be collected **NEXT WEEK** \n[KKB60.keainit.xlsx](https://github.com/PlantandFoodResearch/Kea/files/502013/KKB60.keainit.xlsx)\n\nThrows the above errors in Kea Test and in Kea Prod the following:\n\n```\nMultipleObjectsReturned: get() returned more than one Location -- it returned 2!\n```\n\nI have checked that locations & barcodes are unique\n",
              "created": "2016-09-30T01:47:34Z"
            },
            {
              "body": "@mareikek can you try to reproduce please\n",
              "created": "2016-09-30T01:51:07Z"
            },
            {
              "body": "My latest attempt on test with this file\n[TPBlock11MetabolomicsOct19_2016_keainit.xlsx](https://github.com/PlantandFoodResearch/Kea/files/549504/TPBlock11MetabolomicsOct19_2016_keainit.xlsx)\n\nthrew this error I fail to understand:\n\n```\nDoesNotExist: AltNameType matching query does not exist.\n```\n",
              "created": "2016-10-25T02:56:02Z"
            },
            {
              "body": "THis  now throws a new error in both test and production:\n\n```\nTraceback (most recent call last):\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 240, in trace_task\n    R = retval = fun(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/celery-3.1.18-py2.7.egg/celery/app/trace.py\", line 438, in __protected_call__\n    return self.run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/celery/tasks/logging.py\", line 52, in run_decorator\n    func_output = self.wrapped_run(*args, **kwargs)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/tasks.py\", line 58, in initialise_ebrida_samples\n    stdout=out)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/__init__.py\", line 120, in call_command\n    return command.execute(*args, **defaults)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 441, in execute\n    output = self.handle(*args, **options)\n  File \"/home/keaapp/.virtualenvs/kea/eggs/Django-1.8.2-py2.7.egg/django/core/management/base.py\", line 619, in handle\n    label_output = self.handle_label(label, **options)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 309, in handle_label\n    self.create_samples(sheet_data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 505, in create_samples\n    plant, genotype, population = self.create_pedigree_data(data)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 646, in create_pedigree_data\n    plant = self.get_or_create_plant(data, genotype, population)\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 1035, in get_or_create_plant\n    if data_row['pedigree item'] not in [ga.AltName for ga in gen_altnames]:\n  File \"/home/keaapp/.virtualenvs/kea/src/kea/kea/ebrida/management/commands/ebrida_import.py\", line 1035, in get_or_create_plant\n    if data_row['pedigree item'] not in [ga.AltName for ga in gen_altnames]:\n  File \"/home/keaapp/.python/2.7.6/lib/python2.7/bdb.py\", line 49, in trace_dispatch\n    return self.dispatch_line(frame)\n  File \"/home/keaapp/.python/2.7.6/lib/python2.7/bdb.py\", line 68, in dispatch_line\n    if self.quitting: raise BdbQuit\nBdbQuit\n\n```\n",
              "created": "2016-10-30T22:25:16Z"
            },
            {
              "body": "Oops.\nSorry John,\nThat was a set_trace I left in... The dev equivalent of leaving the forceps in after sewing up the patient :-(\n\nHave commented it out and pushed it up to test. \nTry again.\n",
              "author": "zane.gilmore",
              "created": "2016-10-31T01:06:10Z"
            },
            {
              "body": "Some of above issues were confusing test by trying to re-init an already init-ed population. \n\nHowever a futher issue has arisen https://github.com/PlantandFoodResearch/Kea/issues/377\n\nThink this one is sorted and we best moive in to more specific issues\n",
              "created": "2016-10-31T01:25:20Z"
            }
          ]
        },
        {
          "summary": "NZW number and Grapelink block ID",
          "key": "KEA-338",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Please add unique field to Vineyard.\n\"NZW_Num\" to vineyard: type char 7 , unique\n\nAnd \"Grapelink_BlockID\" to Vineyard Block:\ntype integer, unique\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/338",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Also make them nullable\n",
              "author": "zane.gilmore",
              "created": "2016-09-01T00:11:39Z"
            },
            {
              "body": "Fixed with PR #344 \n",
              "author": "tim.millar",
              "created": "2016-09-05T05:07:53Z"
            }
          ]
        },
        {
          "summary": "Save state of datagrids for each user and each datagrid",
          "key": "KEA-339",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "A user has suggested that they want datagrids to remember what ordering anfd page sizes etc they had set up for each datagrid.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/339",
          "labels": [
            "Datagrid",
            "UI Issue",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "reset search on datagrid defaulting to page size 10",
          "key": "KEA-340",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It should be defaulting to 50\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/340",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "I think this is fixed now",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:48:58Z"
            },
            {
              "body": "I was wrong this is defaulting to 10 again.\r\n",
              "author": "zane.gilmore",
              "created": "2017-02-07T20:00:50Z"
            },
            {
              "body": "This has already been fixed but not merged\r\n\r\nPlease see here\r\n\r\nhttps://github.com/PlantandFoodResearch/Kea/commit/0b78249929594780775752a8d12cf49704433115\r\n\r\nYour comment is incorrect. This fix does work. I've just tested this in my local dev to confirm.",
              "author": "will.buick",
              "created": "2017-02-07T23:44:55Z"
            }
          ]
        },
        {
          "summary": "Contact person m2m choice field in Company admin form not sorted",
          "key": "KEA-341",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "M2M fields will need to be sorted.\nIf there is any kind of decent number to choose from it is awful to find them without sorting.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/341",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "There are two ways to solve this problem and examples of both have been included in the commit.\n\nThe first is to set the default ordering of a model using the model Meta. An example of this is shown here. This option would need to be set per model as required.\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/d5963aa97dbc5f6732a96c0fc8d54bca79155586#diff-667531a35968de880a4bb78b757ce449R52\n\nThe second approach was to make all m2m fields use the datagrid select mechanism in the admin. The code for this can be seen here\n\nhttps://github.com/PlantandFoodResearch/Kea/commit/d5963aa97dbc5f6732a96c0fc8d54bca79155586#diff-cbb7a1134e0bc33f63e1cafa2b3dbe6dR137\n\nThe correct approach is most likely a combination of these two. The datagrid select solves the clunky multi select widget and the default ordering sets the ordering of the model anywhere it is used that doesn't explicitly set it's own order.\n",
              "author": "will.buick",
              "created": "2016-09-04T21:50:57Z"
            },
            {
              "body": "That looks good. \nHowever, I haven't had a chance to look at it. How do the selected values get displayed when looking at the entry for editing?\n",
              "author": "zane.gilmore",
              "created": "2016-09-13T23:53:45Z"
            },
            {
              "body": "I can't see any change in the Company admin form.\nThe same awful listbox thingy is being used and there doesn't appear to be a way of bringing up the datagrid.\nDid you do it on a branch I can't see?\n",
              "author": "zane.gilmore",
              "created": "2016-09-20T23:49:30Z"
            },
            {
              "body": "It's in the branch called issue_341. You should be able to see it there. See the links added above\n",
              "author": "will.buick",
              "created": "2016-09-21T00:36:54Z"
            }
          ]
        },
        {
          "summary": "vineyard row and bay of row on trial plot being highlighted yellow",
          "key": "KEA-342",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There appears to be an issue with the colour coding of the headers in the import spreadsheets for provenance tables.\n\nThe headers coloured yellow should be the non-nullable fields i.e. mandatory.\nThe vineyard row and bay of row fields on trial_plot are not mandatory and are being coloured yellow.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/342",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug",
            "invalid"
          ],
          "comments": [
            {
              "body": "I am unable to replicate this. My master branch is up to date and the column headers are not being coloured yellow.\n",
              "author": "will.buick",
              "created": "2016-09-04T22:02:52Z"
            },
            {
              "body": "Looks like a non-issue\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T21:31:22Z"
            }
          ]
        },
        {
          "summary": "EBrida imports date problem",
          "key": "KEA-343",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "EBrida changed their date format to a standard date format.\n\nIt now appears to be in dd/mm/yyyy format via a string.\nPlease make it work with this date format ASAP.\n\nSampling time is looming very soon for the Kiwifruit people.\n\nWilliam, please liase with Tim next week to get your fix rolled out to test instance.\n\nI can't attach xls files so will email it to you\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/343",
          "labels": [
            "EBrida_interface",
            "bug"
          ],
          "comments": [
            {
              "body": "The offending code is here\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/kea/ebrida/management/commands/ebrida_import.py#L570\n",
              "author": "zane.gilmore",
              "created": "2016-09-02T01:37:22Z"
            },
            {
              "body": "Hi Tim,\n\nZane is away next week and he wanted this fix to go out to the test site next week. He mentioned that I could talk you through the release process next week together with Eric. We would need to get Eric arrange ssh access for you to connect to the test server then I could go through the release process with you over hangout. What do you think?\n\nThanks,\n\nWilliam.\n",
              "author": "will.buick",
              "created": "2016-09-02T05:00:41Z"
            },
            {
              "body": "Hi Will, that sounds good. We can hopefully sort a time on Monday\nCheers,\nT.\n",
              "author": "tim.millar",
              "created": "2016-09-03T21:56:14Z"
            },
            {
              "body": "Any time Monday - Wednesday should be ok. We could use either google hangouts or skype if you don't have an account with google. That way we could screen share so I could see your terminal window. That would be the easiest way to do it I think.\n\nAre you able to get in touch with Eric and get him to provide you with ssh access to the kea test server? You will need that before you are able to get started. You will need ssh access and also access to the keaapp user to preform the release.\n\nThanks,\n\nWilliam.\n",
              "author": "will.buick",
              "created": "2016-09-04T21:07:43Z"
            },
            {
              "body": "@wilbuick, I've got access to the test server now, you should have a hangouts invite from me,\nT.\n",
              "author": "tim.millar",
              "created": "2016-09-04T22:54:08Z"
            }
          ]
        },
        {
          "summary": "Vineyard subregion is nullable but not blankable",
          "key": "KEA-345",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "@zanejg Is this correct? It effectively makes `sub_region` not null when entering data\n\n```\n    sub_region = models.ForeignKey(\n        \"pndata.Location\",\n        related_name=\"vineyard_location\",\n        unique=False,\n        to_field=\"Name\",\n        blank=False,\n        null=True)\n```\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/345",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed by @zanejg in: https://github.com/PlantandFoodResearch/Kea/commit/dfe3b07409a17154daea0167ad765d46cb76276a",
              "author": "tim.millar",
              "created": "2016-11-21T22:44:37Z"
            }
          ]
        },
        {
          "summary": "Kiwifruit provenance",
          "key": "KEA-346",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Create a provenance for Kiwifruit microbiome work.\nWorking with Sarah Thompson.\n\nStarted schema design in dia on branch [f/kiwifruit_microbiome_provenance](https://github.com/PlantandFoodResearch/Kea/tree/f/kiwifruit_microbiome_provenance)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/346",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Details to discuss with Sarah:\n- both vines and orchard_block have a rootstock option. I guess this is for flexibility but it is ideal if this information is only stored in one place (maybe in trial_plot?)\n- I reversed one-to-many relationships from cultivation_details because that makes more sense? I.e many orchard_blocks or trial_plots can have the same cultivation details.\n- There are several date specific fields in cultivation_details that make me think it should only connect to trial_plot as I imagine that orchard_blocks are more of a permanent entity.\n- Irrigation type is something that may change over time so it may be best to added it to cultivation_details instead of orchard_block.\n- several foreign keys that we're uncertain about marked in red in schema diagram \n",
              "author": "tim.millar",
              "created": "2016-09-06T04:27:04Z"
            },
            {
              "body": "It would be worth consulting more widely on this as most of the same logic should apply to sampling the plant tissue as well as whats living in or on it...",
              "created": "2017-08-14T03:45:35Z"
            }
          ]
        },
        {
          "summary": "Django migration can't convert database column to nullable",
          "key": "KEA-347",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "[Migration 0006](https://github.com/PlantandFoodResearch/Kea/blob/master/src/kea/provenance/grape_and_wine/migrations/0006_auto_20160817_1708.py) in the grape and wine provenance alters the attribute \"trial_plot\" (a foreign key) to nullable but running the migration does not alter the database column to nullable. Is this a known issue?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/347",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Tim and William need to talk together about this to try to nail it down.\n",
              "author": "zane.gilmore",
              "created": "2016-09-20T03:08:57Z"
            },
            {
              "body": "Seems attached to #353 ",
              "author": "zane.gilmore",
              "created": "2016-11-22T00:20:52Z"
            }
          ]
        },
        {
          "summary": "Documentaiton for Provenance Entities ",
          "key": "KEA-348",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "We need to start documenting the various entities in each provenance. \nThis has been a bit of a pain point when trying to get a provenance (grape and wine) to work for two or more use cases.\nConcepts like `trial_plot` and even `vineyard_block` have different meanings for different people and we need to ensure that different people use them in a similar (as similar as possible) manner. \nI know there is a technical writer working on docs but this is a problem for which we need end user input and this Fridays meeting \"Getting Wine and Grape data into Kea this season\" would be a good place to start.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/348",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Perhaps we should do it on the keawiki ( http://keawiki.pfr.co.nz )\nWe could create a another bunch of pages devoted to the documentation of each provenance.\nOr we could do it all in the Dia files and put them into the repo\nIf you can think of anything better, feel free to say.\n",
              "author": "zane.gilmore",
              "created": "2016-09-14T04:21:16Z"
            },
            {
              "body": "That seems like the best place. It needs to be user accessible \n",
              "author": "tim.millar",
              "created": "2016-09-14T04:24:26Z"
            }
          ]
        },
        {
          "summary": "BlindID column on Vineyard",
          "key": "KEA-349",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Another column on the Vineyard table.\nBlindID: 8 chars\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/349",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "@zanejg  BlindID or blind_identifier ? \n",
              "author": "tim.millar",
              "created": "2016-09-18T21:30:02Z"
            },
            {
              "body": "Already discussed BlindID so let's use that to avoid confusion.\n",
              "author": "zane.gilmore",
              "created": "2016-09-19T00:37:42Z"
            },
            {
              "body": "@zanejg I'm guessing this is unique nullable?\n",
              "author": "tim.millar",
              "created": "2016-09-19T01:24:24Z"
            },
            {
              "body": "Fixed in PR #354\n",
              "author": "tim.millar",
              "created": "2016-09-19T23:38:53Z"
            }
          ]
        },
        {
          "summary": "More columns for vineyard block",
          "key": "KEA-350",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Some more columns are needed for the vineyard block table:\n- row_range: 15 chars\n- bay_range: 15 chars\n- vines_per_bay: float\n- vine_spacing: float\n- row_spacing: float\n  All nullable and blankable.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/350",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "@zanejg  Should vines_per_bay be int our float?\n",
              "author": "tim.millar",
              "created": "2016-09-18T22:07:38Z"
            },
            {
              "body": "and do we want limitations on digits or decimal places?\n",
              "author": "tim.millar",
              "created": "2016-09-18T22:09:03Z"
            },
            {
              "body": "That float was the subject of a funny discussion.\nApparently there is at least one vintner(?) who has 4 vines in one bay then 5 in the next iterated over the entire block.\nNot sure whether the best way of denoting this is with a 4.5 but in the interests of keeping things simple this seemed like a good plan at the time.\nThis means that we could limit the decimal places to one but if they, for instance, decided to add an extra vine every 3 bays then... aaargh.\n\nLimit it to 2 decimal places and hope for the best.\n",
              "author": "zane.gilmore",
              "created": "2016-09-19T00:46:22Z"
            },
            {
              "body": "Cool. should I limit spacing? im not sure what measurement they are using\n",
              "author": "tim.millar",
              "created": "2016-09-19T01:15:24Z"
            },
            {
              "body": "Fixed in PR #354\n",
              "author": "tim.millar",
              "created": "2016-09-19T23:38:45Z"
            }
          ]
        },
        {
          "summary": "Skeleton spreadsheets and Excel dumps from admin interface columns not the same order",
          "key": "KEA-351",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "The files downloaded from the datagrids in the provenance admin interface for each table is not matching the column order for the skeleton spreadsheets for uploading data.\n\nThis is a major problem for data curation.\nI realise that I may have to fix this myself William but I may need some pointers on where to start.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/351",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This has been looked at and checked. VineyardBlocks and TrialPlots have been checked and the spreadsheet columns match up perfectly.\n",
              "author": "will.buick",
              "created": "2016-09-20T03:08:58Z"
            },
            {
              "body": "Just saw this:\r\nGo to trial plots.\r\nDo an excel dump of the datagrid\r\nNow go to the Excel import and do a download skeleton.\r\nTake note odf the order of the columns especially the \"Trials\" column.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2016-12-06T04:13:01Z"
            },
            {
              "body": "This still needs to be looked at",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:47:32Z"
            },
            {
              "body": "It looks like the position of any M2M columns are not being preserved.",
              "author": "zane.gilmore",
              "created": "2017-02-10T00:02:56Z"
            }
          ]
        },
        {
          "summary": "Rename dimension in the treatment table to factor",
          "key": "KEA-352",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It has been deemed that the name dimension is not appropriate.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/352",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Fixed in PR #354\n",
              "author": "tim.millar",
              "created": "2016-09-19T23:38:37Z"
            }
          ]
        },
        {
          "summary": "Grape and wine Trial description not nullable in database ",
          "key": "KEA-353",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Trial tables description field in grape_and_wine is nullable in models.py but not-nullable in the actual database. This is likely the same underlying issue as #347\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/353",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Done",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:46:35Z"
            }
          ]
        },
        {
          "summary": "Excel upload not doing updates",
          "key": "KEA-355",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the upload spreadsheet import for provenance data has data to be updated it doesn't work and just generates a database duplicate error.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/355",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Fixed",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:46:13Z"
            }
          ]
        },
        {
          "summary": "cascade identifiers being changed when they are used as foreign keys",
          "key": "KEA-356",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Because we are keeping foreign keys in the Provenance tables as their name columns etc to maximise usability.\nWe need to make it so that the user can change those Names on the tables and have the tables using that name to cascade the change.\n\nI realise that this is a non-trivial exercise but we will need to do something.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/356",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "William, please remember that the datagrids for the provenances will need to list the foreign key columns correctly too.\n",
              "author": "zane.gilmore",
              "created": "2016-10-05T01:17:19Z"
            },
            {
              "body": "It also needs to work with foreign keys point to tables outside of the provenance e.g. locations\n",
              "author": "tim.millar",
              "created": "2016-10-05T03:17:41Z"
            },
            {
              "body": "This is being addressed by #408 ",
              "author": "zane.gilmore",
              "created": "2017-02-10T00:01:22Z"
            },
            {
              "body": "Now moot.\r\nWe are now using proper IDs and translating them.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:02:47Z"
            }
          ]
        },
        {
          "summary": "Error reporting mechanism for eBrida uploads.",
          "key": "KEA-357",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "A way of reporting errors back from the celery task.\nAfter a discussion with William we will probably be using the logging mechanism.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/357",
          "labels": [
            "EBrida_interface",
            "UI Issue",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Firefox updates break Selenium tests",
          "key": "KEA-358",
          "status": "Done",
          "description": "To run Firefox, the Python Selenium library needs to have been released at around the same time. If we let Firefox stay current, we have to keep Selenium current too.\n\nHow do we want to handle this? Hold back Firefox, keep updating Selenium, or something else (like using a different browser)?\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/358",
          "labels": [
            "Testing",
            "wontfix"
          ],
          "comments": [
            {
              "body": "My local solution was to use Firefox ESR (Extended Support Release). That means I can keep using older Selenium versions for longer. Just another option to consider.\n",
              "created": "2016-10-05T00:04:40Z"
            }
          ]
        },
        {
          "summary": "Dates in provenance downloads are not compatible with the uploads.",
          "key": "KEA-359",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Because of the way that updates to Kea provenance data is done we need to ensure that the dates that are downloaded via the Datagrid \"Export to Excel\" for the provenance data is able to be uploaded via the \"Excel Import\"\n\nRight now the Datagrid data dump is converting the dates to a string a la YYYY-MM-dd.\nAnd the upload is not able to parse it to a date. \n\nSo we either have to make the upload able to parse it or make the download produce a date.\nIf I have to choose then the former is preferable, although both might be better as it is better to have the upload as flexible as possible and the download should try to preserve the data in a state that honours the original as perfectly as possible.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/359",
          "labels": [
            "Datagrid",
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "I couldn't replicate the datagrid dumping the date as YYYY-MM-dd. Perhaps this is related to a particular field/model. Perhaps you could point me at the particular datagrid that is causing the problem.\n\nIn regards to parsing of dates from excel import you should be able to configure the accepted formats by setting the DATE_INPUT_FORMATS and DATETIME_INPUT_FORMATS. Django provides default values for these but they can be added to the base settings file and customized. django-import-export which does the excel parsing uses those settings to parse the date.\n\nI can discuss this further with you next week if you like.\n",
              "author": "will.buick",
              "created": "2016-09-30T03:23:59Z"
            }
          ]
        },
        {
          "summary": "Add trial_plot_type to grape_and_wine",
          "key": "KEA-360",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Add trial_plot_type table to to grape_and_wine\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/360",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Fixed in #366\n",
              "author": "tim.millar",
              "created": "2016-10-07T08:54:48Z"
            }
          ]
        },
        {
          "summary": "Option for \"contact-trial\" or similar in grape and wine",
          "key": "KEA-361",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "From Marc:\n\"\"\"We now have contacts linked to company. As we discussed, we are dealing with big companies and running several trials (over time) with them with different people responsible. Can we change the link from contact-company to contact-trial or keep contact-company link and add contact-trial somewhere in 窶狼rials窶?\"\"\"\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/361",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Fixed in #366\n",
              "author": "tim.millar",
              "created": "2016-10-07T08:54:52Z"
            }
          ]
        },
        {
          "summary": "Program column on project",
          "key": "KEA-362",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to a add a new column to the Project table.\n\nProgram: char max 50 chars non-nullable.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/362",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Fixed in #366\n",
              "author": "tim.millar",
              "created": "2016-10-07T08:54:55Z"
            }
          ]
        },
        {
          "summary": "New Trial plot form not dealing with errors properly",
          "key": "KEA-363",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When data is left out the error is not being reported properly via the interface.\nThe exceptions do not appear to be captured properly and just producing a 500 .\n\nAlthough one exception being created does not appear to be correct in the case we saw.\nThe message was for a missing localid field that should have been auto generated.\n\nPerhaps that should be on a separate ticket.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/363",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "add company test check for company is not reliable",
          "key": "KEA-367",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The test in \"test_add_company\" starting at at line 381\nis not reliable because of the datagrid pagination.\n\nThe test was failing on my setup because the company was appearing on page 2.\nYou will have to either do a search first or  a sort on the column first. But perhaps if you just sort then a name like \"Aardvark Wines\" might be more appropriate.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/367",
          "labels": [
            "Testing"
          ],
          "comments": [
            {
              "body": "Datagrids are searched using the filter feature. The processing pane is now checked to be sure it is gone and the data are displayed before we try to grab them.",
              "created": "2016-12-12T02:51:18Z"
            }
          ]
        },
        {
          "summary": "Provenance LocalIDs need fixing",
          "key": "KEA-368",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There are some issues with LocalIDs that need to be addressed in the provenance stuff.\nWe should probably be using Postgres sequences etc.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/368",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I have made the necessary changes to use sequences for the provenance LocalID field and have written the migrations to update the existing localid fields. However I have hit a problem with creating new records in the database using the admin area.  It doesn't seem to be working and I haven't been able to figure out why just yet.\n",
              "author": "will.buick",
              "created": "2016-10-11T01:12:20Z"
            },
            {
              "body": "I have managed to solve the admin problem. Now records can be saved. This has been pushed to the issue_363 branch.\n",
              "author": "will.buick",
              "created": "2016-10-12T00:45:32Z"
            }
          ]
        },
        {
          "summary": "Many to many relationships not capturing errors for upload reports",
          "key": "KEA-369",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The error reports for missing many to many relationships is not being captured.\nThe uploads are going straight to 500 errors\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/369",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "See excel import branch\n",
              "author": "will.buick",
              "created": "2016-10-19T01:13:01Z"
            },
            {
              "body": "Relates to https://github.com/PlantandFoodResearch/Kea/issues/315\n",
              "author": "will.buick",
              "created": "2016-10-24T23:29:27Z"
            },
            {
              "body": "Fixed",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:45:20Z"
            }
          ]
        },
        {
          "summary": "Project SAP number to be expanded",
          "key": "KEA-370",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We will need to expand that SAP number to 20 chars.\nThere are already some that are 14 chars long\n\nAlso this column to be renamed as WBS_number\n\nPLEASE NOTE \nWait until we have applied the LocalID changes before we do this\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/370",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Fixed by @zanejg and renamed to 'WBS_number' in: https://github.com/PlantandFoodResearch/Kea/commit/b2b66c34e13b9ea9668178815490c5a8b84946fa",
              "author": "tim.millar",
              "created": "2016-11-21T22:49:45Z"
            }
          ]
        },
        {
          "summary": "Change Easting-Northing to Lat-Long in Vineyard Block",
          "key": "KEA-371",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The coordinates for the vineyard block need to be changed from Easting-Northing to Lat-Long\nThis just means changing the type from Decimal to char with 25 chars\n\nPLEASE NOTE \nWait until we have applied the LocalID changes before we do this\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/371",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Fixed by @zanejg in: https://github.com/PlantandFoodResearch/Kea/commit/b2b66c34e13b9ea9668178815490c5a8b84946fa",
              "author": "tim.millar",
              "created": "2016-11-21T22:52:42Z"
            }
          ]
        },
        {
          "summary": "Apply m2m to contacts from Vineyard and remove contact from trial",
          "key": "KEA-372",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After trying to apply some actual data Marc has found that there should be a list of contacts for a Vineyard.\nAnd the trial may be across many Vineyards so a contact would be irrelevant.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/372",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "Fixed by @zanejg in: https://github.com/PlantandFoodResearch/Kea/commit/b2b66c34e13b9ea9668178815490c5a8b84946fa",
              "author": "tim.millar",
              "created": "2016-11-21T22:54:26Z"
            }
          ]
        },
        {
          "summary": "Provenance Admin add entry form has bad breadcrumbs",
          "key": "KEA-373",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The form is showing the default Django admin breadcrumbs where we want the Provenance based breadcrumbs.\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/373",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Same as #253\n",
              "author": "zane.gilmore",
              "created": "2016-10-20T22:25:24Z"
            }
          ]
        },
        {
          "summary": "Initialised samples/plates not populating data grid",
          "key": "KEA-376",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Newly initialised samples and their containing plates do not populate data grid on the website (samples are in database). Tested with Potato auditing provenance. \n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/376",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "This should work now\n",
              "author": "zane.gilmore",
              "created": "2016-10-31T23:21:51Z"
            }
          ]
        },
        {
          "summary": "Parental Genotypes not propagated to AltNames on Init",
          "key": "KEA-377",
          "status": "Done",
          "description": "Following eBrida initialisation I note that parental genotypes appear in the comments but not in genotype altname\n\neg for  \nKiw1SAF5.01 http://kea.pfr.co.nz/plants/search/?queries%5BPlant+LocalID%5D=Kiw1SAF5.01&data_format=json\n\n![screen shot 2016-10-31 at 2 18 35 pm](https://cloud.githubusercontent.com/assets/268441/19841732/d953d31c-9f74-11e6-8f32-f718f1b08570.png)\n\nIn this case Kea picked up that this population was initiated earlier, reflected in the Population LocalID\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/377",
          "labels": [],
          "comments": [
            {
              "body": "Not sure what happened here but heaps of stuff has been done around it.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:01:58Z"
            }
          ]
        },
        {
          "summary": "Edit link no-go for Vineyards in grape and wine provenance",
          "key": "KEA-378",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the edit icon is clicked in the Vineyard list a 500 error is produced.\r\n```\r\nNoReverseMatch at /provenance/provedit/grape_and_wine/vineyard/497/\r\n```\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/378",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Editing a Vineyard reports existing null fields",
          "key": "KEA-380",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a Vineyard is edited and then saved then any unique but nullable field is then reported as already existing.\r\nThis looks like the problem with the Django making fields empty strings not nulls.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/380",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Does this relate to the import_export_validations branch?\n",
              "author": "will.buick",
              "created": "2016-11-02T23:10:53Z"
            },
            {
              "body": "No. We still need to keep that as a high priority but this problem seems unrelated.\n",
              "author": "zane.gilmore",
              "created": "2016-11-02T23:39:22Z"
            }
          ]
        },
        {
          "summary": "import_export branch issues",
          "key": "KEA-381",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "A catch-all for issues on the django-import-export update branch\r\nattached to #369 #315 ",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/381",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Upload not handling Vintage foreign key\n\nIt appears that the upload is not finding Vintages as foreign keys.\nAnd also there is an integer column (Trial plot number) that is not being dealt with as well.\n\nI am attaching the xlsx version of the file I found these with.\n[trialplots_20161104.xlsx](https://github.com/PlantandFoodResearch/Kea/files/574427/trialplots_20161104.xlsx)\n",
              "author": "zane.gilmore",
              "created": "2016-11-07T03:46:56Z"
            },
            {
              "body": "Uploading Trial plot types that already existed registered as errors not as updates.\nI uploaded the attached file and already had a few entered by hand.\nThose ones showed red and, of course, I could not upload it because of our earlier change to disallow uploading erroneous files.\nThese entries should be treated as updates not constraint violations.\n\n[trialplottype20161109.xlsx](https://github.com/PlantandFoodResearch/Kea/files/579386/trialplottype20161109.xlsx)\n",
              "author": "zane.gilmore",
              "created": "2016-11-08T21:08:41Z"
            },
            {
              "body": "Trial plots export and import file columns do not match.\nThe trials column is appended at the end for the downloaded file and is column D for the upload skeleton.\nThis is not a show stopper right now but we probably need to fix it in the long run.\nSo fix it if you can easily right now. But the previous bug is definitely a showstopper.\n",
              "author": "zane.gilmore",
              "created": "2016-11-08T21:33:23Z"
            },
            {
              "body": "I think we can close this now",
              "author": "zane.gilmore",
              "created": "2016-12-14T20:44:56Z"
            }
          ]
        },
        {
          "summary": "Edit trialplot trial popup showing trialplots",
          "key": "KEA-382",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When editing trialplots and the magnifying glass icon is clicked, the popup should show a list of all the trials to choose from.\r\n\r\nRight now the list being shown is for trialplots not trials.\r\nThis pop-up is for handling the many to many relationship between trials and trialplots.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/382",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I cannot replicate this issue. It is working correctly for me.\n",
              "author": "will.buick",
              "created": "2016-11-04T01:37:29Z"
            }
          ]
        },
        {
          "summary": "provenance uploads are doubling up the inserts",
          "key": "KEA-384",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Marc demo'ed this.\r\nHe uploaded a 1600 (approx) row file and ended up with over 3200 entries inserted.\r\nNot sure whether this is reproducible yet.\r\n\r\nAm attaching the xlsx version of the file he used.\r\n[trialplots_20161104.xlsx](https://github.com/PlantandFoodResearch/Kea/files/570536/trialplots_20161104.xlsx)\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/384",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I'm pretty sure that this turned out to be PEBKAC",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:01:04Z"
            }
          ]
        },
        {
          "summary": "Do not allow confirmation if there are missing entries",
          "key": "KEA-385",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Marc has found that entered locations in a Vineyard upload were left null when the location was not found.\r\n\r\nI suspect that they were probably reported on the confirmation page but the confirmation was allowed.\r\nIf this is true then we need to disable the conformation button when there are errors like this.\r\nOr perhaps have something like a warning saying \"Are you sure you want nulls where the entries can't be found?\"\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/385",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Need a marker for non-nullable fields in provenance entry form",
          "key": "KEA-386",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It needs to be obvious which fields are mandatory.\r\nThere is no way of telling which fields need to filled out.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/386",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "I have made a small change which provides this. Mandatory fields have a bold label and all others non bold. I have pushed this to the import_export_validations branch\n",
              "author": "will.buick",
              "created": "2016-11-08T04:44:28Z"
            },
            {
              "body": "I think we have done this now.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:00:18Z"
            }
          ]
        },
        {
          "summary": "Uploadable report file",
          "key": "KEA-387",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "A request has been made for an uploadable version of a report file.\r\nThe only way that this could really be done is to have the proper report as the first worksheet.\r\nThen a worksheet for each of the selected entities in the report so that any updates to the reported entities could be made easily.\r\n\r\nMy initial feeling about this is that it require a huge amount of work and I would like to see a a lot of support for it before even considering it.\r\nBTW this could possibly even be applicable to non-Provenance  based reports.\r\n\r\n ",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/387",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "Now part of provenances",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:59:41Z"
            }
          ]
        },
        {
          "summary": "500 error when initialising multi-population",
          "key": "KEA-388",
          "status": "Done",
          "description": "I just tried to initialise an apple multi-population sample batch and received a 500 server error.\r\n\r\nThis is on the live database, so all through the initialisation I had a normal Kea logo in the top right corner. The 500 page I got had \"DEVEL\" in pink text covering the logo, but the http://kea.pfr.co.nz/new-batch/initialise/finished/ (i.e. it should be the live database). I don't know if this is relevant.\r\n\r\nClicking look at samples and filtering for my samples shows the samples were not created.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/388",
          "labels": [],
          "comments": [
            {
              "body": "Applied on live server too.\n",
              "author": "zane.gilmore",
              "created": "2016-11-15T04:51:30Z"
            },
            {
              "body": "I just tried running it again and got the same fail. I suspected something from my previous failed attempt was stored in history or cached or something, so I tried in incognito mode as well and got the same error.\n",
              "created": "2016-11-15T19:30:50Z"
            },
            {
              "body": "Problem seems to be fixed. Great service A++ 10/10, would bug report again!\n",
              "created": "2016-11-16T03:18:09Z"
            }
          ]
        },
        {
          "summary": "A more efficient method for initialising samples",
          "key": "KEA-389",
          "status": "Done",
          "description": "Hi Kea dudes,\r\n\r\nSo I've just been initialising some samples for our annual(ish) apple harvest. This year it consists of two multi-population batches, each consisting of 20ish populations.\r\n\r\nThe data I receive in order to do this is a spreadsheet that looks something like:\r\n`Population | Mother               | Father               | Number`\r\n`AA0208      | A001R001T001 | A001R001T002 |        257`\r\n`AA0209     | A001R001T001 | A001R001T003 |        117`\r\n`...`\r\n\r\nwith one row per population, and one spreadsheet per sample batch. The Population column is to be a population altName; the Mother and Father columns are altNames of plants that may or may not exist in Kea, and may or may not have isParent = True; and the Number column is the number of plants in that population.\r\n\r\nCurrently to initialise these, I need to:\r\nMake a new list of unique parent altNames\r\nSearch Kea for plants by each altName, and check if each one exists\r\nIf a plant exists, check that it is isParents=TRUE\r\nIf it does not exist, create a genotype via the admin screen and add the altName, then create the plant via the admin screen and add the altName\r\nUsing the admin screen, create each population, each time searching the sample table for the parents and setting them as the parents, adding the population altNames; selecting the same Breeder and cross date every time.\r\nCreate the multi-population batch, selecting my new populations\r\nMake sure the generated spreadsheet lists them in the right order, and enter the number of plants for each population\r\n\r\nToday this has taken me over two hours so far. It strikes me that if I could just upload the above spreadsheet, and gave a bit of additional info like Breeder and Cross Date or whatever, the parents could be get_or_created or something, and isParent=TRUEed; and the populations created and given altNames; and the correct number of samples added automatically. And it would take about four seconds.\r\n\r\nSo my questions are:\r\n1. Is there currently a much quicker way to achieve all of this? (i.e. am I a moron?)\r\n2. Can I try to outsmart Kea somehow (probably not...) I mean can I manipulate this spreadsheet somehow to create a list of all the samples, and tell Kea it's an Ebrida spreadsheet and initialise it that way or something? (I'm guessing no, because the plants don't have Barcodes/LotIDs/PlotIDs/Locations/Social Security Numbers/EbridaPedigreeItems or whatever).\r\n3. Can something be added to Kea so that it understands this sort of spreadsheet?\r\n\r\nThanks,\r\nMike",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/389",
          "labels": [],
          "comments": [
            {
              "body": "Also,\n4. I can't seem to add labels to my issues.\n",
              "created": "2016-11-15T01:41:05Z"
            },
            {
              "body": "I think we have done this with the eBrida upload stuff",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:10:37Z"
            }
          ]
        },
        {
          "summary": "add vine_of_row to Vine specimen in grape_and_wine",
          "key": "KEA-390",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "vine_of_row is a number of the vine as counted from the start of the row",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/390",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "vine_of_bay not of row",
              "author": "tim.millar",
              "created": "2016-12-01T01:25:09Z"
            },
            {
              "body": "Added in #399",
              "author": "tim.millar",
              "created": "2016-12-01T02:20:35Z"
            }
          ]
        },
        {
          "summary": "Uploading existing Vineyards not dealing with blank NZW_number and blindID",
          "key": "KEA-391",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "As a test, I downloaded an \"Export to Excel\" file and copied the contents over to a newly downloaded skeleton file.\r\nThe confirm page then showed all of the empty entries for NZW_number and blindID as erroneous with the message \"\"Vineyard with that $$$ already exists\" ($$$ = column name)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/391",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Date fields not uploading",
          "key": "KEA-392",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The confirmation page is consistently not allowing date fields to be uploaded.\r\nIt always shows an error saying that the date format is wrong.\r\n\r\nFor the record:\r\nThis came to light in the Potato Auditing provenance on the Potato_Sack table.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/392",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "uploading potato sack without localid fails",
          "key": "KEA-395",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "This should be detected as a new sack.\r\nIt is just producing a 500.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/395",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Form based edit not giving save and close",
          "key": "KEA-397",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the save button is clicked in the insert form for provenances there should at least be a link back to the pertinent listings or separate buttons for save and close and save and insert another.\r\n\r\nI'm pretty certain that this has been in previous versions but somehow has been lost along the way\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/397",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "I think this may be my mistake.\r\nI was not looking at provenance insert forms but location inserts.\r\nApologies.\r\n",
              "author": "zane.gilmore",
              "created": "2016-11-30T20:55:49Z"
            },
            {
              "body": "OK this is not from the form based insert.\r\nIt's when you click the edit icon on the datagrid listing.\r\n\r\nI think we need to have a chat about the UI of this.\r\nRight now all that happens is that a message appears saying data successfully saved when the save button is clicked.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2016-12-07T20:47:11Z"
            }
          ]
        },
        {
          "summary": "Pagination does not work in combination with filter",
          "key": "KEA-398",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Tried on Test:\r\n* go to trialplot table in grape and wine\r\n* add filter `2011` to column vintage year\r\n* try to change page\r\n\r\nNote removing the filter will allow you to change page again",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/398",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Getting more done in GitHub with ZenHub",
          "key": "KEA-400",
          "status": "Done",
          "reporter": "guy.davenport",
          "description": "Hola! @guypfr has created a [ZenHub](http://www.zenhub.com) account for the **PlantandFoodResearch** organization. ZenHub is the only project management tool integrated natively in GitHub 窶 created specifically for fast-moving, software-driven teams.\n\n----\n\n#### How do I use ZenHub?\n\nTo get set up with ZenHub, all you have to do is **[download the browser extension](https://www.zenhub.com?utm_source=ZHOnboarding)** and log in with your GitHub account. Once you do, you窶冤l get access to ZenHub窶冱 complete feature-set immediately.\n\n#### What can ZenHub do?\n\nZenHub adds a series of enhancements directly inside the GitHub UI:\n\n- Real-time, customizable task boards for GitHub issues;\n- Multi-Repository burndown charts, estimates, and velocity tracking based on GitHub Milestones;\n- Personal to-do lists and task prioritization;\n- Time-saving shortcuts 窶 like a quick repo switcher, a 窶廴ove issue窶 button, and much more.\n\n### [Add ZenHub to GitHub](https://www.zenhub.com?utm_source=ZHOnboarding)\n\n_Still curious? See [more ZenHub features](https://www.zenhub.com/features?utm_source=ZHOnboarding) or read [user reviews](https://chrome.google.com/webstore/detail/zenhub-for-github/ogcgkffhplmphkaahpmffcafajaocjbd/reviews). This issue was written by your friendly ZenHub bot, posted by request from @guypfr._\n\n![ZenHub Board](https://cloud.githubusercontent.com/assets/8771909/11153956/233ac4a8-89f1-11e5-94b1-1569d3f38b4d.png)\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/400",
          "labels": [],
          "comments": [
            {
              "body": "PS, I am just testing ZenHub at the moment. This issue generated automatically for me during testing. I am going to close it now.",
              "author": "guy.davenport",
              "created": "2016-12-01T19:38:00Z"
            }
          ]
        },
        {
          "summary": "Confirmation list needs headers not scrolled",
          "key": "KEA-401",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "On the confirmation page after uploading a spreadsheet for a provenance entity.\r\nWe want the headers to remain when the confirmation list is displayed while the user scrolls through the list.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/401",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Datagrids not filtering on some columns",
          "key": "KEA-405",
          "status": "Done",
          "description": "Some datagrids (specifically the \"select location\" datagrid in sample initialisation) do not filter on some columns (\"location type\" for this grid) when exact matching text is entered (e.g. \"External Laboratory\"). All records are still shown. Adding a \"%\" makes the filter behave as expected (i,e, \"External Laboratory%\" shows only locations of type \"External Laboratory\").",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/405",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "I think we have nailed this now.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:09:14Z"
            }
          ]
        },
        {
          "summary": "Datagrid filter slow on some columns",
          "key": "KEA-406",
          "status": "Done",
          "description": "Some datagrid columns take a long time to filter. Example: Batch \"SaB1007\" in Browse Samples datagrid. Must search for \"SaB1007%\", due to #405.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/406",
          "labels": [
            "Datagrid"
          ],
          "comments": [
            {
              "body": "This will always be the case.\r\nWe have done work on specific cases but there always be some depending on the SQL",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:08:28Z"
            }
          ]
        },
        {
          "summary": "Apply LotIDs to eBrida uploads that were missing them",
          "key": "KEA-407",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Between the time that I did the dump to find the plants etc for applying the LotIDs and the time that I applied them there were some eBrida uploads that did not have LotIDs. From what Mike McVeigh said it sounded like approx 10,000\r\nSo at some time in the near future I will need to apply LotIDs to those plants.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/407",
          "labels": [
            "EBrida_interface"
          ],
          "comments": [
            {
              "body": "I think I have done this but not sure.",
              "author": "zane.gilmore",
              "created": "2018-08-07T02:06:41Z"
            }
          ]
        },
        {
          "summary": "Fix foreign key issue in Provenances",
          "key": "KEA-408",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Because of a decision made by me we are going to have to change the way we deal with foreign key relationships in the provenances.\r\n\r\nWe were trying to ensure that users did not have to enter primary key ids that were just meaningless numbers so we made the foreign keys use unique columns like names.\r\n\r\nHowever we now need to ensure that the foreign keys at the database level are \"proper foreign keys\" so names can be edited without screwing up relationships.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/408",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "m2m relations checked and no work is required there. They are already using integer foreign keys. I found a bug in the migrations when running against the latest database which I have fixed. Now it's all ready to go.",
              "author": "will.buick",
              "created": "2017-02-02T00:10:40Z"
            },
            {
              "body": "This is being dealt with in #408",
              "author": "zane.gilmore",
              "created": "2017-02-09T20:19:59Z"
            }
          ]
        },
        {
          "summary": "Sample Batch spreadsheet customisation for each specimen-type",
          "key": "KEA-409",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to be able to define the shape of the spreadsheet produced for each specimen type.\r\nThe purpose of these spreadsheets is to provide a worksheet from which the people who collect the samples can work from.\r\n\r\nThis means that each specimen type will probably need spreadsheets that have different data on them.\r\nHow we define this and how much variability we can provide between the different spreadsheets is something we will need to discuss.\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/409",
          "labels": [
            "Provenance",
            "Sample Init",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "[Marcs_prototype_02_trialplot-SaB111G-20161216-114453.xlsx](https://github.com/PlantandFoodResearch/Kea/files/659710/Marcs_prototype_02_trialplot-SaB111G-20161216-114453.xlsx)\r\n",
              "author": "zane.gilmore",
              "created": "2016-12-18T22:21:02Z"
            },
            {
              "body": "Just thinking about it the attached spreadsheet as it is created by Marc, will need to have all of the entries in the yellow block put in as columns in the data list. And the yellow block entries will be comma delimited lists of a set of all of the entities contained in he data list.",
              "author": "zane.gilmore",
              "created": "2016-12-18T22:32:11Z"
            },
            {
              "body": "Implementation will be as follows:\r\n\r\nExtend provenance.py file.\r\nThis file contains Specimen classes for each specimen.\r\nExtend specimen class with another option that points to a custom batch spreadsheet class.\r\nThis class will have one method for each tab in spreadsheet.\r\nEach method can be overridden to customize batch spreadsheet as required.\r\n\r\nSomething roughly like this.\r\n\r\n```python\r\nclass BunchBatchFile(Spreadsheet):\r\n    def data_tab(self):\r\n        pass\r\n\r\n    def cover_sheet(self):\r\n        pass\r\n```",
              "author": "will.buick",
              "created": "2016-12-18T22:39:15Z"
            },
            {
              "body": "I've pushed initial version of code that allows generating different batch spreadsheets per specimen. I've replicated the spreadsheet attached to this issue to demonstrate this functionality. This spreadsheet will likely need further work though.",
              "author": "will.buick",
              "created": "2017-01-10T03:18:57Z"
            }
          ]
        },
        {
          "summary": "LocalID filters in datagrids can't be filtered because they are treated as integers",
          "key": "KEA-410",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to be able to filter LocalIDs.\r\nRight now the filter options are for integers so can't enter the localid strings for the filter.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/410",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Fix old files on Provenances",
          "key": "KEA-413",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The old file page for getting old batch files is 500ing.\r\nNeed to get it going.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/413",
          "labels": [
            "Datagrid",
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Default sample set sizes at init need zeroing",
          "key": "KEA-414",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The set sizes for the sample initialisation should be set to zero or left empty.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/414",
          "labels": [
            "Provenance",
            "Sample Init",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:58:33Z"
            }
          ]
        },
        {
          "summary": "Sample list on provenance not translating localids",
          "key": "KEA-415",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a sample's provenance is a localid we need to ensure that it is translated properly from the integer for display in the sample search datagrid.\r\n\r\nWilliam has said he will get the code to get the appropriate prefix from the model.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/415",
          "labels": [
            "Datagrid",
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This has already been done and merged here\r\n\r\nhttps://github.com/PlantandFoodResearch/Kea/commit/26090ee774b38caffb7018e7cc69f83ca465ace9",
              "author": "will.buick",
              "created": "2017-01-25T20:43:56Z"
            }
          ]
        },
        {
          "summary": "Trial display string needs updating",
          "key": "KEA-416",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The string for listing trial plots need to be updated.\r\nEspecially for the listing of chosen trial plots in sample batches.\r\nWe want:\r\nvineyard block name\r\nplot type\r\ntrial plot number\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/416",
          "labels": [
            "Provenance",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:57:04Z"
            }
          ]
        },
        {
          "summary": "Sample search pop-up in processrun creation needs different data",
          "key": "KEA-418",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the the samples are chosen for a process run we need to be able to specify the columns shown for each provenance. and perhaps for each process.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/418",
          "labels": [
            "Process Handling",
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "What Marc needs right now is:\r\n* Trial\r\n* VineyardBlock\r\n* Vineyard\r\n* Field Plot Number\r\n\r\nWe will need to have this dependent on the provenance maybe even on the process.\r\n",
              "author": "zane.gilmore",
              "created": "2017-01-31T21:22:21Z"
            },
            {
              "body": "Just pushed issue_418 branch.\r\nI think this will do what's required.\r\n\r\nA little more testing is required.",
              "author": "zane.gilmore",
              "created": "2017-02-03T03:48:36Z"
            }
          ]
        },
        {
          "summary": "sample search pop-up in process run creation has data overview pop-up for every click",
          "key": "KEA-419",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Every time a sample is chosen in the sample search pop-up the data overview pop-up appears.\r\nThis is extremely irritating.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/419",
          "labels": [
            "Datagrid",
            "Process Handling",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "sample list of selected samples in proc-run creation needs more info",
          "key": "KEA-420",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "To be able to check that the samples chosen in the process-run creation form are correct we need to display more data about the samples.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/420",
          "labels": [
            "Process Handling",
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Which data we provide is going to need assessment. But it should probably depend on the provenance.\r\n",
              "author": "zane.gilmore",
              "created": "2017-01-31T21:19:04Z"
            },
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:56:39Z"
            }
          ]
        },
        {
          "summary": "filtering of datagrid columns needs proper like classes",
          "key": "KEA-421",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "People need to be able to make their filters follow the full SQL \"like\" clause functionality.\r\nWe will need to do some work to remove SQL injection exposure but I believe that this should be possible.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/421",
          "labels": [
            "Datagrid",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "404 error on successive sample init's",
          "key": "KEA-422",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The user has reported getting a 404 error when trying to initialise a batch after initialising a prior one.\r\nI saw the 404 being generated.\r\n\r\nWhen the user logged out of Kea then logged in again, it worked.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/422",
          "labels": [
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "Have also noticed that I can't always kill that pop-up either.\r\nIt doesn't always seem to respond to clicking the \"X\"\r\n",
              "author": "zane.gilmore",
              "created": "2017-02-07T03:19:53Z"
            },
            {
              "body": "Unable to replicate this problem.",
              "author": "will.buick",
              "created": "2017-02-08T01:45:56Z"
            },
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:56:01Z"
            }
          ]
        },
        {
          "summary": "Potato plant upload doesn't work",
          "key": "KEA-425",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Katrina Monaghan has given me the attached spreadsheet that gives a 500 error on upload.\r\nWilliam, could you please track \r\n[Copy of Meis Extra ForPotatoPlant.xlsx](https://github.com/PlantandFoodResearch/Kea/files/786196/Copy.of.Meis.Extra.ForPotatoPlant.xlsx)\r\ndown the problem?",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/425",
          "labels": [],
          "comments": [
            {
              "body": "BTW don't forget to convert it to xls\r\n",
              "author": "zane.gilmore",
              "created": "2017-02-19T21:02:44Z"
            },
            {
              "body": "Hi Zane,\r\n\r\nI'm not sure if Marek has been in touch with you yet, but I only have very limited time to spend on kea at the moment. I only have some time available on Thursdays. For any urgent tasks you will need to fix yourself at the moment. I should be able to look at some smaller non urgent tasks each Thursday if I have time.\r\n\r\nAll that being said, I will have time this Thursday so I'll have a look at this for you and see if I can figure it out.\r\n\r\nThanks,\r\n\r\nWilliam.",
              "author": "will.buick",
              "created": "2017-02-20T21:11:49Z"
            },
            {
              "body": "William,\r\nThat is still not fixed.\r\nThe form for adding a new plant now works but the spreadsheet upload is not finding the SAC or the person",
              "author": "zane.gilmore",
              "created": "2017-02-23T02:15:55Z"
            },
            {
              "body": "Have another look now. I had an or condition instead of an and. I think it should work now.",
              "author": "will.buick",
              "created": "2017-02-23T02:58:27Z"
            },
            {
              "body": "We're making progress :-)\r\n\r\nGot the sack now we need the person...\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-02-23T03:02:37Z"
            },
            {
              "body": "OK things look good now\r\n",
              "author": "zane.gilmore",
              "created": "2017-02-23T03:22:30Z"
            }
          ]
        },
        {
          "summary": "Vineyard block description report showing ids",
          "key": "KEA-426",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to ensure that the report named \"Vineyard Block Description Report\"\r\nis showing the names of the rootstaocks and the clones not their ids.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/426",
          "labels": [
            "Provenance",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Column orders of some datagrids need to be standardised for Marc's samples",
          "key": "KEA-427",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The column orders for sample listings in:\r\n* the browse samples datagrid\r\n* the trial plot samples report\r\n* the sample batch spreadsheet\r\n\r\nNeed to be standardised.\r\nMarc to send me the correct order.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/427",
          "labels": [
            "Provenance",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "done. Now have customised sample list",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:55:17Z"
            }
          ]
        },
        {
          "summary": "Cell borders set in datagrid spreadsheets for better printouts",
          "key": "KEA-429",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There appears to be a requirement for printed spreadsheets to show grid lines.\r\nThis is normally done with cell borders.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/429",
          "labels": [
            "Datagrid",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:54:30Z"
            }
          ]
        },
        {
          "summary": "Need to develop more speciment types on Grape and Wine",
          "key": "KEA-430",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There are some more specimen types needed in Grape and Wine.\r\nMarc has said \"Wine Barrel\" and \"Juice\"\r\nBut information will be needed from \"vem in Blenheim\"\r\nSo we will need to talk to them.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/430",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "last digits or vineyard_row and bay_of_row zeroes truncated",
          "key": "KEA-431",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The zeroes have been lopped off the end of the row and bay numbers for trial_plots in Grape and Wine provenance. I think that this occurred only once but still needs to be fixed and checked.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/431",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:53:35Z"
            }
          ]
        },
        {
          "summary": "Location type for cryopreservation",
          "key": "KEA-432",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "As part of the potato project, they are looking to use cryopreservation.\r\n\r\nRanjiths description:\r\n\r\n> I have attached the sheet we have developed so far. We are not taking any risk of loss. So, when we receive a potato variety in a tissue culture tub or as microtubers from Lincoln, we first multiply into 3 -4 tubs to get about 30-40  plantlets. For cryopreservation, we use 120 buds (both shoot tips and developed axillary buds). They go into: 4 cryo tubes each having 25 buds and another fifth with 20 buds. So we have 5 tubes in liquid nitrogen. One with 20 buds comes out after a week or so and get tested for viability and if we have >40  % viability, that variety is in permanent storage in 4 tubes.\r\n In the Dewar we have chambers A, B, C, D and within the chambers we have towers A-1, A2 窶ｦ D1, D2 etc. Each tower has 12 positions which can take one cryo box each. Cryo boxes have their barcodes (box bar code  in sheet), can take 48 cryo tubes with barcode (tube barcode in sheet). For each cultivar we allocate two towers taking two tubes each. We have now placed 2 tubes per variety of 18 varieties in their final resting place. The other two tubes will be placed in another tower from their temporary storage position and the sheet will be updated. We also write down the position of each tube within the box.\r\nSo, for Kea, we can only identify the tube (not the individual 25 shoot tips in it) and link it to the variety. A variety will have four tubes in four different positions, using two boxes that are in two different towers.\r\n\r\nIn this case the material being stored is a viable plant (a specimen) so I think this should be modeled in the locations table (could also contain samples/sample-extracts). Obviously we cant track the individual plantlets in each tube but each tube could be treated as a single specimen (or other entity). ",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/432",
          "labels": [
            "Location"
          ],
          "comments": [
            {
              "body": "Potential implementation:\r\n\r\n* Create a location type \"Dewar position\" with coordinates for \"Dewar\", \"Chamber\" and \"Tower\".\r\n* Create a container type \"Dewar Tube\" that can store the projects barcode associated with each tube\r\n* Add \"Container\" as an option to the Specimen table of the provenance \r\n\r\n@zanejg the only issue with this is that specimens already require a location. if they are in a container that also requires a location then we are duplicating information.\r\n",
              "author": "tim.millar",
              "created": "2017-02-28T23:00:12Z"
            },
            {
              "body": "Simpler plan:\r\n\r\n* Create a location type \"Dewar position\" with coordinates for \"Dewar\", \"Chamber\" and \"Tower\".\r\n* Add \"Plant type\" column to potato specimen table\r\n  * foreign key to table of plant types\r\n  * not nullable \r\n* Add \"Cryostorage barcode\" column to potato specimen table\r\n  * unique\r\n  * nullable",
              "author": "tim.millar",
              "created": "2017-03-01T00:55:19Z"
            },
            {
              "body": "Potato Plant Types: \"Tissues Culture\", \"Cryo-Specimen\" and \"Regular Plant\"",
              "author": "tim.millar",
              "created": "2017-03-01T02:17:13Z"
            },
            {
              "body": "Progress on branch [f/432-cryo-potato-storage](https://github.com/PlantandFoodResearch/Kea/tree/f/432-cryo-potato-storage)",
              "author": "tim.millar",
              "created": "2017-03-22T02:33:39Z"
            },
            {
              "body": "Notes from visiting Palmy:\r\n\r\n- Need to associate duplicates in cryo\r\n  - these are intentional duplicates that are replicates \r\n  - each tube in a set of duplicates share their \"Tube Number\" (but have unique barcodes)",
              "author": "tim.millar",
              "created": "2017-08-15T21:51:16Z"
            }
          ]
        },
        {
          "summary": "Final next button on prov' sample init needs to be different",
          "key": "KEA-433",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The \"Next\" button in the SampleBatch  initialisation wixzardy thing needs to be different so that the user can easily see that this is the final button that will create the batch.\r\n\r\nThis means that the user can treat that button with more respect and can double check that they have everything correct.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/433",
          "labels": [
            "Provenance",
            "Sample Init",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "This is done",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:52:42Z"
            }
          ]
        },
        {
          "summary": "Prov' Sample init keeping chosen specimens when it shouldn't",
          "key": "KEA-434",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The wizard for initialising samples in provenances is keeping chosen specimens despite almost everything the does.\r\nThe point here is that if the user does not complete the sample batch init' then the chosen trial_plots or whatever seem to be very hard to remove.\r\nJust going back to the beginning of the init' wizard does not reset the chosen specimens.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/434",
          "labels": [
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "Closing this as I think it is a non-issue",
              "author": "zane.gilmore",
              "created": "2018-08-07T01:52:11Z"
            }
          ]
        },
        {
          "summary": "Nested containers and locations",
          "key": "KEA-435",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Currently Kea has several different ways of answering \"where is this thing located\".\r\nFor Specimens this is just a foreign key to the locations table.\r\nLocations themselves can be nested.\r\nSamples and sample extracts have a container and the container itself has location (which may be nested).\r\n\r\nThis is working for the most part but there are a couple of limitations:\r\n * Containers are often nested e.g. a bar-coded tube inside a  bar-coded box at a location.\r\n * Specimens (plants) can often have a container instead of just a location e.g. a plant in a numbered pot that is moved between greenhouses or a plantlet in an agar plate in a fridge in a lab\r\n\r\nI think there is a way to represent this relationships without too much change to the current system:\r\n\r\nWe could add new \"pseudo\" locations to the locations table that point at a container in the container table. This is a (tree-like) recursive relationship between containers a locations. A container must have a location which could be a 'real' location or another container-location.\r\nThis would effectively be treating containers as a type of location that can be moved (taking its contents with it).\r\n\r\nPros:\r\n * More flexible model of the (fundamentally nested) nature of containers/locations\r\n * From the users point of view, there is a single (compulsory) option that states where a 'thing' is located\r\n * Existing Specimen's locations are unaffected as there is still a foreign key to location table\r\n * New specimens can have a container via the location table\r\n * Samples and Sample-extracts can still be forced to have a container (foreign key to container table) and are unaffected \r\n\r\nCons:\r\n * Potential for deeply nested structures\r\n   - probably no more than three levels deep in practice\r\n   - can be presented to users like a breadcrumb trail?\r\n * Risk of infinite recursion (a container inside itself)\r\n   - disallow it in the code?\r\n\r\nPlease criticise ",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/435",
          "labels": [
            "Location",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Juice blend Specimen type for grape and wine",
          "key": "KEA-436",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Grape and Wine Prov requires a \"Juice blend\" specimen type that can track the proportion and provenance of each component juice.\r\n\r\nBased on discussion with @zanejg:\r\n * Add \"Juice\" specimen table:\r\n   * flexible provenance (optional company, vineyard, trialplot, vintage etc)\r\n   * required location, volume, volume_units\r\n * Add \"JuiceBlend\" specimen table:\r\n   * Many to many with Juice table (tracking volumes of each)\r\n   * required location, volume, volume_units",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/436",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "@zanejg current progress on branch `f/436-juice-blend`",
              "author": "tim.millar",
              "created": "2017-03-13T22:56:59Z"
            },
            {
              "body": "@zanejg new specimen tables working, I have created batch spreadsheets for both but could use some work. Not sure of how to include StoredJuice metadata in StoredJuiceBlend.\r\n\r\nShould consider making Variety and Vintage non-nullable in StoredJuiceBlend with sensible default? would make it easier to include them in the spreadsheet",
              "author": "tim.millar",
              "created": "2017-03-16T03:35:50Z"
            },
            {
              "body": "done. And about to be deprecated",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:52:37Z"
            }
          ]
        },
        {
          "summary": "Filtering on Provenance column in Sample search no-go",
          "key": "KEA-437",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "The filtering for the specimen column in the sample search datagrid doesn't work.\r\nAnd I am having problems figuring out how to make it work.\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/437",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Make this you last issue",
              "author": "zane.gilmore",
              "created": "2017-11-02T00:53:49Z"
            },
            {
              "body": "I did manage to come up with the solution found here\r\n\r\nhttps://github.com/PlantandFoodResearch/Kea/commit/8619bc67c4906889593b09a912aa76fd77410072\r\n\r\nThis is not really something I would consider safe for merging without further work, it's more of a proof of concept.\r\n\r\nI did try various different approaches to this but this was the only one that actually worked. It's a very simple approach at this point and we might be able to make it a bit more robust with further work.\r\n\r\nI've tested lookups on localid columns and it does appear to be working. The only type of lookup that is currently working is an exact text match.\r\n\r\nI think with further work you should be able to do more complicated lookups, I don't think that it's possible to order on the provenance column though.",
              "author": "will.buick",
              "created": "2017-11-16T03:46:06Z"
            },
            {
              "body": "OK\r\nNeed to have a look at this",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:52:00Z"
            }
          ]
        },
        {
          "summary": "Remove HarvestSample specimen from grape and wine",
          "key": "KEA-438",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Unused and should be removed",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/438",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:48:59Z"
            }
          ]
        },
        {
          "summary": "Merging/pooling samples and sample extracts",
          "key": "KEA-439",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "It's become apparent that some samples (and in future sample extracts) will need to be merged/pooled into new samples (e.g. juice and wine). \r\n\r\nThis is possibly via a \"merge samples\" process:\r\n* takes a number of samples to be merged (one per row) \r\n* user inputs into each row the pooled-sample that each sample is merged into\r\n  * could be done by a unique name/number that is only used for that process and thrown away when the new sample is created\r\n  * could be done with a compulsory-unique alternate-id\r\n* process identifies unique names from the pooled-sample names column then for each new pooled-sample:\r\n  * create a new sample in the sample table\r\n  * attach pooled-sample to it's parent samples via a recursive many-to-many\r\n\r\n\r\nExample data sheet from users perspective:\r\n\r\n| sample-name | volume | volume unit | pooled-sample-name |\r\n| ------------- | -------- | ----------- | ---------------------- |\r\n| sample 1        | 20          | ml                |  mix 1                            |\r\n| sample 2        | 20          | ml                |  mix 1                            |\r\n| sample 3        | 20          | ml                |  mix 1                            |\r\n| sample 4        | 20          | ml                |  mix 2                            |\r\n| sample 5        | 20          | ml                |  mix 2                            |\r\n| sample 6        | 20          | ml                |  mix 2                            |\r\n| sample 7        | 20          | ml                |  mix 2                            |\r\n\r\nthis would result in two new samples in the sample table and 7 new connections in the many-to-many table (which the user doesn't need to see).\r\n\r\nPros:\r\n* Works for any sample type\r\n* Can create mixtures of mixtures (I'm sorry)\r\n* Uses existing UI elements = less friction for users\r\n* Users doesn't need to see/understand the many-to-many table\r\n* Similar implementation for samples and sample-extracts\r\n\r\nCons:\r\n* yet more recursion to deal with\r\n* a unique name/number is required for the pooled-sample *before* the sample is created but this can be done with a temporary name/number that is thrown away afterwards or stored as an alternate id",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/439",
          "labels": [
            "Process Handling",
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "@zanejg \r\n\r\nA slightly simpler version would work if you wanted the process to result in only a single merged sample. This way you could avoid the issue of specifying a unique id before the sample is created.\r\nE.g.:\r\n\r\n| sample-name | volume | volume unit |\r\n| ------------- | -------- | ----------- |\r\n| sample 1        | 20          | ml                |\r\n| sample 2        | 20          | ml                |\r\n| sample 3        | 20          | ml                |\r\n\r\nwould create a single new pooled-sample",
              "author": "tim.millar",
              "created": "2017-03-14T22:59:33Z"
            },
            {
              "body": "Yup, just about to start work on this... hopefully",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:48:14Z"
            }
          ]
        },
        {
          "summary": "can't update trialplots with upload",
          "key": "KEA-440",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We are getting a 500 error when trying to update trialplots via the spreadsheet upload.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/440",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "OK... \r\nto reproduce this error download some trial-plots from the admin interface.\r\nIn the downloaded data file, move  the trials column to the correct position (see bug #351 )\r\nCopy the data to the skeleton.\r\nMake some changes e.g. to the description is easiest\r\nUpload the file.\r\n\r\nWilliam, I think this has to be you who fixes this. It looks like the Trial-plot LocalID is not being translated properly.\r\n\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-03-22T03:56:13Z"
            }
          ]
        },
        {
          "summary": "Vine column on trial-plot",
          "key": "KEA-441",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It looks like we need a \"vine\" column in the trialplot table for Grape and Wine provenance.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/441",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Turns out... not really",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:47:08Z"
            }
          ]
        },
        {
          "summary": "Reports for Settled juice and Finished wine",
          "key": "KEA-442",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Need to add some reports:\r\n\r\n- Settled Juice\r\n- Finished wine\r\n\r\nWill need to talk to Marc",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/442",
          "labels": [
            "Provenance",
            "Report"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:45:52Z"
            }
          ]
        },
        {
          "summary": "Another berry report",
          "key": "KEA-443",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Marc wants another report a la the attached spreadsheet.\r\n\r\n[Example Process Berry Samples Report.xlsx](https://github.com/PlantandFoodResearch/Kea/files/863604/Example.Process.Berry.Samples.Report.xlsx)\r\n\r\nAlso wants the second worksheet... hmmm",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/443",
          "labels": [
            "Provenance",
            "Report"
          ],
          "comments": []
        },
        {
          "summary": "Bunches of Processes on a set of samples",
          "key": "KEA-444",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need a non-sequential way of applying a group of processes to the same group of samples.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/444",
          "labels": [
            "Process Handling",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Done. It is called cascade",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:45:27Z"
            }
          ]
        },
        {
          "summary": "filtering on trialplot localids broken",
          "key": "KEA-448",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Right now we don't seem to be able to filter on trialplot localids in the trial plot search admin datagrid\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/448",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "cascading processruns not doing cascading extracts properly",
          "key": "KEA-449",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When extracts are cascaded from a processrun then that process-run can't cascade its own extracts.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/449",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:44:31Z"
            }
          ]
        },
        {
          "summary": "dead tray handling needs info pop-up turned off",
          "key": "KEA-451",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The column with the tray dimensions needs to have the pop-up turned off for it.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/451",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2017-10-18T00:39:26Z"
            }
          ]
        },
        {
          "summary": "Fix plate handling page",
          "key": "KEA-452",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Looks like my SQL is still using the old process schema...\r\npre-process app.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/452",
          "labels": [
            "Datagrid",
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:44:00Z"
            }
          ]
        },
        {
          "summary": "/var/log/keaapp needs to be owned by keaapp",
          "key": "KEA-454",
          "status": "Done",
          "reporter": "eric.burgueﾃｱo",
          "description": "Upon starting the containers we get these in the docker logs:\r\n\r\n```\r\n[root@wkokea21 ~]# docker ps\r\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                         PORTS                    NAMES\r\n96ee14f17a36        322fcfd63570        \"/app/deploy/docker/w\"   23 seconds ago      Restarting (2) 8 seconds ago   0.0.0.0:8080->8080/tcp   kea_web_prod\r\n7cc7407a9908        4fb558e8daa0        \"/app/deploy/docker/c\"   23 seconds ago      Restarting (2) 9 seconds ago                            kea_celery_prod\r\n[root@wkokea21 ~]# docker logs 96ee14f17a36\r\n/app/deploy/docker/web/entrypoint.sh: 5: /app/deploy/docker/web/entrypoint.sh: cannot create /app/var/log/django_migrate.log: Permission denied\r\n/app/deploy/docker/web/entrypoint.sh: 5: /app/deploy/docker/web/entrypoint.sh: cannot create /app/var/log/django_migrate.log: Permission denied\r\n/app/deploy/docker/web/entrypoint.sh: 5: /app/deploy/docker/web/entrypoint.sh: cannot create /app/var/log/django_migrate.log: Permission denied\r\n/app/deploy/docker/web/entrypoint.sh: 5: /app/deploy/docker/web/entrypoint.sh: cannot create /app/var/log/django_migrate.log: Permission denied\r\n```\r\n\r\nLooking at the Dockerfile, I can see that you are chowning the log directory as part of the Docker build:\r\nhttps://github.com/PlantandFoodResearch/Kea/blob/master/deploy/docker/web/Dockerfile#L34\r\n\r\nThis would work when the container is built on the target host, but not when the container is pulled on a different one. Maybe `entrypoint.sh` (or perhaps as part of the ansible deployment playbook?) is a better place.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/454",
          "labels": [],
          "comments": [
            {
              "body": "Hi Eric,\r\n\r\nI am unable to access the aklkea22 server again. Perhaps it is the same problem as before? I can ssh into powerplant without any issues. Could you please have a look at this for me then I'll have a look at the issue.\r\n\r\nThanks,\r\n\r\nWilliam.",
              "author": "will.buick",
              "created": "2017-04-27T01:16:23Z"
            },
            {
              "body": "I'm also not sure what difference chowning the directory after the image is built would make? Everything happens within the image so it wouldn't matter what host the image is run on\r\n\r\nYou mention ansible so are you referring to creating the directory on the host machine? In this case then yes it should be part of the ansible playbook. The playbook should create the directory /var/log/keaapp on the host and make sure it is chowned by keaapp.\r\n\r\n/app/var/log should work in exactly the same way that /app/var/media and /app/var/static do.",
              "author": "will.buick",
              "created": "2017-04-27T01:24:38Z"
            },
            {
              "body": "@wilbuick \r\n\r\n> I am unable to access the aklkea22 server again.\r\n\r\nI noticed you were able to login, so I assume this is not an issue anymore. If it happens again do flick us an email, but it should (at least on `aklkea22`).\r\n\r\n> /app/var/log should work in exactly the same way that /app/var/media and /app/var/static do.\r\n\r\nOk, cool. I'll add it to the playbook.",
              "author": "eric.burgueﾃｱo",
              "created": "2017-04-27T03:11:11Z"
            },
            {
              "body": "Fixed with #458",
              "author": "eric.burgueﾃｱo",
              "created": "2017-04-27T03:25:33Z"
            }
          ]
        },
        {
          "summary": "Update SELinux policy to allow everything that is currently not working",
          "key": "KEA-455",
          "status": "Done",
          "reporter": "eric.burgueﾃｱo",
          "description": "From `/var/log/audit/audit.log`:\r\n\r\n```\r\ntype=AVC msg=audit(1493244655.744:33755): avc:  denied  { write } for  pid=29366 comm=\"entrypoint.sh\" name=\"keaapp\" dev=\"dm-3\" ino=131191 scontext=system_u:system_r:svirt_lxc_net_t:s0:c46,c549 tcontext=system_u:object_r:container_log_t:s0 tclass=dir\r\n\r\n\tWas caused by:\r\n\t\tMissing type enforcement (TE) allow rule.\r\n\r\n\t\tYou can use audit2allow to generate a loadable module to allow this access.\r\n```",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/455",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "More things coming from the logs as we went. Changed SELinux policy to Permissive to capture all possible denials, which I will use to compile a new policy module.",
              "author": "eric.burgueﾃｱo",
              "created": "2017-04-26T22:59:18Z"
            }
          ]
        },
        {
          "summary": "Add SELinux policy in plain text for future reference",
          "key": "KEA-456",
          "status": "Done",
          "reporter": "eric.burgueﾃｱo",
          "description": "At the moment, we only have the SELinux policy as a binary file. We should include the text-version to make it human-friendly.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/456",
          "labels": [
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Wrong permissions set to /var/www/html/keaapp",
          "key": "KEA-457",
          "status": "Done",
          "reporter": "eric.burgueﾃｱo",
          "description": "Ansible is creating `/var/www/html/keaapp` with the wrong permissions set:\r\n\r\n```\r\n[root@wkokea21 keaapp]# cd /var/www/html/\r\n[root@wkokea21 html]# ll\r\ntotal 4\r\nd-ws-w-rwt. 4 keaapp www 4096 Apr 26 17:45 keaapp\r\n[root@wkokea21 html]# cd keaapp/\r\n[root@wkokea21 keaapp]# ll\r\ntotal 8\r\nd-ws-w-rwt.  2 keaapp www 4096 Apr 26 17:45 media\r\nd-ws-w-rwt. 13 keaapp www 4096 Apr 27 10:56 static\r\n```\r\n\r\nThis is probably related to https://github.com/ansible/ansible/issues/13159. The fix would be to quote the octal modes in the playbook.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/457",
          "labels": [
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Kea servers to run on TLS",
          "key": "KEA-459",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "We need to ensure that the Kea servers are all running on https.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/459",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "Still needs to be done",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:34:13Z"
            }
          ]
        },
        {
          "summary": "Uploading stored juiceblend components  gives errors",
          "key": "KEA-463",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When trying to upload the many to many components for stored juice blends we are getting a 500 error.\r\n\r\n```\r\nInternal Server Error: /provenance/import/grape_and_wine/storedjuiceblendcomponent/1/\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py\", line 132, in get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 145, in inner\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 71, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"./kea/provenance/views/provimport.py\", line 82, in dispatch\r\n    return super(ProvenanceAdminImportView, self).dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/formtools/wizard/views.py\", line 237, in dispatch\r\n    response = super(WizardView, self).dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 34, in _wrapper\r\n    return bound_func(*args, **kwargs)\r\n  File \"./kea/provenance/decorators.py\", line 19, in _wrapped\r\n    return view_func(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 30, in bound_func\r\n    return func.__get__(self, type(self))(*args2, **kwargs2)\r\n  File \"./kea/provenance/views/mixins.py\", line 20, in dispatch\r\n    request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 89, in dispatch\r\n    return handler(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/formtools/wizard/views.py\", line 686, in post\r\n    return super(NamedUrlWizardView, self).post(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/formtools/wizard/views.py\", line 290, in post\r\n    if form.is_valid():\r\n  File \"/usr/local/lib/python2.7/site-packages/django/forms/forms.py\", line 184, in is_valid\r\n    return self.is_bound and not self.errors\r\n  File \"/usr/local/lib/python2.7/site-packages/django/forms/forms.py\", line 176, in errors\r\n    self.full_clean()\r\n  File \"/usr/local/lib/python2.7/site-packages/django/forms/forms.py\", line 392, in full_clean\r\n    self._clean_fields()\r\n  File \"/usr/local/lib/python2.7/site-packages/django/forms/forms.py\", line 410, in _clean_fields\r\n    value = getattr(self, 'clean_%s' % name)()\r\n  File \"./kea/provenance/forms/provimport.py\", line 22, in clean_spreadsheet\r\n    return validate_spreadsheet(self, self.cleaned_data['spreadsheet'])\r\n  File \"./kea/provenance/forms/validators.py\", line 43, in validate_spreadsheet\r\n    form.model, default_excel_storage.path(filename))\r\n  File \"./kea/provenance/excel/utils.py\", line 84, in import_provenance_definition\r\n    dataset, dry_run=dryrun, raise_errors=True)\r\n  File \"/usr/local/lib/python2.7/site-packages/import_export/resources.py\", line 509, in import_data\r\n    return self.import_data_inner(dataset, dry_run, raise_errors, using_transactions, collect_failed_rows, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/import_export/resources.py\", line 542, in import_data_inner\r\n    row_result = self.import_row(row, instance_loader, using_transactions, dry_run, **kwargs)\r\n  File \"./kea/import_export/resource.py\", line 275, in import_row\r\n    instance, new = self.get_or_init_instance(instance_loader, row)\r\n  File \"/usr/local/lib/python2.7/site-packages/import_export/resources.py\", line 258, in get_or_init_instance\r\n    instance = self.get_instance(instance_loader, row)\r\n  File \"/usr/local/lib/python2.7/site-packages/import_export/resources.py\", line 252, in get_instance\r\n    return instance_loader.get_instance(row)\r\n  File \"/usr/local/lib/python2.7/site-packages/import_export/instance_loaders.py\", line 30, in get_instance\r\n    for key in self.resource.get_import_id_fields():\r\nTypeError: 'NoneType' object is not iterable\r\n```\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/463",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "It turns out this problem was by-passed when the StoredJuiceBlendComponent model had a LocalID field added.\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-05-02T23:09:14Z"
            }
          ]
        },
        {
          "summary": "Prominence of counts in the Datagrid",
          "key": "KEA-464",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "There has been some discussion about how prominent the counts of the pagination etc is for the Datagrid.\r\ni.e. \"Showing 50 of 12345 Samples\"\r\n\r\nI think we need to have a discussion about whether that information is displayed in a way that can be \r\n\"mentally parsed\" as easily as it might be.\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/464",
          "labels": [
            "Datagrid",
            "UI Issue",
            "question"
          ],
          "comments": [
            {
              "body": "Closing this now because I don't think this an issue.",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:33:23Z"
            }
          ]
        },
        {
          "summary": "Sample counts for chosen samples in processrun creation",
          "key": "KEA-465",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When samples have been chosen from the Datagrid pop-up in the processrun creation form, it would be a good idea to show a count of how many have been chosen.\r\n\r\nI started to have a look at this and discovered that it would take me days just to figure out how the damn page works!\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/465",
          "labels": [
            "Process Handling",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This is done now",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:31:55Z"
            }
          ]
        },
        {
          "summary": "Datagrid numerical data formatted as text",
          "key": "KEA-466",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "We need to ensure that numerical data is set as numerical data in the datagrid \"Export to Excel\".\r\n\r\nRight now there is something setting that data to text. Which is useless to a scientist.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/466",
          "labels": [
            "Datagrid",
            "Report",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "This is done now I think",
              "author": "zane.gilmore",
              "created": "2017-10-18T00:37:56Z"
            }
          ]
        },
        {
          "summary": "Generic Process Report view needs a sample extract variant",
          "key": "KEA-467",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I need to ensure that the process data reports can either handle the sample extract data or do separate ones especially for the extract data.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/467",
          "labels": [
            "Process Handling",
            "Provenance",
            "Report",
            "bug"
          ],
          "comments": [
            {
              "body": "This has been done",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:31:16Z"
            }
          ]
        },
        {
          "summary": "Process upload files with ignore column",
          "key": "KEA-468",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "To make partial data upload easier we need a column that gives ignore command to spreadsheet parser.\r\nA la comment hash",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/468",
          "labels": [
            "Process Handling",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I'm reasonably sure that this is moot now.\r\nWe have solved the original problem that required this.",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:30:37Z"
            }
          ]
        },
        {
          "summary": "Datagrid filter. Search for null",
          "key": "KEA-469",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "It would be nice to able to search for a null value in a datagrid column.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/469",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Date format downloaded as datagrid etc when uploaded format is rejected",
          "key": "KEA-470",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When data containing date is downloaded via datagrid or process then uploaded via provenance admin upload or proceszane-HP-EliteBook-8570ws upload.\r\n\r\nWe need to work out which combo is failing here.\r\nIt looks like it is related to #466 as the cells are being forced into text mode.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/470",
          "labels": [
            "Datagrid",
            "Process Handling",
            "Provenance",
            "Report",
            "bug"
          ],
          "comments": [
            {
              "body": "I'm pretty sure this works now.\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:28:39Z"
            }
          ]
        },
        {
          "summary": "Can't generate API keys",
          "key": "KEA-471",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I try to generate an API key, I get a 500 error with stacktrace:\r\n```\r\nInternal Server Error: /api/users/generate-api-key/ Traceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py\", line 132, in get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 145, in inner\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 71, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 34, in _wrapper\r\n    return bound_func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/contrib/auth/decorators.py\", line 22, in _wrapped_view\r\n    return view_func(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 30, in bound_func\r\n    return func.__get__(self, type(self))(*args2, **kwargs2)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 34, in _wrapper\r\n    return bound_func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/contrib/auth/decorators.py\", line 22, in _wrapped_view\r\n    return view_func(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 30, in bound_func\r\n    return func.__get__(self, type(self))(*args2, **kwargs2)\r\n  File \"./kea/api/views/token.py\", line 25, in dispatch\r\n    return super(UserApiTokenView, self).dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 89, in dispatch\r\n    return handler(request, *args, **kwargs)\r\n  File \"./kea/api/views/token.py\", line 45, in post\r\n    reverse('generate-user-api-key'))\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/urlresolvers.py\", line 578, in reverse\r\n    return force_text(iri_to_uri(resolver._reverse_with_prefix(view, prefix, *args, **kwargs)))\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/urlresolvers.py\", line 495, in _reverse_with_prefix\r\n    (lookup_view_s, args, kwargs, len(patterns), patterns))\r\nNoReverseMatch: Reverse for 'generate-user-api-key' with arguments '()' and keyword arguments '{}' not found. 0 pattern(s) tried: []\r\n```\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/471",
          "labels": [
            "API"
          ],
          "comments": [
            {
              "body": "This is easy to fix. The api urls are namespaced so you need to change\r\n\r\ngenerate-user-api-key\r\n\r\nto\r\n\r\napi:generate-user-api-key\r\n\r\nin api/views/token.py",
              "author": "will.buick",
              "created": "2017-06-06T01:49:16Z"
            },
            {
              "body": "Cheers for that.\r\nDone.",
              "author": "zane.gilmore",
              "created": "2017-06-06T03:22:31Z"
            },
            {
              "body": "@zanejg did you fix this with [release 0.16.19](https://github.com/PlantandFoodResearch/Kea/releases/tag/0.16.19)? see Roys issue ",
              "author": "tim.millar",
              "created": "2017-07-26T03:21:35Z"
            },
            {
              "body": "Bugger.\r\nThe test instance is working but the live is not.\r\nWill look at this tomorrow.\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-07-26T04:39:29Z"
            },
            {
              "body": "done",
              "author": "zane.gilmore",
              "created": "2017-10-18T00:43:57Z"
            },
            {
              "body": "@zanejg from @kiwiroy in [kea_notebooks/issues/1](https://github.com/PlantandFoodResearch/kea_notebooks/issues/1#issuecomment-349464271)\r\n\r\n> This is **still** an issue for me 汨",
              "author": "tim.millar",
              "created": "2017-12-05T22:39:23Z"
            },
            {
              "body": "This looks like it was fixed then re-broken.\n\nWhen I checked it last it worked.\n\n\n\n\nOn 6 December 2017 at 11:39, Tim Millar <notifications@github.com> wrote:\n\n> @zanejg <https://github.com/zanejg> from @kiwiroy\n> <https://github.com/kiwiroy> in kea_notebooks/issues/1\n> <https://github.com/PlantandFoodResearch/kea_notebooks/issues/1#issuecomment-349464271>\n>\n> This is *still* an issue for me 汨蚕n>\n> 窶能n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/PlantandFoodResearch/Kea/issues/471#issuecomment-349465490>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAykovrZJ9XVPQTg4dhTIP7nzTSOJySjks5s9cYcgaJpZM4Nww01>\n> .\n>\n",
              "author": "zane.gilmore",
              "created": "2017-12-05T23:05:18Z"
            },
            {
              "body": "OK, just talked to William and the issue here is permissions.\r\nWe need to give the authtoken permissions to anyone that wants to create a token. \r\n\r\nAm going to close this as there a new issue that has come to light regarding recreating the keys.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-12-06T22:50:09Z"
            }
          ]
        },
        {
          "summary": "Error when initialising samples using Ebrida Excel sheet",
          "key": "KEA-472",
          "status": "Done",
          "description": "We got the attached error when the Excel sheet to import has two Sheets (\"Sheet1\" containing the data and \"Sheet2\" which was empty). I tried to reproduce the error using the xlrd library and got the same message when I used your recipe for looping through the data on the empty Sheet2.\r\n\r\nThe algorithm needs to check whether '''sheet.row_values(0)\" which is the header is empty. \r\n\r\n![image001](https://user-images.githubusercontent.com/877361/29194069-1918ad6a-7e7c-11e7-857d-7b5b61292b1e.png)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/472",
          "labels": [],
          "comments": [
            {
              "body": "I hope that this is fixed now.\r\nI seem to remember that I did some work on it in the past",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:20:41Z"
            }
          ]
        },
        {
          "summary": "Contextual Help on eBrida  Initialisation",
          "key": "KEA-473",
          "status": "To Do",
          "description": "Please add a  link to an example or template or specification for the required spreadsheet format\r\n\r\n![image](https://user-images.githubusercontent.com/268441/29257748-962197b6-8108-11e7-98f9-2271c2640d94.png)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/473",
          "labels": [
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This needs to be done.",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:19:21Z"
            }
          ]
        },
        {
          "summary": "Plate records for collection need Some location Context Not Just KEA info",
          "key": "KEA-474",
          "status": "To Do",
          "description": "The plate records currently generated by Kea using eBrida initialisation dont contain **any** eBrida contextual information  to aid collectors\r\nFor collection, an orchard location is needed. For usage the KEA sample ID is needed.\r\nIn this case the Kea PlantID is not useful \r\neg \r\n![image](https://user-images.githubusercontent.com/268441/29258075-d6bcf2e6-810a-11e7-899a-9e1c4dae09c8.png)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/474",
          "labels": [
            "Requirement",
            "Sample Init",
            "enhancement"
          ],
          "comments": [
            {
              "body": "This looks interesting but the problem is that different data will be required for different teams.\r\nThere would need to be a way of choosing which data is required for the particular collection batch.",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:18:09Z"
            }
          ]
        },
        {
          "summary": "Kiwifruit eBrida Initialisation Failure",
          "key": "KEA-475",
          "status": "To Do",
          "description": "Trying to init with this record:\r\n\r\n| Pedigree Item | Plot | LotId  | Group | Mother  | Father  | Barcode     | BreederName  | Synonyms                               | From Ped. Item | Start Date | Plot Location |\r\n|---------------|------|--------|-------|---------|---------|-------------|--------------|----------------------------------------|----------------|------------|---------------|\r\n| Hort51-1785   | 146  | 724217 |       | Jinfeng | CK40_02 | TPCB21|0146 | Russell Lowe | T96.51-07-01f; 51-1785; Yellow 46; Y46 | K95.0001       | 01/01/1990 | T02.21-17-14a |\r\n\r\nCauses epic fail (see below):\r\n\r\n>Key (\"AltName\")=(TPCB21|0146) already exists.\r\n\r\nIs this  due to this genotype being assigned to Pop AltName 'Actinidia parents'?\r\n\r\n![image](https://user-images.githubusercontent.com/268441/29258665-b0613350-810f-11e7-82d9-7fe5def07093.png)\r\n\r\nThis may have been issue breaking collection init last spring..this is a major issue we need to resolve\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/site-packages/celery/app/trace.py\", line 240, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/celery/app/trace.py\", line 438, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/app/kea/celery/tasks/logging.py\", line 52, in run_decorator\r\n    func_output = self.wrapped_run(*args, **kwargs)\r\n  File \"/app/kea/ebrida/tasks.py\", line 58, in initialise_ebrida_samples\r\n    stdout=out)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/management/__init__.py\", line 120, in call_command\r\n    return command.execute(*args, **defaults)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/management/base.py\", line 445, in execute\r\n    output = self.handle(*args, **options)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/management/base.py\", line 623, in handle\r\n    label_output = self.handle_label(label, **options)\r\n  File \"/app/kea/ebrida/management/commands/ebrida_import.py\", line 309, in handle_label\r\n    self.create_samples(sheet_data)\r\n  File \"/app/kea/ebrida/management/commands/ebrida_import.py\", line 505, in create_samples\r\n    plant, genotype, population = self.create_pedigree_data(data)\r\n  File \"/app/kea/ebrida/management/commands/ebrida_import.py\", line 646, in create_pedigree_data\r\n    plant = self.get_or_create_plant(data, genotype, population)\r\n  File \"/app/kea/ebrida/management/commands/ebrida_import.py\", line 1090, in get_or_create_plant\r\n    AltNameType=self.barcode_altname_type)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/manager.py\", line 127, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/query.py\", line 348, in create\r\n    obj.save(force_insert=True, using=self.db)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 734, in save\r\n    force_update=force_update, update_fields=update_fields)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 762, in save_base\r\n    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 846, in _save_table\r\n    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 885, in _do_insert\r\n    using=using, raw=raw)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/manager.py\", line 127, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/query.py\", line 920, in _insert\r\n    return query.get_compiler(using=using).execute_sql(return_id)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/sql/compiler.py\", line 974, in execute_sql\r\n    cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/utils.py\", line 98, in __exit__\r\n    six.reraise(dj_exc_type, dj_exc_value, traceback)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/app/kea/core/db/backends/postgresql_psycopg2/base.py\", line 32, in execute\r\n    return self.cursor.execute(operation, params)\r\nIntegrityError: duplicate key value violates unique constraint \"plants_plantaltname_AltName_key\"\r\nDETAIL:  Key (\"AltName\")=(TPCB21|0146) already exists.\r\n``",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/475",
          "labels": [
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "another fail \r\n\r\n>DETAIL:  Key (\"AltName\")=(TPCB21|0155) already exists.",
              "created": "2017-08-14T04:50:13Z"
            },
            {
              "body": "This has several broke records....\r\n\r\n[TP4xAncestors.xlsx](https://github.com/PlantandFoodResearch/Kea/files/1221287/TP4xAncestors.xlsx)\r\n",
              "created": "2017-08-14T04:58:22Z"
            },
            {
              "body": "Just tested this Kea version and the above file on the test instance.\r\nAnd it worked.\r\n",
              "author": "zane.gilmore",
              "created": "2017-08-29T03:10:43Z"
            },
            {
              "body": "This batch breaks it still:\r\n\r\n```\r\n\r\nPedigree Item | Plot | LotId | Group | Mother | Father | Barcode | BreederName | Synonyms | From Ped. Item | Start Date | breederCrCode\r\n-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --\r\nK07.0007.00242 | 3322 | 191871 | T13.59-14-13e | Hort51-1785 | T03.32-08-15h | TP13B59\\|3322 | Russell Lowe | 0007.2007K | 18/03/2013 | GZ22\r\nK11.0129.00085 | 3742 | 135702 | T13.57-32-23f | Jinfeng | T08.33-10-04e | TP13B57\\|3742 | Russell Lowe | 0129.2011K | 11/12/2013 | rJQ_297\r\nK12.0123.00127 | 3720 | 201244 | T14.11-23-13d | T08.33-03-04d | T08.33-07-18b | TP13B11\\|3720 | Russell Lowe | rMP_361 | K12.0123 | 01/01/2013 | rMP_361\r\nK12.0128.00339 | 2526 | 201504 | T14.28-07-10i | T08.33-05-13b | T08.33-07-18b | TP14B28\\|2526 | Russell Lowe | rMR_361 | K12.0128 | 24/02/2014 | rMR_361\r\nK12.0128.00416 | 1615 | 219063 | T14.13-11-02g | T08.33-05-13b | T08.33-07-18b | TP14B13\\|1615 | Russell Lowe | rMR_361 | K12.0128 | 07/03/2014 | rMR_361\r\nK12.0128.00504 | 989 | 219151 | T14.28-10-05c | T08.33-05-13b | T08.33-07-18b | TP14B28\\|0989 | Russell Lowe | rMR_361 | K12.0128 | 24/02/2014 | rMR_361\r\nK12.0128.01013 | 4171 | 453958 | T14.11-30-19f | T08.33-05-13b | T08.33-07-18b | TP13B11\\|4171 | Russell Lowe | rMR_361 | K12.0128 | 01/01/2013 | rMR_361\r\nK12.0129.00143 | 4124 | 205205 | T14.11-29-09a | T08.33-05-13b | T08.33-05-07f | TP13B11\\|4124 | Russell Lowe | rMR_360 | K12.0129 | 01/01/2013 | rMR_360\r\nK12.0131.00350 | 1525 | 218779 | T14.13-14-02f | T08.33-05-13b | T03.32-08-15h | TP14B13\\|1525 | Russell Lowe | rMR_022 | K12.0131 | 07/03/2014 | rMR_022\r\nK12.0181.00302 | 2034 | 221507 | T14.13-03-06d | T08.33-14-07b | T08.33-10-04e | TP14B13\\|2034 | Russell Lowe | rOA_363 | K12.0181 | 07/03/2014 | rOA_363\r\nK12.0190.00210 | 1377 | 220865 | T14.28-16-02b | T08.33-20-02c | T08.33-10-04e | TP14B28\\|1377 | Russell Lowe | rNO_363 | K12.0190 | 24/02/2014 | rNO_363\r\nK12.0190.00341 | 1414 | 220996 | T14.28-15-07e | T08.33-20-02c | T08.33-10-04e | TP14B28\\|1414 | Russell Lowe | rNO_363 | K12.0190 | 24/02/2014 | rNO_363\r\nK12.0208.00732 | 8104 | 290353 | T14.57-20-13c*r1 | Hort51-1785 | T08.33-05-07f | TP13B57\\|8104 | Russell Lowe | rJZ_360 | K12.0208 | 11/12/2013 | rJZ_360\r\nK12.0221.00220 | 286 | 200845 | T14.13-04-02g | T02.13-15-01f | T03.32-08-15h | TP14B13\\|0286 | Russell Lowe | rML_022 | K12.0221 | 07/03/2014 | rML_022\r\nK12.0377.00796 | 975 | 217033 | T14.13-17-02f | Gold 3 | T08.33-05-13e | TP14B13\\|0975 | Russell Lowe | rKG_377 | K12.0377 | 07/03/2014 | rKG_377\r\nT08.33-13-15a | 80 | 732742 | T14.24-01-15c | Hort51-1785 | T02.13-01-12e | TPCB24\\|0080 | Russell Lowe | Yellow 107; Yellow107; Y107 | 0038.2007K | 01/01/1992 | GZ29\r\nT08.33-14-11e | 90 | 732752 | T14.24-02-01e | Hort51-1785 | T03.32-10-02d | TPCB24\\|0090 | Russell Lowe | 0049.2007K | 01/01/1992 | GZ17\r\nT08.33-15-02f | 1187 | 833552 | T13.02-27-13b | Hort51-1785 | T03.32-02-11a | TP12B02\\|1187 | Russell Lowe | 0030.2007K | 01/01/2011 | GZ23\r\n\r\n\r\n```",
              "created": "2018-10-29T01:15:20Z"
            }
          ]
        },
        {
          "summary": "Template fields when using a Foreign Key",
          "key": "KEA-476",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "### issue\r\n\r\nIn some contexts when a new entity is created, some of data is clearly inhered from an existing entity of the same type.\r\n\r\nThis data currently needs to be filled in by the user manually which is error prone and slow.\r\n\r\nWhile this inherited information is implicit in the DB it is not displayed explicitly to the user an in special cases there may be real reason why the data is not inherited.\r\n\r\n### example\r\n\r\nAn example of this is in the potato provenance when creating a new potato plant that is a child of a preexisting parent potato plant. \r\nIn this case fields like \"variety\" should always be inherited.\r\n\r\ntechnically this is implied by the parent-child relationship in the DB but this is not clear to the user and having the field automatically filled in is a good sanity check that the user has selected the correct parent plant.\r\n\r\nA second example in potato is when a potato comes from a potato sac. The company/purported variety should be inherited from the sac\r\n\r\n### feature\r\n\r\nIn a provenance models when defining foreign key (maybe via a TemplateForeignKey class) you can specify inherited/template fields as key-value pairs.\r\nThe data from those fields are then automatically filled out in the gui (but can be manually changed).\r\n\r\nThis may be simpler to implement only for recursive foreign keys.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/476",
          "labels": [
            "Provenance",
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "eurrk\r\nThis is the sort of work that would be good to do but would be a big job especially to make it reasonably generalised and hence reusable.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:29:09Z"
            }
          ]
        },
        {
          "summary": "Potato provenance - string method for varieties",
          "key": "KEA-477",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "should include crop number, maybe description.\r\n```\r\ndef __str__(self):\r\n    \"Ebrida:{0} Crop:{1}\".format(self.EBridaID, self.crop_number)\r\n```\r\n\r\n\r\nNote: it looks like altnames have been added to the description field rather than the altnames table.\r\nThis probably reflects usability issues.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/477",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Add \"todays- date\" option and or calender to GUI",
          "key": "KEA-478",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Date fields currently need to be manually typed.\r\nThere should be a \"todays date\" option and/or a calender for selecting other dates.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/478",
          "labels": [
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "We need to find a Django widget to do this.\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:13:52Z"
            }
          ]
        },
        {
          "summary": "Fill out field with logged in user",
          "key": "KEA-479",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Ideally many fields would be filled out automatically based on the currently logged in user:\r\n- propagated by\r\n- terminated by\r\n\r\nThis would involve connecting usernames to multiple contact/people tables.\r\nIt should leave field empty if it can't make a match (i.e. not throw an error).",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/479",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "This is a good idea and now easier to implement with my new process data handling\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:13:01Z"
            }
          ]
        },
        {
          "summary": "Automatically create location names based on coordinates",
          "key": "KEA-480",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Many location types are best referred to by a combination of their coordinates (atleast one unique coordinate).\r\nThere would ideally be a way of automatically filling in the name field with a template that uses coordinate fields  ",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/480",
          "labels": [
            "Location",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Interesting idea.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:11:49Z"
            },
            {
              "body": "Especially in cases where containers are modeled as locations",
              "author": "tim.millar",
              "created": "2018-07-27T04:12:58Z"
            }
          ]
        },
        {
          "summary": "potato cryo report/view",
          "key": "KEA-481",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Need to display all info related to potato cryopreservation.\r\nThis should include all specimen info with the addition of Dewar Tube, Box and position info",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/481",
          "labels": [
            "Provenance"
          ],
          "comments": [
            {
              "body": "have you done this?\r\nOr did you decide to do something else?",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:11:04Z"
            },
            {
              "body": "yes",
              "author": "tim.millar",
              "created": "2018-07-27T04:11:56Z"
            }
          ]
        },
        {
          "summary": "Datagrid \"NOT\" filter",
          "key": "KEA-482",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "A request has been made for a \"not\" variant of filters.\r\n\r\ne.g. does not contain \"abc\"\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/482",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Larger page sizes are failing with 500 error",
          "key": "KEA-483",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The stack trace is:\r\n```\r\nInternal Server Error: /reports/winescan_juice_report/ Traceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py\", line 132, in get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 145, in inner\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 71, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"./kea/reports/views/grape_and_wine_processes.py\", line 75, in dispatch\r\n    request, *args, **kwargs)\r\n  File \"./kea/datagrid/views/base.py\", line 65, in dispatch\r\n    return super(DataGridView, self).dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 89, in dispatch\r\n    return handler(request, *args, **kwargs)\r\n  File \"./kea/datagrid/views/dynatable.py\", line 35, in post\r\n    return self.form_valid(form)\r\n  File \"./kea/datagrid/views/dynatable.py\", line 56, in form_valid\r\n    json_data = self.to_json(form)\r\n  File \"./kea/datagrid/views/dynatable.py\", line 88, in to_json\r\n    prepared_data[key] = self.get_column_value(row, key)\r\n  File \"./kea/datagrid/views/base.py\", line 90, in get_column_value\r\n    value = self.backend.get_value_from_object(obj, column_name)\r\n  File \"./kea/datagrid/backends/raw_sql_process.py\", line 525, in get_value_from_object\r\n    if the_data_dict[name] == None:\r\nTypeError: 'NoneType' object has no attribute '__getitem__'\r\n```",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/483",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "Require steps to replicate please. I have not managed to trigger this error. I've loaded large enough datasets to cause the javascript to fail.\r\n\r\nBecause this is the process backend that is failing I was testing using the following url\r\n\r\nhttp://localhost:8000/reports/samples_by_experiment/",
              "author": "will.buick",
              "created": "2017-11-02T03:59:03Z"
            },
            {
              "body": "http://localhost:8000/reports/winescan_juice_report/\r\n\r\nLoad 6000 records in datagrid. This will cause 500 error.",
              "author": "will.buick",
              "created": "2017-11-06T22:25:07Z"
            }
          ]
        },
        {
          "summary": "Dead plant marking not working",
          "key": "KEA-486",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The dead plant marking is not finding the correct stuff\n\n\n_Sent from my Lge LG-H815 using [FastHub](https://play.google.com/store/apps/details?id=com.fastaccess.github)_",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/486",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Report spreadsheets displaying dates wrong",
          "key": "KEA-488",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The dates in the spreadsheets downloaded from reports are getting mangled.\r\nThey are randomly swapping month and day.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/488",
          "labels": [],
          "comments": [
            {
              "body": "I can't reproduce this.",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:09:30Z"
            }
          ]
        },
        {
          "summary": "Dead tray batch altname check 500 on duplicate",
          "key": "KEA-489",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the user enters a batch altname on the form for defining the size of the trays for dead plant marking.\r\nIf the entered altname already exists then a 500 error is generated which is ugly and useless to the user.\r\n\r\nWe need to capture this and report the exact problem to the user.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/489",
          "labels": [
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "Markers and mapping.\r\n\r\nedit assignment of trays to plants\r\ncopy sample batch alt name\r\n\r\nadd assignment of trays to plants\r\nuse this altname\r\ntick some boxes\r\nclick save\r\nthrows unique contraint error.",
              "author": "will.buick",
              "created": "2017-11-06T22:39:00Z"
            }
          ]
        },
        {
          "summary": "Correct Dewar Name",
          "key": "KEA-490",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "Correct the dewar name before inserting related locations into Prod (test will need to be updated).\r\n\r\nThe dewer's should also have a parent location of a pfr site or lab",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/490",
          "labels": [
            "Location",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Ability to add multiple processruns of same process in one upload",
          "key": "KEA-491",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The chemists in Blenheim have found that they need to be able to upload data for multiple processruns at the same time.\r\nThey can/should be for the same process.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/491",
          "labels": [
            "Process Handling",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I think we have solved this in a different way now with the cascade functionality",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:34:31Z"
            }
          ]
        },
        {
          "summary": "Data Grid Export Format",
          "key": "KEA-493",
          "status": "To Do",
          "description": "Is there any good reason why there is a blank second row in these by default?\r\n\r\n\r\nPopulation   Altnames | Sample Container Localid | Sample Container Typename | Sample Type | Plate Position Location | Entrydate | Sampledate | Sample Container Location\r\n-- | -- | -- | -- | -- | -- | -- | --\r\nﾂ | ﾂ | ﾂ | ﾂ | ﾂ | ﾂ | ﾂ | ﾂ\r\nrML_022 | BBR9382 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9423 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9426 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9433 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9437 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9451 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9460 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9476 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9481 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\nrML_022 | BBR9487 | Small Bag | Leaf | ﾂ | 2017/06/04 | ﾂ | ﾂ\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/493",
          "labels": [
            "Datagrid",
            "UI Issue",
            "question"
          ],
          "comments": [
            {
              "body": "Umm... cos.\r\nI'll have a look at it :-)\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:33:29Z"
            }
          ]
        },
        {
          "summary": "Kea API gives JSONDecodeError",
          "key": "KEA-494",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Following @wilbuick example notebook (Python 3)\r\n\r\n```\r\n...\r\nresp = requests.get(crop_url, headers=headers)\r\nresp.json()\r\n```\r\nresults in:\r\n```\r\n---------------------------------------------------------------------------\r\nJSONDecodeError                           Traceback (most recent call last)\r\n<ipython-input-26-b88426b512f5> in <module>()\r\n      1 resp = requests.get(crop_url, headers=headers)\r\n----> 2 resp.json()\r\n\r\n/software/programming/pfr-python3-3.6.1/lib/python3.6/site-packages/requests/models.py in json(self, **kwargs)\r\n    883                     # used.\r\n    884                     pass\r\n--> 885         return complexjson.loads(self.text, **kwargs)\r\n    886 \r\n    887     @property\r\n\r\n/software/programming/pfr-python3-3.6.1/lib/python3.6/site-packages/simplejson/__init__.py in loads(s, encoding, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, use_decimal, **kw)\r\n    514             parse_constant is None and object_pairs_hook is None\r\n    515             and not use_decimal and not kw):\r\n--> 516         return _default_decoder.decode(s)\r\n    517     if cls is None:\r\n    518         cls = JSONDecoder\r\n\r\n/software/programming/pfr-python3-3.6.1/lib/python3.6/site-packages/simplejson/decoder.py in decode(self, s, _w, _PY3)\r\n    372         if _PY3 and isinstance(s, binary_type):\r\n    373             s = s.decode(self.encoding)\r\n--> 374         obj, end = self.raw_decode(s)\r\n    375         end = _w(s, end).end()\r\n    376         if end != len(s):\r\n\r\n/software/programming/pfr-python3-3.6.1/lib/python3.6/site-packages/simplejson/decoder.py in raw_decode(self, s, idx, _w, _PY3)\r\n    402             elif ord0 == 0xef and s[idx:idx + 3] == '\\xef\\xbb\\xbf':\r\n    403                 idx += 3\r\n--> 404         return self.scan_once(s, idx=_w(s, idx).end())\r\n\r\nJSONDecodeError: Expecting value: line 5 column 1 (char 4)\r\n\r\n\r\n```",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/494",
          "labels": [
            "API",
            "bug"
          ],
          "comments": [
            {
              "body": "FYI\r\n```\r\n>>> resp.status_code\r\n200\r\n```",
              "author": "tim.millar",
              "created": "2017-09-26T20:44:14Z"
            },
            {
              "body": "Status code is not helpful. Please provide  entire resp.text so I can run it through json.loads() function.",
              "author": "will.buick",
              "created": "2017-09-26T20:57:44Z"
            },
            {
              "body": "```\r\nIn [7]: resp.text\r\nOut[7]: '\\n\\n\\n\\n<!DOCTYPE html>\\n<html>\\n  <head>\\n    \\n\\n      \\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\\n        <meta name=\"robots\" content=\"NONE,NOARCHIVE\" />\\n      \\n\\n      <title>Crop List 窶 Django REST framework</title>\\n\\n      \\n        \\n          <link rel=\"stylesheet\" type=\"text/css\" href=\"/static/rest_framework/css/bootstrap.min.css\"/>\\n          <link rel=\"stylesheet\" type=\"text/css\" href=\"/static/rest_framework/css/bootstrap-tweaks.css\"/>\\n        \\n\\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"/static/rest_framework/css/prettify.css\"/>\\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"/static/rest_framework/css/default.css\"/>\\n      \\n\\n    \\n  </head>\\n\\n  \\n  <body class=\"\">\\n\\n    <div class=\"wrapper\">\\n      \\n        <div class=\"navbar navbar-static-top navbar-inverse\">\\n          <div class=\"container\">\\n            <span>\\n              \\n                <a class=\\'navbar-brand\\' rel=\"nofollow\" href=\\'http://www.django-rest-framework.org\\'>\\n                    Django REST framework\\n                </a>\\n              \\n            </span>\\n            <ul class=\"nav navbar-nav pull-right\">\\n              \\n                \\n                  <li class=\"navbar-text\">cfltxm</li>\\n                \\n              \\n            </ul>\\n          </div>\\n        </div>\\n      \\n\\n      <div class=\"container\">\\n        \\n          <ul class=\"breadcrumb\">\\n            \\n              \\n                <li class=\"active\"><a href=\"/api/crops/\">Crop List</a></li>\\n              \\n            \\n          </ul>\\n        \\n\\n        <!-- Content -->\\n        <div id=\"content\">\\n\\n          \\n            <form id=\"get-form\" class=\"pull-right\">\\n              <fieldset>\\n                \\n                  <div class=\"btn-group format-selection\">\\n                    <a class=\"btn btn-primary js-tooltip\" href=\"/api/crops/\" rel=\"nofollow\" title=\"Make a GET request on the Crop List resource\">GET</a>\\n\\n                    <button class=\"btn btn-primary dropdown-toggle js-tooltip\" data-toggle=\"dropdown\" title=\"Specify a format for the GET request\">\\n                      <span class=\"caret\"></span>\\n                    </button>\\n                    <ul class=\"dropdown-menu\">\\n                      \\n                        <li>\\n                          <a class=\"js-tooltip format-option\" href=\"/api/crops/?format=api\" rel=\"nofollow\" title=\"Make a GET request on the Crop List resource with the format set to `api`\">api</a>\\n                        </li>\\n                      \\n                        <li>\\n                          <a class=\"js-tooltip format-option\" href=\"/api/crops/?format=json\" rel=\"nofollow\" title=\"Make a GET request on the Crop List resource with the format set to `json`\">json</a>\\n                        </li>\\n                      \\n                    </ul>\\n                  </div>\\n                \\n              </fieldset>\\n            </form>\\n          \\n\\n          \\n            <form class=\"button-form\" action=\"/api/crops/\" data-method=\"OPTIONS\">\\n              <button class=\"btn btn-primary js-tooltip\" title=\"Make an OPTIONS request on the Crop List resource\">OPTIONS</button>\\n            </form>\\n          \\n\\n          \\n\\n          \\n\\n            <div class=\"content-main\">\\n              <div class=\"page-header\">\\n                <h1>Crop List</h1>\\n              </div>\\n              <div style=\"float:left\">\\n                \\n                  <p>API endpoint that allows crops to be viewed.<br /><br />retrieve:<br />Return a crop instance<br /><br />list:<br />Return all crops ordered by id</p>\\n                \\n              </div>\\n\\n              \\n\\n              <div class=\"request-info\" style=\"clear: both\" >\\n                <pre class=\"prettyprint\"><b>GET</b> /api/crops/</pre>\\n              </div>\\n\\n              <div class=\"response-info\">\\n                <pre class=\"prettyprint\"><span class=\"meta nocode\"><b>HTTP 200 OK</b>\\n<b>Allow:</b> <span class=\"lit\">GET, OPTIONS</span>\\n<b>Content-Type:</b> <span class=\"lit\">application/json</span>\\n<b>Vary:</b> <span class=\"lit\">Accept</span>\\n\\n</span>{\\n    &quot;count&quot;: 1,\\n    &quot;next&quot;: null,\\n    &quot;previous&quot;: null,\\n    &quot;results&quot;: [\\n        {\\n            &quot;id&quot;: 15,\\n            &quot;Name&quot;: &quot;Funnyfruit&quot;,\\n            &quot;Description&quot;: &quot;For testing and demos&quot;,\\n            &quot;IDPrefix&quot;: &quot;Fun&quot;,\\n            &quot;LastID&quot;: 1779509\\n        }\\n    ]\\n}</pre>\\n              </div>\\n            </div>\\n\\n            \\n              \\n\\n              \\n            \\n        </div><!-- /.content -->\\n      </div><!-- /.container -->\\n    </div><!-- ./wrapper -->\\n\\n    \\n\\n    \\n      <script>\\n        window.drf = {\\n          csrfHeaderName: \"X-CSRFToken\",\\n          csrfCookieName: \"csrftoken\"\\n        };\\n      </script>\\n      <script src=\"/static/rest_framework/js/jquery-1.12.4.min.js\"></script>\\n      <script src=\"/static/rest_framework/js/ajax-form.js\"></script>\\n      <script src=\"/static/rest_framework/js/csrf.js\"></script>\\n      <script src=\"/static/rest_framework/js/bootstrap.min.js\"></script>\\n      <script src=\"/static/rest_framework/js/prettify-min.js\"></script>\\n      <script src=\"/static/rest_framework/js/default.js\"></script>\\n      <script>\\n        $(document).ready(function() {\\n          $(\\'form\\').ajaxForm();\\n        });\\n      </script>\\n    \\n\\n  </body>\\n  \\n</html>\\n'\r\n```",
              "author": "tim.millar",
              "created": "2017-09-26T21:02:20Z"
            },
            {
              "body": "Looks like the url is rendering the html interface for the api. It should return JSON by default so not sure why it's doing that.\r\n\r\nAnyway, adding ?format=json onto the end of the url should fix it from memory.",
              "author": "will.buick",
              "created": "2017-09-26T21:20:18Z"
            },
            {
              "body": "Yup that works, thanks @wilbuick \r\n```\r\n>>> api_url = 'http://keatest.pfr.co.nz/api/{0}/?format=json'\r\n>>> crop_url = api_url.format('crops')\r\n>>> resp = requests.get(crop_url, headers=headers)\r\n>>> resp.json()\r\n{u'count': 1,\r\n u'next': None,\r\n u'previous': None,\r\n u'results': [{u'Description': u'For testing and demos',\r\n   u'IDPrefix': u'Fun',\r\n   u'LastID': 1779509,\r\n   u'Name': u'Funnyfruit',\r\n   u'id': 15}]}\r\n```",
              "author": "tim.millar",
              "created": "2017-09-26T21:33:00Z"
            },
            {
              "body": "Please note that the fix for this is just re-ordering the default renderer classes in the settings file.\r\n\r\nThe rest-framework library will go through the renderer classes in the order that they are defined and pick one based on best match. This is by checking things like the Accept header, querystring params etc.\r\n\r\nI'm not sure if anyone is actually using the html interface to use the api (KeaBrowsableApiRenderer) but this change may make that particular renderer not available in the browser by default. So this \"fix\" is a trade off in usability as to what the default renderer should be.\r\n\r\nSo, knowing all of this you may or may not want to merge in this particular change. If you want further clarification please talk to me.",
              "author": "will.buick",
              "created": "2017-11-09T20:11:10Z"
            }
          ]
        },
        {
          "summary": "Cannonical 'terminate' option/button",
          "key": "KEA-495",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "We need to establish a canonical 'terminate' option for all entities which users can interact with.\r\n\r\nCurrently they have options to delete entities including specimens/samples/locations.\r\nDeleting is OK if they create an entity that was a mistake, but not if the entity was real bu has been thrown out/died/etc.\r\nAs time goes on Kea will become full of entities that where real but have now been  'terminated'.\r\nIt's critical that these entities remain in the DB for the sake of auditing and if they are referenced by other entities (e.g. parent child relationships). \r\n\r\nTo ensure that they don't get deleted and don't clutter up what the user sees we need to have a recycle bin type approach that will flag an entity as 'terminated' and hide it from UI elements (at least by default).",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/495",
          "labels": [
            "enhancement"
          ],
          "comments": [
            {
              "body": "Good idea",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:30:21Z"
            }
          ]
        },
        {
          "summary": "Datagrid-like data entry",
          "key": "KEA-496",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "There are a few use cases emerging where someone has to routinely add a handful of entities to the DB that relate to one another. Doing this manually through the current website is slow and error prone.\r\n\r\nIt would be useful to have a datagrid-like UI element that can be set up for data entry.\r\nI.e. something that we can code to take a set number of named  (and typed) input fields that can then be inserted into the DB via the ORM or as as a single transaction, this would allow for some level of functionality as described in  #476",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/496",
          "labels": [
            "Datagrid",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Datagrid slow for biggish datasets",
          "key": "KEA-497",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "William,\r\nWe need to get this faster.\r\nAs far as I can tell it's not the SQL.\r\nAlthough I have replaced everything to use the rawSQL backend there doesn't appear to be too much time being spent in the backend. (< 0.5 sec)\r\nThe datagrid is taking > 6 secs to respond and often > 20 secs.\r\nPerhaps some profiling is required?\r\nCould you please spend some time trying to characterise what needs to change?\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/497",
          "labels": [
            "Datagrid",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "The slow response times are coming from the raw sql model backend. In my case the query is taking 23 seconds to run when trying to return page 2000 of the samples datagrid.",
              "author": "will.buick",
              "created": "2017-11-02T03:31:21Z"
            },
            {
              "body": "That particular case is certainly one source of slowness but not the important one.\r\n\r\nIf someone is looking at the 100th page of a monstrous result set... don't care.\r\n\r\nGo to the list process-runs page on Kiwifruit. ( process/processrun/search/ )\r\nEven the first page is sloooow (~5secs) . \r\nAnd I don't think that that is being caused by the back-end.\r\nBut I could be convinced otherwise.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-11-02T04:25:00Z"
            },
            {
              "body": "A stab in the dark here. \r\nI cant remember the infrastructure of Kea completely, how difficult is it to set u a docker container running postgres next to kea restore a db and repeat the steps?\r\nThe increase in performance from Kakapo moving out of the shared database was enough for **users** to notice on the quick forms as well as clearing up some of the long running ones.",
              "created": "2017-11-02T18:41:52Z"
            },
            {
              "body": "Lee,\r\nIt's probably easy for William to do this but running Postgres in a Docker container gives me the willies.\r\n(this is probably not rational but I would need to be convinced that DB corruption etc would not be an problem)\r\n\r\nBut as I said earlier in this issue. I'm not convinced it's the DB stuff that's causing the sluggishness anyway. However perhaps we need to look at the available resources for the Postgres server etc.\r\n",
              "author": "zane.gilmore",
              "created": "2017-11-02T21:36:16Z"
            },
            {
              "body": "I agree Zane, initially I was concerned about dockerising to the db, however with the remote volume (actual data) on the host not the container it doesn't seem so bad. This also give you the flexibility to jump versions without testing/upgrading the other 8 systems on the shared host, 9.3 is getting old!\r\n\r\nWe really need someone to optimize the config on the pg servers. they are out of the box config from what I have seen, then have multiple high demand dbs on them...\r\n\r\n23sec for 2000 rows doesn't sound good. Unless this is due to demoralization, then maybe you need to look at Cassandra or similar for the read model - a significant change though.",
              "created": "2017-11-02T22:07:53Z"
            },
            {
              "body": "You're returning a dataset starting at page 2000. 50 results per page means that you have an offset of 100000. Using limit/offset queries in postgres is not an efficient way to paginate over large datasets. Postgres will actually look through the entire dataset until it gets to row 100000 and will return results starting there. This is the reason why it takes 20 seconds to return page 2000 and almost instant when you return page 1.\r\n\r\nThe big problem to switch to something like cassandra is that django (the framework that kea is built on) does not nicely support these type of databases.",
              "author": "will.buick",
              "created": "2017-11-02T22:44:10Z"
            },
            {
              "body": "I have found the problem.\r\n\r\nPlease refer to the following file/line\r\n\r\nkea/processes/views/processrun.py line 496\r\n\r\nProcessRun.objects.get(id = obj['id']).has_started_data_entry()\r\n\r\nThat is running quite a few database queries. So for every record that you are trying to render in the datagrid you are running several database queries. \r\n\r\nI'm not sure exactly how you want to solve this. Will need to discuss with you.",
              "author": "will.buick",
              "created": "2017-11-02T23:11:10Z"
            },
            {
              "body": "So let's prioritise some particular datagrids.\r\nStarting with the Sample search one\r\nIn the crop prov's please ensure that the genotypes and plants are as quick as easily possible.\r\n\r\nWhen I get back we can discuss a better approach.\r\n\r\n\r\n\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2017-11-06T22:31:28Z"
            },
            {
              "body": "I've done some benchmarking of postgres 9.4, 9.6 and 10 using the samples datagrid. Just by using a newer version of postgres you can see some significant speed increases.\r\n\r\nTests were completed using the kiwifruit crop and samples datagrid.\r\n\r\nLoading last page in samples datagrid :\r\n\r\n- 9.4 32 seconds\r\n- 9.6 28 seconds\r\n- 10 30 seconds\r\n\r\nOrder by plant local id (postgres stored function)\r\n\r\n- 9.4 31 seconds\r\n- 9.6 10 seconds\r\n- 10  9 seconds\r\n\r\nSearch for plant localid (postgres stored function)\r\n\r\n- 9.4 54 seconds\r\n- 9.6 42 seconds\r\n- 10 38 seconds\r\n\r\nSo this is an easy way to get more speed without changes to the codebase. I know it's not sub-second, but it's a speed improvement that you can easily get.\r\n\r\nPlease note that these times were taken when running postgres in a docker container in a development environment. It may be faster running on a more powerful machine and/or natively.",
              "author": "will.buick",
              "created": "2017-11-14T00:22:42Z"
            },
            {
              "body": "Code changes that will increase speed.\r\n\r\nhttps://github.com/PlantandFoodResearch/Kea/commit/16a15ac2528af2ac62b73fc3d1ce0dba9987fc54\r\n\r\nThe important one is the change to getplantlocalid postgres function. You were running 3 select queries in that function that was getting data that you already had access to in the main select query. I changed the function to not do any select queries and pass all of the required values using function parameters. This increased the speed considerably, especially when filtering on that column.\r\n\r\nI put the changed function into var/sql/getplantlocalid.sql - You may want to change the name of the function, however it should work just fine with the existing function with the same name because it has different arguments so shouldn't conflict.\r\n\r\nOther changes include\r\n- Added missing indexes\r\n- Separate sql queries between provenance/crop samples to not include unnecessary tables in joins.",
              "author": "will.buick",
              "created": "2017-11-14T03:44:52Z"
            },
            {
              "body": "I'm reasonably sure that this work has been added now.\r\nThough we will always need to be vigilant for speed issues and try to speed things up as we go.",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:24:40Z"
            }
          ]
        },
        {
          "summary": "Moves ample method needs collector assignment ",
          "key": "KEA-498",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The move sample method of the data grinder needs to assign collectors",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/498",
          "labels": [
            "Process Handling",
            "in progress"
          ],
          "comments": [
            {
              "body": "Done now",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:21:59Z"
            }
          ]
        },
        {
          "summary": "Split sample method to be done",
          "key": "KEA-499",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Am about to redo split sample method in datagrinder class.\nNeeds to make use of moves ample method iso external function",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/499",
          "labels": [
            "Process Handling",
            "in progress"
          ],
          "comments": [
            {
              "body": "This became moot after the refactor I think",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:21:29Z"
            }
          ]
        },
        {
          "summary": "Datagrid headers not lining up with data on fullscreen",
          "key": "KEA-500",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the datagrid is set to full screen mode and the headers are more than the width of the screen then the headers lose their matching to the data columns.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/500",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": [
            {
              "body": "OK\r\nThis seems wrong perhaps.\r\nIt might be when the columns are LESS than the width of the screen.",
              "author": "zane.gilmore",
              "created": "2017-11-06T22:06:55Z"
            },
            {
              "body": "I've found a fix  for this that actually allows you to have fixed table headers using a single table. It uses a new bit of css trickery. You can find the code in the issue_500 branch and I'd like you to have a look at it and let me know what you think.\r\n\r\nIt fixes the table header problem but introduces two other issues.\r\n\r\n1. The header table cells are not showing the grey borders\r\n2. The font-awesome icons in the first column appear above the fixed table header when scrolling\r\n\r\nPoint 1 is not possible to fix afaik. Point 2 we can work around by using  <img> tags rather then font-awesome.\r\n\r\nI want to get your thoughts on this approach before I spend more time on it.",
              "author": "will.buick",
              "created": "2017-11-08T23:11:00Z"
            },
            {
              "body": "I think that this is done now",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:20:22Z"
            }
          ]
        },
        {
          "summary": "Final step in Provenance sample init needs \"Submit\" not \"Next\"",
          "key": "KEA-501",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The button marked next in the final step of the provenance sample initialisation needs \"Submit\" denote the final step that will create the batch etc.\r\n\r\nThis is a user interface issue that is causing bad data to be created\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/501",
          "labels": [
            "Provenance",
            "Sample Init",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Sample init for provenance step 2 sample count",
          "key": "KEA-502",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After the user has chosen some samples we want a count of how many have been chosen.\r\nThis will facilitate error checking.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/502",
          "labels": [
            "Provenance",
            "Sample Init",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "Place count at top as well as bottom",
              "author": "will.buick",
              "created": "2017-11-06T22:25:41Z"
            }
          ]
        },
        {
          "summary": "Trial plot default string needs vineyard block added",
          "key": "KEA-503",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "For Trial plot listings we need to see vineyard block as well as plot#\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/503",
          "labels": [],
          "comments": [
            {
              "body": "This is done",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:19:49Z"
            }
          ]
        },
        {
          "summary": "convert juice trial plots to juice specimens",
          "key": "KEA-504",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "We need to convert the trial plots that were created in haste that were actually juices to actual juice specimens.\r\nThese can be identified by trial plot types of:\r\n18Litre KEg,\r\n700ml\r\nand 40l bucket\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/504",
          "labels": [
            "Provenance"
          ],
          "comments": []
        },
        {
          "summary": "filtering on datagrid processdata backend dodgey",
          "key": "KEA-505",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Searches and filtering does not seem to be working properly on the process data columns for reports on the process data.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/505",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "I think this has been fixed a few times over now",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:18:17Z"
            }
          ]
        },
        {
          "summary": "Processrun creation needs sampleextract choice",
          "key": "KEA-506",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a new processrun is created we need to be able to choose extracts instead of samples idf the user so desires.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/506",
          "labels": [
            "Process Handling",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Need pick-n-mix process data reporting",
          "key": "KEA-507",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Need to be able to pull data out of multiple processruns and provide in one report.\r\n\r\nSo we need a mechanism where columns from one process(run) can be matched up with columns from another.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/507",
          "labels": [
            "Process Handling",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Please note that at the end of the file reports/views/grape_and_wine_processes.py I have created a test view called WilliamView to illustrate the functionality of multiple (all) process runs in a single report. This view and corresponding url should be removed during the merge process.",
              "author": "will.buick",
              "created": "2017-11-13T03:03:00Z"
            }
          ]
        },
        {
          "summary": "Add serial number to Dewar Tube locations",
          "key": "KEA-516",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "There are two 'numbers' given to Dewar Tubes (not including barcode or position).\r\n\r\nWhen some tissue is put into cryo several (usually four) duplicates are made.\r\nEach of the duplicates has the same **\"Tube Number\"** which identifies the set of replicates.\r\nEach Tube within a set of replicates has a unique **\"Serial Number\"** which is used to separate each tube within the set (e.g. 1, 2, 3, 4).\r\n\r\n\"Tube number\" is already included in the  Dewar Tube location but \"Serial number\" needs to be added.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/516",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Has this been done?",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:17:34Z"
            },
            {
              "body": "yes",
              "author": "tim.millar",
              "created": "2018-07-27T03:30:10Z"
            }
          ]
        },
        {
          "summary": "Process run results in proxy error on testing",
          "key": "KEA-518",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "I received this via email from Ana Claasen:\r\n\r\n> Slipstream have completed kiwifruit sex testing for PFR and I am currently trying to upload results to Kea. I have been attempting to test the process (Sex screening into plate) in keatest.pfr.co.nz and I keep running into the error below when downloading an excel spreadsheet for the process.\r\n\r\n![image jpg](https://user-images.githubusercontent.com/14065102/32806582-e2f23c44-c9f1-11e7-860d-1215d66bc2a8.jpeg)\r\n\r\n> Do you have any idea what might be causing the issue? Does this seem like an error that may be restricted to Kea test and not Kea actual? I'm not sure if they run on the same server.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/518",
          "labels": [
            "Testing",
            "bug"
          ],
          "comments": [
            {
              "body": "There could be any number of different things causing this. Without actually being on site at PFR to debug this there isn't much that I can do I'm afraid.\r\n\r\nIf you can provide exact replication steps I could try to see if I can generate an error in my development environment, but because of differences between my dev env and keatest/prod this may not be possible.",
              "author": "will.buick",
              "created": "2017-11-15T03:48:02Z"
            },
            {
              "body": "@timothymillar it could a be a reverse proxy timeout. Apache's default is 10 seconds. If the spreadsheet took longer than that to be generated, or if Kea took longer than that to start sending the data for Apache to proxy it, you would get a proxy error.\r\n\r\nI found these in `/var/log/keaapp`:\r\n\r\n```\r\nuwsgi.log:[pid: 18|app: 0|req: 67199/112286] 172.17.0.1 () {46 vars in 1013 bytes} [Wed Nov 15 14:31:23 2017] GET /process/processrun/execute/1548/1548/XL/ => generated 26707 bytes in 172333 msecs (HTTP/1.1 200) 4 headers in 244 bytes (1 switches on core 2)\r\n(...)\r\nuwsgi.log:[pid: 18|app: 0|req: 70267/117379] 172.17.0.1 () {44 vars in 1088 bytes} [Thu Nov 16 11:55:11 2017] GET /process/processrun/execute/1548/1548/XL/ => generated 2581 bytes in 10137 msecs (HTTP/1.1 500) 3 headers in 130 bytes (1 switches on core 4)\r\nuwsgi.log:[pid: 18|app: 0|req: 70269/117383] 172.17.0.1 () {48 vars in 1141 bytes} [Thu Nov 16 11:55:32 2017] GET /process/processrun/execute/1548/1548/XL/ => generated 2581 bytes in 10194 msecs (HTTP/1.1 500) 3 headers in 130 bytes (1 switches on core 3)\r\n```\r\n\r\nYou can try increasing [ProxyTimeout](https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxytimeout) in `/etc/httpd/conf.d/kea.conf` and restarting apache.",
              "author": "eric.burgueﾃｱo",
              "created": "2017-11-15T23:07:51Z"
            },
            {
              "body": "Thanks @eburgueno could you give that a go on the test server? Zane is on leave for a couple of weeks",
              "author": "tim.millar",
              "created": "2017-11-15T23:37:41Z"
            },
            {
              "body": "you can do it yourself I believe :) good chance to test your permissions",
              "author": "eric.burgueﾃｱo",
              "created": "2017-11-15T23:41:58Z"
            },
            {
              "body": "@eburgueno are you suggesting edit `/etc/httpd/conf.d/kea.conf` directly on `aklweb22` or doing it in the [ansible config](https://github.com/PlantandFoodResearch/Kea/blob/d813a0ae299d0a68f3e4162ea0467bf36becbc8f/deploy/ansible/kea.yml) and re deploying?\r\n",
              "author": "tim.millar",
              "created": "2017-11-16T00:58:03Z"
            },
            {
              "body": "Has this been fixed now?",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:16:48Z"
            }
          ]
        },
        {
          "summary": "Fruit speciment for grape and wine",
          "key": "KEA-519",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "For when the sample is a fruit.\r\n\r\nFK's:\r\n- Vine\r\n- Bay\r\n- Row\r\n- Plot ?\r\n\r\nData:\r\n- weight\r\n- brix\r\n\r\nNeed to double check if this is a single fruit or multiple fruit that may be sub divided later although Mark did indicate that it is from a single vine.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/519",
          "labels": [
            "Provenance",
            "enhancement"
          ],
          "comments": [
            {
              "body": "I think this is done now.",
              "author": "zane.gilmore",
              "created": "2018-07-27T03:15:35Z"
            }
          ]
        },
        {
          "summary": "Unwanted blank wells in sample initialisation",
          "key": "KEA-520",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "From Mareike\r\n\r\n> I have an issue with KEA. I have attached the input and output file of the samples I wanted initialised. I have done this in KEAtest.\r\nThey are multiple populations and I didn窶冲 want blank wells between populations- see below, not ticked.\r\nAs you can see in the output file KEA doesn窶冲 fill up a plate. It leaves all or some of the wells in column 12 empty.\r\n\r\n\r\n![image001](https://user-images.githubusercontent.com/14065102/33453791-cd3482ae-d67b-11e7-8cf5-4901fb6529d4.png)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/520",
          "labels": [
            "Sample Init",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "500 error when selecting \"Processes\" without Crop or Provinance",
          "key": "KEA-521",
          "status": "Done",
          "reporter": "tim.millar",
          "description": "Needs to ask user to select crop/prov as it does for location handling\r\n\r\nPS: `theSQL` is a great variable name:\r\n\r\n```\r\nEnvironment:\r\n\r\n\r\nRequest Method: GET\r\nRequest URL: http://localhost:8000/process/processrun/search/\r\n\r\nDjango Version: 1.8.18\r\nPython Version: 2.7.13\r\nInstalled Applications:\r\n('django.contrib.auth',\r\n 'django.contrib.admin',\r\n 'django.contrib.contenttypes',\r\n 'django.contrib.sessions',\r\n 'django.contrib.sites',\r\n 'django.contrib.staticfiles',\r\n 'django.contrib.messages',\r\n 'bootstrap3',\r\n 'import_export',\r\n 'elasticutils',\r\n 'crispy_forms',\r\n 'rest_framework',\r\n 'rest_framework.authtoken',\r\n 'rest_framework_swagger',\r\n 'kea.pndata',\r\n 'kea.core',\r\n 'kea.elasticsearch',\r\n 'kea.datagrid',\r\n 'kea.choose',\r\n 'kea.excel',\r\n 'kea.crops',\r\n 'kea.users',\r\n 'kea.batch',\r\n 'kea.populations',\r\n 'kea.plants',\r\n 'kea.genotypes',\r\n 'kea.samples',\r\n 'kea.ebrida',\r\n 'kea.locations',\r\n 'kea.reports',\r\n 'kea.provenance',\r\n 'kea.processes',\r\n 'kea.api',\r\n 'provenance.funny',\r\n 'provenance.cereal_breeding',\r\n 'provenance.grape_and_wine',\r\n 'provenance.potato_auditing',\r\n 'provenance.biosecurity',\r\n 'debug_toolbar',\r\n 'django_extensions')\r\nInstalled Middleware:\r\n('django.middleware.common.CommonMiddleware',\r\n 'django.contrib.sessions.middleware.SessionMiddleware',\r\n 'django.contrib.auth.middleware.AuthenticationMiddleware',\r\n 'django.contrib.messages.middleware.MessageMiddleware',\r\n 'kea.core.middleware.CropOrProvenanceMiddleware',\r\n 'kea.crops.middleware.CropMiddleware',\r\n 'kea.provenance.middleware.ProvenanceMiddleware',\r\n 'kea.users.middleware.SetUsernameCookieMiddleware',\r\n 'debug_toolbar.middleware.DebugToolbarMiddleware')\r\n\r\n\r\nTraceback:\r\nFile \"/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py\" in get_response\r\n  132.                     response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\nFile \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\" in inner\r\n  145.                     return func(*args, **kwargs)\r\nFile \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\" in view\r\n  71.             return self.dispatch(request, *args, **kwargs)\r\nFile \"/app/kea/datagrid/views/base.py\" in dispatch\r\n  64.         self.setup(request, *args, **kwargs)\r\nFile \"/app/kea/datagrid/views/base.py\" in setup\r\n  57.             self.backend = self.get_backend(request, *args, **kwargs)\r\nFile \"/app/kea/datagrid/views/base.py\" in get_backend\r\n  69.         return self.backend_class(**self.get_backend_kwargs(request, *args, **kwargs))\r\nFile \"/app/kea/processes/views/processrun.py\" in get_backend_kwargs\r\n  459.             'query': theSQL,\r\n\r\nException Type: UnboundLocalError at /process/processrun/search/\r\nException Value: local variable 'theSQL' referenced before assignment\r\n\r\n```",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/521",
          "labels": [
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "resampling spreadsheets not showing on old spreadsheet list",
          "key": "KEA-525",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "From Ana Claasen:\r\nI tried to locate an old sample batch initialisation file which was generated using the 'Resample populations' tool. I couldn't find them in the 'Old files' table. Are the resample batch files not able to be found on this table?\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/525",
          "labels": [
            "Sample Init",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "recreating a token gives unique constraint error",
          "key": "KEA-526",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I try to recreate my token I get this error:\r\n```\r\nInternal Server Error: /api/users/generate-api-key/ Traceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py\", line 132, in get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 145, in inner\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 71, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 34, in _wrapper\r\n    return bound_func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/contrib/auth/decorators.py\", line 22, in _wrapped_view\r\n    return view_func(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 30, in bound_func\r\n    return func.__get__(self, type(self))(*args2, **kwargs2)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 34, in _wrapper\r\n    return bound_func(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/contrib/auth/decorators.py\", line 22, in _wrapped_view\r\n    return view_func(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/utils/decorators.py\", line 30, in bound_func\r\n    return func.__get__(self, type(self))(*args2, **kwargs2)\r\n  File \"./kea/api/views/token.py\", line 25, in dispatch\r\n    return super(UserApiTokenView, self).dispatch(request, *args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/views/generic/base.py\", line 89, in dispatch\r\n    return handler(request, *args, **kwargs)\r\n  File \"./kea/api/views/token.py\", line 32, in post\r\n    key.save()\r\n  File \"/usr/local/lib/python2.7/site-packages/rest_framework/authtoken/models.py\", line 35, in save\r\n    return super(Token, self).save(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 734, in save\r\n    force_update=force_update, update_fields=update_fields)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 762, in save_base\r\n    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 846, in _save_table\r\n    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/base.py\", line 885, in _do_insert\r\n    using=using, raw=raw)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/manager.py\", line 127, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/query.py\", line 920, in _insert\r\n    return query.get_compiler(using=using).execute_sql(return_id)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/models/sql/compiler.py\", line 974, in execute_sql\r\n    cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/utils.py\", line 98, in __exit__\r\n    six.reraise(dj_exc_type, dj_exc_value, traceback)\r\n  File \"/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"./kea/core/db/backends/postgresql_psycopg2/base.py\", line 32, in execute\r\n    return self.cursor.execute(operation, params)\r\nIntegrityError: duplicate key value violates unique constraint \"authtoken_token_user_id_key\"\r\nDETAIL:  Key (user_id)=(13) already exists.\r\n```",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/526",
          "labels": [
            "API",
            "bug"
          ],
          "comments": [
            {
              "body": "I am reasonably sure that this has been fixed now.\r\nHowever it's possible to create something similar when there are permission problems.\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T02:54:00Z"
            }
          ]
        },
        {
          "summary": "Fill whole plates despite population ends",
          "key": "KEA-527",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When initialising samples in eBrida upload,\r\nthe wells at the end of the plate sequence are skipped when the population will only just go beyond the end of the plate.\r\n\r\nThere has been a request to provide the ability to disable this.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/527",
          "labels": [
            "Sample Init",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "resample choose plant datagrid not respecting untick after select all",
          "key": "KEA-528",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When selecting the plants to be resampled in the datagrid the user will often click on the top left tick box to tick every plant on the page then unselect a few plants.\r\n\r\nRight now the datagrid is returning every plant in the page regardless of the unticked boxes when the top left tick box is ticked.\r\n\r\nWe need to ensure that the unticked boxes are respected.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/528",
          "labels": [
            "Datagrid",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "I can't replicate this now.\r\nPerhaps it was browser related?\r\n",
              "author": "zane.gilmore",
              "created": "2018-07-27T02:51:46Z"
            }
          ]
        },
        {
          "summary": "proxy error on processrun create spreadsheet",
          "key": "KEA-529",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When trying to create a spreadsheet on a particular processrun we are getting a \"Proxy Error\":\r\n```\r\nProxy Error\r\n\r\nThe proxy server received an invalid response from an upstream server.\r\nThe proxy server could not handle the request GET /process/processrun/execute/1548/1548/XL/.\r\n\r\nReason: Error reading from remote server\r\n```\r\nThe process (id= 1588 on the test server) have about 4700 samples.\r\nSo I am thinking that we may have some sort of time-out problem with the docker container or similar.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/529",
          "labels": [
            "Process Handling",
            "bug"
          ],
          "comments": [
            {
              "body": "Yes, that is exactly what this is\r\n\r\ndeploy/docker/web/run_web.sh needs to be changed\r\n\r\nTry adding the --http-timeout=600 parameter\r\n\r\nuwsgi --http-auto-chunked --http-keepalive --logto=/app/var/log/uwsgi.log \r\n\r\nbecomes\r\n\r\nuwsgi --http-auto-chunked --http-keepalive --logto=/app/var/log/uwsgi.log --http-timeout=600\r\n\r\nThen push out a new release.",
              "author": "will.buick",
              "created": "2017-12-11T02:46:06Z"
            },
            {
              "body": "Did that and redeployed to test.\r\nIt did not work.\r\nWhat about that healthcheck thing?\r\nHow does that work?\r\n",
              "author": "zane.gilmore",
              "created": "2017-12-12T22:21:36Z"
            },
            {
              "body": "You also may need to adjust the proxy timeout on the apache side also.",
              "author": "will.buick",
              "created": "2017-12-12T23:02:40Z"
            },
            {
              "body": "Eric,\r\n could you please set:\r\nProxyTimeout 1200\r\n\r\nIn the Apache settings virtualhost.\r\nThanks",
              "author": "zane.gilmore",
              "created": "2017-12-13T02:30:02Z"
            },
            {
              "body": "Done in test",
              "author": "eric.burgueﾃｱo",
              "created": "2017-12-13T03:06:10Z"
            }
          ]
        },
        {
          "summary": "text filtering on provenance-admin datagrids always returns nothing",
          "key": "KEA-532",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When a filter of any kind is entered into a text field provenance table datagrid it always returns no rows.\r\nNumeric column filtering seems to work.\r\n\r\nReports and other datagrids do not seem to show the same problem.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/532",
          "labels": [
            "Datagrid",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Seems to fixed now",
              "author": "zane.gilmore",
              "created": "2018-07-27T02:46:03Z"
            }
          ]
        },
        {
          "summary": "Grape and Wine Juice etc Datafix",
          "key": "KEA-533",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "We need to sort out the juices and wines that have been put into trial plots.\r\nWe also need to ensure that we are going to accommodate the data that the likes of Claire Grose will be entering.\r\n\r\n\r\nWith this in mind we have decided to:\r\n- The new tables are defined by the attached spreadsheets\r\n[storedjuice (8).xlsx](https://github.com/PlantandFoodResearch/Kea/files/1570163/storedjuice.8.xlsx)\r\n[trialplot (54).xlsx](https://github.com/PlantandFoodResearch/Kea/files/1570165/trialplot.54.xlsx)\r\n\r\n\r\n- leave some of the juices in trial plots. In \"marcs_data_to_fix\" file the ones marked as juice or wine are to be removed and added to juice table.\r\n- add Vintage to the trial plot table. compulsory... will need to give a useful default\r\n- add container-type to trialplot non-compulsory\r\n- remove initial volume and units from stored juice\r\n- concat the present data in stored juice for the previous bullet to description to preserve the data.\r\n- add container-type to stored juice\r\n[marcs_data_to_fix_20171212.xlsx](https://github.com/PlantandFoodResearch/Kea/files/1570117/marcs_data_to_fix_20171212.xlsx)\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/533",
          "labels": [
            "Provenance",
            "in progress"
          ],
          "comments": []
        },
        {
          "summary": "API query parameter filtering.",
          "key": "KEA-534",
          "status": "Done",
          "reporter": "roy.storey",
          "description": "Like the browsing samples etc... issue that existed yesterday, but this affects the API queries.\r\n\r\nThis could be confounded by my lack of understanding/poor usage (PlantandFoodResearch/kea_notebooks#3) so I include a trace of what is going over the wire.\r\n\r\nFor reference [this](http://kea.pfr.co.nz/plateChoose/53953/) is the plate (SampleContainer LocalID) in the query\r\n\r\n```\r\n-- Blocking request (http://kea.pfr.co.nz/api/crop/15/samples/?format=json&SampleContainer__LocalID=1HP4)\r\n-- Connect 107aea013b945c4b596901af3b281d95 (http://proxy.pfr.co.nz:8080)\r\n-- Client >>> Server (http://kea.pfr.co.nz/api/crop/15/samples/?format=json&SampleContainer__LocalID=1HP4)\r\nGET http://kea.pfr.co.nz/api/crop/15/samples/?format=json&SampleContainer__LocalID=1HP4 HTTP/1.1\\x0d\r\nHost: kea.pfr.co.nz\\x0d\r\nAccept: application/json\\x0d\r\nContent-Length: 0\\x0d\r\nAuthorization: Token e9cb88c21ce0eb0af9cd0f655ccd46f38e640837\\x0d\r\nUser-Agent: kea-client (0.1)\\x0d\r\nAccept-Encoding: gzip\\x0d\r\n\\x0d\r\n\r\n-- Client >>> Server (http://kea.pfr.co.nz/api/crop/15/samples/?format=json&SampleContainer__LocalID=1HP4)\r\n\r\n-- Client <<< Server (http://kea.pfr.co.nz/api/crop/15/samples/?format=json&SampleContainer__LocalID=1HP4)\r\nHTTP/1.1 200 OK\\x0d\r\nDate: Wed, 20 Dec 2017 20:04:41 GMT\\x0d\r\nServer: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips\\x0d\r\nVary: Accept,Cookie\\x0d\r\nContent-Type: application/json\\x0d\r\nAllow: GET, OPTIONS\\x0d\r\nSet-Cookie: username=hrards; Path=/\\x0d\r\nTransfer-Encoding: chunked\\x0d\r\n\\x0d\r\n34\\x0d\r\n{\"count\":0,\"next\":null,\"previous\":null,\"results\":[]}\r\n-- Client <<< Server (http://kea.pfr.co.nz/api/crop/15/samples/?format=json&SampleContainer__LocalID=1HP4)\r\n\\x0d\r\n0\\x0d\r\n\\x0d\r\n```",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/534",
          "labels": [
            "API"
          ],
          "comments": [
            {
              "body": "@timothymillar help me, what's missing?",
              "author": "roy.storey",
              "created": "2018-01-17T04:30:28Z"
            },
            {
              "body": "@kiwiroy It looks like you are using the wrong crop number \r\n> `http://kea.pfr.co.nz/api/crop/15`\r\n\r\nKiwifruit is crop 2 (It took me way too long to figure this out)\r\n\r\nThis works for me:\r\n```\r\nsample_container_url = '{}/crop/{}/sample-containers/'.format(api_url, 2)  # crop number = 2\r\n\r\nsearch_params = {\r\n    'LocalID': '1HP4',\r\n}\r\n\r\nresp = requests.get(sample_container_url, headers=headers, params=search_params)\r\n\r\ndata = resp.json()\r\n\r\nprint(json.dumps(data, indent=4))\r\n```",
              "author": "tim.millar",
              "created": "2018-01-18T00:08:14Z"
            },
            {
              "body": "Just so you're aware, permissions are tied to crops/provinence in Kea which will be why you need to specify the correct crop to pull data associated with that crop",
              "author": "tim.millar",
              "created": "2018-01-18T00:29:27Z"
            },
            {
              "body": "superb.",
              "author": "roy.storey",
              "created": "2018-01-18T21:47:09Z"
            }
          ]
        },
        {
          "summary": "Prov sample init specimen choice Datagrid, filter popup textboxes not accepting focus",
          "key": "KEA-535",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When initialising samples in a provenance (only checked Grape and Wine) and the datagrid is brought up to choose which specimens are to be sampled, the datagrid that comes up produces filter pop-ups that will not accept text entry focus.\r\n\r\nThis means that the user can't enter a filter on the datagrid.\r\n\r\nIt might be pertinent that when one clicks outside the datagrid after briniging up a filter popup, the popup stays there and will then accept focus.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/535",
          "labels": [
            "Datagrid",
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "add uploaded sample count to browse processruns",
          "key": "KEA-536",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Marc  wants the count of how many samples have been uploaded in a processrun already.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/536",
          "labels": [
            "Process Handling",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "API docs page not showing full list of endpoints",
          "key": "KEA-537",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "The automatically created Swagger page for the API is not showing the full list of endpoints.\r\nIt is missing samples and genotypes and plants.\r\nAnd it appears to be showing some sort of error at the bottom of the page.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/537",
          "labels": [
            "API",
            "bug"
          ],
          "comments": [
            {
              "body": "It turned out that I did not understand the structure of the API.\r\nSamples are either taken from the crop or provenance section.",
              "author": "zane.gilmore",
              "created": "2018-07-27T02:42:34Z"
            }
          ]
        },
        {
          "summary": "sample initialisation with specimen upload file",
          "key": "KEA-538",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Perhaps a interface where uploading the list of specimens instead of choosing them from the datagrid.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/538",
          "labels": [
            "Provenance",
            "Sample Init",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Dates on datgrid dumps are swapping month/day",
          "key": "KEA-539",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When a Excel dump is taken from a process report the some of the dates are swapping day and month numbers in the spreadsheet.\r\n\r\nThis only seems to happen when the numbers are below 12.\r\nSee Berry Analysis report.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/539",
          "labels": [
            "Datagrid",
            "bug"
          ],
          "comments": [
            {
              "body": "This is apparently not fixed.\r\nPlease see email I will also send you\r\n",
              "author": "zane.gilmore",
              "created": "2018-02-21T01:07:54Z"
            },
            {
              "body": "I'm not able to replicate this. I'm testing in latest master branch and the dates are being rendered correctly. Are you sure that this fix is on production?",
              "author": "will.buick",
              "created": "2018-02-21T04:17:17Z"
            }
          ]
        },
        {
          "summary": "Choking with One PI",
          "key": "KEA-541",
          "status": "To Do",
          "description": "\r\n```\r\nPedigree Item | Plot | LotId | Group | Mother | Father | Barcode | BreederName | Synonyms | From Ped. Item | Start Date | Plot Location\r\n-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --\r\nCK13_03 | 83 | 753712 | ﾂ | ﾂ | ﾂ | KKCB03\\|0083 | Russell Lowe | G2A1 | CK13_03 | 07/12/2015 | K97.03-06-01a\r\n```\r\nfails with\r\n\r\n>[2018-01-25 17:08:23,752][kea.ebrida.management.commands.ebrida_import][WARNING] Row#:6 Column:Pedigree Item...Genotype already exists with CK13_03 as an altname",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/541",
          "labels": [
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "maintain order of specimen types at sample init",
          "key": "KEA-542",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "when samples are initialised in provenance we need to enure that the sample id order has some determinacy.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/542",
          "labels": [
            "Provenance",
            "Sample Init",
            "bug"
          ],
          "comments": [
            {
              "body": "Marc says he wants the order to be of the provenance.\r\ni.e. for trialplot samples order them by their trialplot ids.\r\n",
              "author": "zane.gilmore",
              "created": "2018-03-07T03:57:25Z"
            }
          ]
        },
        {
          "summary": "Wonky Lot ID",
          "key": "KEA-543",
          "status": "To Do",
          "description": "This looks wrong but its a doubled up vine from Tissue culture I believe\r\n\r\n\r\n| PlantID     | Sample ID | Population | Plant Alt Names                 | Collection Date | Plate No | Position on Plate(s) | Plant Location:Kiwifruit Orchard Vine | Row | Block | Vine ID | Bay Number | Plant Parent Location |\r\n|-------------|-----------|------------|---------------------------------|-----------------|----------|----------------------|---------------------------------------|-----|-------|---------|------------|-----------------------|\r\n| Kiw1L1F7.01 | BCA9914   | POP0Y1D    | 733543, 733121, 754275, CK51_09 |                 | 1VPY     | E4                   | T15.25-04-01a                         | 04  | 25    | a       | 01         | Te Puke               |\r\n| Kiw1L1F7.01 | BCA9915   | POP0Y1D    | 733543, 733121, 754275, CK51_09 |                 | 1VPZ     | E4                   | T15.25-04-01a                         | 04  | 25    | a       | 01         | Te Puke               |\r\n| Kiw1L1F7.01 | BCA9916   | POP0Y1D    | 733543, 733121, 754275, CK51_09 |                 | 1VPY     | F4                   | T15.25-04-01a                         | 04  | 25    | a       | 01         | Te Puke               |\r\n| Kiw1L1F7.01 | BCA9917   | POP0Y1D    | 733543, 733121, 754275, CK51_09 |                 | 1VPZ     | F4                   | T15.25-04-01a                         | 04  | 25    | a       | 01         | Te Puke               |\r\n\r\n\r\n### eBrida trial entry is\r\n\r\n\r\n| TrlId | Trial_Type      | Trial_Name                  | PlotId  | Plot | Pedigree_Item | Group_Code    | From_Breeding_Operation | Subprogram_ObsDate | Subprogram | BarCodeString | Psa | PsaSecSymp | sexObs | sexPred | sexTestRes | Contract | VineStatus | Stock_Value | posInTray_ObsDate | posInTray | keaId_plot | Plate | NumberOfPlants | LotId  | PdiId | id     |\r\n|-------|-----------------|-----------------------------|---------|------|---------------|---------------|-------------------------|--------------------|------------|---------------|-----|------------|--------|---------|------------|----------|------------|-------------|-------------------|-----------|------------|-------|----------------|--------|-------|--------|\r\n| 1094  | Transplantation | Te Puke Collection Block 25 | 1138323 | 139  | CK51_09       | T15.25-04-01a | Import Collections TP   |                    |            | TPCB25|0139   |     |            |        |         |            |          |            | 1           |                   |           |            |       | 1              | 733543 | 19816 | 257813 |\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/543",
          "labels": [
            "Sample Init"
          ],
          "comments": [
            {
              "body": "Should be:\r\n\r\n> T15.25-04-01a TPCB25|0139 733543\r\n\r\n> T13.12W-06-04b TPCB12W|0248  726559",
              "created": "2018-02-14T02:07:18Z"
            }
          ]
        },
        {
          "summary": "Settled juice date filtering broken",
          "key": "KEA-544",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "This may be for all reports",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/544",
          "labels": [],
          "comments": [
            {
              "body": "Not for all reports but for only the process data.\r\nAnd having a filter on a process date breaks other date filtering on non-process data",
              "author": "zane.gilmore",
              "created": "2018-06-15T00:55:29Z"
            },
            {
              "body": "Fixed",
              "author": "zane.gilmore",
              "created": "2018-07-27T02:39:09Z"
            }
          ]
        },
        {
          "summary": "Markers and Mapping processes not quite working",
          "key": "KEA-548",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "The plates one is not setting the sample container properly.\r\n\r\nI need to properly check what's going on.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/548",
          "labels": [],
          "comments": []
        },
        {
          "summary": "split 6 process not handling errors properly",
          "key": "KEA-549",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Need to ensure that on error that the process spreadsheet upload does not save the data.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/549",
          "labels": [],
          "comments": [
            {
              "body": "This is done now.\r\nWhen one of the splits is empty it is ignored.\r\n",
              "author": "zane.gilmore",
              "created": "2018-06-14T04:49:07Z"
            }
          ]
        },
        {
          "summary": "process file names need filtering",
          "key": "KEA-550",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When the processrun name has chars like semicolons the filenames can break all sorts of things.\r\nSome sort of filtering needs to take place before the filename is created",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/550",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Specimen IDs in processrun spread sheets (feature)",
          "key": "KEA-551",
          "status": "To Do",
          "reporter": "tim.millar",
          "description": "@zanejg \r\nWhen executing a processrun with a large number of samples it can be confusing.\r\nIs it possible to include the specimen Id in the first column before the sample ID?\r\nI know this is a stretch...",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/551",
          "labels": [
            "Process Handling"
          ],
          "comments": [
            {
              "body": "Probably a good idea.\r\nAnd now a bit easier",
              "author": "zane.gilmore",
              "created": "2018-07-27T04:50:01Z"
            }
          ]
        },
        {
          "summary": "berry analysis and harvest processes need merging into one report",
          "key": "KEA-552",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "The Grape and Wine people need to be able to see the data from Berry analysis and Harvest togther on one report.\r\nThis will require putting the JSON data from 2 processes together.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/552",
          "labels": [
            "Process Handling",
            "Report"
          ],
          "comments": []
        },
        {
          "summary": "Header Capitalisation of Datagrid Spreadsheet Dumps",
          "key": "KEA-553",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "The headers for many of the datagrid spreadsheet dumps are having their capitalisation modified somewhere.\r\nThis means pH is being changed to Ph and mg/L is being changed to Mg/L \r\n(which actually changes the meaning to mega-grams/litre!)\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/553",
          "labels": [
            "Datagrid",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Add link to KeaWiki on the Kea app",
          "key": "KEA-554",
          "status": "Done",
          "reporter": "eric.burgueﾃｱo",
          "description": "As discussed at the Kea Users Meeting in PN, we should have a link to KeaWiki somewhere in Kea (perhaps a \"Help\" link next to \"Report issue\"?)",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/554",
          "labels": [
            "UI Issue",
            "enhancement"
          ],
          "comments": [
            {
              "body": "Yes this will be done",
              "author": "zane.gilmore",
              "created": "2018-09-21T04:44:02Z"
            },
            {
              "body": "'tis done",
              "author": "zane.gilmore",
              "created": "2018-10-12T01:05:49Z"
            }
          ]
        },
        {
          "summary": "Altnames in plate maps",
          "key": "KEA-556",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "A request has been made that we display the plant altnames in the plate maps in batch spreadsheets.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/556",
          "labels": [
            "Sample Init",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "The quick batch is producing data list in reverse order",
          "key": "KEA-557",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Apparently the data tab of the quick batch list is in the reverse order to what they are used to.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/557",
          "labels": [
            "Sample Init",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "Some unit handling required",
          "key": "KEA-558",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "Working with the Grape and Wine people who mainly deal with the chemistry of their samples has made it obvious that we may need to be able to deal with measurement units a bit more intelligently.\r\n\r\nUsing something like [Pint]( https://pint.readthedocs.io/en/latest/ ) could simplify things.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/558",
          "labels": [
            "UI Issue",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "Selection popups not working properly",
          "key": "KEA-559",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "For \r\n- the plant selection in \"Quick batch\"\r\n- Populations selection in \"Intialise Multi-population\"\r\nThe selection popup seems to be set for single selection when multiple selection is required\r\n\r\ne.g. Populations selection in \"Intialise Samples\" is correctly set to single selection.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/559",
          "labels": [
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-15T18:37:14Z"
            },
            {
              "body": "looks good",
              "author": "zane.gilmore",
              "created": "2019-12-16T20:28:04Z"
            }
          ]
        },
        {
          "summary": "Str decode problem on creation of XL file in process",
          "key": "KEA-560",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I click on the create XL file icon in a process, I get a decode issue.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/560",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed! ",
              "author": "rodrigo.otero",
              "created": "2019-12-08T18:31:16Z"
            },
            {
              "body": "Looks good",
              "author": "zane.gilmore",
              "created": "2019-12-09T21:58:28Z"
            }
          ]
        },
        {
          "summary": "Sample selection popup is single select in process create",
          "key": "KEA-561",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "the sample selection popup is set to single select in the \"Create Process Run\" tab.\r\nProbably connected to #559 \r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/561",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed. Would you please test it again ?",
              "author": "rodrigo.otero",
              "created": "2019-12-07T16:41:53Z"
            },
            {
              "body": "You have fixed the ability to select more than one sample.\r\nHowever there is still no \"select all\" button which will toggle the select of all of the entities on the page.\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-09T21:02:54Z"
            },
            {
              "body": "Sorry about that, fixed now!",
              "author": "rodrigo.otero",
              "created": "2019-12-15T18:37:26Z"
            },
            {
              "body": "looks good",
              "author": "zane.gilmore",
              "created": "2019-12-16T21:53:14Z"
            },
            {
              "body": "After activating the Kauri Dieback provenance and tried to initialise some samples discovered the same issue again.\r\nPerhaps I should create a new issue but it seems like the same problem.",
              "author": "zane.gilmore",
              "created": "2020-04-07T03:53:50Z"
            },
            {
              "body": "Hi Zane,\r\n\r\nCould you pleas give me the steps to replicate it?\r\n\r\nI see no \"Kauri Dieback\" in the provenance dropdown.\r\n\r\n![kea](https://user-images.githubusercontent.com/5288675/78688423-a0d18000-78cb-11ea-8b93-d505f930e3ba.png)\r\n",
              "author": "rodrigo.otero",
              "created": "2020-04-07T15:31:41Z"
            },
            {
              "body": "Are you using the new DB?\r\n\r\nIf you are then you will have to add your user to the Kauri-Dieback list in the \"Provenance-User Management\" i/f.\r\nLink on main page on the right, that is if you are set to be a superuser.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-04-07T20:27:22Z"
            },
            {
              "body": "Hi Zane,\r\n\r\nThanks for the reply.\r\n\r\nI'm still on \"py3\" and select multiple is working ok for me.\r\n\r\nAm i in the right place?\r\n\r\n![1](https://user-images.githubusercontent.com/5288675/78800180-88c43400-7991-11ea-88d5-a81a50c0262e.png)\r\n![2](https://user-images.githubusercontent.com/5288675/78800183-8a8df780-7991-11ea-99c7-64133329d48d.png)\r\n![3](https://user-images.githubusercontent.com/5288675/78800185-8b268e00-7991-11ea-811b-02c21c570c6d.png)\r\n",
              "author": "rodrigo.otero",
              "created": "2020-04-08T15:08:21Z"
            }
          ]
        },
        {
          "summary": "LDAP authentication not working",
          "key": "KEA-562",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I can't authenticate using my LDAP login.\r\nI realise that I might have to fix this one but I might need a hand.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/562",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "It seems that the day that I tested this originally was the day that some changes were happening on the AD servers.\r\nIt seems to be all working now.",
              "author": "zane.gilmore",
              "created": "2020-01-28T01:00:40Z"
            }
          ]
        },
        {
          "summary": "Sample init final step  \"'float' object cannot be interpreted as an integer\"",
          "key": "KEA-563",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "On the final step of \"Sample Initialisation\".\r\nThe above error is created.\r\nThis is for a non-zero plate-set and 200 plants.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/563",
          "labels": [
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-10T12:52:10Z"
            },
            {
              "body": "looks good",
              "author": "zane.gilmore",
              "created": "2019-12-11T23:02:21Z"
            }
          ]
        },
        {
          "summary": "Genotype editing from \"View Data\"-Genotypes not populating form",
          "key": "KEA-564",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I click the edit icon in the Genotype list from the View Data.\r\nThe form for editing the Genotype is not pre-populated with the correct data.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/564",
          "labels": [
            "Datagrid",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "The same for Plants.\r\nPopulations and Samples seem OK.\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-09T23:05:30Z"
            },
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-15T18:11:36Z"
            },
            {
              "body": "Looks good now thanks",
              "author": "zane.gilmore",
              "created": "2019-12-16T21:55:42Z"
            }
          ]
        },
        {
          "summary": "Type error when swapping or deleting plate wells in \"View Plates\"",
          "key": "KEA-565",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the view plates form thethere is functionality for editing the contents of plates.\r\nWhen I attempt to delete or swap the wells in a plate I get a type error:\r\n'>' not supported between instances of 'list' and 'int'\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/565",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "The same for swapping wells on Extract Plates.\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-09T23:22:49Z"
            },
            {
              "body": "Fixed.\r\n\r\nIt seems that this was never working as the disinfect method interface does not correspond with its call.\r\n\r\n![disinfect-call](https://user-images.githubusercontent.com/5288675/70537146-c37ea280-1b3e-11ea-986d-1d99c86738e8.png)\r\n![disinfect-interface](https://user-images.githubusercontent.com/5288675/70537148-c37ea280-1b3e-11ea-8610-1e1afff207b2.png)\r\n",
              "author": "rodrigo.otero",
              "created": "2019-12-10T14:18:34Z"
            },
            {
              "body": "That's embarassing :-)\r\nThank you all the same.",
              "author": "zane.gilmore",
              "created": "2019-12-11T23:14:01Z"
            }
          ]
        },
        {
          "summary": "Delete wells on Extract plates not working",
          "key": "KEA-566",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the Extract plates view/form (\"View Data\"-\"Extract Plates\")\r\nDelete icon does nothing.\r\n(also see #565 )\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/566",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "I see no delete icon in the image below.\r\n\r\n\r\nBut i found that going through:       \"see plate\" -> select a sample extract    the delete redirection was not working so i fixed it.\r\n\r\n\r\n![no-delete](https://user-images.githubusercontent.com/5288675/70534153-3258fd00-1b39-11ea-8a44-24d853635b51.png)\r\n\r\n\r\n![delete-button](https://user-images.githubusercontent.com/5288675/70534165-38e77480-1b39-11ea-97a3-7de5a39b7477.png)\r\n\r\n\r\n",
              "author": "rodrigo.otero",
              "created": "2019-12-10T13:38:43Z"
            },
            {
              "body": "Sorry I was not clear.\r\nI meant the same sort of issue as #565  but for sample extract plates.\r\n\r\nAnd I am having the same issues as before. \r\nHowever if this was an existing bug feel free to skip it.\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-11T23:22:53Z"
            },
            {
              "body": "Hi Zane, \r\n\r\nThis error was also happening on python 2.7\r\n\r\nAs it was a syntax error i've fixed it anyway.\r\n\r\nIt was working OK on \"View Data -> Plates\" but not on \"View Data -> Extrat Plates\"",
              "author": "rodrigo.otero",
              "created": "2019-12-16T19:34:05Z"
            },
            {
              "body": "Thanks Rodrigo.\r\n\r\nI now discovered another bug in this. \r\nBut I won't burden you with it.",
              "author": "zane.gilmore",
              "created": "2019-12-16T22:01:54Z"
            }
          ]
        },
        {
          "summary": "Multi-population sample batches type error",
          "key": "KEA-567",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "On the final step of the multi-population batch initialisation:\r\nTypeError at /new-batch/initialise/finished/\r\n'odict_values' object is not subscriptable\r\n\r\nWas using 100 plants per population in the Apple crop.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/567",
          "labels": [
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-10T14:50:20Z"
            },
            {
              "body": "look good",
              "author": "zane.gilmore",
              "created": "2019-12-11T23:25:53Z"
            }
          ]
        },
        {
          "summary": "Process file upload error display is a mess",
          "key": "KEA-568",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After uploading a bad data file into a process, \r\nthe list of errors found are not producing a new-line for each error.\r\nThere is a `<br>` instead.\r\n\r\nPlease Note.\r\nIf you need more information on how to reproduce this error please let me know.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/568",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Hi Zane,\r\n\r\nCan you give me the steps to replicate this error? i couldnt do that",
              "author": "rodrigo.otero",
              "created": "2019-12-11T23:28:12Z"
            },
            {
              "body": "Fixed!",
              "author": "rodrigo.otero",
              "created": "2019-12-12T16:24:42Z"
            },
            {
              "body": "I don't know whether this fixed because there are now a number of bugs that have come up now.\r\nAnd I think that we probably need to deal with them separately.\r\nSo I'm leaving this open until I can see that it is fixed.\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-16T22:25:44Z"
            },
            {
              "body": "This should be ready to re-test.",
              "author": "will.buick",
              "created": "2019-12-17T21:28:11Z"
            },
            {
              "body": "That looks a lot better",
              "author": "zane.gilmore",
              "created": "2019-12-18T02:59:10Z"
            }
          ]
        },
        {
          "summary": "Attribute error on upload of process data file (prob' containing choice field)",
          "key": "KEA-569",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I am getting a consistent error:\r\nAttributeError at /process/processrun/execute/upload/2582/2582/\r\nmodule 'string' has no attribute 'lower'\r\n\r\nWhen I try to upload a data file into a process containing a \"choice\" field.\r\nThe 2 I have tried are:\r\nPyruvate Chemical Assay\r\nSex Screening into plate\r\n\r\nAgain please talk to me if you have problems reproducing this.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/569",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "I couldn replicate it as i don't know the format of the excel file to upload.\r\n\r\nHowever i've changed string.lower to a lambda function to have the same result, it should work.\r\n\r\nfrom:       map(string.lower, fieldDefn[\"Choices\"])\r\nto:           map(lambda x: x.lower(), fieldDefn[\"Choices\"]))",
              "author": "rodrigo.otero",
              "created": "2019-12-10T16:43:51Z"
            },
            {
              "body": "I have written a very quick page to describe some of how the process handling works.\r\n[Process Descriptions](https://github.com/PlantandFoodResearch/Kea/wiki/Process-Decriptions)\r\nSorry it's just grey text. \r\nBut I have run out of time today.",
              "author": "zane.gilmore",
              "created": "2019-12-12T01:46:18Z"
            },
            {
              "body": "William and Rodrigo,\r\nPlease read the above link.\r\nYou can create a process run of one those 2 processes, create a spreadsheet and download it.\r\nThen you can try to upload that spreadsheet after filling in some data.\r\n\r\nIf you need me to explain how it is done etc then let me know\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-18T01:05:27Z"
            },
            {
              "body": "Just checked and all seems ok now",
              "author": "zane.gilmore",
              "created": "2019-12-18T02:59:53Z"
            }
          ]
        },
        {
          "summary": "Sample Extract plate viewer and editor not swapping wells",
          "key": "KEA-570",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When I attempt to swap 2 wells in the Sample Extract Plate viewer/editor it only seems to delete one of them.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/570",
          "labels": [
            "bug"
          ],
          "comments": [
            {
              "body": "Hi Zane,\r\n\r\nIs this something that you would like us to resolve? I see this is only assigned to you.\r\n\r\nThanks,\r\n\r\nWilliam.",
              "author": "will.buick",
              "created": "2019-12-17T19:09:12Z"
            },
            {
              "body": "If it can be done easily.\r\nBut please don't spend very long on it.\r\nIf it hasn't been going for a while then it proabably isn't used much (noone complained :-) )\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-18T01:07:39Z"
            },
            {
              "body": "Would need instructions on how to replicate.",
              "author": "will.buick",
              "created": "2019-12-18T20:44:02Z"
            },
            {
              "body": "Go to a sample extract plate and try to swap 2 wells.\r\n\r\nThis is done by clicking on the green icons inside the 2 wells that you want to swap.",
              "author": "zane.gilmore",
              "created": "2019-12-19T02:05:10Z"
            },
            {
              "body": "Still not sure how this is supposed to work. Is it supposed to swap them rather than delete?",
              "author": "will.buick",
              "created": "2019-12-19T21:36:56Z"
            }
          ]
        },
        {
          "summary": "Attribute error while uploading process data",
          "key": "KEA-571",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I am going to try something new and upload a Django stacktrace html file\r\n[AttributeError_at_process_processrun_execute_upload_2582_2582_.zip](https://github.com/PlantandFoodResearch/Kea/files/3970454/AttributeError_at_process_processrun_execute_upload_2582_2582_.zip)\r\n\r\nHopefully you can unzip it and see the info.\r\n\r\nIt happened when I attempted to upload a file for a process-run of the \"Sex Screening into Plate\" process.\r\nI had entered incorrect choices for the results column to test #568 .\r\n[freddyfrog001--freddyfrog001_Sex_Screening_into_Plate-20191217-111034.zip](https://github.com/PlantandFoodResearch/Kea/files/3970463/freddyfrog001--freddyfrog001_Sex_Screening_into_Plate-20191217-111034.zip)\r\n\r\nHoping this gives you the data you need to fix this issue.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/571",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed (just a typo, my apologies)",
              "created": "2019-12-17T02:18:47Z"
            },
            {
              "body": "No worries,\r\nLooks good now",
              "author": "zane.gilmore",
              "created": "2019-12-18T03:00:51Z"
            }
          ]
        },
        {
          "summary": "NameError after returning to processrun after uploading data",
          "key": "KEA-572",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Again zipping an html Django stacktrace.\r\n[NameError_at _process_processrun_execute_2581_.zip](https://github.com/PlantandFoodResearch/Kea/files/3970480/NameError_at._process_processrun_execute_2581_.zip)\r\n\r\nThis happened when I clicked on the \"Go back to processrun\" link after successfully uploading a data file for that process-run.\r\n\r\nI notice that the bottom exception in the trace is a \"# -*- coding: utf-8 -*- \" line.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/572",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "I have not tested this yet but it should be working.\r\n\r\neval()...... I don't think I need to say any more than that.",
              "author": "will.buick",
              "created": "2019-12-17T02:45:32Z"
            },
            {
              "body": "eeurch.\r\nDid I use eval?\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-18T01:09:50Z"
            },
            {
              "body": "Seems ok",
              "author": "zane.gilmore",
              "created": "2019-12-18T03:01:30Z"
            }
          ]
        },
        {
          "summary": "typeError when getting Printoff of traymaps",
          "key": "KEA-573",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the \"Markers and Mapping\" tab section.\r\nWhen I go to \"Print off tray maps\"\r\nAnd click on any one of the \"Print tray\" links.\r\n\r\nI get \r\n[TypeError_at _trayPlantPrint_12_.zip](https://github.com/PlantandFoodResearch/Kea/files/3971065/TypeError_at._trayPlantPrint_12_.zip)\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/573",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed",
              "author": "rodrigo.otero",
              "created": "2019-12-17T15:57:25Z"
            },
            {
              "body": "Seems to be working now",
              "author": "zane.gilmore",
              "created": "2019-12-18T03:02:45Z"
            }
          ]
        },
        {
          "summary": "Attribute error when clicking on edit plant",
          "key": "KEA-574",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the plant list (Either View Data-> plants or Home page -> Samples Plants)\r\nWhen I click on the edit link I get:\r\n[AttributeError_at_admin_pndata_plant_249375_change_.zip](https://github.com/PlantandFoodResearch/Kea/files/3971088/AttributeError_at_admin_pndata_plant_249375_change_.zip)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/574",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-17T18:45:24Z"
            },
            {
              "body": "looks good",
              "author": "zane.gilmore",
              "created": "2019-12-18T01:33:25Z"
            }
          ]
        },
        {
          "summary": "Sample status report failing sometimes with NameError",
          "key": "KEA-575",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "Sample status reports (eye icon in sample list) is sometimes failing with a NameError.\r\n[NameError_at_reports_sample_status_BBU5452_.zip](https://github.com/PlantandFoodResearch/Kea/files/3971103/NameError_at_reports_sample_status_BBU5452_.zip)\r\n\r\nThis appears to be when the sample is in a Process-Run.\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/575",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "I couldn't replicate this issue, as far as i see it has been fixed yesterday by Patricia.\r\n\r\nCommit: 5e4938aa3a9cc04565033634694e89e95e3b437a\r\n",
              "author": "rodrigo.otero",
              "created": "2019-12-17T16:13:33Z"
            },
            {
              "body": "Yup.\r\nSeems to be going now",
              "author": "zane.gilmore",
              "created": "2019-12-18T03:05:16Z"
            }
          ]
        },
        {
          "summary": "Att' Error at add new entry form for some entities in G and W provenance",
          "key": "KEA-576",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I clicked the \"Add new XXXX\" button for:\r\nBunches\r\nClones\r\nCompanies\r\nCultivation Details\r\nI get:\r\n[AttributeError_at_provenance_provcreate_grape_and_wine_clone_.zip](https://github.com/PlantandFoodResearch/Kea/files/3976486/AttributeError_at_provenance_provcreate_grape_and_wine_clone_.zip)\r\n\r\n\r\nLooks like anything with a textual foreign key perhaps?\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/576",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-18T18:45:25Z"
            },
            {
              "body": "Seems to be working now",
              "author": "zane.gilmore",
              "created": "2019-12-19T02:02:27Z"
            }
          ]
        },
        {
          "summary": "ModuleNotFoundError when downloading skeleton spreadsheet",
          "key": "KEA-577",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I go to download the skeleton spreadsheet for importing data into a table (all of the tables that I tried). \r\nI get:\r\n[ModuleNotFoundError at _provenance_import_grape_and_wine_company_import_.zip](https://github.com/PlantandFoodResearch/Kea/files/3976501/ModuleNotFoundError.at._provenance_import_grape_and_wine_company_import_.zip)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/577",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed, ready to be tested again",
              "created": "2019-12-18T20:43:34Z"
            },
            {
              "body": "Now I'm getting:\r\n[AttributeError at _provenance_import_grape_and_wine_clone_import_.zip](https://github.com/PlantandFoodResearch/Kea/files/3981117/AttributeError.at._provenance_import_grape_and_wine_clone_import_.zip)\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-19T00:25:37Z"
            },
            {
              "body": "See if it's okay now",
              "created": "2019-12-19T00:51:38Z"
            },
            {
              "body": "Can download the skeleton.\r\nNow there's another issue :-/\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-19T02:14:11Z"
            }
          ]
        },
        {
          "summary": "Attribute Error at edit of entity",
          "key": "KEA-578",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I go to edit an entry in the listing of a table in a provenance.\r\nI get:\r\n[AttributeError at _provenance_provedit_grape_and_wine_trialplot_6129_.zip](https://github.com/PlantandFoodResearch/Kea/files/3976542/AttributeError.at._provenance_provedit_grape_and_wine_trialplot_6129_.zip)\r\n\r\nSeems to be for all tables.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/578",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed.",
              "author": "rodrigo.otero",
              "created": "2019-12-18T18:45:21Z"
            },
            {
              "body": "That looks good now.",
              "author": "zane.gilmore",
              "created": "2019-12-19T02:22:13Z"
            }
          ]
        },
        {
          "summary": "Type Error in Init sample in provenance",
          "key": "KEA-579",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After choosing speciment type and trialplots in the G and W provenance I click to the next page in the sequence and get:\r\n[TypeError at _provenance_batch_initialise_complete-selection_.zip](https://github.com/PlantandFoodResearch/Kea/files/3981138/TypeError.at._provenance_batch_initialise_complete-selection_.zip)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/579",
          "labels": [
            "Provenance",
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "Fixed!",
              "author": "rodrigo.otero",
              "created": "2019-12-19T16:05:23Z"
            },
            {
              "body": "looking good",
              "author": "zane.gilmore",
              "created": "2019-12-19T21:51:40Z"
            }
          ]
        },
        {
          "summary": "Exception for sample extract list in Grape and Wine",
          "key": "KEA-580",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In the View Data->Sample Extracts list.\r\nI get \r\n[Exception at _samples_search_sample-extracts_.zip](https://github.com/PlantandFoodResearch/Kea/files/3981152/Exception.at._samples_search_sample-extracts_.zip)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/580",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Hi Zane,\r\n\r\nWas this functionality working properly on py2.7 ?\r\n\r\nI'm taking a look at the code before the upgrade and the SQL query for SampleExtractSearchView class  when you select a provenance has different columns than the ordering.\r\n\r\n![columns](https://user-images.githubusercontent.com/5288675/71205905-20d2cc00-2282-11ea-8d14-4b3ff1d66b84.png)\r\n![column_order](https://user-images.githubusercontent.com/5288675/71205908-229c8f80-2282-11ea-8af6-f7d29e538704.png)\r\n\r\n\r\nWhen i try to check this functionality on 2.7 it raises the next error:\r\n**Exception at /samples/search/sample-extracts/\r\nUnable to detect column class for \"ExtractionDate\"**\r\n\r\nThat's why i couldn't check if it's working ok.\r\n",
              "author": "rodrigo.otero",
              "created": "2019-12-19T20:10:29Z"
            },
            {
              "body": "Not sure what is going on here.\r\nThe functionality seems to work on the live site.\r\n\r\nAnd now it appears to work on my dev instance!\r\nI will look at it properly next year :-)\r\n\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2019-12-19T21:58:29Z"
            },
            {
              "body": "This issue has been fixed. We might have introduced this issue when we ran flake8 over the codebase and fixed any issues it found. But in either case this seems like it was a bug in the original code anyway.",
              "author": "will.buick",
              "created": "2019-12-19T22:36:23Z"
            },
            {
              "body": "This seems to be working now",
              "author": "zane.gilmore",
              "created": "2020-01-24T01:39:02Z"
            }
          ]
        },
        {
          "summary": "TypeError on confirmation step of excel import",
          "key": "KEA-581",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When confirming the import of a import into clone table got this:\r\n[TypeError at _provenance_import_grape_and_wine_clone_finished_.zip](https://github.com/PlantandFoodResearch/Kea/files/3981432/TypeError.at._provenance_import_grape_and_wine_clone_finished_.zip)\r\nAnd am including the file I uploaded.\r\n[clone20191219.zip](https://github.com/PlantandFoodResearch/Kea/files/3981444/clone20191219.zip)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/581",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed!",
              "author": "rodrigo.otero",
              "created": "2019-12-19T16:53:21Z"
            },
            {
              "body": "Working now thanks.",
              "author": "zane.gilmore",
              "created": "2019-12-19T22:01:13Z"
            }
          ]
        },
        {
          "summary": "TypeError on excel import confirmation",
          "key": "KEA-582",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When confirming the import of a import into clone table got this:\r\n[TypeError at _provenance_import_grape_and_wine_clone_finished_.zip](https://github.com/PlantandFoodResearch/Kea/files/3981432/TypeError.at._provenance_import_grape_and_wine_clone_finished_.zip)\r\nAnd am including the file I uploaded.\r\n[clone20191219.zip](https://github.com/PlantandFoodResearch/Kea/files/3981444/clone20191219.zip)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/582",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Aargh this is a duplicate of #581 ",
              "author": "zane.gilmore",
              "created": "2019-12-19T02:24:10Z"
            }
          ]
        },
        {
          "summary": "Trialplots edit form is not populating trials field",
          "key": "KEA-583",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When trying to change a trialplot entry the trials field is not being populated.\r\nThis means it won't allow saving any changes until a trial is chosen.",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/583",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed!",
              "author": "rodrigo.otero",
              "created": "2019-12-19T16:46:39Z"
            },
            {
              "body": "Looks good",
              "author": "zane.gilmore",
              "created": "2019-12-19T21:26:04Z"
            }
          ]
        },
        {
          "summary": "After initialising samples getting \"Page not Found\" on \"Initialise Samples\"",
          "key": "KEA-584",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I initialised some some stored-juice samples in Grape and Wine Provenance.\r\n\r\nAfter downloading the spreadsheet I then went to initialise some some more and got a page not found error.\r\nNot sure whether I have done something wrong or whether this is an old bug.\r\nEither way we need to address it.\r\n[Page not found at _provenance_batch_initialise_complete-selection_.zip](https://github.com/PlantandFoodResearch/Kea/files/4069244/Page.not.found.at._provenance_batch_initialise_complete-selection_.zip)\r\n\r\nLooks like it might be a problem in the wizardy thing you did William.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/584",
          "labels": [
            "Provenance",
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "This is definitely a problem.\r\nI am not able to get at any sample intialisation for any provenance.\r\n",
              "author": "zane.gilmore",
              "created": "2020-01-19T21:15:10Z"
            },
            {
              "body": "Please test again @zanejg ",
              "created": "2020-01-20T21:03:29Z"
            },
            {
              "body": "Looks good",
              "author": "zane.gilmore",
              "created": "2020-01-22T20:51:14Z"
            }
          ]
        },
        {
          "summary": "Crop Sample Init: Single sample container missing in step 2 causing error",
          "key": "KEA-585",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "In step 2 of the:\r\nSample Initialisation->Initialise Samples   Wizard.\r\nThere is no \"Single Sample Container\" info entry stuff.\r\nThis probably then causes this error:\r\n[KeyError at _samples_batch_initialise_complete-selection_.zip](https://github.com/PlantandFoodResearch/Kea/files/4083820/KeyError.at._samples_batch_initialise_complete-selection_.zip)\r\nWhen I click next after filling out the form.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/585",
          "labels": [
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "@zanejg can you please clarify \"There is no \"Single Sample Container\" info entry stuff.\" I am struggling to replicate the error. Thank you",
              "created": "2020-01-20T22:09:01Z"
            },
            {
              "body": "@zanejg could you please follow up on this when you have a minute.",
              "author": "will.buick",
              "created": "2020-01-22T20:57:44Z"
            },
            {
              "body": "Sorry.\r\nMy mistake. \r\nThis is for \"Sample Initialisation->Quick Batch\".\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-01-22T22:03:01Z"
            },
            {
              "body": "@zanejg please test again, i think it's fixed now. My bad, it was an error introduced by me",
              "created": "2020-01-23T00:45:47Z"
            },
            {
              "body": "Looks good",
              "author": "zane.gilmore",
              "created": "2020-01-24T01:39:50Z"
            }
          ]
        },
        {
          "summary": "EBrida Init failing with import error",
          "key": "KEA-586",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "While trying to initialise samples using the EBrida init\r\n(Sample Initialisation->Initialise EBrida)\r\nA import error exception was created and captured:\r\n[Ebrida Sample Batch Status.zip](https://github.com/PlantandFoodResearch/Kea/files/4084044/Ebrida.Sample.Batch.Status.zip)\r\nThis is the file that I used to upload (sorry zipped again because Github won't accept a .xls):\r\n[2x red DNA collection panel Amar and Liz keainit-2_truncated.zip](https://github.com/PlantandFoodResearch/Kea/files/4084047/2x.red.DNA.collection.panel.Amar.and.Liz.keainit-2_truncated.zip)\r\n\r\nAlso when testing with this file you will have to be in the Kiwifuit crop and set the plant location type to \"Kiwifruit Orchard Vine\". I have tested this file on our staging server and it works.\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/586",
          "labels": [
            "EBrida_interface",
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "Fixed!\r\n\r\nGive it a try.",
              "author": "rodrigo.otero",
              "created": "2020-01-22T12:56:20Z"
            },
            {
              "body": "Looks good",
              "author": "zane.gilmore",
              "created": "2020-01-24T01:48:18Z"
            }
          ]
        },
        {
          "summary": "Plant location upload error reporting is funky",
          "key": "KEA-587",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "When a bad file is uploaded to the:\r\nSample Initialisation->Upload Plant Locations,    interface.\r\nWe get this: (included the files dir)\r\n[_ Kea Upload Excel for Sample Batch.zip](https://github.com/PlantandFoodResearch/Kea/files/4084108/_.Kea.Upload.Excel.for.Sample.Batch.zip)\r\n\"thiscoordName\" is in the line.\r\nIt shouldn't be.\r\n\r\nWilliam:\r\nI will look at this. It is in the original on staging and live.\r\n\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/587",
          "labels": [
            "Sample Init",
            "UI Issue",
            "bug"
          ],
          "comments": []
        },
        {
          "summary": "Attribute error in complex process create XL file",
          "key": "KEA-588",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "While executing a complex processrun:\r\n\"A.S. Wilcox May 2016\"\r\nThen clicking on the XL icon of the \"Split extracts into Plate\" just above \"Pyruvate Chemical Assay\"\r\nI get:\r\n[AttributeError at _process_processrun_execute_1114_1119_XL_.zip](https://github.com/PlantandFoodResearch/Kea/files/4084149/AttributeError.at._process_processrun_execute_1114_1119_XL_.zip)\r\nThis works on the staging instance.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/588",
          "labels": [
            "Process Handling",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Just a quick note.\r\nThe line that I clicked the XL icon for was the highlighted one. (and should be for you if you are running a similar DB)\r\nThe others appear to work.\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-01-20T02:25:46Z"
            },
            {
              "body": "Fixed!\r\n\r\n",
              "author": "rodrigo.otero",
              "created": "2020-01-21T14:52:07Z"
            },
            {
              "body": "First of all my apologies for not giving you the details required for this.\r\nIt is in the Onion crop, but it looks like you found it.\r\n\r\nFor these complex multi-step processes, as the user works their way down the process the step or steps that become the \"current\" step is highlighted light green.\r\n\r\nBecause a split is done on the samples, 2 steps become current because they can be done concurrently.\r\nYes you have fixed the problem I described but now that there are 2 current steps highlighted, neither of the new current Excel production buttons are working.\r\nThe \"pyruvate\" one is giving:\r\n[TypeError at _process_processrun_execute_1114_1120_XL_.zip](https://github.com/PlantandFoodResearch/Kea/files/4106561/TypeError.at._process_processrun_execute_1114_1120_XL_.zip)\r\n\r\nAnd the \"fructan\" one is giving:\r\n[AttributeError at _process_processrun_execute_1114_1121_XL_.zip](https://github.com/PlantandFoodResearch/Kea/files/4106562/AttributeError.at._process_processrun_execute_1114_1121_XL_.zip)\r\n\r\nAgain, my apologies for not being very comprehensive with my description.\r\nAnd if you need help understanding what is going on with this interface please feel free to ask.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-01-24T02:20:06Z"
            },
            {
              "body": "I have added a description of the multi-step processes to that wiki page [here](https://github.com/PlantandFoodResearch/Kea/wiki/Process-Decriptions)",
              "author": "zane.gilmore",
              "created": "2020-01-24T03:00:40Z"
            },
            {
              "body": "Hi Zane\r\nI've fixed the second one.\r\n\r\nHowever the first error is produced because the parent SampleExtractProcess of the highlighted one has no nothing on its \"Data\" attribute. Is this a bug or is it possible to create a process without data?\r\n\r\n\r\n\r\n![sample_extract_process](https://user-images.githubusercontent.com/5288675/73137806-e1df2580-403a-11ea-8e27-fbbafae94790.png)\r\n\r\n![sample_extract_process2](https://user-images.githubusercontent.com/5288675/73137807-e1df2580-403a-11ea-9b87-4a06e3772593.png)\r\n\r\n\r\n\r\n\r\n\r\n",
              "author": "rodrigo.otero",
              "created": "2020-01-26T15:56:39Z"
            },
            {
              "body": "Let's call sample[extract]process SEP it is one of the 2 many to many relations between sample ad ProcessRun. They hold the actual data as JSON that is defined by the \"DataDefinition\" JSON field in the Process column.\r\n\r\nWhen the ProcessRun is initially set up the SEP has no data.\r\nThe data field is only populated when the spreadsheet is created.\r\nAnd even then it is empty (I think it is \"{}\" )\r\nOnly when the spreadsheet is uploaded is there actual JSON data in the field.\r\n\r\nThose getDataDict method calls should return None if there is no data for the sample[extract]process. \r\nYour question \"is it possible to create a process without data?\" \r\nThe short answer is no for **Processes**. But a **ProcessRun** _can_ have no data.\r\nProcessRuns have no data when they are created.\r\n\r\nAfter a quick rummage around it looks like extraneous SEPs are being produced when the user clicks on the Excel icon. If there is already data in the ProcessRun then a new spreadsheet should just be produced from the data without producing new SEPs. \r\n",
              "author": "zane.gilmore",
              "created": "2020-01-26T21:23:18Z"
            },
            {
              "body": "OK.\r\nAfter a lot of rummaging around and setting pdb break points etc...\r\n\r\nIt appears that during our testing and debugging, a bunch of bad SEP rows were produced.\r\nMaybe my transaction management is not so good or something similar but those bad SEP rows seem to have have been causing those problems.\r\n\r\nAfter testing that Process against other ProcessRuns that were not involved with the original bugs, it looks like we are sweet :-)\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-01-27T02:38:31Z"
            }
          ]
        },
        {
          "summary": "SampleExtract Processes API Endpoints",
          "key": "KEA-589",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "There appears to be a hole in the API where getting access to data in SampleExtract processes is non-existent.\r\n\r\nNot for you William et al",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/589",
          "labels": [
            "API",
            "Process Handling"
          ],
          "comments": []
        },
        {
          "summary": "EBrida import producing plates with one sample each",
          "key": "KEA-590",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "For the eBrida sample initialisation\r\n\"Sample Initialisation->Initialise eBrida\"\r\n\r\nIn the spreadsheet and the plate, there is only one sample assigned at the starting point of each plate.\r\nThis means that for a 150 entry eBrida spreadsheet with a plate set size of 2. \r\n300 plates are produced with only the first well populated.\r\n\r\nIt all works though and no errors were produced.\r\n\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/590",
          "labels": [
            "EBrida_interface",
            "Python3_upgrade",
            "Sample Init"
          ],
          "comments": [
            {
              "body": "We'll need some more details on this one",
              "author": "will.buick",
              "created": "2020-01-24T01:45:24Z"
            },
            {
              "body": "Yes just looked at it with a different upload data file and got a different result.\r\nUsing the file I uploaded for #586 it worked perfectly.\r\n\r\nHowever for this file:\r\n[truncated_kea_init_KKBatch1.zip](https://github.com/PlantandFoodResearch/Kea/files/4106500/truncated_kea_init_KKBatch1.zip)\r\n\r\nIt produced the weird one sample per plate problem.\r\nThe trouble is that this might be a feature :-(\r\nSo forget it for now.\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-01-24T01:53:09Z"
            }
          ]
        },
        {
          "summary": "Syntax error on Sample Extract plates",
          "key": "KEA-591",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "On \"View Data->Extract Plates\"\r\nam getting:\r\n[ProgrammingError at _samples_search_extract-plates_.zip](https://github.com/PlantandFoodResearch/Kea/files/4106465/ProgrammingError.at._samples_search_extract-plates_.zip)\r\nThis is fairly consistent. And has happened recently. This was working before.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/591",
          "labels": [
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "@zanejg please test again and let us know if it works now",
              "created": "2020-01-25T19:25:03Z"
            },
            {
              "body": "Looks ok now",
              "author": "zane.gilmore",
              "created": "2020-01-28T00:48:14Z"
            }
          ]
        },
        {
          "summary": "Need space stripping on DB Entities in Process spreadsheet uploads",
          "key": "KEA-592",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "(not for Py3 upgrade)\r\nKatrina Monaghan had problems with appending a space char on a Location when uploading a process spreadsheet.\r\n\r\nThere needs to be some space stripping to ensure this does not happen.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/592",
          "labels": [
            "Process Handling",
            "UI Issue"
          ],
          "comments": []
        },
        {
          "summary": "API Swagger page gives attribute error",
          "key": "KEA-593",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "When I point my browser at /api/docs/\r\nAll I get is:\r\n[API_att_error.txt](https://github.com/PlantandFoodResearch/Kea/files/4115487/API_att_error.txt)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/593",
          "labels": [
            "API",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "Fixed!",
              "author": "rodrigo.otero",
              "created": "2020-01-29T14:56:35Z"
            },
            {
              "body": "looks OK",
              "author": "zane.gilmore",
              "created": "2020-01-30T01:37:50Z"
            }
          ]
        },
        {
          "summary": "Authentication to LDAPS",
          "key": "KEA-594",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "I need to get our Active Directory authentication moved over to LDAPS.\r\nAnd I am being hassled bythe infrastructure team to do it.\r\n\r\nNOT for Python 3 upgrade.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/594",
          "labels": [
            "Requirement",
            "enhancement"
          ],
          "comments": []
        },
        {
          "summary": "bad page formatting on admin",
          "key": "KEA-595",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "After rolling out to staging...\r\n![bad_snap01](https://user-images.githubusercontent.com/828578/74300766-b9368a00-4db5-11ea-8360-c2c88fedab08.png)\r\nAnd it should look like this:\r\n![good_snap01](https://user-images.githubusercontent.com/828578/74300783-c6ec0f80-4db5-11ea-9e99-5bab8a269032.png)\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/595",
          "labels": [
            "Python3_upgrade",
            "UI Issue"
          ],
          "comments": [
            {
              "body": "But obvously with the test stamp on the logo",
              "author": "zane.gilmore",
              "created": "2020-02-12T03:37:31Z"
            },
            {
              "body": "Did you run the collectstatic command?",
              "author": "will.buick",
              "created": "2020-02-12T03:39:46Z"
            },
            {
              "body": "The last 3 lines of the staging.env file:\r\n#Entrypoint settings\r\nMIGRATE=on\r\nCOLLECTSTATIC=on\r\n",
              "author": "zane.gilmore",
              "created": "2020-02-12T20:06:13Z"
            },
            {
              "body": "I assume this looks correct on your local?",
              "author": "will.buick",
              "created": "2020-02-12T20:12:59Z"
            },
            {
              "body": "Yes it does.",
              "author": "zane.gilmore",
              "created": "2020-02-13T02:17:44Z"
            },
            {
              "body": "Ok, I'll need to see if I can replicate locally.",
              "author": "will.buick",
              "created": "2020-02-13T03:39:50Z"
            },
            {
              "body": "Ummm... ahem :-)\r\nI did a ctrl F5 and it fixed it\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-02-13T20:17:48Z"
            }
          ]
        },
        {
          "summary": "SQL error on renaming LocalIDField",
          "key": "KEA-596",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I am trying to change a provenance table set and have hit a problem with a particular change.\r\nWhen I try to rename a column of type LocalIDField, the Django migration crashes and burns.\r\n\r\nI will send a copy of a recent staging DB dump and the new models.py file.\r\nNot absolutely sure of whether this is a Py3 migration probelm but would appreciate help nonetheless.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/596",
          "labels": [
            "Provenance",
            "Python3_upgrade"
          ],
          "comments": [
            {
              "body": "On second thought I have created a branch called issue596\r\n\r\n\r\n",
              "author": "zane.gilmore",
              "created": "2020-04-07T00:00:08Z"
            },
            {
              "body": "I found the bug,\r\n\r\nWorking on it.",
              "author": "rodrigo.otero",
              "created": "2020-04-07T18:48:43Z"
            },
            {
              "body": "Fix deployed to branch \"py3\"",
              "author": "rodrigo.otero",
              "created": "2020-04-14T19:32:41Z"
            },
            {
              "body": "fixed",
              "author": "zane.gilmore",
              "created": "2020-07-03T03:41:20Z"
            }
          ]
        },
        {
          "summary": "relation entry in path array wrong by one",
          "key": "KEA-597",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "For each of the samples you have a \"path\" array.\r\nThe attribute \"relation\" is listed as the name of the table in the previous path entry and the first entry is empty.\r\n\r\nI don't know whether it is by design but if it is it is confusing. It needs to be the name of the current relation/table/model.\r\n\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/597",
          "labels": [
            "API",
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "It should be the name of the foreign key field that links to the previous object in the chain.",
              "author": "will.buick",
              "created": "2020-08-03T04:09:12Z"
            },
            {
              "body": "Yeah.\r\nNot good. It should be the name of the actual current object.\r\nThe way it is is just confusing.\r\n\r\nBTW also getting the impression that providing the speciment to the endpoint would simplify things a whole lot and probably speed things up.\r\n",
              "author": "zane.gilmore",
              "created": "2020-08-03T04:17:08Z"
            },
            {
              "body": "I take it back. It is potentially useful to have the foreign-key name in that list.\r\nHowever it should not be called  \"relation\".\r\nIn the DB world relation is another name for a table/model.\r\nIt needs to be renamed \"foreign-key\" or similar.\r\n",
              "author": "zane.gilmore",
              "created": "2020-08-03T21:32:19Z"
            },
            {
              "body": "Hi Zane,\r\n\r\nI just called but got your voicemail. Give me a ring sometime this afternoon and we can discuss in detail.",
              "author": "will.buick",
              "created": "2020-08-04T02:08:09Z"
            }
          ]
        },
        {
          "summary": "view-schema incompatibility error on start up",
          "key": "KEA-598",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "I'mgetting this on start up:\r\n\r\n/```\r\nhome/zane/programming/virtenv/kea_py3/lib/python3.7/site-packages/django_filters/rest_framework/backends.py:128: UserWarning: <class 'kea.api.views.crop.CropViewSet'> is not compatible with schema generation\r\n  \"{} is not compatible with schema generation\".format(view.__class__)\r\n/home/zane/programming/virtenv/kea_py3/lib/python3.7/site-packages/django_filters/rest_framework/backends.py:128: UserWarning: <class 'kea.api.views.provenance.ProvenanceViewSet'> is not compatible with schema generation\r\n  \"{} is not compatible with schema generation\".format(view.__class__)\r\n```\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/598",
          "labels": [],
          "comments": []
        },
        {
          "summary": "Provenance model lookup not working with LocalIDs",
          "key": "KEA-599",
          "status": "To Do",
          "reporter": "zane.gilmore",
          "description": "It appears that any call to the:\r\n/provenance窶/{provenance_id}窶/model窶/{provenance_model_id}窶/\r\nendpoint gives an the error:\r\nresolved field 'XXXXX' with 'exact' lookup to an unrecognized field type LocalIDField\r\n\r\nIt seems that there is nothing to handle look ups for LocaID field types.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/599",
          "labels": [],
          "comments": [
            {
              "body": "Fixed here https://github.com/PlantandFoodResearch/Kea/tree/provenance_localid_filter",
              "author": "will.buick",
              "created": "2020-08-27T01:45:43Z"
            },
            {
              "body": "https://github.com/PlantandFoodResearch/Kea/pull/600",
              "author": "will.buick",
              "created": "2020-08-27T02:10:02Z"
            }
          ]
        },
        {
          "summary": "\"no unique constraint\" error for provenance migration",
          "key": "KEA-601",
          "status": "Done",
          "reporter": "zane.gilmore",
          "description": "I'm getting:\r\n`django.db.utils.ProgrammingError: there is no unique constraint matching given keys for referenced table \"solanaceae_lnc_rna_plant\"`\r\n\r\nAfter adding a couple of tables to the solanaceae_lnc_rna provenance.\r\nI am also making one of them a new specimen-type.\r\nI will push the salient code shortly.\r\nAnd send an appropriate DB dump.\r\n",
          "externalId": "https://github.com/PlantandFoodResearch/Kea/issues/601",
          "labels": [
            "Provenance",
            "bug"
          ],
          "comments": [
            {
              "body": "Thanks for your help diagnosing that William.\r\nWill close this now.\r\nNB It turned out that the DB was corrupted somehow and had no constraints.\r\nA fresh DB dump from live fixed it\r\n",
              "author": "zane.gilmore",
              "created": "2020-09-17T04:39:17Z"
            }
          ]
        }
      ]
    }
  ]
}